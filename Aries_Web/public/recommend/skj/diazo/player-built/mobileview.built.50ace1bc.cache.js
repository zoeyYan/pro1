var _gsScope=typeof module!="undefined"&&module.exports&&typeof global!="undefined"?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";_gsScope._gsDefine("TweenMax",["core.Animation","core.SimpleTimeline","TweenLite"],function(e,t,n){var r=function(e){var t=[],n=e.length,r;for(r=0;r!==n;t.push(e[r++]));return t},i=function(e,t,r){n.call(this,e,t,r),this._cycle=0,this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._dirty=!0,this.render=i.prototype.render},s=1e-10,o=n._internals,u=o.isSelector,a=o.isArray,f=i.prototype=n.to({},.1,{}),l=[];i.version="1.13.2",f.constructor=i,f.kill()._gc=!1,i.killTweensOf=i.killDelayedCallsTo=n.killTweensOf,i.getTweensOf=n.getTweensOf,i.lagSmoothing=n.lagSmoothing,i.ticker=n.ticker,i.render=n.render,f.invalidate=function(){return this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),n.prototype.invalidate.call(this)},f.updateTo=function(e,t){var r=this.ratio,i;t&&this._startTime<this._timeline._time&&(this._startTime=this._timeline._time,this._uncache(!1),this._gc?this._enabled(!0,!1):this._timeline.insert(this,this._startTime-this._delay));for(i in e)this.vars[i]=e[i];if(this._initted)if(t)this._initted=!1;else{this._gc&&this._enabled(!0,!1),this._notifyPluginsOfEnabled&&this._firstPT&&n._onPluginEvent("_onDisable",this);if(this._time/this._duration>.998){var s=this._time;this.render(0,!0,!1),this._initted=!1,this.render(s,!0,!1)}else if(this._time>0){this._initted=!1,this._init();var o=1/(1-r),u=this._firstPT,a;while(u)a=u.s+u.c,u.c*=o,u.s=a-u.c,u=u._next}}return this},f.render=function(e,t,n){this._initted||this._duration===0&&this.vars.repeat&&this.invalidate();var r=this._dirty?this.totalDuration():this._totalDuration,i=this._time,u=this._totalTime,a=this._cycle,f=this._duration,c=this._rawPrevTime,h,p,d,v,m,g,y,b,w;if(e>=r)this._totalTime=r,this._cycle=this._repeat,this._yoyo&&(this._cycle&1)!==0?(this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0):(this._time=f,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1),this._reversed||(h=!0,p="onComplete"),f===0&&(this._initted||!this.vars.lazy||n)&&(this._startTime===this._timeline._duration&&(e=0),(e===0||c<0||c===s)&&c!==e&&(n=!0,c>s&&(p="onReverseComplete")),this._rawPrevTime=b=!t||e||c===e?e:s);else if(e<1e-7){this._totalTime=this._time=this._cycle=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0;if(u!==0||f===0&&c>0&&c!==s)p="onReverseComplete",h=this._reversed;e<0&&(this._active=!1,f===0&&(this._initted||!this.vars.lazy||n)&&(c>=0&&(n=!0),this._rawPrevTime=b=!t||e||c===e?e:s)),this._initted||(n=!0)}else{this._totalTime=this._time=e,this._repeat!==0&&(v=f+this._repeatDelay,this._cycle=this._totalTime/v>>0,this._cycle!==0&&this._cycle===this._totalTime/v&&this._cycle--,this._time=this._totalTime-this._cycle*v,this._yoyo&&(this._cycle&1)!==0&&(this._time=f-this._time),this._time>f?this._time=f:this._time<0&&(this._time=0));if(this._easeType){m=this._time/f,g=this._easeType,y=this._easePower;if(g===1||g===3&&m>=.5)m=1-m;g===3&&(m*=2),y===1?m*=m:y===2?m*=m*m:y===3?m*=m*m*m:y===4&&(m*=m*m*m*m),g===1?this.ratio=1-m:g===2?this.ratio=m:this._time/f<.5?this.ratio=m/2:this.ratio=1-m/2}else this.ratio=this._ease.getRatio(this._time/f)}if(i===this._time&&!n&&a===this._cycle){u!==this._totalTime&&this._onUpdate&&(t||this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||l));return}if(!this._initted){this._init();if(!this._initted||this._gc)return;if(!n&&this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration)){this._time=i,this._totalTime=u,this._rawPrevTime=c,this._cycle=a,o.lazyTweens.push(this),this._lazy=[e,t];return}this._time&&!h?this.ratio=this._ease.getRatio(this._time/f):h&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(this._time===0?0:1))}this._lazy!==!1&&(this._lazy=!1),this._active||!this._paused&&this._time!==i&&e>=0&&(this._active=!0),u===0&&(this._initted===2&&e>0&&this._init(),this._startAt&&(e>=0?this._startAt.render(e,t,n):p||(p="_dummyGS")),this.vars.onStart&&(this._totalTime!==0||f===0)&&(t||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||l))),d=this._firstPT;while(d)d.f?d.t[d.p](d.c*this.ratio+d.s):d.t[d.p]=d.c*this.ratio+d.s,d=d._next;this._onUpdate&&(e<0&&this._startAt&&this._startTime&&this._startAt.render(e,t,n),t||(this._totalTime!==u||h)&&this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||l)),this._cycle!==a&&(t||this._gc||this.vars.onRepeat&&this.vars.onRepeat.apply(this.vars.onRepeatScope||this,this.vars.onRepeatParams||l)),p&&(!this._gc||n)&&(e<0&&this._startAt&&!this._onUpdate&&this._startTime&&this._startAt.render(e,t,n),h&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!t&&this.vars[p]&&this.vars[p].apply(this.vars[p+"Scope"]||this,this.vars[p+"Params"]||l),f===0&&this._rawPrevTime===s&&b!==s&&(this._rawPrevTime=0))},i.to=function(e,t,n){return new i(e,t,n)},i.from=function(e,t,n){return n.runBackwards=!0,n.immediateRender=n.immediateRender!=0,new i(e,t,n)},i.fromTo=function(e,t,n,r){return r.startAt=n,r.immediateRender=r.immediateRender!=0&&n.immediateRender!=0,new i(e,t,r)},i.staggerTo=i.allTo=function(e,t,s,o,f,c,h){o=o||0;var p=s.delay||0,d=[],v=function(){s.onComplete&&s.onComplete.apply(s.onCompleteScope||this,arguments),f.apply(h||this,c||l)},m,g,y,b;a(e)||(typeof e=="string"&&(e=n.selector(e)||e),u(e)&&(e=r(e))),m=e.length;for(y=0;y<m;y++){g={};for(b in s)g[b]=s[b];g.delay=p,y===m-1&&f&&(g.onComplete=v),d[y]=new i(e[y],t,g),p+=o}return d},i.staggerFrom=i.allFrom=function(e,t,n,r,s,o,u){return n.runBackwards=!0,n.immediateRender=n.immediateRender!=0,i.staggerTo(e,t,n,r,s,o,u)},i.staggerFromTo=i.allFromTo=function(e,t,n,r,s,o,u,a){return r.startAt=n,r.immediateRender=r.immediateRender!=0&&n.immediateRender!=0,i.staggerTo(e,t,r,s,o,u,a)},i.delayedCall=function(e,t,n,r,s){return new i(t,0,{delay:e,onComplete:t,onCompleteParams:n,onCompleteScope:r,onReverseComplete:t,onReverseCompleteParams:n,onReverseCompleteScope:r,immediateRender:!1,useFrames:s,overwrite:0})},i.set=function(e,t){return new i(e,0,t)},i.isTweening=function(e){return n.getTweensOf(e,!0).length>0};var c=function(e,t){var r=[],i=0,s=e._first;while(s)s instanceof n?r[i++]=s:(t&&(r[i++]=s),r=r.concat(c(s,t)),i=r.length),s=s._next;return r},h=i.getAllTweens=function(t){return c(e._rootTimeline,t).concat(c(e._rootFramesTimeline,t))};i.killAll=function(e,n,r,i){n==null&&(n=!0),r==null&&(r=!0);var s=h(i!=0),o=s.length,u=n&&r&&i,a,f,l;for(l=0;l<o;l++){f=s[l];if(u||f instanceof t||(a=f.target===f.vars.onComplete)&&r||n&&!a)e?f.totalTime(f._reversed?0:f.totalDuration()):f._enabled(!1,!1)}},i.killChildTweensOf=function(e,t){if(e==null)return;var s=o.tweenLookup,f,l,c,h,p;typeof e=="string"&&(e=n.selector(e)||e),u(e)&&(e=r(e));if(a(e)){h=e.length;while(--h>-1)i.killChildTweensOf(e[h],t);return}f=[];for(c in s){l=s[c].target.parentNode;while(l)l===e&&(f=f.concat(s[c].tweens)),l=l.parentNode}p=f.length;for(h=0;h<p;h++)t&&f[h].totalTime(f[h].totalDuration()),f[h]._enabled(!1,!1)};var p=function(e,n,r,i){n=n!==!1,r=r!==!1,i=i!==!1;var s=h(i),o=n&&r&&i,u=s.length,a,f;while(--u>-1)f=s[u],(o||f instanceof t||(a=f.target===f.vars.onComplete)&&r||n&&!a)&&f.paused(e)};return i.pauseAll=function(e,t,n){p(!0,e,t,n)},i.resumeAll=function(e,t,n){p(!1,e,t,n)},i.globalTimeScale=function(t){var r=e._rootTimeline,i=n.ticker.time;return arguments.length?(t=t||s,r._startTime=i-(i-r._startTime)*r._timeScale/t,r=e._rootFramesTimeline,i=n.ticker.frame,r._startTime=i-(i-r._startTime)*r._timeScale/t,r._timeScale=e._rootTimeline._timeScale=t,t):r._timeScale},f.progress=function(e){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&(this._cycle&1)!==0?1-e:e)+this._cycle*(this._duration+this._repeatDelay),!1):this._time/this.duration()},f.totalProgress=function(e){return arguments.length?this.totalTime(this.totalDuration()*e,!1):this._totalTime/this.totalDuration()},f.time=function(e,t){return arguments.length?(this._dirty&&this.totalDuration(),e>this._duration&&(e=this._duration),this._yoyo&&(this._cycle&1)!==0?e=this._duration-e+this._cycle*(this._duration+this._repeatDelay):this._repeat!==0&&(e+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(e,t)):this._time},f.duration=function(t){return arguments.length?e.prototype.duration.call(this,t):this._duration},f.totalDuration=function(e){return arguments.length?this._repeat===-1?this:this.duration((e-this._repeat*this._repeatDelay)/(this._repeat+1)):(this._dirty&&(this._totalDuration=this._repeat===-1?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat,this._dirty=!1),this._totalDuration)},f.repeat=function(e){return arguments.length?(this._repeat=e,this._uncache(!0)):this._repeat},f.repeatDelay=function(e){return arguments.length?(this._repeatDelay=e,this._uncache(!0)):this._repeatDelay},f.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},i},!0),_gsScope._gsDefine("TimelineLite",["core.Animation","core.SimpleTimeline","TweenLite"],function(e,t,n){var r=function(e){t.call(this,e),this._labels={},this.autoRemoveChildren=this.vars.autoRemoveChildren===!0,this.smoothChildTiming=this.vars.smoothChildTiming===!0,this._sortChildren=!0,this._onUpdate=this.vars.onUpdate;var n=this.vars,r,i;for(i in n)r=n[i],u(r)&&r.join("").indexOf("{self}")!==-1&&(n[i]=this._swapSelfInParams(r));u(n.tweens)&&this.add(n.tweens,0,n.align,n.stagger)},i=1e-10,s=n._internals,o=s.isSelector,u=s.isArray,a=s.lazyTweens,f=s.lazyRender,l=[],c=_gsScope._gsDefine.globals,h=function(e){var t={},n;for(n in e)t[n]=e[n];return t},p=function(e,t,n,r){var i=e._timeline._totalTime;if(t||!this._forcingPlayhead)e._timeline.pause(e._startTime),t&&t.apply(r||e._timeline,n||l),this._forcingPlayhead&&e._timeline.seek(i)},d=function(e){var t=[],n=e.length,r;for(r=0;r!==n;t.push(e[r++]));return t},v=r.prototype=new t;return r.version="1.13.2",v.constructor=r,v.kill()._gc=v._forcingPlayhead=!1,v.to=function(e,t,r,i){var s=r.repeat&&c.TweenMax||n;return t?this.add(new s(e,t,r),i):this.set(e,r,i)},v.from=function(e,t,r,i){return this.add((r.repeat&&c.TweenMax||n).from(e,t,r),i)},v.fromTo=function(e,t,r,i,s){var o=i.repeat&&c.TweenMax||n;return t?this.add(o.fromTo(e,t,r,i),s):this.set(e,i,s)},v.staggerTo=function(e,t,i,s,u,a,f,l){var c=new r({onComplete:a,onCompleteParams:f,onCompleteScope:l,smoothChildTiming:this.smoothChildTiming}),p;typeof e=="string"&&(e=n.selector(e)||e),o(e)&&(e=d(e)),s=s||0;for(p=0;p<e.length;p++)i.startAt&&(i.startAt=h(i.startAt)),c.to(e[p],t,h(i),p*s);return this.add(c,u)},v.staggerFrom=function(e,t,n,r,i,s,o,u){return n.immediateRender=n.immediateRender!=0,n.runBackwards=!0,this.staggerTo(e,t,n,r,i,s,o,u)},v.staggerFromTo=function(e,t,n,r,i,s,o,u,a){return r.startAt=n,r.immediateRender=r.immediateRender!=0&&n.immediateRender!=0,this.staggerTo(e,t,r,i,s,o,u,a)},v.call=function(e,t,r,i){return this.add(n.delayedCall(0,e,t,r),i)},v.set=function(e,t,r){return r=this._parseTimeOrLabel(r,0,!0),t.immediateRender==null&&(t.immediateRender=r===this._time&&!this._paused),this.add(new n(e,0,t),r)},r.exportRoot=function(e,t){e=e||{},e.smoothChildTiming==null&&(e.smoothChildTiming=!0);var i=new r(e),s=i._timeline,o,u;t==null&&(t=!0),s._remove(i,!0),i._startTime=0,i._rawPrevTime=i._time=i._totalTime=s._time,o=s._first;while(o)u=o._next,(!t||!(o instanceof n&&o.target===o.vars.onComplete))&&i.add(o,o._startTime-o._delay),o=u;return s.add(i,0),i},v.add=function(i,s,o,a){var f,l,c,h,p,d;typeof s!="number"&&(s=this._parseTimeOrLabel(s,0,!0,i));if(!(i instanceof e)){if(i instanceof Array||i&&i.push&&u(i)){o=o||"normal",a=a||0,f=s,l=i.length;for(c=0;c<l;c++)u(h=i[c])&&(h=new r({tweens:h})),this.add(h,f),typeof h!="string"&&typeof h!="function"&&(o==="sequence"?f=h._startTime+h.totalDuration()/h._timeScale:o==="start"&&(h._startTime-=h.delay())),f+=a;return this._uncache(!0)}if(typeof i=="string")return this.addLabel(i,s);if(typeof i!="function")throw"Cannot add "+i+" into the timeline; it is not a tween, timeline, function, or string.";i=n.delayedCall(0,i)}t.prototype.add.call(this,i,s);if(this._gc||this._time===this._duration)if(!this._paused&&this._duration<this.duration()){p=this,d=p.rawTime()>i._startTime;while(p._timeline)d&&p._timeline.smoothChildTiming?p.totalTime(p._totalTime,!0):p._gc&&p._enabled(!0,!1),p=p._timeline}return this},v.remove=function(t){if(t instanceof e)return this._remove(t,!1);if(t instanceof Array||t&&t.push&&u(t)){var n=t.length;while(--n>-1)this.remove(t[n]);return this}return typeof t=="string"?this.removeLabel(t):this.kill(null,t)},v._remove=function(e,n){t.prototype._remove.call(this,e,n);var r=this._last;return r?this._time>r._startTime+r._totalDuration/r._timeScale&&(this._time=this.duration(),this._totalTime=this._totalDuration):this._time=this._totalTime=this._duration=this._totalDuration=0,this},v.append=function(e,t){return this.add(e,this._parseTimeOrLabel(null,t,!0,e))},v.insert=v.insertMultiple=function(e,t,n,r){return this.add(e,t||0,n,r)},v.appendMultiple=function(e,t,n,r){return this.add(e,this._parseTimeOrLabel(null,t,!0,e),n,r)},v.addLabel=function(e,t){return this._labels[e]=this._parseTimeOrLabel(t),this},v.addPause=function(e,t,n,r){return this.call(p,["{self}",t,n,r],this,e)},v.removeLabel=function(e){return delete this._labels[e],this},v.getLabelTime=function(e){return this._labels[e]!=null?this._labels[e]:-1},v._parseTimeOrLabel=function(t,n,r,i){var s;if(i instanceof e&&i.timeline===this)this.remove(i);else if(i&&(i instanceof Array||i.push&&u(i))){s=i.length;while(--s>-1)i[s]instanceof e&&i[s].timeline===this&&this.remove(i[s])}if(typeof n=="string")return this._parseTimeOrLabel(n,r&&typeof t=="number"&&this._labels[n]==null?t-this.duration():0,r);n=n||0;if(typeof t!="string"||!isNaN(t)&&this._labels[t]==null)t==null&&(t=this.duration());else{s=t.indexOf("=");if(s===-1)return this._labels[t]==null?r?this._labels[t]=this.duration()+n:n:this._labels[t]+n;n=parseInt(t.charAt(s-1)+"1",10)*Number(t.substr(s+1)),t=s>1?this._parseTimeOrLabel(t.substr(0,s-1),0,r):this.duration()}return Number(t)+n},v.seek=function(e,t){return this.totalTime(typeof e=="number"?e:this._parseTimeOrLabel(e),t!==!1)},v.stop=function(){return this.paused(!0)},v.gotoAndPlay=function(e,t){return this.play(e,t)},v.gotoAndStop=function(e,t){return this.pause(e,t)},v.render=function(e,t,n){this._gc&&this._enabled(!0,!1);var r=this._dirty?this.totalDuration():this._totalDuration,s=this._time,o=this._startTime,u=this._timeScale,c=this._paused,h,p,d,v,m;if(e>=r)this._totalTime=this._time=r,this._reversed||this._hasPausedChild()||(p=!0,v="onComplete",this._duration===0&&(e===0||this._rawPrevTime<0||this._rawPrevTime===i)&&this._rawPrevTime!==e&&this._first&&(m=!0,this._rawPrevTime>i&&(v="onReverseComplete"))),this._rawPrevTime=this._duration||!t||e||this._rawPrevTime===e?e:i,e=r+1e-4;else if(e<1e-7){this._totalTime=this._time=0;if(s!==0||this._duration===0&&this._rawPrevTime!==i&&(this._rawPrevTime>0||e<0&&this._rawPrevTime>=0))v="onReverseComplete",p=this._reversed;e<0?(this._active=!1,this._rawPrevTime>=0&&this._first&&(m=!0),this._rawPrevTime=e):(this._rawPrevTime=this._duration||!t||e||this._rawPrevTime===e?e:i,e=0,this._initted||(m=!0))}else this._totalTime=this._time=this._rawPrevTime=e;if((this._time===s||!this._first)&&!n&&!m)return;this._initted||(this._initted=!0),this._active||!this._paused&&this._time!==s&&e>0&&(this._active=!0),s===0&&this.vars.onStart&&this._time!==0&&(t||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||l));if(this._time>=s){h=this._first;while(h){d=h._next;if(this._paused&&!c)break;if(h._active||h._startTime<=this._time&&!h._paused&&!h._gc)h._reversed?h.render((h._dirty?h.totalDuration():h._totalDuration)-(e-h._startTime)*h._timeScale,t,n):h.render((e-h._startTime)*h._timeScale,t,n);h=d}}else{h=this._last;while(h){d=h._prev;if(this._paused&&!c)break;if(h._active||h._startTime<=s&&!h._paused&&!h._gc)h._reversed?h.render((h._dirty?h.totalDuration():h._totalDuration)-(e-h._startTime)*h._timeScale,t,n):h.render((e-h._startTime)*h._timeScale,t,n);h=d}}this._onUpdate&&(t||(a.length&&f(),this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||l))),v&&!this._gc&&(o===this._startTime||u!==this._timeScale)&&(this._time===0||r>=this.totalDuration())&&(p&&(a.length&&f(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!t&&this.vars[v]&&this.vars[v].apply(this.vars[v+"Scope"]||this,this.vars[v+"Params"]||l))},v._hasPausedChild=function(){var e=this._first;while(e){if(e._paused||e instanceof r&&e._hasPausedChild())return!0;e=e._next}return!1},v.getChildren=function(e,t,r,i){i=i||-9999999999;var s=[],o=this._first,u=0;while(o)o._startTime<i||(o instanceof n?t!==!1&&(s[u++]=o):(r!==!1&&(s[u++]=o),e!==!1&&(s=s.concat(o.getChildren(!0,t,r)),u=s.length))),o=o._next;return s},v.getTweensOf=function(e,t){var r=this._gc,i=[],s=0,o,u;r&&this._enabled(!0,!0),o=n.getTweensOf(e),u=o.length;while(--u>-1)if(o[u].timeline===this||t&&this._contains(o[u]))i[s++]=o[u];return r&&this._enabled(!1,!0),i},v._contains=function(e){var t=e.timeline;while(t){if(t===this)return!0;t=t.timeline}return!1},v.shiftChildren=function(e,t,n){n=n||0;var r=this._first,i=this._labels,s;while(r)r._startTime>=n&&(r._startTime+=e),r=r._next;if(t)for(s in i)i[s]>=n&&(i[s]+=e);return this._uncache(!0)},v._kill=function(e,t){if(!e&&!t)return this._enabled(!1,!1);var n=t?this.getTweensOf(t):this.getChildren(!0,!0,!1),r=n.length,i=!1;while(--r>-1)n[r]._kill(e,t)&&(i=!0);return i},v.clear=function(e){var t=this.getChildren(!1,!0,!0),n=t.length;this._time=this._totalTime=0;while(--n>-1)t[n]._enabled(!1,!1);return e!==!1&&(this._labels={}),this._uncache(!0)},v.invalidate=function(){var t=this._first;while(t)t.invalidate(),t=t._next;return e.prototype.invalidate.call(this)},v._enabled=function(e,n){if(e===this._gc){var r=this._first;while(r)r._enabled(e,!0),r=r._next}return t.prototype._enabled.call(this,e,n)},v.totalTime=function(t,n,r){this._forcingPlayhead=!0;var i=e.prototype.totalTime.apply(this,arguments);return this._forcingPlayhead=!1,i},v.duration=function(e){return arguments.length?(this.duration()!==0&&e!==0&&this.timeScale(this._duration/e),this):(this._dirty&&this.totalDuration(),this._duration)},v.totalDuration=function(e){if(!arguments.length){if(this._dirty){var t=0,n=this._last,r=999999999999,i,s;while(n)i=n._prev,n._dirty&&n.totalDuration(),n._startTime>r&&this._sortChildren&&!n._paused?this.add(n,n._startTime-n._delay):r=n._startTime,n._startTime<0&&!n._paused&&(t-=n._startTime,this._timeline.smoothChildTiming&&(this._startTime+=n._startTime/this._timeScale),this.shiftChildren(-n._startTime,!1,-9999999999),r=0),s=n._startTime+n._totalDuration/n._timeScale,s>t&&(t=s),n=i;this._duration=this._totalDuration=t,this._dirty=!1}return this._totalDuration}return this.totalDuration()!==0&&e!==0&&this.timeScale(this._totalDuration/e),this},v.usesFrames=function(){var t=this._timeline;while(t._timeline)t=t._timeline;return t===e._rootFramesTimeline},v.rawTime=function(){return this._paused?this._totalTime:(this._timeline.rawTime()-this._startTime)*this._timeScale},r},!0),_gsScope._gsDefine("TimelineMax",["TimelineLite","TweenLite","easing.Ease"],function(e,t,n){var r=function(t){e.call(this,t),this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._cycle=0,this._yoyo=this.vars.yoyo===!0,this._dirty=!0},i=1e-10,s=[],o=t._internals,u=o.lazyTweens,a=o.lazyRender,f=new n(null,null,1,0),l=r.prototype=new e;return l.constructor=r,l.kill()._gc=!1,r.version="1.13.2",l.invalidate=function(){return this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),e.prototype.invalidate.call(this)},l.addCallback=function(e,n,r,i){return this.add(t.delayedCall(0,e,r,i),n)},l.removeCallback=function(e,t){if(e)if(t==null)this._kill(null,e);else{var n=this.getTweensOf(e,!1),r=n.length,i=this._parseTimeOrLabel(t);while(--r>-1)n[r]._startTime===i&&n[r]._enabled(!1,!1)}return this},l.tweenTo=function(e,n){n=n||{};var r={ease:f,overwrite:n.delay?2:1,useFrames:this.usesFrames(),immediateRender:!1},i,o,u;for(o in n)r[o]=n[o];return r.time=this._parseTimeOrLabel(e),i=Math.abs(Number(r.time)-this._time)/this._timeScale||.001,u=new t(this,i,r),r.onStart=function(){u.target.paused(!0),u.vars.time!==u.target.time()&&i===u.duration()&&u.duration(Math.abs(u.vars.time-u.target.time())/u.target._timeScale),n.onStart&&n.onStart.apply(n.onStartScope||u,n.onStartParams||s)},u},l.tweenFromTo=function(e,t,n){n=n||{},e=this._parseTimeOrLabel(e),n.startAt={onComplete:this.seek,onCompleteParams:[e],onCompleteScope:this},n.immediateRender=n.immediateRender!==!1;var r=this.tweenTo(t,n);return r.duration(Math.abs(r.vars.time-e)/this._timeScale||.001)},l.render=function(e,t,n){this._gc&&this._enabled(!0,!1);var r=this._dirty?this.totalDuration():this._totalDuration,o=this._duration,f=this._time,l=this._totalTime,c=this._startTime,h=this._timeScale,p=this._rawPrevTime,d=this._paused,v=this._cycle,m,g,y,b,w,E;if(e>=r)this._locked||(this._totalTime=r,this._cycle=this._repeat),this._reversed||this._hasPausedChild()||(g=!0,b="onComplete",this._duration===0&&(e===0||p<0||p===i)&&p!==e&&this._first&&(w=!0,p>i&&(b="onReverseComplete"))),this._rawPrevTime=this._duration||!t||e||this._rawPrevTime===e?e:i,this._yoyo&&(this._cycle&1)!==0?this._time=e=0:(this._time=o,e=o+1e-4);else if(e<1e-7){this._locked||(this._totalTime=this._cycle=0),this._time=0;if(f!==0||o===0&&p!==i&&(p>0||e<0&&p>=0)&&!this._locked)b="onReverseComplete",g=this._reversed;e<0?(this._active=!1,p>=0&&this._first&&(w=!0),this._rawPrevTime=e):(this._rawPrevTime=o||!t||e||this._rawPrevTime===e?e:i,e=0,this._initted||(w=!0))}else o===0&&p<0&&(w=!0),this._time=this._rawPrevTime=e,this._locked||(this._totalTime=e,this._repeat!==0&&(E=o+this._repeatDelay,this._cycle=this._totalTime/E>>0,this._cycle!==0&&this._cycle===this._totalTime/E&&this._cycle--,this._time=this._totalTime-this._cycle*E,this._yoyo&&(this._cycle&1)!==0&&(this._time=o-this._time),this._time>o?(this._time=o,e=o+1e-4):this._time<0?this._time=e=0:e=this._time));if(this._cycle!==v&&!this._locked){var S=this._yoyo&&(v&1)!==0,x=S===(this._yoyo&&(this._cycle&1)!==0),T=this._totalTime,N=this._cycle,C=this._rawPrevTime,k=this._time;this._totalTime=v*o,this._cycle<v?S=!S:this._totalTime+=o,this._time=f,this._rawPrevTime=o===0?p-1e-4:p,this._cycle=v,this._locked=!0,f=S?0:o,this.render(f,t,o===0),t||this._gc||this.vars.onRepeat&&this.vars.onRepeat.apply(this.vars.onRepeatScope||this,this.vars.onRepeatParams||s),x&&(f=S?o+1e-4:-0.0001,this.render(f,!0,!1)),this._locked=!1;if(this._paused&&!d)return;this._time=k,this._totalTime=T,this._cycle=N,this._rawPrevTime=C}if((this._time===f||!this._first)&&!n&&!w){l!==this._totalTime&&this._onUpdate&&(t||this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||s));return}this._initted||(this._initted=!0),this._active||!this._paused&&this._totalTime!==l&&e>0&&(this._active=!0),l===0&&this.vars.onStart&&this._totalTime!==0&&(t||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||s));if(this._time>=f){m=this._first;while(m){y=m._next;if(this._paused&&!d)break;if(m._active||m._startTime<=this._time&&!m._paused&&!m._gc)m._reversed?m.render((m._dirty?m.totalDuration():m._totalDuration)-(e-m._startTime)*m._timeScale,t,n):m.render((e-m._startTime)*m._timeScale,t,n);m=y}}else{m=this._last;while(m){y=m._prev;if(this._paused&&!d)break;if(m._active||m._startTime<=f&&!m._paused&&!m._gc)m._reversed?m.render((m._dirty?m.totalDuration():m._totalDuration)-(e-m._startTime)*m._timeScale,t,n):m.render((e-m._startTime)*m._timeScale,t,n);m=y}}this._onUpdate&&(t||(u.length&&a(),this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||s))),b&&(this._locked||!this._gc&&(c===this._startTime||h!==this._timeScale)&&(this._time===0||r>=this.totalDuration())&&(g&&(u.length&&a(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!t&&this.vars[b]&&this.vars[b].apply(this.vars[b+"Scope"]||this,this.vars[b+"Params"]||s)))},l.getActive=function(e,t,n){e==null&&(e=!0),t==null&&(t=!0),n==null&&(n=!1);var r=[],i=this.getChildren(e,t,n),s=0,o=i.length,u,a;for(u=0;u<o;u++)a=i[u],a.isActive()&&(r[s++]=a);return r},l.getLabelAfter=function(e){e||e!==0&&(e=this._time);var t=this.getLabelsArray(),n=t.length,r;for(r=0;r<n;r++)if(t[r].time>e)return t[r].name;return null},l.getLabelBefore=function(e){e==null&&(e=this._time);var t=this.getLabelsArray(),n=t.length;while(--n>-1)if(t[n].time<e)return t[n].name;return null},l.getLabelsArray=function(){var e=[],t=0,n;for(n in this._labels)e[t++]={time:this._labels[n],name:n};return e.sort(function(e,t){return e.time-t.time}),e},l.progress=function(e,t){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&(this._cycle&1)!==0?1-e:e)+this._cycle*(this._duration+this._repeatDelay),t):this._time/this.duration()},l.totalProgress=function(e,t){return arguments.length?this.totalTime(this.totalDuration()*e,t):this._totalTime/this.totalDuration()},l.totalDuration=function(t){return arguments.length?this._repeat===-1?this:this.duration((t-this._repeat*this._repeatDelay)/(this._repeat+1)):(this._dirty&&(e.prototype.totalDuration.call(this),this._totalDuration=this._repeat===-1?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat),this._totalDuration)},l.time=function(e,t){return arguments.length?(this._dirty&&this.totalDuration(),e>this._duration&&(e=this._duration),this._yoyo&&(this._cycle&1)!==0?e=this._duration-e+this._cycle*(this._duration+this._repeatDelay):this._repeat!==0&&(e+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(e,t)):this._time},l.repeat=function(e){return arguments.length?(this._repeat=e,this._uncache(!0)):this._repeat},l.repeatDelay=function(e){return arguments.length?(this._repeatDelay=e,this._uncache(!0)):this._repeatDelay},l.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},l.currentLabel=function(e){return arguments.length?this.seek(e,!0):this.getLabelBefore(this._time+1e-8)},r},!0),function(){var e=180/Math.PI,t=[],n=[],r=[],i={},s=function(e,t,n,r){this.a=e,this.b=t,this.c=n,this.d=r,this.da=r-e,this.ca=n-e,this.ba=t-e},o=",x,y,z,left,top,right,bottom,marginTop,marginLeft,marginRight,marginBottom,paddingLeft,paddingTop,paddingRight,paddingBottom,backgroundPosition,backgroundPosition_y,",u=function(e,t,n,r){var i={a:e},s={},o={},u={c:r},a=(e+t)/2,f=(t+n)/2,l=(n+r)/2,c=(a+f)/2,h=(f+l)/2,p=(h-c)/8;return i.b=a+(e-a)/4,s.b=c+p,i.c=s.a=(i.b+s.b)/2,s.c=o.a=(c+h)/2,o.b=h-p,u.b=l+(r-l)/4,o.c=u.a=(o.b+u.b)/2,[i,s,o,u]},a=function(e,i,s,o,a){var f=e.length-1,l=0,c=e[0].a,h,p,d,v,m,g,y,b,w,E,S,x,T;for(h=0;h<f;h++)m=e[l],p=m.a,d=m.d,v=e[l+1].d,a?(S=t[h],x=n[h],T=(x+S)*i*.25/(o?.5:r[h]||.5),g=d-(d-p)*(o?i*.5:S!==0?T/S:0),y=d+(v-d)*(o?i*.5:x!==0?T/x:0),b=d-(g+((y-g)*(S*3/(S+x)+.5)/4||0))):(g=d-(d-p)*i*.5,y=d+(v-d)*i*.5,b=d-(g+y)/2),g+=b,y+=b,m.c=w=g,h!==0?m.b=c:m.b=c=m.a+(m.c-m.a)*.6,m.da=d-p,m.ca=w-p,m.ba=c-p,s?(E=u(p,c,w,d),e.splice(l,1,E[0],E[1],E[2],E[3]),l+=4):l++,c=y;m=e[l],m.b=c,m.c=c+(m.d-c)*.4,m.da=m.d-m.a,m.ca=m.c-m.a,m.ba=c-m.a,s&&(E=u(m.a,c,m.c,m.d),e.splice(l,1,E[0],E[1],E[2],E[3]))},f=function(e,r,i,o){var u=[],a,f,l,c,h,p;if(o){e=[o].concat(e),f=e.length;while(--f>-1)typeof (p=e[f][r])=="string"&&p.charAt(1)==="="&&(e[f][r]=o[r]+Number(p.charAt(0)+p.substr(2)))}a=e.length-2;if(a<0)return u[0]=new s(e[0][r],0,0,e[a<-1?0:1][r]),u;for(f=0;f<a;f++)l=e[f][r],c=e[f+1][r],u[f]=new s(l,0,0,c),i&&(h=e[f+2][r],t[f]=(t[f]||0)+(c-l)*(c-l),n[f]=(n[f]||0)+(h-c)*(h-c));return u[f]=new s(e[f][r],0,0,e[f+1][r]),u},l=function(e,s,u,l,c,h){var p={},d=[],v=h||e[0],m,g,y,b,w,E,S,x;c=typeof c=="string"?","+c+",":o,s==null&&(s=1);for(g in e[0])d.push(g);if(e.length>1){x=e[e.length-1],S=!0,m=d.length;while(--m>-1){g=d[m];if(Math.abs(v[g]-x[g])>.05){S=!1;break}}S&&(e=e.concat(),h&&e.unshift(h),e.push(e[1]),h=e[e.length-3])}t.length=n.length=r.length=0,m=d.length;while(--m>-1)g=d[m],i[g]=c.indexOf(","+g+",")!==-1,p[g]=f(e,g,i[g],h);m=t.length;while(--m>-1)t[m]=Math.sqrt(t[m]),n[m]=Math.sqrt(n[m]);if(!l){m=d.length;while(--m>-1)if(i[g]){y=p[d[m]],E=y.length-1;for(b=0;b<E;b++)w=y[b+1].da/n[b]+y[b].da/t[b],r[b]=(r[b]||0)+w*w}m=r.length;while(--m>-1)r[m]=Math.sqrt(r[m])}m=d.length,b=u?4:1;while(--m>-1)g=d[m],y=p[g],a(y,s,u,l,i[g]),S&&(y.splice(0,b),y.splice(y.length-b,b));return p},c=function(e,t,n){t=t||"soft";var r={},i=t==="cubic"?3:2,o=t==="soft",u=[],a,f,l,c,h,p,d,v,m,g,y;o&&n&&(e=[n].concat(e));if(e==null||e.length<i+1)throw"invalid Bezier data";for(m in e[0])u.push(m);p=u.length;while(--p>-1){m=u[p],r[m]=h=[],g=0,v=e.length;for(d=0;d<v;d++)a=n==null?e[d][m]:typeof (y=e[d][m])=="string"&&y.charAt(1)==="="?n[m]+Number(y.charAt(0)+y.substr(2)):Number(y),o&&d>1&&d<v-1&&(h[g++]=(a+h[g-2])/2),h[g++]=a;v=g-i+1,g=0;for(d=0;d<v;d+=i)a=h[d],f=h[d+1],l=h[d+2],c=i===2?0:h[d+3],h[g++]=y=i===3?new s(a,f,l,c):new s(a,(2*f+a)/3,(2*f+l)/3,l);h.length=g}return r},h=function(e,t,n){var r=1/n,i=e.length,s,o,u,a,f,l,c,h,p,d,v;while(--i>-1){d=e[i],u=d.a,a=d.d-u,f=d.c-u,l=d.b-u,s=o=0;for(h=1;h<=n;h++)c=r*h,p=1-c,s=o-(o=(c*c*a+3*p*(c*f+p*l))*c),v=i*n+h-1,t[v]=(t[v]||0)+s*s}},p=function(e,t){t=t>>0||6;var n=[],r=[],i=0,s=0,o=t-1,u=[],a=[],f,l,c,p;for(f in e)h(e[f],n,t);c=n.length;for(l=0;l<c;l++)i+=Math.sqrt(n[l]),p=l%t,a[p]=i,p===o&&(s+=i,p=l/t>>0,u[p]=a,r[p]=s,i=0,a=[]);return{length:s,lengths:r,segments:u}},d=_gsScope._gsDefine.plugin({propName:"bezier",priority:-1,version:"1.3.3",API:2,global:!0,init:function(e,t,n){this._target=e,t instanceof Array&&(t={values:t}),this._func={},this._round={},this._props=[],this._timeRes=t.timeResolution==null?6:parseInt(t.timeResolution,10);var r=t.values||[],i={},s=r[0],o=t.autoRotate||n.vars.orientToBezier,u,a,f,h,d;this._autoRotate=o?o instanceof Array?o:[["x","y","rotation",o===!0?0:Number(o)||0]]:null;for(u in s)this._props.push(u);f=this._props.length;while(--f>-1)u=this._props[f],this._overwriteProps.push(u),a=this._func[u]=typeof e[u]=="function",i[u]=a?e[u.indexOf("set")||typeof e["get"+u.substr(3)]!="function"?u:"get"+u.substr(3)]():parseFloat(e[u]),d||i[u]!==r[0][u]&&(d=i);this._beziers=t.type!=="cubic"&&t.type!=="quadratic"&&t.type!=="soft"?l(r,isNaN(t.curviness)?1:t.curviness,!1,t.type==="thruBasic",t.correlate,d):c(r,t.type,i),this._segCount=this._beziers[u].length;if(this._timeRes){var v=p(this._beziers,this._timeRes);this._length=v.length,this._lengths=v.lengths,this._segments=v.segments,this._l1=this._li=this._s1=this._si=0,this._l2=this._lengths[0],this._curSeg=this._segments[0],this._s2=this._curSeg[0],this._prec=1/this._curSeg.length}if(o=this._autoRotate){this._initialRotations=[],o[0]instanceof Array||(this._autoRotate=o=[o]),f=o.length;while(--f>-1){for(h=0;h<3;h++)u=o[f][h],this._func[u]=typeof e[u]=="function"?e[u.indexOf("set")||typeof e["get"+u.substr(3)]!="function"?u:"get"+u.substr(3)]:!1;u=o[f][2],this._initialRotations[f]=this._func[u]?this._func[u].call(this._target):this._target[u]}}return this._startRatio=n.vars.runBackwards?1:0,!0},set:function(t){var n=this._segCount,r=this._func,i=this._target,s=t!==this._startRatio,o,u,a,f,l,c,h,p,d,v;if(!this._timeRes)o=t<0?0:t>=1?n-1:n*t>>0,c=(t-o*(1/n))*n;else{d=this._lengths,v=this._curSeg,t*=this._length,a=this._li;if(t>this._l2&&a<n-1){p=n-1;while(a<p&&(this._l2=d[++a])<=t);this._l1=d[a-1],this._li=a,this._curSeg=v=this._segments[a],this._s2=v[this._s1=this._si=0]}else if(t<this._l1&&a>0){while(a>0&&(this._l1=d[--a])>=t);a===0&&t<this._l1?this._l1=0:a++,this._l2=d[a],this._li=a,this._curSeg=v=this._segments[a],this._s1=v[(this._si=v.length-1)-1]||0,this._s2=v[this._si]}o=a,t-=this._l1,a=this._si;if(t>this._s2&&a<v.length-1){p=v.length-1;while(a<p&&(this._s2=v[++a])<=t);this._s1=v[a-1],this._si=a}else if(t<this._s1&&a>0){while(a>0&&(this._s1=v[--a])>=t);a===0&&t<this._s1?this._s1=0:a++,this._s2=v[a],this._si=a}c=(a+(t-this._s1)/(this._s2-this._s1))*this._prec}u=1-c,a=this._props.length;while(--a>-1)f=this._props[a],l=this._beziers[f][o],h=(c*c*l.da+3*u*(c*l.ca+u*l.ba))*c+l.a,this._round[f]&&(h=Math.round(h)),r[f]?i[f](h):i[f]=h;if(this._autoRotate){var m=this._autoRotate,g,y,b,w,E,S,x;a=m.length;while(--a>-1)f=m[a][2],S=m[a][3]||0,x=m[a][4]===!0?1:e,l=this._beziers[m[a][0]],g=this._beziers[m[a][1]],l&&g&&(l=l[o],g=g[o],y=l.a+(l.b-l.a)*c,w=l.b+(l.c-l.b)*c,y+=(w-y)*c,w+=(l.c+(l.d-l.c)*c-w)*c,b=g.a+(g.b-g.a)*c,E=g.b+(g.c-g.b)*c,b+=(E-b)*c,E+=(g.c+(g.d-g.c)*c-E)*c,h=s?(Math.atan2(E-b,w-y)+3.1415)*x+S:this._initialRotations[a],r[f]?i[f](h):i[f]=h)}}}),v=d.prototype;d.bezierThrough=l,d.cubicToQuadratic=u,d._autoCSS=!0,d.quadraticToCubic=function(e,t,n){return new s(e,(2*t+e)/3,(2*t+n)/3,n)},d._cssRegister=function(){var e=_gsScope._gsDefine.globals.CSSPlugin;if(!e)return;var t=e._internals,n=t._parseToProxy,r=t._setPluginRatio,i=t.CSSPropTween;t._registerComplexSpecialProp("bezier",{parser:function(e,t,s,o,u,a){t instanceof Array&&(t={values:t}),a=new d;var f=t.values,l=f.length-1,c=[],h={},p,v,m;if(l<0)return u;for(p=0;p<=l;p++)m=n(e,f[p],o,u,a,l!==p),c[p]=m.end;for(v in t)h[v]=t[v];return h.values=c,u=new i(e,"bezier",0,0,m.pt,2),u.data=m,u.plugin=a,u.setRatio=r,h.autoRotate===0&&(h.autoRotate=!0),h.autoRotate&&!(h.autoRotate instanceof Array)&&(p=h.autoRotate===!0?0:Number(h.autoRotate),h.autoRotate=m.end.left!=null?[["left","top","rotation",p,!1]]:m.end.x!=null?[["x","y","rotation",p,!1]]:!1),h.autoRotate&&(o._transform||o._enableTransforms(!1),m.autoRotate=o._target._gsTransform),a._onInitTween(m.proxy,h,o._tween),u}})},v._roundProps=function(e,t){var n=this._overwriteProps,r=n.length;while(--r>-1)if(e[n[r]]||e.bezier||e.bezierThrough)this._round[n[r]]=t},v._kill=function(e){var t=this._props,n,r;for(n in this._beziers)if(n in e){delete this._beziers[n],delete this._func[n],r=t.length;while(--r>-1)t[r]===n&&t.splice(r,1)}return this._super._kill.call(this,e)}}(),_gsScope._gsDefine("plugins.CSSPlugin",["plugins.TweenPlugin","TweenLite"],function(e,t){var n=function(){e.call(this,"css"),this._overwriteProps.length=0,this.setRatio=n.prototype.setRatio},r,i,s,o,u={},a=n.prototype=new e("css");a.constructor=n,n.version="1.13.2",n.API=2,n.defaultTransformPerspective=0,n.defaultSkewType="compensated",a="px",n.suffixMap={top:a,right:a,bottom:a,left:a,width:a,height:a,fontSize:a,padding:a,margin:a,perspective:a,lineHeight:""};var f=/(?:\d|\-\d|\.\d|\-\.\d)+/g,l=/(?:\d|\-\d|\.\d|\-\.\d|\+=\d|\-=\d|\+=.\d|\-=\.\d)+/g,c=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b)/gi,h=/[^\d\-\.]/g,p=/(?:\d|\-|\+|=|#|\.)*/g,d=/opacity *= *([^)]*)/i,v=/opacity:([^;]*)/i,m=/alpha\(opacity *=.+?\)/i,g=/^(rgb|hsl)/,y=/([A-Z])/g,b=/-([a-z])/gi,w=/(^(?:url\(\"|url\())|(?:(\"\))$|\)$)/gi,E=function(e,t){return t.toUpperCase()},S=/(?:Left|Right|Width)/i,x=/(M11|M12|M21|M22)=[\d\-\.e]+/gi,T=/progid\:DXImageTransform\.Microsoft\.Matrix\(.+?\)/i,N=/,(?=[^\)]*(?:\(|$))/gi,C=Math.PI/180,k=180/Math.PI,L={},A=document,O=A.createElement("div"),M=A.createElement("img"),_=n._internals={_specialProps:u},D=navigator.userAgent,P,H,B,j,F,I,q=function(){var e=D.indexOf("Android"),t=A.createElement("div"),n;return B=D.indexOf("Safari")!==-1&&D.indexOf("Chrome")===-1&&(e===-1||Number(D.substr(e+8,1))>3),F=B&&Number(D.substr(D.indexOf("Version/")+8,1))<6,j=D.indexOf("Firefox")!==-1,/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(D)&&(I=parseFloat(RegExp.$1)),t.innerHTML="<a style='top:1px;opacity:.55;'>a</a>",n=t.getElementsByTagName("a")[0],n?/^0.55/.test(n.style.opacity):!1}(),R=function(e){return d.test(typeof e=="string"?e:(e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?parseFloat(RegExp.$1)/100:1},U=function(e){window.console&&console.log(e)},z="",W="",X=function(e,t){t=t||O;var n=t.style,r,i;if(n[e]!==undefined)return e;e=e.charAt(0).toUpperCase()+e.substr(1),r=["O","Moz","ms","Ms","Webkit"],i=5;while(--i>-1&&n[r[i]+e]===undefined);return i>=0?(W=i===3?"ms":r[i],z="-"+W.toLowerCase()+"-",W+e):null},V=A.defaultView?A.defaultView.getComputedStyle:function(){},$=n.getStyle=function(e,t,n,r,i){var s;return!q&&t==="opacity"?R(e):(!r&&e.style[t]?s=e.style[t]:(n=n||V(e))?s=n[t]||n.getPropertyValue(t)||n.getPropertyValue(t.replace(y,"-$1").toLowerCase()):e.currentStyle&&(s=e.currentStyle[t]),i==null||!!s&&s!=="none"&&s!=="auto"&&s!=="auto auto"?s:i)},J=_.convertToPixels=function(e,r,i,s,o){if(s==="px"||!s)return i;if(s==="auto"||!i)return 0;var u=S.test(r),a=e,f=O.style,l=i<0,c,h,p;l&&(i=-i);if(s==="%"&&r.indexOf("border")!==-1)c=i/100*(u?e.clientWidth:e.clientHeight);else{f.cssText="border:0 solid red;position:"+$(e,"position")+";line-height:0;";if(s==="%"||!a.appendChild){a=e.parentNode||A.body,h=a._gsCache,p=t.ticker.frame;if(h&&u&&h.time===p)return h.width*i/100;f[u?"width":"height"]=i+s}else f[u?"borderLeftWidth":"borderTopWidth"]=i+s;a.appendChild(O),c=parseFloat(O[u?"offsetWidth":"offsetHeight"]),a.removeChild(O),u&&s==="%"&&n.cacheWidths!==!1&&(h=a._gsCache=a._gsCache||{},h.time=p,h.width=c/i*100),c===0&&!o&&(c=J(e,r,i,s,!0))}return l?-c:c},K=_.calculateOffset=function(e,t,n){if($(e,"position",n)!=="absolute")return 0;var r=t==="left"?"Left":"Top",i=$(e,"margin"+r,n);return e["offset"+r]-(J(e,t,parseFloat(i),i.replace(p,""))||0)},Q=function(e,t){var n={},r,i;if(t=t||V(e,null))if(r=t.length)while(--r>-1)n[t[r].replace(b,E)]=t.getPropertyValue(t[r]);else for(r in t)n[r]=t[r];else if(t=e.currentStyle||e.style)for(r in t)typeof r=="string"&&n[r]===undefined&&(n[r.replace(b,E)]=t[r]);return q||(n.opacity=R(e)),i=Ct(e,t,!1),n.rotation=i.rotation,n.skewX=i.skewX,n.scaleX=i.scaleX,n.scaleY=i.scaleY,n.x=i.x,n.y=i.y,Tt&&(n.z=i.z,n.rotationX=i.rotationX,n.rotationY=i.rotationY,n.scaleZ=i.scaleZ),n.filters&&delete n.filters,n},G=function(e,t,n,r,i){var s={},o=e.style,u,a,f;for(a in n)a!=="cssText"&&a!=="length"&&isNaN(a)&&(t[a]!==(u=n[a])||i&&i[a])&&a.indexOf("Origin")===-1&&(typeof u=="number"||typeof u=="string")&&(s[a]=u!=="auto"||a!=="left"&&a!=="top"?u!==""&&u!=="auto"&&u!=="none"||typeof t[a]!="string"||t[a].replace(h,"")===""?u:0:K(e,a),o[a]!==undefined&&(f=new ht(o,a,o[a],f)));if(r)for(a in r)a!=="className"&&(s[a]=r[a]);return{difs:s,firstMPT:f}},Y={width:["Left","Right"],height:["Top","Bottom"]},Z=["marginLeft","marginRight","marginTop","marginBottom"],et=function(e,t,n){var r=parseFloat(t==="width"?e.offsetWidth:e.offsetHeight),i=Y[t],s=i.length;n=n||V(e,null);while(--s>-1)r-=parseFloat($(e,"padding"+i[s],n,!0))||0,r-=parseFloat($(e,"border"+i[s]+"Width",n,!0))||0;return r},tt=function(e,t){if(e==null||e===""||e==="auto"||e==="auto auto")e="0 0";var n=e.split(" "),r=e.indexOf("left")!==-1?"0%":e.indexOf("right")!==-1?"100%":n[0],i=e.indexOf("top")!==-1?"0%":e.indexOf("bottom")!==-1?"100%":n[1];i==null?i="0":i==="center"&&(i="50%");if(r==="center"||isNaN(parseFloat(r))&&(r+"").indexOf("=")===-1)r="50%";return t&&(t.oxp=r.indexOf("%")!==-1,t.oyp=i.indexOf("%")!==-1,t.oxr=r.charAt(1)==="=",t.oyr=i.charAt(1)==="=",t.ox=parseFloat(r.replace(h,"")),t.oy=parseFloat(i.replace(h,""))),r+" "+i+(n.length>2?" "+n[2]:"")},nt=function(e,t){return typeof e=="string"&&e.charAt(1)==="="?parseInt(e.charAt(0)+"1",10)*parseFloat(e.substr(2)):parseFloat(e)-parseFloat(t)},rt=function(e,t){return e==null?t:typeof e=="string"&&e.charAt(1)==="="?parseInt(e.charAt(0)+"1",10)*Number(e.substr(2))+t:parseFloat(e)},it=function(e,t,n,r){var i=1e-6,s,o,u,a;return e==null?a=t:typeof e=="number"?a=e:(s=360,o=e.split("_"),u=Number(o[0].replace(h,""))*(e.indexOf("rad")===-1?1:k)-(e.charAt(1)==="="?0:t),o.length&&(r&&(r[n]=t+u),e.indexOf("short")!==-1&&(u%=s,u!==u%(s/2)&&(u=u<0?u+s:u-s)),e.indexOf("_cw")!==-1&&u<0?u=(u+s*9999999999)%s-(u/s|0)*s:e.indexOf("ccw")!==-1&&u>0&&(u=(u-s*9999999999)%s-(u/s|0)*s)),a=t+u),a<i&&a>-i&&(a=0),a},st={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},ot=function(e,t,n){return e=e<0?e+1:e>1?e-1:e,(e*6<1?t+(n-t)*e*6:e<.5?n:e*3<2?t+(n-t)*(2/3-e)*6:t)*255+.5|0},ut=function(e){var t,n,r,i,s,o;return!e||e===""?st.black:typeof e=="number"?[e>>16,e>>8&255,e&255]:(e.charAt(e.length-1)===","&&(e=e.substr(0,e.length-1)),st[e]?st[e]:e.charAt(0)==="#"?(e.length===4&&(t=e.charAt(1),n=e.charAt(2),r=e.charAt(3),e="#"+t+t+n+n+r+r),e=parseInt(e.substr(1),16),[e>>16,e>>8&255,e&255]):e.substr(0,3)==="hsl"?(e=e.match(f),i=Number(e[0])%360/360,s=Number(e[1])/100,o=Number(e[2])/100,n=o<=.5?o*(s+1):o+s-o*s,t=o*2-n,e.length>3&&(e[3]=Number(e[3])),e[0]=ot(i+1/3,t,n),e[1]=ot(i,t,n),e[2]=ot(i-1/3,t,n),e):(e=e.match(f)||st.transparent,e[0]=Number(e[0]),e[1]=Number(e[1]),e[2]=Number(e[2]),e.length>3&&(e[3]=Number(e[3])),e))},at="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#.+?\\b";for(a in st)at+="|"+a+"\\b";at=new RegExp(at+")","gi");var ft=function(e,t,n,r){if(e==null)return function(e){return e};var i=t?(e.match(at)||[""])[0]:"",s=e.split(i).join("").match(c)||[],o=e.substr(0,e.indexOf(s[0])),u=e.charAt(e.length-1)===")"?")":"",a=e.indexOf(" ")!==-1?" ":",",l=s.length,h=l>0?s[0].replace(f,""):"",p;return l?t?(p=function(e){var t,f,d,v;if(typeof e=="number")e+=h;else if(r&&N.test(e)){v=e.replace(N,"|").split("|");for(d=0;d<v.length;d++)v[d]=p(v[d]);return v.join(",")}t=(e.match(at)||[i])[0],f=e.split(t).join("").match(c)||[],d=f.length;if(l>d--)while(++d<l)f[d]=n?f[(d-1)/2|0]:s[d];return o+f.join(a)+a+t+u+(e.indexOf("inset")!==-1?" inset":"")},p):(p=function(e){var t,i,f;if(typeof e=="number")e+=h;else if(r&&N.test(e)){i=e.replace(N,"|").split("|");for(f=0;f<i.length;f++)i[f]=p(i[f]);return i.join(",")}t=e.match(c)||[],f=t.length;if(l>f--)while(++f<l)t[f]=n?t[(f-1)/2|0]:s[f];return o+t.join(a)+u},p):function(e){return e}},lt=function(e){return e=e.split(","),function(t,n,r,i,s,o,u){var a=(n+"").split(" "),f;u={};for(f=0;f<4;f++)u[e[f]]=a[f]=a[f]||a[(f-1)/2>>0];return i.parse(t,u,s,o)}},ct=_._setPluginRatio=function(e){this.plugin.setRatio(e);var t=this.data,n=t.proxy,r=t.firstMPT,i=1e-6,s,o,u,a;while(r)s=n[r.v],r.r?s=Math.round(s):s<i&&s>-i&&(s=0),r.t[r.p]=s,r=r._next;t.autoRotate&&(t.autoRotate.rotation=n.rotation);if(e===1){r=t.firstMPT;while(r){o=r.t;if(!o.type)o.e=o.s+o.xs0;else if(o.type===1){a=o.xs0+o.s+o.xs1;for(u=1;u<o.l;u++)a+=o["xn"+u]+o["xs"+(u+1)];o.e=a}r=r._next}}},ht=function(e,t,n,r,i){this.t=e,this.p=t,this.v=n,this.r=i,r&&(r._prev=this,this._next=r)},pt=_._parseToProxy=function(e,t,n,r,i,s){var o=r,u={},a={},f=n._transform,l=L,c,h,p,d,v;n._transform=null,L=t,r=v=n.parse(e,t,r,i),L=l,s&&(n._transform=f,o&&(o._prev=null,o._prev&&(o._prev._next=null)));while(r&&r!==o){if(r.type<=1){h=r.p,a[h]=r.s+r.c,u[h]=r.s,s||(d=new ht(r,"s",h,d,r.r),r.c=0);if(r.type===1){c=r.l;while(--c>0)p="xn"+c,h=r.p+"_"+p,a[h]=r.data[p],u[h]=r[p],s||(d=new ht(r,p,h,d,r.rxp[p]))}}r=r._next}return{proxy:u,end:a,firstMPT:d,pt:v}},dt=_.CSSPropTween=function(e,t,n,i,s,u,a,f,l,c,h){this.t=e,this.p=t,this.s=n,this.c=i,this.n=a||t,e instanceof dt||o.push(this.n),this.r=f,this.type=u||0,l&&(this.pr=l,r=!0),this.b=c===undefined?n:c,this.e=h===undefined?n+i:h,s&&(this._next=s,s._prev=this)},vt=n.parseComplex=function(e,t,n,r,i,s,o,u,a,c){n=n||s||"",o=new dt(e,t,0,0,o,c?2:1,null,!1,u,n,r),r+="";var h=n.split(", ").join(",").split(" "),p=r.split(", ").join(",").split(" "),d=h.length,v=P!==!1,m,y,b,w,E,S,x,T,C,k,L,A;if(r.indexOf(",")!==-1||n.indexOf(",")!==-1)h=h.join(" ").replace(N,", ").split(" "),p=p.join(" ").replace(N,", ").split(" "),d=h.length;d!==p.length&&(h=(s||"").split(" "),d=h.length),o.plugin=a,o.setRatio=c;for(m=0;m<d;m++){w=h[m],E=p[m],T=parseFloat(w);if(T||T===0)o.appendXtra("",T,nt(E,T),E.replace(l,""),v&&E.indexOf("px")!==-1,!0);else if(i&&(w.charAt(0)==="#"||st[w]||g.test(w)))A=E.charAt(E.length-1)===","?"),":")",w=ut(w),E=ut(E),C=w.length+E.length>6,C&&!q&&E[3]===0?(o["xs"+o.l]+=o.l?" transparent":"transparent",o.e=o.e.split(p[m]).join("transparent")):(q||(C=!1),o.appendXtra(C?"rgba(":"rgb(",w[0],E[0]-w[0],",",!0,!0).appendXtra("",w[1],E[1]-w[1],",",!0).appendXtra("",w[2],E[2]-w[2],C?",":A,!0),C&&(w=w.length<4?1:w[3],o.appendXtra("",w,(E.length<4?1:E[3])-w,A,!1)));else{S=w.match(f);if(!S)o["xs"+o.l]+=o.l?" "+w:w;else{x=E.match(l);if(!x||x.length!==S.length)return o;b=0;for(y=0;y<S.length;y++)L=S[y],k=w.indexOf(L,b),o.appendXtra(w.substr(b,k-b),Number(L),nt(x[y],L),"",v&&w.substr(k+L.length,2)==="px",y===0),b=k+L.length;o["xs"+o.l]+=w.substr(b)}}}if(r.indexOf("=")!==-1&&o.data){A=o.xs0+o.data.s;for(m=1;m<o.l;m++)A+=o["xs"+m]+o.data["xn"+m];o.e=A+o["xs"+m]}return o.l||(o.type=-1,o.xs0=o.e),o.xfirst||o},mt=9;a=dt.prototype,a.l=a.pr=0;while(--mt>0)a["xn"+mt]=0,a["xs"+mt]="";a.xs0="",a._next=a._prev=a.xfirst=a.data=a.plugin=a.setRatio=a.rxp=null,a.appendXtra=function(e,t,n,r,i,s){var o=this,u=o.l;return o["xs"+u]+=s&&u?" "+e:e||"",!n&&u!==0&&!o.plugin?(o["xs"+u]+=t+(r||""),o):(o.l++,o.type=o.setRatio?2:1,o["xs"+o.l]=r||"",u>0?(o.data["xn"+u]=t+n,o.rxp["xn"+u]=i,o["xn"+u]=t,o.plugin||(o.xfirst=new dt(o,"xn"+u,t,n,o.xfirst||o,0,o.n,i,o.pr),o.xfirst.xs0=0),o):(o.data={s:t+n},o.rxp={},o.s=t,o.c=n,o.r=i,o))};var gt=function(e,t){t=t||{},this.p=t.prefix?X(e)||e:e,u[e]=u[this.p]=this,this.format=t.formatter||ft(t.defaultValue,t.color,t.collapsible,t.multi),t.parser&&(this.parse=t.parser),this.clrs=t.color,this.multi=t.multi,this.keyword=t.keyword,this.dflt=t.defaultValue,this.pr=t.priority||0},yt=_._registerComplexSpecialProp=function(e,t,n){typeof t!="object"&&(t={parser:n});var r=e.split(","),i=t.defaultValue,s,o;n=n||[i];for(s=0;s<r.length;s++)t.prefix=s===0&&t.prefix,t.defaultValue=n[s]||i,o=new gt(r[s],t)},bt=function(e){if(!u[e]){var t=e.charAt(0).toUpperCase()+e.substr(1)+"Plugin";yt(e,{parser:function(e,n,r,i,s,o,a){var f=(_gsScope.GreenSockGlobals||_gsScope).com.greensock.plugins[t];return f?(f._cssRegister(),u[r].parse(e,n,r,i,s,o,a)):(U("Error: "+t+" js file not loaded."),s)}})}};a=gt.prototype,a.parseComplex=function(e,t,n,r,i,s){var o=this.keyword,u,a,f,l,c,h;this.multi&&(N.test(n)||N.test(t)?(a=t.replace(N,"|").split("|"),f=n.replace(N,"|").split("|")):o&&(a=[t],f=[n]));if(f){l=f.length>a.length?f.length:a.length;for(u=0;u<l;u++)t=a[u]=a[u]||this.dflt,n=f[u]=f[u]||this.dflt,o&&(c=t.indexOf(o),h=n.indexOf(o),c!==h&&(n=h===-1?f:a,n[u]+=" "+o));t=a.join(", "),n=f.join(", ")}return vt(e,this.p,t,n,this.clrs,this.dflt,r,this.pr,i,s)},a.parse=function(e,t,n,r,i,o,u){return this.parseComplex(e.style,this.format($(e,this.p,s,!1,this.dflt)),this.format(t),i,o)},n.registerSpecialProp=function(e,t,n){yt(e,{parser:function(e,r,i,s,o,u,a){var f=new dt(e,i,0,0,o,2,i,!1,n);return f.plugin=u,f.setRatio=t(e,r,s._tween,i),f},priority:n})};var wt="scaleX,scaleY,scaleZ,x,y,z,skewX,skewY,rotation,rotationX,rotationY,perspective,xPercent,yPercent".split(","),Et=X("transform"),St=z+"transform",xt=X("transformOrigin"),Tt=X("perspective")!==null,Nt=_.Transform=function(){this.skewY=0},Ct=_.getTransform=function(e,t,r,i){if(e._gsTransform&&r&&!i)return e._gsTransform;var s=r?e._gsTransform||new Nt:new Nt,o=s.scaleX<0,u=2e-5,a=1e5,f=179.99,l=f*C,c=Tt?parseFloat($(e,xt,t,!1,"0 0 0").split(" ")[2])||s.zOrigin||0:0,h=parseFloat(n.defaultTransformPerspective)||0,p,d,v,m,g,y,b,w,E,S,T,N,L;Et?p=$(e,St,t,!0):e.currentStyle&&(p=e.currentStyle.filter.match(x),p=p&&p.length===4?[p[0].substr(4),Number(p[2].substr(4)),Number(p[1].substr(4)),p[3].substr(4),s.x||0,s.y||0].join(","):"");if(!p||p==="none"||p==="matrix(1, 0, 0, 1, 0, 0)")s={x:0,y:0,z:0,scaleX:1,scaleY:1,scaleZ:1,skewX:0,perspective:h,rotation:0,rotationX:0,rotationY:0,zOrigin:0};else{d=(p||"").match(/(?:\-|\b)[\d\-\.e]+\b/gi)||[],v=d.length;while(--v>-1)m=Number(d[v]),d[v]=(g=m-(m|=0))?(g*a+(g<0?-0.5:.5)|0)/a+m:m;if(d.length===16){var A=d[8],O=d[9],M=d[10],_=d[12],D=d[13],P=d[14];s.zOrigin&&(P=-s.zOrigin,_=A*P-d[12],D=O*P-d[13],P=M*P+s.zOrigin-d[14]);if(!r||i||s.rotationX==null){var H=d[0],B=d[1],j=d[2],F=d[3],I=d[4],q=d[5],R=d[6],U=d[7],z=d[11],W=Math.atan2(R,M),X=W<-l||W>l,V,J,K,Q,G,Y,Z;s.rotationX=W*k,W&&(Q=Math.cos(-W),G=Math.sin(-W),V=I*Q+A*G,J=q*Q+O*G,K=R*Q+M*G,A=I*-G+A*Q,O=q*-G+O*Q,M=R*-G+M*Q,z=U*-G+z*Q,I=V,q=J,R=K),W=Math.atan2(A,H),s.rotationY=W*k,W&&(Y=W<-l||W>l,Q=Math.cos(-W),G=Math.sin(-W),V=H*Q-A*G,J=B*Q-O*G,K=j*Q-M*G,O=B*G+O*Q,M=j*G+M*Q,z=F*G+z*Q,H=V,B=J,j=K),W=Math.atan2(B,q),s.rotation=W*k,W&&(Z=W<-l||W>l,Q=Math.cos(-W),G=Math.sin(-W),H=H*Q+I*G,J=B*Q+q*G,q=B*-G+q*Q,R=j*-G+R*Q,B=J),Z&&X?s.rotation=s.rotationX=0:Z&&Y?s.rotation=s.rotationY=0:Y&&X&&(s.rotationY=s.rotationX=0),s.scaleX=(Math.sqrt(H*H+B*B)*a+.5|0)/a,s.scaleY=(Math.sqrt(q*q+O*O)*a+.5|0)/a,s.scaleZ=(Math.sqrt(R*R+M*M)*a+.5|0)/a,s.skewX=0,s.perspective=z?1/(z<0?-z:z):0,s.x=_,s.y=D,s.z=P}}else if((!Tt||i||!d.length||s.x!==d[4]||s.y!==d[5]||!s.rotationX&&!s.rotationY)&&(s.x===undefined||$(e,"display",t)!=="none")){var et=d.length>=6,tt=et?d[0]:1,nt=d[1]||0,rt=d[2]||0,it=et?d[3]:1;s.x=d[4]||0,s.y=d[5]||0,y=Math.sqrt(tt*tt+nt*nt),b=Math.sqrt(it*it+rt*rt),w=tt||nt?Math.atan2(nt,tt)*k:s.rotation||0,E=rt||it?Math.atan2(rt,it)*k+w:s.skewX||0,S=y-Math.abs(s.scaleX||0),T=b-Math.abs(s.scaleY||0),Math.abs(E)>90&&Math.abs(E)<270&&(o?(y*=-1,E+=w<=0?180:-180,w+=w<=0?180:-180):(b*=-1,E+=E<=0?180:-180)),N=(w-s.rotation)%180,L=(E-s.skewX)%180;if(s.skewX===undefined||S>u||S<-u||T>u||T<-u||N>-f&&N<f&&N*a|!1||L>-f&&L<f&&L*a|!1)s.scaleX=y,s.scaleY=b,s.rotation=w,s.skewX=E;Tt&&(s.rotationX=s.rotationY=s.z=0,s.perspective=h,s.scaleZ=1)}s.zOrigin=c;for(v in s)s[v]<u&&s[v]>-u&&(s[v]=0)}return r&&(e._gsTransform=s),s.xPercent=s.yPercent=0,s},kt=function(e){var t=this.data,n=-t.rotation*C,r=n+t.skewX*C,i=1e5,s=(Math.cos(n)*t.scaleX*i|0)/i,o=(Math.sin(n)*t.scaleX*i|0)/i,u=(Math.sin(r)*-t.scaleY*i|0)/i,a=(Math.cos(r)*t.scaleY*i|0)/i,f=this.t.style,l=this.t.currentStyle,c,h;if(!l)return;h=o,o=-u,u=-h,c=l.filter,f.filter="";var v=this.t.offsetWidth,m=this.t.offsetHeight,g=l.position!=="absolute",y="progid:DXImageTransform.Microsoft.Matrix(M11="+s+", M12="+o+", M21="+u+", M22="+a,b=t.x+v*t.xPercent/100,w=t.y+m*t.yPercent/100,E,S;t.ox!=null&&(E=(t.oxp?v*t.ox*.01:t.ox)-v/2,S=(t.oyp?m*t.oy*.01:t.oy)-m/2,b+=E-(E*s+S*o),w+=S-(E*u+S*a)),g?(E=v/2,S=m/2,y+=", Dx="+(E-(E*s+S*o)+b)+", Dy="+(S-(E*u+S*a)+w)+")"):y+=", sizingMethod='auto expand')",c.indexOf("DXImageTransform.Microsoft.Matrix(")!==-1?f.filter=c.replace(T,y):f.filter=y+" "+c,(e===0||e===1)&&s===1&&o===0&&u===0&&a===1&&(!g||y.indexOf("Dx=0, Dy=0")!==-1)&&(!d.test(c)||parseFloat(RegExp.$1)===100)&&c.indexOf(c.indexOf("Alpha"))===-1&&f.removeAttribute("filter");if(!g){var x=I<8?1:-1,N,k,L;E=t.ieOffsetX||0,S=t.ieOffsetY||0,t.ieOffsetX=Math.round((v-((s<0?-s:s)*v+(o<0?-o:o)*m))/2+b),t.ieOffsetY=Math.round((m-((a<0?-a:a)*m+(u<0?-u:u)*v))/2+w);for(mt=0;mt<4;mt++)k=Z[mt],N=l[k],h=N.indexOf("px")!==-1?parseFloat(N):J(this.t,k,parseFloat(N),N.replace(p,""))||0,h!==t[k]?L=mt<2?-t.ieOffsetX:-t.ieOffsetY:L=mt<2?E-t.ieOffsetX:S-t.ieOffsetY,f[k]=(t[k]=Math.round(h-L*(mt===0||mt===2?1:x)))+"px"}},Lt=_.set3DTransformRatio=function(e){var t=this.data,n=this.t.style,r=t.rotation*C,i=t.scaleX,s=t.scaleY,o=t.scaleZ,u=t.x,a=t.y,f=t.z,l=t.perspective,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,k,L,A,O,M,_,D,P;if(e===1||e===0)if(t.force3D==="auto"&&!t.rotationY&&!t.rotationX&&o===1&&!l&&!f){At.call(this,e);return}if(j){var H=1e-4;i<H&&i>-H&&(i=o=2e-5),s<H&&s>-H&&(s=o=2e-5),l&&!t.z&&!t.rotationX&&!t.rotationY&&(l=0)}if(r||t.skewX)A=Math.cos(r),O=Math.sin(r),c=A,v=O,t.skewX&&(r-=t.skewX*C,A=Math.cos(r),O=Math.sin(r),t.skewType==="simple"&&(M=Math.tan(t.skewX*C),M=Math.sqrt(1+M*M),A*=M,O*=M)),h=-O,m=A;else{if(!t.rotationY&&!t.rotationX&&o===1&&!l){n[Et]=(t.xPercent||t.yPercent?"translate("+t.xPercent+"%,"+t.yPercent+"%) translate3d(":"translate3d(")+u+"px,"+a+"px,"+f+"px)"+(i!==1||s!==1?" scale("+i+","+s+")":"");return}c=m=1,h=v=0}E=1,p=d=g=y=b=w=S=x=T=0,N=l?-1/l:0,k=t.zOrigin,L=1e5,r=t.rotationY*C,r&&(A=Math.cos(r),O=Math.sin(r),b=E*-O,x=N*-O,p=c*O,g=v*O,E*=A,N*=A,c*=A,v*=A),r=t.rotationX*C,r&&(A=Math.cos(r),O=Math.sin(r),M=h*A+p*O,_=m*A+g*O,D=w*A+E*O,P=T*A+N*O,p=h*-O+p*A,g=m*-O+g*A,E=w*-O+E*A,N=T*-O+N*A,h=M,m=_,w=D,T=P),o!==1&&(p*=o,g*=o,E*=o,N*=o),s!==1&&(h*=s,m*=s,w*=s,T*=s),i!==1&&(c*=i,v*=i,b*=i,x*=i),k&&(S-=k,d=p*S,y=g*S,S=E*S+k),d=(M=(d+=u)-(d|=0))?(M*L+(M<0?-0.5:.5)|0)/L+d:d,y=(M=(y+=a)-(y|=0))?(M*L+(M<0?-0.5:.5)|0)/L+y:y,S=(M=(S+=f)-(S|=0))?(M*L+(M<0?-0.5:.5)|0)/L+S:S,n[Et]=(t.xPercent||t.yPercent?"translate("+t.xPercent+"%,"+t.yPercent+"%) matrix3d(":"matrix3d(")+[(c*L|0)/L,(v*L|0)/L,(b*L|0)/L,(x*L|0)/L,(h*L|0)/L,(m*L|0)/L,(w*L|0)/L,(T*L|0)/L,(p*L|0)/L,(g*L|0)/L,(E*L|0)/L,(N*L|0)/L,d,y,S,l?1+ -S/l:1].join(",")+")"},At=_.set2DTransformRatio=function(e){var t=this.data,n=this.t,r=n.style,i=t.x,s=t.y,o="",u,a,f,l,c;if(t.rotationX||t.rotationY||t.z||t.force3D===!0||t.force3D==="auto"&&e!==1&&e!==0){this.setRatio=Lt,Lt.call(this,e);return}!t.rotation&&!t.skewX?r[Et]=(t.xPercent||t.yPercent?"translate("+t.xPercent+"%,"+t.yPercent+"%) matrix(":"matrix(")+t.scaleX+",0,0,"+t.scaleY+","+i+","+s+")":(u=t.rotation*C,a=u-t.skewX*C,f=1e5,l=t.scaleX*f,c=t.scaleY*f,r[Et]=(t.xPercent||t.yPercent?"translate("+t.xPercent+"%,"+t.yPercent+"%) matrix(":"matrix(")+(Math.cos(u)*l|0)/f+","+(Math.sin(u)*l|0)/f+","+(Math.sin(a)*-c|0)/f+","+(Math.cos(a)*c|0)/f+","+i+","+s+")")};yt("transform,scale,scaleX,scaleY,scaleZ,x,y,z,rotation,rotationX,rotationY,rotationZ,skewX,skewY,shortRotation,shortRotationX,shortRotationY,shortRotationZ,transformOrigin,transformPerspective,directionalRotation,parseTransform,force3D,skewType,xPercent,yPercent",{parser:function(e,t,r,i,o,u,a){if(i._transform)return o;var f=i._transform=Ct(e,s,!0,a.parseTransform),l=e.style,c=1e-6,h=wt.length,p=a,d={},v,m,g,y,b,w,E;if(typeof p.transform=="string"&&Et)g=O.style,g[Et]=p.transform,g.display="block",g.position="absolute",A.body.appendChild(O),v=Ct(O,null,!1),A.body.removeChild(O);else if(typeof p=="object"){v={scaleX:rt(p.scaleX!=null?p.scaleX:p.scale,f.scaleX),scaleY:rt(p.scaleY!=null?p.scaleY:p.scale,f.scaleY),scaleZ:rt(p.scaleZ,f.scaleZ),x:rt(p.x,f.x),y:rt(p.y,f.y),z:rt(p.z,f.z),xPercent:rt(p.xPercent,f.xPercent),yPercent:rt(p.yPercent,f.yPercent),perspective:rt(p.transformPerspective,f.perspective)},E=p.directionalRotation;if(E!=null)if(typeof E=="object")for(g in E)p[g]=E[g];else p.rotation=E;typeof p.x=="string"&&p.x.indexOf("%")!==-1&&(v.x=0,v.xPercent=rt(p.x,f.xPercent)),typeof p.y=="string"&&p.y.indexOf("%")!==-1&&(v.y=0,v.yPercent=rt(p.y,f.yPercent)),v.rotation=it("rotation"in p?p.rotation:"shortRotation"in p?p.shortRotation+"_short":"rotationZ"in p?p.rotationZ:f.rotation,f.rotation,"rotation",d),Tt&&(v.rotationX=it("rotationX"in p?p.rotationX:"shortRotationX"in p?p.shortRotationX+"_short":f.rotationX||0,f.rotationX,"rotationX",d),v.rotationY=it("rotationY"in p?p.rotationY:"shortRotationY"in p?p.shortRotationY+"_short":f.rotationY||0,f.rotationY,"rotationY",d)),v.skewX=p.skewX==null?f.skewX:it(p.skewX,f.skewX),v.skewY=p.skewY==null?f.skewY:it(p.skewY,f.skewY);if(m=v.skewY-f.skewY)v.skewX+=m,v.rotation+=m}Tt&&p.force3D!=null&&(f.force3D=p.force3D,w=!0),f.skewType=p.skewType||f.skewType||n.defaultSkewType,b=f.force3D||f.z||f.rotationX||f.rotationY||v.z||v.rotationX||v.rotationY||v.perspective,!b&&p.scale!=null&&(v.scaleZ=1);while(--h>-1){r=wt[h],y=v[r]-f[r];if(y>c||y<-c||L[r]!=null)w=!0,o=new dt(f,r,f[r],y,o),r in d&&(o.e=d[r]),o.xs0=0,o.plugin=u,i._overwriteProps.push(o.n)}y=p.transformOrigin;if(y||Tt&&b&&f.zOrigin)Et?(w=!0,r=xt,y=(y||$(e,r,s,!1,"50% 50%"))+"",o=new dt(l,r,0,0,o,-1,"transformOrigin"),o.b=l[r],o.plugin=u,Tt?(g=f.zOrigin,y=y.split(" "),f.zOrigin=(y.length>2&&(g===0||y[2]!=="0px")?parseFloat(y[2]):g)||0,o.xs0=o.e=y[0]+" "+(y[1]||"50%")+" 0px",o=new dt(f,"zOrigin",0,0,o,-1,o.n),o.b=g,o.xs0=o.e=f.zOrigin):o.xs0=o.e=y):tt(y+"",f);return w&&(i._transformType=b||this._transformType===3?3:2),o},prefix:!0}),yt("boxShadow",{defaultValue:"0px 0px 0px 0px #999",prefix:!0,color:!0,multi:!0,keyword:"inset"}),yt("borderRadius",{defaultValue:"0px",parser:function(e,t,n,r,o,u){t=this.format(t);var a=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],f=e.style,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N;y=parseFloat(e.offsetWidth),b=parseFloat(e.offsetHeight),l=t.split(" ");for(c=0;c<a.length;c++)this.p.indexOf("border")&&(a[c]=X(a[c])),d=p=$(e,a[c],s,!1,"0px"),d.indexOf(" ")!==-1&&(p=d.split(" "),d=p[0],p=p[1]),v=h=l[c],m=parseFloat(d),E=d.substr((m+"").length),S=v.charAt(1)==="=",S?(g=parseInt(v.charAt(0)+"1",10),v=v.substr(2),g*=parseFloat(v),w=v.substr((g+"").length-(g<0?1:0))||""):(g=parseFloat(v),w=v.substr((g+"").length)),w===""&&(w=i[n]||E),w!==E&&(x=J(e,"borderLeft",m,E),T=J(e,"borderTop",m,E),w==="%"?(d=x/y*100+"%",p=T/b*100+"%"):w==="em"?(N=J(e,"borderLeft",1,"em"),d=x/N+"em",p=T/N+"em"):(d=x+"px",p=T+"px"),S&&(v=parseFloat(d)+g+w,h=parseFloat(p)+g+w)),o=vt(f,a[c],d+" "+p,v+" "+h,!1,"0px",o);return o},prefix:!0,formatter:ft("0px 0px 0px 0px",!1,!0)}),yt("backgroundPosition",{defaultValue:"0 0",parser:function(e,t,n,r,i,o){var u="background-position",a=s||V(e,null),f=this.format((a?I?a.getPropertyValue(u+"-x")+" "+a.getPropertyValue(u+"-y"):a.getPropertyValue(u):e.currentStyle.backgroundPositionX+" "+e.currentStyle.backgroundPositionY)||"0 0"),l=this.format(t),c,h,p,d,v,m;if(f.indexOf("%")!==-1!=(l.indexOf("%")!==-1)){m=$(e,"backgroundImage").replace(w,"");if(m&&m!=="none"){c=f.split(" "),h=l.split(" "),M.setAttribute("src",m),p=2;while(--p>-1)f=c[p],d=f.indexOf("%")!==-1,d!==(h[p].indexOf("%")!==-1)&&(v=p===0?e.offsetWidth-M.width:e.offsetHeight-M.height,c[p]=d?parseFloat(f)/100*v+"px":parseFloat(f)/v*100+"%");f=c.join(" ")}}return this.parseComplex(e.style,f,l,i,o)},formatter:tt}),yt("backgroundSize",{defaultValue:"0 0",formatter:tt}),yt("perspective",{defaultValue:"0px",prefix:!0}),yt("perspectiveOrigin",{defaultValue:"50% 50%",prefix:!0}),yt("transformStyle",{prefix:!0}),yt("backfaceVisibility",{prefix:!0}),yt("userSelect",{prefix:!0}),yt("margin",{parser:lt("marginTop,marginRight,marginBottom,marginLeft")}),yt("padding",{parser:lt("paddingTop,paddingRight,paddingBottom,paddingLeft")}),yt("clip",{defaultValue:"rect(0px,0px,0px,0px)",parser:function(e,t,n,r,i,o){var u,a,f;return I<9?(a=e.currentStyle,f=I<8?" ":",",u="rect("+a.clipTop+f+a.clipRight+f+a.clipBottom+f+a.clipLeft+")",t=this.format(t).split(",").join(f)):(u=this.format($(e,this.p,s,!1,this.dflt)),t=this.format(t)),this.parseComplex(e.style,u,t,i,o)}}),yt("textShadow",{defaultValue:"0px 0px 0px #999",color:!0,multi:!0}),yt("autoRound,strictUnits",{parser:function(e,t,n,r,i){return i}}),yt("border",{defaultValue:"0px solid #000",parser:function(e,t,n,r,i,o){return this.parseComplex(e.style,this.format($(e,"borderTopWidth",s,!1,"0px")+" "+$(e,"borderTopStyle",s,!1,"solid")+" "+$(e,"borderTopColor",s,!1,"#000")),this.format(t),i,o)},color:!0,formatter:function(e){var t=e.split(" ");return t[0]+" "+(t[1]||"solid")+" "+(e.match(at)||["#000"])[0]}}),yt("borderWidth",{parser:lt("borderTopWidth,borderRightWidth,borderBottomWidth,borderLeftWidth")}),yt("float,cssFloat,styleFloat",{parser:function(e,t,n,r,i,s){var o=e.style,u="cssFloat"in o?"cssFloat":"styleFloat";return new dt(o,u,0,0,i,-1,n,!1,0,o[u],t)}});var Ot=function(e){var t=this.t,n=t.filter||$(this.data,"filter"),r=this.s+this.c*e|0,i;r===100&&(n.indexOf("atrix(")===-1&&n.indexOf("radient(")===-1&&n.indexOf("oader(")===-1?(t.removeAttribute("filter"),i=!$(this.data,"filter")):(t.filter=n.replace(m,""),i=!0));if(!i){this.xn1&&(t.filter=n=n||"alpha(opacity="+r+")");if(n.indexOf("pacity")===-1){if(r!==0||!this.xn1)t.filter=n+" alpha(opacity="+r+")"}else t.filter=n.replace(d,"opacity="+r)}};yt("opacity,alpha,autoAlpha",{defaultValue:"1",parser:function(e,t,n,r,i,o){var u=parseFloat($(e,"opacity",s,!1,"1")),a=e.style,f=n==="autoAlpha";return typeof t=="string"&&t.charAt(1)==="="&&(t=(t.charAt(0)==="-"?-1:1)*parseFloat(t.substr(2))+u),f&&u===1&&$(e,"visibility",s)==="hidden"&&t!==0&&(u=0),q?i=new dt(a,"opacity",u,t-u,i):(i=new dt(a,"opacity",u*100,(t-u)*100,i),i.xn1=f?1:0,a.zoom=1,i.type=2,i.b="alpha(opacity="+i.s+")",i.e="alpha(opacity="+(i.s+i.c)+")",i.data=e,i.plugin=o,i.setRatio=Ot),f&&(i=new dt(a,"visibility",0,0,i,-1,null,!1,0,u!==0?"inherit":"hidden",t===0?"hidden":"inherit"),i.xs0="inherit",r._overwriteProps.push(i.n),r._overwriteProps.push(n)),i}});var Mt=function(e,t){t&&(e.removeProperty?(t.substr(0,2)==="ms"&&(t="M"+t.substr(1)),e.removeProperty(t.replace(y,"-$1").toLowerCase())):e.removeAttribute(t))},_t=function(e){this.t._gsClassPT=this;if(e===1||e===0){this.t.setAttribute("class",e===0?this.b:this.e);var t=this.data,n=this.t.style;while(t)t.v?n[t.p]=t.v:Mt(n,t.p),t=t._next;e===1&&this.t._gsClassPT===this&&(this.t._gsClassPT=null)}else this.t.getAttribute("class")!==this.e&&this.t.setAttribute("class",this.e)};yt("className",{parser:function(e,t,n,i,o,u,a){var f=e.getAttribute("class")||"",l=e.style.cssText,c,h,p,d,v;o=i._classNamePT=new dt(e,n,0,0,o,2),o.setRatio=_t,o.pr=-11,r=!0,o.b=f,h=Q(e,s),p=e._gsClassPT;if(p){d={},v=p.data;while(v)d[v.p]=1,v=v._next;p.setRatio(1)}return e._gsClassPT=o,o.e=t.charAt(1)!=="="?t:f.replace(new RegExp("\\s*\\b"+t.substr(2)+"\\b"),"")+(t.charAt(0)==="+"?" "+t.substr(2):""),i._tween._duration&&(e.setAttribute("class",o.e),c=G(e,h,Q(e),a,d),e.setAttribute("class",f),o.data=c.firstMPT,e.style.cssText=l,o=o.xfirst=i.parse(e,c.difs,o,u)),o}});var Dt=function(e){if(e===1||e===0)if(this.data._totalTime===this.data._totalDuration&&this.data.data!=="isFromStart"){var t=this.t.style,n=u.transform.parse,r,i,s,o;if(this.e==="all")t.cssText="",o=!0;else{r=this.e.split(","),s=r.length;while(--s>-1)i=r[s],u[i]&&(u[i].parse===n?o=!0:i=i==="transformOrigin"?xt:u[i].p),Mt(t,i)}o&&(Mt(t,Et),this.t._gsTransform&&delete this.t._gsTransform)}};yt("clearProps",{parser:function(e,t,n,i,s){return s=new dt(e,n,0,0,s,2),s.setRatio=Dt,s.e=t,s.pr=-10,s.data=i._tween,r=!0,s}}),a="bezier,throwProps,physicsProps,physics2D".split(","),mt=a.length;while(mt--)bt(a[mt]);a=n.prototype,a._firstPT=null,a._onInitTween=function(e,t,u){if(!e.nodeType)return!1;this._target=e,this._tween=u,this._vars=t,P=t.autoRound,r=!1,i=t.suffixMap||n.suffixMap,s=V(e,""),o=this._overwriteProps;var a=e.style,f,l,c,h,p,d,m,g,y;H&&a.zIndex===""&&(f=$(e,"zIndex",s),(f==="auto"||f==="")&&this._addLazySet(a,"zIndex",0)),typeof t=="string"&&(h=a.cssText,f=Q(e,s),a.cssText=h+";"+t,f=G(e,f,Q(e)).difs,!q&&v.test(t)&&(f.opacity=parseFloat(RegExp.$1)),t=f,a.cssText=h),this._firstPT=l=this.parse(e,t,null);if(this._transformType){y=this._transformType===3,Et?B&&(H=!0,a.zIndex===""&&(m=$(e,"zIndex",s),(m==="auto"||m==="")&&this._addLazySet(a,"zIndex",0)),F&&this._addLazySet(a,"WebkitBackfaceVisibility",this._vars.WebkitBackfaceVisibility||(y?"visible":"hidden"))):a.zoom=1,c=l;while(c&&c._next)c=c._next;g=new dt(e,"transform",0,0,null,2),this._linkCSSP(g,null,c),g.setRatio=y&&Tt?Lt:Et?At:kt,g.data=this._transform||Ct(e,s,!0),o.pop()}if(r){while(l){d=l._next,c=h;while(c&&c.pr>l.pr)c=c._next;(l._prev=c?c._prev:p)?l._prev._next=l:h=l,(l._next=c)?c._prev=l:p=l,l=d}this._firstPT=h}return!0},a.parse=function(e,t,n,r){var o=e.style,a,f,l,c,h,d,v,m,y,b;for(a in t){d=t[a],f=u[a];if(f)n=f.parse(e,d,a,this,n,r,t);else{h=$(e,a,s)+"",y=typeof d=="string";if(a==="color"||a==="fill"||a==="stroke"||a.indexOf("Color")!==-1||y&&g.test(d))y||(d=ut(d),d=(d.length>3?"rgba(":"rgb(")+d.join(",")+")"),n=vt(o,a,h,d,!0,"transparent",n,0,r);else if(!y||d.indexOf(" ")===-1&&d.indexOf(",")===-1){l=parseFloat(h),v=l||l===0?h.substr((l+"").length):"";if(h===""||h==="auto")a==="width"||a==="height"?(l=et(e,a,s),v="px"):a==="left"||a==="top"?(l=K(e,a,s),v="px"):(l=a!=="opacity"?0:1,v="");b=y&&d.charAt(1)==="=",b?(c=parseInt(d.charAt(0)+"1",10),d=d.substr(2),c*=parseFloat(d),m=d.replace(p,"")):(c=parseFloat(d),m=y?d.substr((c+"").length)||"":""),m===""&&(m=a in i?i[a]:v),d=c||c===0?(b?c+l:c)+m:t[a],v!==m&&m!==""&&(c||c===0)&&l&&(l=J(e,a,l,v),m==="%"?(l/=J(e,a,100,"%")/100,t.strictUnits!==!0&&(h=l+"%")):m==="em"?l/=J(e,a,1,"em"):m!=="px"&&(c=J(e,a,c,m),m="px"),b&&(c||c===0)&&(d=c+l+m)),b&&(c+=l),!l&&l!==0||!c&&c!==0?o[a]===undefined||!d&&(d+""=="NaN"||d==null)?U("invalid "+a+" tween value: "+t[a]):(n=new dt(o,a,c||l||0,0,n,-1,a,!1,0,h,d),n.xs0=d!=="none"||a!=="display"&&a.indexOf("Style")===-1?d:h):(n=new dt(o,a,l,c-l,n,0,a,P!==!1&&(m==="px"||a==="zIndex"),0,h,d),n.xs0=m)}else n=vt(o,a,h,d,!0,null,n,0,r)}r&&n&&!n.plugin&&(n.plugin=r)}return n},a.setRatio=function(e){var t=this._firstPT,n=1e-6,r,i,s;if(e!==1||this._tween._time!==this._tween._duration&&this._tween._time!==0)if(e||this._tween._time!==this._tween._duration&&this._tween._time!==0||this._tween._rawPrevTime===-0.000001)while(t){r=t.c*e+t.s,t.r?r=Math.round(r):r<n&&r>-n&&(r=0);if(!t.type)t.t[t.p]=r+t.xs0;else if(t.type===1){s=t.l;if(s===2)t.t[t.p]=t.xs0+r+t.xs1+t.xn1+t.xs2;else if(s===3)t.t[t.p]=t.xs0+r+t.xs1+t.xn1+t.xs2+t.xn2+t.xs3;else if(s===4)t.t[t.p]=t.xs0+r+t.xs1+t.xn1+t.xs2+t.xn2+t.xs3+t.xn3+t.xs4;else if(s===5)t.t[t.p]=t.xs0+r+t.xs1+t.xn1+t.xs2+t.xn2+t.xs3+t.xn3+t.xs4+t.xn4+t.xs5;else{i=t.xs0+r+t.xs1;for(s=1;s<t.l;s++)i+=t["xn"+s]+t["xs"+(s+1)];t.t[t.p]=i}}else t.type===-1?t.t[t.p]=t.xs0:t.setRatio&&t.setRatio(e);t=t._next}else while(t)t.type!==2?t.t[t.p]=t.b:t.setRatio(e),t=t._next;else while(t)t.type!==2?t.t[t.p]=t.e:t.setRatio(e),t=t._next},a._enableTransforms=function(e){this._transformType=e||this._transformType===3?3:2,this._transform=this._transform||Ct(this._target,s,!0)};var Pt=function(e){this.t[this.p]=this.e,this.data._linkCSSP(this,this._next,null,!0)};a._addLazySet=function(e,t,n){var r=this._firstPT=new dt(e,t,0,0,this._firstPT,2);r.e=n,r.setRatio=Pt,r.data=this},a._linkCSSP=function(e,t,n,r){return e&&(t&&(t._prev=e),e._next&&(e._next._prev=e._prev),e._prev?e._prev._next=e._next:this._firstPT===e&&(this._firstPT=e._next,r=!0),n?n._next=e:!r&&this._firstPT===null&&(this._firstPT=e),e._next=t,e._prev=n),e},a._kill=function(t){var n=t,r,i,s;if(t.autoAlpha||t.alpha){n={};for(i in t)n[i]=t[i];n.opacity=1,n.autoAlpha&&(n.visibility=1)}return t.className&&(r=this._classNamePT)&&(s=r.xfirst,s&&s._prev?this._linkCSSP(s._prev,r._next,s._prev._prev):s===this._firstPT&&(this._firstPT=r._next),r._next&&this._linkCSSP(r._next,r._next._next,s._prev),this._classNamePT=null),e.prototype._kill.call(this,n)};var Ht=function(e,t,n){var r,i,s,o;if(e.slice){i=e.length;while(--i>-1)Ht(e[i],t,n);return}r=e.childNodes,i=r.length;while(--i>-1)s=r[i],o=s.type,s.style&&(t.push(Q(s)),n&&n.push(s)),(o===1||o===9||o===11)&&s.childNodes.length&&Ht(s,t,n)};return n.cascadeTo=function(e,n,r){var i=t.to(e,n,r),s=[i],o=[],u=[],a=[],f=t._internals.reservedProps,l,c,h;e=i._targets||i.target,Ht(e,o,a),i.render(n,!0),Ht(e,u),i.render(0,!0),i._enabled(!0),l=a.length;while(--l>-1){c=G(a[l],o[l],u[l]);if(c.firstMPT){c=c.difs;for(h in r)f[h]&&(c[h]=r[h]);s.push(t.to(a[l],n,c))}}return s},e.activate([n]),n},!0),function(){var e=_gsScope._gsDefine.plugin({propName:"roundProps",priority:-1,API:2,init:function(e,t,n){return this._tween=n,!0}}),t=e.prototype;t._onInitAllProps=function(){var e=this._tween,t=e.vars.roundProps instanceof Array?e.vars.roundProps:e.vars.roundProps.split(","),n=t.length,r={},i=e._propLookup.roundProps,s,o,u;while(--n>-1)r[t[n]]=1;n=t.length;while(--n>-1){s=t[n],o=e._firstPT;while(o)u=o._next,o.pg?o.t._roundProps(r,!0):o.n===s&&(this._add(o.t,s,o.s,o.c),u&&(u._prev=o._prev),o._prev?o._prev._next=u:e._firstPT===o&&(e._firstPT=u),o._next=o._prev=null,e._propLookup[s]=i),o=u}return!1},t._add=function(e,t,n,r){this._addTween(e,t,n,n+r,t,!0),this._overwriteProps.push(t)}}(),_gsScope._gsDefine.plugin({propName:"attr",API:2,version:"0.3.3",init:function(e,t,n){var r,i,s;if(typeof e.setAttribute!="function")return!1;this._target=e,this._proxy={},this._start={},this._end={};for(r in t)this._start[r]=this._proxy[r]=i=e.getAttribute(r),s=this._addTween(this._proxy,r,parseFloat(i),t[r],r),this._end[r]=s?s.s+s.c:t[r],this._overwriteProps.push(r);return!0},set:function(e){this._super.setRatio.call(this,e);var t=this._overwriteProps,n=t.length,r=e===1?this._end:e?this._proxy:this._start,i;while(--n>-1)i=t[n],this._target.setAttribute(i,r[i]+"")}}),_gsScope._gsDefine.plugin({propName:"directionalRotation",version:"0.2.1",API:2,init:function(e,t,n){typeof t!="object"&&(t={rotation:t}),this.finals={};var r=t.useRadians===!0?Math.PI*2:360,i=1e-6,s,o,u,a,f,l;for(s in t)if(s!=="useRadians"){l=(t[s]+"").split("_"),o=l[0],u=parseFloat(typeof e[s]!="function"?e[s]:e[s.indexOf("set")||typeof e["get"+s.substr(3)]!="function"?s:"get"+s.substr(3)]()),a=this.finals[s]=typeof o=="string"&&o.charAt(1)==="="?u+parseInt(o.charAt(0)+"1",10)*Number(o.substr(2)):Number(o)||0,f=a-u,l.length&&(o=l.join("_"),o.indexOf("short")!==-1&&(f%=r,f!==f%(r/2)&&(f=f<0?f+r:f-r)),o.indexOf("_cw")!==-1&&f<0?f=(f+r*9999999999)%r-(f/r|0)*r:o.indexOf("ccw")!==-1&&f>0&&(f=(f-r*9999999999)%r-(f/r|0)*r));if(f>i||f<-i)this._addTween(e,s,u,u+f,s),this._overwriteProps.push(s)}return!0},set:function(e){var t;if(e!==1)this._super.setRatio.call(this,e);else{t=this._firstPT;while(t)t.f?t.t[t.p](this.finals[t.p]):t.t[t.p]=this.finals[t.p],t=t._next}}})._autoCSS=!0,_gsScope._gsDefine("easing.Back",["easing.Ease"],function(e){var t=_gsScope.GreenSockGlobals||_gsScope,n=t.com.greensock,r=Math.PI*2,i=Math.PI/2,s=n._class,o=function(t,n){var r=s("easing."+t,function(){},!0),i=r.prototype=new e;return i.constructor=r,i.getRatio=n,r},u=e.register||function(){},a=function(e,t,n,r,i){var o=s("easing."+e,{easeOut:new t,easeIn:new n,easeInOut:new r},!0);return u(o,e),o},f=function(e,t,n){this.t=e,this.v=t,n&&(this.next=n,n.prev=this,this.c=n.v-t,this.gap=n.t-e)},l=function(t,n){var r=s("easing."+t,function(e){this._p1=e||e===0?e:1.70158,this._p2=this._p1*1.525},!0),i=r.prototype=new e;return i.constructor=r,i.getRatio=n,i.config=function(e){return new r(e)},r},c=a("Back",l("BackOut",function(e){return(e-=1)*e*((this._p1+1)*e+this._p1)+1}),l("BackIn",function(e){return e*e*((this._p1+1)*e-this._p1)}),l("BackInOut",function(e){return(e*=2)<1?.5*e*e*((this._p2+1)*e-this._p2):.5*((e-=2)*e*((this._p2+1)*e+this._p2)+2)})),h=s("easing.SlowMo",function(e,t,n){t=t||t===0?t:.7,e==null?e=.7:e>1&&(e=1),this._p=e!==1?t:0,this._p1=(1-e)/2,this._p2=e,this._p3=this._p1+this._p2,this._calcEnd=n===!0},!0),p=h.prototype=new e,d,v,m;return p.constructor=h,p.getRatio=function(e){var t=e+(.5-e)*this._p;return e<this._p1?this._calcEnd?1-(e=1-e/this._p1)*e:t-(e=1-e/this._p1)*e*e*e*t:e>this._p3?this._calcEnd?1-(e=(e-this._p3)/this._p1)*e:t+(e-t)*(e=(e-this._p3)/this._p1)*e*e*e:this._calcEnd?1:t},h.ease=new h(.7,.7),p.config=h.config=function(e,t,n){return new h(e,t,n)},d=s("easing.SteppedEase",function(e){e=e||1,this._p1=1/e,this._p2=e+1},!0),p=d.prototype=new e,p.constructor=d,p.getRatio=function(e){return e<0?e=0:e>=1&&(e=.999999999),(this._p2*e>>0)*this._p1},p.config=d.config=function(e){return new d(e)},v=s("easing.RoughEase",function(t){t=t||{};var n=t.taper||"none",r=[],i=0,s=(t.points||20)|0,o=s,u=t.randomize!==!1,a=t.clamp===!0,l=t.template instanceof e?t.template:null,c=typeof t.strength=="number"?t.strength*.4:.4,h,p,d,v,m,g;while(--o>-1)h=u?Math.random():1/s*o,p=l?l.getRatio(h):h,n==="none"?d=c:n==="out"?(v=1-h,d=v*v*c):n==="in"?d=h*h*c:h<.5?(v=h*2,d=v*v*.5*c):(v=(1-h)*2,d=v*v*.5*c),u?p+=Math.random()*d-d*.5:o%2?p+=d*.5:p-=d*.5,a&&(p>1?p=1:p<0&&(p=0)),r[i++]={x:h,y:p};r.sort(function(e,t){return e.x-t.x}),g=new f(1,1,null),o=s;while(--o>-1)m=r[o],g=new f(m.x,m.y,g);this._prev=new f(0,0,g.t!==0?g:g.next)},!0),p=v.prototype=new e,p.constructor=v,p.getRatio=function(e){var t=this._prev;if(e>t.t){while(t.next&&e>=t.t)t=t.next;t=t.prev}else while(t.prev&&e<=t.t)t=t.prev;return this._prev=t,t.v+(e-t.t)/t.gap*t.c},p.config=function(e){return new v(e)},v.ease=new v,a("Bounce",o("BounceOut",function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}),o("BounceIn",function(e){return(e=1-e)<1/2.75?1-7.5625*e*e:e<2/2.75?1-(7.5625*(e-=1.5/2.75)*e+.75):e<2.5/2.75?1-(7.5625*(e-=2.25/2.75)*e+.9375):1-(7.5625*(e-=2.625/2.75)*e+.984375)}),o("BounceInOut",function(e){var t=e<.5;return t?e=1-e*2:e=e*2-1,e<1/2.75?e=7.5625*e*e:e<2/2.75?e=7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?e=7.5625*(e-=2.25/2.75)*e+.9375:e=7.5625*(e-=2.625/2.75)*e+.984375,t?(1-e)*.5:e*.5+.5})),a("Circ",o("CircOut",function(e){return Math.sqrt(1-(e-=1)*e)}),o("CircIn",function(e){return-(Math.sqrt(1-e*e)-1)}),o("CircInOut",function(e){return(e*=2)<1?-0.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)})),m=function(t,n,i){var o=s("easing."+t,function(e,t){this._p1=e||1,this._p2=t||i,this._p3=this._p2/r*(Math.asin(1/this._p1)||0)},!0),u=o.prototype=new e;return u.constructor=o,u.getRatio=n,u.config=function(e,t){return new o(e,t)},o},a("Elastic",m("ElasticOut",function(e){return this._p1*Math.pow(2,-10*e)*Math.sin((e-this._p3)*r/this._p2)+1},.3),m("ElasticIn",function(e){return-(this._p1*Math.pow(2,10*(e-=1))*Math.sin((e-this._p3)*r/this._p2))},.3),m("ElasticInOut",function(e){return(e*=2)<1?-0.5*this._p1*Math.pow(2,10*(e-=1))*Math.sin((e-this._p3)*r/this._p2):this._p1*Math.pow(2,-10*(e-=1))*Math.sin((e-this._p3)*r/this._p2)*.5+1},.45)),a("Expo",o("ExpoOut",function(e){return 1-Math.pow(2,-10*e)}),o("ExpoIn",function(e){return Math.pow(2,10*(e-1))-.001}),o("ExpoInOut",function(e){return(e*=2)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*(e-1)))})),a("Sine",o("SineOut",function(e){return Math.sin(e*i)}),o("SineIn",function(e){return-Math.cos(e*i)+1}),o("SineInOut",function(e){return-0.5*(Math.cos(Math.PI*e)-1)})),s("easing.EaseLookup",{find:function(t){return e.map[t]}},!0),u(t.SlowMo,"SlowMo","ease,"),u(v,"RoughEase","ease,"),u(d,"SteppedEase","ease,"),c},!0)}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),function(e,t){"use strict";var n=e.GreenSockGlobals=e.GreenSockGlobals||e;if(n.TweenLite)return;var r=function(e){var t=e.split("."),r=n,i;for(i=0;i<t.length;i++)r[t[i]]=r=r[t[i]]||{};return r},i=r("com.greensock"),s=1e-10,o=function(e){var t=[],n=e.length,r;for(r=0;r!==n;t.push(e[r++]));return t},u=function(){},a=function(){var e=Object.prototype.toString,t=e.call([]);return function(n){return n!=null&&(n instanceof Array||typeof n=="object"&&!!n.push&&e.call(n)===t)}}(),f,l,c,h,p,d={},v=function(i,s,o,u){this.sc=d[i]?d[i].sc:[],d[i]=this,this.gsClass=null,this.func=o;var a=[];this.check=function(f){var l=s.length,c=l,h,p,m,g;while(--l>-1)(h=d[s[l]]||new v(s[l],[])).gsClass?(a[l]=h.gsClass,c--):f&&h.sc.push(this);if(c===0&&o){p=("com.greensock."+i).split("."),m=p.pop(),g=r(p.join("."))[m]=this.gsClass=o.apply(o,a),u&&(n[m]=g,typeof define=="function"&&define.amd?define((e.GreenSockAMDPath?e.GreenSockAMDPath+"/":"")+i.split(".").pop(),[],function(){return g}):i===t&&typeof module!="undefined"&&module.exports&&(module.exports=g));for(l=0;l<this.sc.length;l++)this.sc[l].check()}},this.check(!0)},m=e._gsDefine=function(e,t,n,r){return new v(e,t,n,r)},g=i._class=function(e,t,n){return t=t||function(){},m(e,[],function(){return t},n),t};m.globals=n;var y=[0,0,1,1],b=[],w=g("easing.Ease",function(e,t,n,r){this._func=e,this._type=n||0,this._power=r||0,this._params=t?y.concat(t):y},!0),E=w.map={},S=w.register=function(e,t,n,r){var s=t.split(","),o=s.length,u=(n||"easeIn,easeOut,easeInOut").split(","),a,f,l,c;while(--o>-1){f=s[o],a=r?g("easing."+f,null,!0):i.easing[f]||{},l=u.length;while(--l>-1)c=u[l],E[f+"."+c]=E[c+f]=a[c]=e.getRatio?e:e[c]||new e}};c=w.prototype,c._calcEnd=!1,c.getRatio=function(e){if(this._func)return this._params[0]=e,this._func.apply(null,this._params);var t=this._type,n=this._power,r=t===1?1-e:t===2?e:e<.5?e*2:(1-e)*2;return n===1?r*=r:n===2?r*=r*r:n===3?r*=r*r*r:n===4&&(r*=r*r*r*r),t===1?1-r:t===2?r:e<.5?r/2:1-r/2},f=["Linear","Quad","Cubic","Quart","Quint,Strong"],l=f.length;while(--l>-1)c=f[l]+",Power"+l,S(new w(null,null,1,l),c,"easeOut",!0),S(new w(null,null,2,l),c,"easeIn"+(l===0?",easeNone":"")),S(new w(null,null,3,l),c,"easeInOut");E.linear=i.easing.Linear.easeIn,E.swing=i.easing.Quad.easeInOut;var x=g("events.EventDispatcher",function(e){this._listeners={},this._eventTarget=e||this});c=x.prototype,c.addEventListener=function(e,t,n,r,i){i=i||0;var s=this._listeners[e],o=0,u,a;s==null&&(this._listeners[e]=s=[]),a=s.length;while(--a>-1)u=s[a],u.c===t&&u.s===n?s.splice(a,1):o===0&&u.pr<i&&(o=a+1);s.splice(o,0,{c:t,s:n,up:r,pr:i}),this===h&&!p&&h.wake()},c.removeEventListener=function(e,t){var n=this._listeners[e],r;if(n){r=n.length;while(--r>-1)if(n[r].c===t){n.splice(r,1);return}}},c.dispatchEvent=function(e){var t=this._listeners[e],n,r,i;if(t){n=t.length,r=this._eventTarget;while(--n>-1)i=t[n],i.up?i.c.call(i.s||r,{type:e,target:r}):i.c.call(i.s||r)}};var T=e.requestAnimationFrame,N=e.cancelAnimationFrame,C=Date.now||function(){return(new Date).getTime()},k=C();f=["ms","moz","webkit","o"],l=f.length;while(--l>-1&&!T)T=e[f[l]+"RequestAnimationFrame"],N=e[f[l]+"CancelAnimationFrame"]||e[f[l]+"CancelRequestAnimationFrame"];g("Ticker",function(e,t){var n=this,r=C(),i=t!==!1&&T,o=500,a=33,f,l,c,d,v,m=function(e){var t=C()-k,i,s;t>o&&(r+=t-a),k+=t,n.time=(k-r)/1e3,i=n.time-v;if(!f||i>0||e===!0)n.frame++,v+=i+(i>=d?.004:d-i),s=!0;e!==!0&&(c=l(m)),s&&n.dispatchEvent("tick")};x.call(n),n.time=n.frame=0,n.tick=function(){m(!0)},n.lagSmoothing=function(e,t){o=e||1/s,a=Math.min(t,o,0)},n.sleep=function(){if(c==null)return;!i||!N?clearTimeout(c):N(c),l=u,c=null,n===h&&(p=!1)},n.wake=function(){c!==null?n.sleep():n.frame>10&&(k=C()-o+5),l=f===0?u:!i||!T?function(e){return setTimeout(e,(v-n.time)*1e3+1|0)}:T,n===h&&(p=!0),m(2)},n.fps=function(e){if(!arguments.length)return f;f=e,d=1/(f||60),v=this.time+d,n.wake()},n.useRAF=function(e){if(!arguments.length)return i;n.sleep(),i=e,n.fps(f)},n.fps(e),setTimeout(function(){i&&(!c||n.frame<5)&&n.useRAF(!1)},1500)}),c=i.Ticker.prototype=new i.events.EventDispatcher,c.constructor=i.Ticker;var L=g("core.Animation",function(e,t){this.vars=t=t||{},this._duration=this._totalDuration=e||0,this._delay=Number(t.delay)||0,this._timeScale=1,this._active=t.immediateRender===!0,this.data=t.data,this._reversed=t.reversed===!0;if(!z)return;p||h.wake();var n=this.vars.useFrames?U:z;n.add(this,n._time),this.vars.paused&&this.paused(!0)});h=L.ticker=new i.Ticker,c=L.prototype,c._dirty=c._gc=c._initted=c._paused=!1,c._totalTime=c._time=0,c._rawPrevTime=-1,c._next=c._last=c._onUpdate=c._timeline=c.timeline=null,c._paused=!1;var A=function(){p&&C()-k>2e3&&h.wake(),setTimeout(A,2e3)};A(),c.play=function(e,t){return e!=null&&this.seek(e,t),this.reversed(!1).paused(!1)},c.pause=function(e,t){return e!=null&&this.seek(e,t),this.paused(!0)},c.resume=function(e,t){return e!=null&&this.seek(e,t),this.paused(!1)},c.seek=function(e,t){return this.totalTime(Number(e),t!==!1)},c.restart=function(e,t){return this.reversed(!1).paused(!1).totalTime(e?-this._delay:0,t!==!1,!0)},c.reverse=function(e,t){return e!=null&&this.seek(e||this.totalDuration(),t),this.reversed(!0).paused(!1)},c.render=function(e,t,n){},c.invalidate=function(){return this._time=this._totalTime=0,this._initted=this._gc=!1,this._rawPrevTime=-1,(this._gc||!this.timeline)&&this._enabled(!0),this},c.isActive=function(){var e=this._timeline,t=this._startTime,n;return!e||!this._gc&&!this._paused&&e.isActive()&&(n=e.rawTime())>=t&&n<t+this.totalDuration()/this._timeScale},c._enabled=function(e,t){return p||h.wake(),this._gc=!e,this._active=this.isActive(),t!==!0&&(e&&!this.timeline?this._timeline.add(this,this._startTime-this._delay):!e&&this.timeline&&this._timeline._remove(this,!0)),!1},c._kill=function(e,t){return this._enabled(!1,!1)},c.kill=function(e,t){return this._kill(e,t),this},c._uncache=function(e){var t=e?this:this.timeline;while(t)t._dirty=!0,t=t.timeline;return this},c._swapSelfInParams=function(e){var t=e.length,n=e.concat();while(--t>-1)e[t]==="{self}"&&(n[t]=this);return n},c.eventCallback=function(e,t,n,r){if((e||"").substr(0,2)==="on"){var i=this.vars;if(arguments.length===1)return i[e];t==null?delete i[e]:(i[e]=t,i[e+"Params"]=a(n)&&n.join("").indexOf("{self}")!==-1?this._swapSelfInParams(n):n,i[e+"Scope"]=r),e==="onUpdate"&&(this._onUpdate=t)}return this},c.delay=function(e){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+e-this._delay),this._delay=e,this):this._delay},c.duration=function(e){return arguments.length?(this._duration=this._totalDuration=e,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&e!==0&&this.totalTime(this._totalTime*(e/this._duration),!0),this):(this._dirty=!1,this._duration)},c.totalDuration=function(e){return this._dirty=!1,arguments.length?this.duration(e):this._totalDuration},c.time=function(e,t){return arguments.length?(this._dirty&&this.totalDuration(),this.totalTime(e>this._duration?this._duration:e,t)):this._time},c.totalTime=function(e,t,n){p||h.wake();if(!arguments.length)return this._totalTime;if(this._timeline){e<0&&!n&&(e+=this.totalDuration());if(this._timeline.smoothChildTiming){this._dirty&&this.totalDuration();var r=this._totalDuration,i=this._timeline;e>r&&!n&&(e=r),this._startTime=(this._paused?this._pauseTime:i._time)-(this._reversed?r-e:e)/this._timeScale,i._dirty||this._uncache(!1);if(i._timeline)while(i._timeline)i._timeline._time!==(i._startTime+i._totalTime)/i._timeScale&&i.totalTime(i._totalTime,!0),i=i._timeline}this._gc&&this._enabled(!0,!1);if(this._totalTime!==e||this._duration===0)this.render(e,t,!1),P.length&&W()}return this},c.progress=c.totalProgress=function(e,t){return arguments.length?this.totalTime(this.duration()*e,t):this._time/this.duration()},c.startTime=function(e){return arguments.length?(e!==this._startTime&&(this._startTime=e,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,e-this._delay)),this):this._startTime},c.timeScale=function(e){if(!arguments.length)return this._timeScale;e=e||s;if(this._timeline&&this._timeline.smoothChildTiming){var t=this._pauseTime,n=t||t===0?t:this._timeline.totalTime();this._startTime=n-(n-this._startTime)*this._timeScale/e}return this._timeScale=e,this._uncache(!1)},c.reversed=function(e){return arguments.length?(e!=this._reversed&&(this._reversed=e,this.totalTime(this._timeline&&!this._timeline.smoothChildTiming?this.totalDuration()-this._totalTime:this._totalTime,!0)),this):this._reversed},c.paused=function(e){if(!arguments.length)return this._paused;if(e!=this._paused&&this._timeline){!p&&!e&&h.wake();var t=this._timeline,n=t.rawTime(),r=n-this._pauseTime;!e&&t.smoothChildTiming&&(this._startTime+=r,this._uncache(!1)),this._pauseTime=e?n:null,this._paused=e,this._active=this.isActive(),!e&&r!==0&&this._initted&&this.duration()&&this.render(t.smoothChildTiming?this._totalTime:(n-this._startTime)/this._timeScale,!0,!0)}return this._gc&&!e&&this._enabled(!0,!1),this};var O=g("core.SimpleTimeline",function(e){L.call(this,0,e),this.autoRemoveChildren=this.smoothChildTiming=!0});c=O.prototype=new L,c.constructor=O,c.kill()._gc=!1,c._first=c._last=null,c._sortChildren=!1,c.add=c.insert=function(e,t,n,r){var i,s;e._startTime=Number(t||0)+e._delay,e._paused&&this!==e._timeline&&(e._pauseTime=e._startTime+(this.rawTime()-e._startTime)/e._timeScale),e.timeline&&e.timeline._remove(e,!0),e.timeline=e._timeline=this,e._gc&&e._enabled(!0,!0),i=this._last;if(this._sortChildren){s=e._startTime;while(i&&i._startTime>s)i=i._prev}return i?(e._next=i._next,i._next=e):(e._next=this._first,this._first=e),e._next?e._next._prev=e:this._last=e,e._prev=i,this._timeline&&this._uncache(!0),this},c._remove=function(e,t){return e.timeline===this&&(t||e._enabled(!1,!0),e._prev?e._prev._next=e._next:this._first===e&&(this._first=e._next),e._next?e._next._prev=e._prev:this._last===e&&(this._last=e._prev),e._next=e._prev=e.timeline=null,this._timeline&&this._uncache(!0)),this},c.render=function(e,t,n){var r=this._first,i;this._totalTime=this._time=this._rawPrevTime=e;while(r){i=r._next;if(r._active||e>=r._startTime&&!r._paused)r._reversed?r.render((r._dirty?r.totalDuration():r._totalDuration)-(e-r._startTime)*r._timeScale,t,n):r.render((e-r._startTime)*r._timeScale,t,n);r=i}},c.rawTime=function(){return p||h.wake(),this._totalTime};var M=g("TweenLite",function(t,n,r){L.call(this,n,r),this.render=M.prototype.render;if(t==null)throw"Cannot tween a null target.";this.target=t=typeof t!="string"?t:M.selector(t)||t;var i=t.jquery||t.length&&t!==e&&t[0]&&(t[0]===e||t[0].nodeType&&t[0].style&&!t.nodeType),u=this.vars.overwrite,f,l,c;this._overwrite=u=u==null?R[M.defaultOverwrite]:typeof u=="number"?u>>0:R[u];if((i||t instanceof Array||t.push&&a(t))&&typeof t[0]!="number"){this._targets=c=o(t),this._propLookup=[],this._siblings=[];for(f=0;f<c.length;f++){l=c[f];if(!l){c.splice(f--,1);continue}if(typeof l=="string"){l=c[f--]=M.selector(l),typeof l=="string"&&c.splice(f+1,1);continue}if(l.length&&l!==e&&l[0]&&(l[0]===e||l[0].nodeType&&l[0].style&&!l.nodeType)){c.splice(f--,1),this._targets=c=c.concat(o(l));continue}this._siblings[f]=X(l,this,!1),u===1&&this._siblings[f].length>1&&V(l,this,null,1,this._siblings[f])}}else this._propLookup={},this._siblings=X(t,this,!1),u===1&&this._siblings.length>1&&V(t,this,null,1,this._siblings);if(this.vars.immediateRender||n===0&&this._delay===0&&this.vars.immediateRender!==!1)this._time=-s,this.render(-this._delay)},!0),_=function(t){return t.length&&t!==e&&t[0]&&(t[0]===e||t[0].nodeType&&t[0].style&&!t.nodeType)},D=function(e,t){var n={},r;for(r in e)!q[r]&&(!(r in t)||r==="transform"||r==="x"||r==="y"||r==="width"||r==="height"||r==="className"||r==="border")&&(!j[r]||j[r]&&j[r]._autoCSS)&&(n[r]=e[r],delete e[r]);e.css=n};c=M.prototype=new L,c.constructor=M,c.kill()._gc=!1,c.ratio=0,c._firstPT=c._targets=c._overwrittenProps=c._startAt=null,c._notifyPluginsOfEnabled=c._lazy=!1,M.version="1.13.2",M.defaultEase=c._ease=new w(null,null,1,1),M.defaultOverwrite="auto",M.ticker=h,M.autoSleep=!0,M.lagSmoothing=function(e,t){h.lagSmoothing(e,t)},M.selector=e.$||e.jQuery||function(t){var n=e.$||e.jQuery;return n?(M.selector=n,n(t)):typeof document=="undefined"?t:document.querySelectorAll?document.querySelectorAll(t):document.getElementById(t.charAt(0)==="#"?t.substr(1):t)};var P=[],H={},B=M._internals={isArray:a,isSelector:_,lazyTweens:P},j=M._plugins={},F=B.tweenLookup={},I=0,q=B.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1,lazy:1},R={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,"true":1,"false":0},U=L._rootFramesTimeline=new O,z=L._rootTimeline=new O,W=B.lazyRender=function(){var e=P.length;H={};while(--e>-1)f=P[e],f&&f._lazy!==!1&&(f.render(f._lazy[0],f._lazy[1],!0),f._lazy=!1);P.length=0};z._startTime=h.time,U._startTime=h.frame,z._active=U._active=!0,setTimeout(W,1),L._updateRoot=M.render=function(){var e,t,n;P.length&&W(),z.render((h.time-z._startTime)*z._timeScale,!1,!1),U.render((h.frame-U._startTime)*U._timeScale,!1,!1),P.length&&W();if(!(h.frame%120)){for(n in F){t=F[n].tweens,e=t.length;while(--e>-1)t[e]._gc&&t.splice(e,1);t.length===0&&delete F[n]}n=z._first;if(!n||n._paused)if(M.autoSleep&&!U._first&&h._listeners.tick.length===1){while(n&&n._paused)n=n._next;n||h.sleep()}}},h.addEventListener("tick",L._updateRoot);var X=function(e,t,n){var r=e._gsTweenID,i,s;F[r||(e._gsTweenID=r="t"+I++)]||(F[r]={target:e,tweens:[]});if(t){i=F[r].tweens,i[s=i.length]=t;if(n)while(--s>-1)i[s]===t&&i.splice(s,1)}return F[r].tweens},V=function(e,t,n,r,i){var o,u,a,f;if(r===1||r>=4){f=i.length;for(o=0;o<f;o++)if((a=i[o])!==t)a._gc||a._enabled(!1,!1)&&(u=!0);else if(r===5)break;return u}var l=t._startTime+s,c=[],h=0,p=t._duration===0,d;o=i.length;while(--o>-1)(a=i[o])!==t&&!a._gc&&!a._paused&&(a._timeline!==t._timeline?(d=d||$(t,0,p),$(a,d,p)===0&&(c[h++]=a)):a._startTime<=l&&a._startTime+a.totalDuration()/a._timeScale>l&&((p||!a._initted)&&l-a._startTime<=2e-10||(c[h++]=a)));o=h;while(--o>-1)a=c[o],r===2&&a._kill(n,e)&&(u=!0),(r!==2||!a._firstPT&&a._initted)&&a._enabled(!1,!1)&&(u=!0);return u},$=function(e,t,n){var r=e._timeline,i=r._timeScale,o=e._startTime;while(r._timeline){o+=r._startTime,i*=r._timeScale;if(r._paused)return-100;r=r._timeline}return o/=i,o>t?o-t:n&&o===t||!e._initted&&o-t<2*s?s:(o+=e.totalDuration()/e._timeScale/i)>t+s?0:o-t-s};c._init=function(){var e=this.vars,t=this._overwrittenProps,n=this._duration,r=!!e.immediateRender,i=e.ease,s,o,u,a,f;if(e.startAt){this._startAt&&(this._startAt.render(-1,!0),this._startAt.kill()),f={};for(a in e.startAt)f[a]=e.startAt[a];f.overwrite=!1,f.immediateRender=!0,f.lazy=r&&e.lazy!==!1,f.startAt=f.delay=null,this._startAt=M.to(this.target,0,f);if(r)if(this._time>0)this._startAt=null;else if(n!==0)return}else if(e.runBackwards&&n!==0)if(this._startAt)this._startAt.render(-1,!0),this._startAt.kill(),this._startAt=null;else{this._time!==0&&(r=!1),u={};for(a in e)if(!q[a]||a==="autoCSS")u[a]=e[a];u.overwrite=0,u.data="isFromStart",u.lazy=r&&e.lazy!==!1,u.immediateRender=r,this._startAt=M.to(this.target,0,u);if(!r)this._startAt._init(),this._startAt._enabled(!1),this.vars.immediateRender&&(this._startAt=null);else if(this._time===0)return}this._ease=i=i?i instanceof w?i:typeof i=="function"?new w(i,e.easeParams):E[i]||M.defaultEase:M.defaultEase,e.easeParams instanceof Array&&i.config&&(this._ease=i.config.apply(i,e.easeParams)),this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null;if(this._targets){s=this._targets.length;while(--s>-1)this._initProps(this._targets[s],this._propLookup[s]={},this._siblings[s],t?t[s]:null)&&(o=!0)}else o=this._initProps(this.target,this._propLookup,this._siblings,t);o&&M._onPluginEvent("_onInitAllProps",this),t&&(this._firstPT||typeof this.target!="function"&&this._enabled(!1,!1));if(e.runBackwards){u=this._firstPT;while(u)u.s+=u.c,u.c=-u.c,u=u._next}this._onUpdate=e.onUpdate,this._initted=!0},c._initProps=function(t,n,r,i){var s,o,u,f,l,c;if(t==null)return!1;H[t._gsTweenID]&&W(),this.vars.css||t.style&&t!==e&&t.nodeType&&j.css&&this.vars.autoCSS!==!1&&D(this.vars,t);for(s in this.vars){c=this.vars[s];if(q[s])c&&(c instanceof Array||c.push&&a(c))&&c.join("").indexOf("{self}")!==-1&&(this.vars[s]=c=this._swapSelfInParams(c,this));else if(j[s]&&(f=new j[s])._onInitTween(t,this.vars[s],this)){this._firstPT=l={_next:this._firstPT,t:f,p:"setRatio",s:0,c:1,f:!0,n:s,pg:!0,pr:f._priority},o=f._overwriteProps.length;while(--o>-1)n[f._overwriteProps[o]]=this._firstPT;if(f._priority||f._onInitAllProps)u=!0;if(f._onDisable||f._onEnable)this._notifyPluginsOfEnabled=!0}else this._firstPT=n[s]=l={_next:this._firstPT,t:t,p:s,f:typeof t[s]=="function",n:s,pg:!1,pr:0},l.s=l.f?t[s.indexOf("set")||typeof t["get"+s.substr(3)]!="function"?s:"get"+s.substr(3)]():parseFloat(t[s]),l.c=typeof c=="string"&&c.charAt(1)==="="?parseInt(c.charAt(0)+"1",10)*Number(c.substr(2)):Number(c)-l.s||0;l&&l._next&&(l._next._prev=l)}return i&&this._kill(i,t)?this._initProps(t,n,r,i):this._overwrite>1&&this._firstPT&&r.length>1&&V(t,this,n,this._overwrite,r)?(this._kill(n,t),this._initProps(t,n,r,i)):(this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration)&&(H[t._gsTweenID]=!0),u)},c.render=function(e,t,n){var r=this._time,i=this._duration,o=this._rawPrevTime,u,a,f,l;if(e>=i)this._totalTime=this._time=i,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1,this._reversed||(u=!0,a="onComplete"),i===0&&(this._initted||!this.vars.lazy||n)&&(this._startTime===this._timeline._duration&&(e=0),(e===0||o<0||o===s)&&o!==e&&(n=!0,o>s&&(a="onReverseComplete")),this._rawPrevTime=l=!t||e||o===e?e:s);else if(e<1e-7){this._totalTime=this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0;if(r!==0||i===0&&o>0&&o!==s)a="onReverseComplete",u=this._reversed;e<0&&(this._active=!1,i===0&&(this._initted||!this.vars.lazy||n)&&(o>=0&&(n=!0),this._rawPrevTime=l=!t||e||o===e?e:s)),this._initted||(n=!0)}else{this._totalTime=this._time=e;if(this._easeType){var c=e/i,h=this._easeType,p=this._easePower;if(h===1||h===3&&c>=.5)c=1-c;h===3&&(c*=2),p===1?c*=c:p===2?c*=c*c:p===3?c*=c*c*c:p===4&&(c*=c*c*c*c),h===1?this.ratio=1-c:h===2?this.ratio=c:e/i<.5?this.ratio=c/2:this.ratio=1-c/2}else this.ratio=this._ease.getRatio(e/i)}if(this._time===r&&!n)return;if(!this._initted){this._init();if(!this._initted||this._gc)return;if(!n&&this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration)){this._time=this._totalTime=r,this._rawPrevTime=o,P.push(this),this._lazy=[e,t];return}this._time&&!u?this.ratio=this._ease.getRatio(this._time/i):u&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(this._time===0?0:1))}this._lazy!==!1&&(this._lazy=!1),this._active||!this._paused&&this._time!==r&&e>=0&&(this._active=!0),r===0&&(this._startAt&&(e>=0?this._startAt.render(e,t,n):a||(a="_dummyGS")),this.vars.onStart&&(this._time!==0||i===0)&&(t||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||b))),f=this._firstPT;while(f)f.f?f.t[f.p](f.c*this.ratio+f.s):f.t[f.p]=f.c*this.ratio+f.s,f=f._next;this._onUpdate&&(e<0&&this._startAt&&this._startTime&&this._startAt.render(e,t,n),t||(this._time!==r||u)&&this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||b)),a&&(!this._gc||n)&&(e<0&&this._startAt&&!this._onUpdate&&this._startTime&&this._startAt.render(e,t,n),u&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!t&&this.vars[a]&&this.vars[a].apply(this.vars[a+"Scope"]||this,this.vars[a+"Params"]||b),i===0&&this._rawPrevTime===s&&l!==s&&(this._rawPrevTime=0))},c._kill=function(e,t){e==="all"&&(e=null);if(e==null)if(t==null||t===this.target)return this._lazy=!1,this._enabled(!1,!1);t=typeof t!="string"?t||this._targets||this.target:M.selector(t)||t;var n,r,i,s,o,u,f,l;if((a(t)||_(t))&&typeof t[0]!="number"){n=t.length;while(--n>-1)this._kill(e,t[n])&&(u=!0)}else{if(this._targets){n=this._targets.length;while(--n>-1)if(t===this._targets[n]){o=this._propLookup[n]||{},this._overwrittenProps=this._overwrittenProps||[],r=this._overwrittenProps[n]=e?this._overwrittenProps[n]||{}:"all";break}}else{if(t!==this.target)return!1;o=this._propLookup,r=this._overwrittenProps=e?this._overwrittenProps||{}:"all"}if(o){f=e||o,l=e!==r&&r!=="all"&&e!==o&&(typeof e!="object"||!e._tempKill);for(i in f){if(s=o[i]){s.pg&&s.t._kill(f)&&(u=!0);if(!s.pg||s.t._overwriteProps.length===0)s._prev?s._prev._next=s._next:s===this._firstPT&&(this._firstPT=s._next),s._next&&(s._next._prev=s._prev),s._next=s._prev=null;delete o[i]}l&&(r[i]=1)}!this._firstPT&&this._initted&&this._enabled(!1,!1)}}return u},c.invalidate=function(){return this._notifyPluginsOfEnabled&&M._onPluginEvent("_onDisable",this),this._firstPT=this._overwrittenProps=this._startAt=this._onUpdate=null,this._notifyPluginsOfEnabled=this._active=this._lazy=!1,this._propLookup=this._targets?{}:[],L.prototype.invalidate.call(this),this.vars.immediateRender&&(this._time=-s,this.render(-this._delay)),this},c._enabled=function(e,t){p||h.wake();if(e&&this._gc){var n=this._targets,r;if(n){r=n.length;while(--r>-1)this._siblings[r]=X(n[r],this,!0)}else this._siblings=X(this.target,this,!0)}return L.prototype._enabled.call(this,e,t),this._notifyPluginsOfEnabled&&this._firstPT?M._onPluginEvent(e?"_onEnable":"_onDisable",this):!1},M.to=function(e,t,n){return new M(e,t,n)},M.from=function(e,t,n){return n.runBackwards=!0,n.immediateRender=n.immediateRender!=0,new M(e,t,n)},M.fromTo=function(e,t,n,r){return r.startAt=n,r.immediateRender=r.immediateRender!=0&&n.immediateRender!=0,new M(e,t,r)},M.delayedCall=function(e,t,n,r,i){return new M(t,0,{delay:e,onComplete:t,onCompleteParams:n,onCompleteScope:r,onReverseComplete:t,onReverseCompleteParams:n,onReverseCompleteScope:r,immediateRender:!1,useFrames:i,overwrite:0})},M.set=function(e,t){return new M(e,0,t)},M.getTweensOf=function(e,t){if(e==null)return[];e=typeof e!="string"?e:M.selector(e)||e;var n,r,i,s;if((a(e)||_(e))&&typeof e[0]!="number"){n=e.length,r=[];while(--n>-1)r=r.concat(M.getTweensOf(e[n],t));n=r.length;while(--n>-1){s=r[n],i=n;while(--i>-1)s===r[i]&&r.splice(n,1)}}else{r=X(e).concat(),n=r.length;while(--n>-1)(r[n]._gc||t&&!r[n].isActive())&&r.splice(n,1)}return r},M.killTweensOf=M.killDelayedCallsTo=function(e,t,n){typeof t=="object"&&(n=t,t=!1);var r=M.getTweensOf(e,t),i=r.length;while(--i>-1)r[i]._kill(n,e)};var J=g("plugins.TweenPlugin",function(e,t){this._overwriteProps=(e||"").split(","),this._propName=this._overwriteProps[0],this._priority=t||0,this._super=J.prototype},!0);c=J.prototype,J.version="1.10.1",J.API=2,c._firstPT=null,c._addTween=function(e,t,n,r,i,s){var o,u;if(r!=null&&(o=typeof r=="number"||r.charAt(1)!=="="?Number(r)-n:parseInt(r.charAt(0)+"1",10)*Number(r.substr(2))))return this._firstPT=u={_next:this._firstPT,t:e,p:t,s:n,c:o,f:typeof e[t]=="function",n:i||t,r:s},u._next&&(u._next._prev=u),u},c.setRatio=function(e){var t=this._firstPT,n=1e-6,r;while(t)r=t.c*e+t.s,t.r?r=Math.round(r):r<n&&r>-n&&(r=0),t.f?t.t[t.p](r):t.t[t.p]=r,t=t._next},c._kill=function(e){var t=this._overwriteProps,n=this._firstPT,r;if(e[this._propName]!=null)this._overwriteProps=[];else{r=t.length;while(--r>-1)e[t[r]]!=null&&t.splice(r,1)}while(n)e[n.n]!=null&&(n._next&&(n._next._prev=n._prev),n._prev?(n._prev._next=n._next,n._prev=null):this._firstPT===n&&(this._firstPT=n._next)),n=n._next;return!1},c._roundProps=function(e,t){var n=this._firstPT;while(n){if(e[this._propName]||n.n!=null&&e[n.n.split(this._propName+"_").join("")])n.r=t;n=n._next}},M._onPluginEvent=function(e,t){var n=t._firstPT,r,i,s,o,u;if(e==="_onInitAllProps"){while(n){u=n._next,i=s;while(i&&i.pr>n.pr)i=i._next;(n._prev=i?i._prev:o)?n._prev._next=n:s=n,(n._next=i)?i._prev=n:o=n,n=u}n=t._firstPT=s}while(n)n.pg&&typeof n.t[e]=="function"&&n.t[e]()&&(r=!0),n=n._next;return r},J.activate=function(e){var t=e.length;while(--t>-1)e[t].API===J.API&&(j[(new e[t])._propName]=e[t]);return!0},m.plugin=function(e){if(!e||!e.propName||!e.init||!e.API)throw"illegal plugin definition.";var t=e.propName,n=e.priority||0,r=e.overwriteProps,i={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_roundProps",initAll:"_onInitAllProps"},s=g("plugins."+t.charAt(0).toUpperCase()+t.substr(1)+"Plugin",function(){J.call(this,t,n),this._overwriteProps=r||[]},e.global===!0),o=s.prototype=new J(t),u;o.constructor=s,s.API=e.API;for(u in i)typeof e[u]=="function"&&(o[i[u]]=e[u]);return s.version=e.version,J.activate([s]),s},f=e._gsQueue;if(f){for(l=0;l<f.length;l++)f[l]();for(c in d)d[c].func||e.console.log("GSAP encountered missing dependency: com.greensock."+c)}p=!1}(typeof module!="undefined"&&module.exports&&typeof global!="undefined"?global:this||window,"TweenMax"),define("greensock/TweenMax",function(){}),define("/Users/blues/projects/epub360/1-src/epub360-built/html/thirdparty/GreenSock-JS-1.13.2/src/uncompressed/TweenMax.js",function(){});define("text",["module"],function(e){"use strict";var t,n,r,i,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,u=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,a=typeof location!="undefined"&&location.href,f=a&&location.protocol&&location.protocol.replace(/\:/,""),l=a&&location.hostname,c=a&&(location.port||undefined),h=[],p=e.config&&e.config()||{};t={version:"2.0.5+",strip:function(e){if(e){e=e.replace(o,"");var t=e.match(u);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=s[t];try{e=new ActiveXObject(n)}catch(r){}if(e){s=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,p.isBuild&&(h[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}p.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),h=p.useXhr||t.useXhr;!a||h(u,f,l,c)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(h.hasOwnProperty(n)){var s=t.jsEscape(h[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(p.env==="node"||!p.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("﻿")===0&&(r=r.substring(1)),t(r)};else if(p.env==="xhr"||!p.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);p.onXhr&&p.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText))},s.send(null)};else if(p.env==="rhino"||!p.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(p.env==="xpconnect"||!p.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),t.get=function(e,t){var n,s,o={},u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),s=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),s.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(n.available(),o),s.close(),n.close(),t(o.value)}catch(a){throw new Error((u&&u.path||"")+": "+a)}};return t});define("text!interaction_view/template/staticitem_view.js",[],function(){return'<div class="iView static hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="position:absolute; left: <%=iCommon[iPageDirection].iStartx%>px; top: <%=iCommon[iPageDirection].iStarty%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px; backgroud-repeat:no-repeat;background-postion:center;">\n    <%if(iType==\'Cell\'){%>\n        <div class="iCell Element" style="overflow:hidden;position:absolute;left: 0px; top:0px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow:hidden;">\n        </div>\n    <%}%>\n    <%if(iType=="UserSVG"){%>\n        <div class="iUserSVG Element" style="overflow:hidden;position:absolute;left: 0; top: 0;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">\n            <%=iDetail.iSvg%>\n        </div>\n    <%}%>    \n</div>\n'});define("text!interaction_view/template/message.js",[],function(){return'<div class="status <%=type%>">\n<p><%=msg%></p>\n<a href="#" class="close">Close</a>\n</div>'});define("text!interaction_view/template/slidenumber.js",[],function(){return'<%if(slidelength>1){%>\n<% if(iDetail.slideno_horizontal){%>\n<nav class="iView nav-horizen slidenumber" data-id="<%=id%>" style="left:<%=iDetail.slideno_horizontal_data.x%>px;top:<%=iDetail.slideno_horizontal_data.y%>px;">\n    <%for(i=0;i<slidelength;i++){%><li class="<%=0==i?"active":""%>"><a href="#" data-index="<%=i%>"></a></li><% } %>\n</nav>\n<% } %>\n<% if(iDetail.slideno_vertical){%>\n<nav class="iView nav-vertical slidenumber" data-id="<%=id%>" style="left:<%=iDetail.slideno_vertical_data.x%>px;top:<%=iDetail.slideno_vertical_data.y%>px;">\n    <%for(i=0;i<slidelength;i++){%><li class="<%=0==i?"active":""%>"><a href="#" data-index="<%=i%>"></a></li><% } %>\n</nav>\n<% } %>\n<% } %>\n'});define("text!interaction_view/template/imgpreview.js",[],function(){return'<div class="btn-group action-control" style="position: absolute;left: 0;top: 0;z-index: 100001;background: transparent;width: 100%;height: 100%;">\n    <button class="btn preview-left enabled" href="#" rel="tooltip" data-original-title="PREV" style="color: #FFF;position: absolute;left: 0;top: 50%;background-color: transparent;background: none;">\n        <i class="icon-chevron-left icon-2x"></i>\n    </button>\n    <button class="btn preview-right enabled" href="#" rel="tooltip" data-original-title="NEXT" style="color: #FFF;background: transparent;position: absolute;right: 0px;top: 50%;">\n        <i class="icon-chevron-right icon-2x"></i>\n    </button>\n</div>'});(function(){var e={uuid:function(e){function t(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}if(!e)return t()+t()+t()+t()+t()+t()+t()+t();var n="";while(e--)n+=t();return n},getUrlParameterByName:function(e,t){var n=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),r=new RegExp("[\\?&]"+n+"=([^&#]*)"),i=r.exec(typeof t!="undefined"&&t||location.search);return i==null?null:decodeURIComponent(i[1].replace(/\+/g," "))},replaceUrlParameterByName:function(e,t,n){var r=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),i=typeof n!="undefined"&&n||location.search,s=new RegExp("[\\?&]"+r+"=([^&#]*)"),o=s.exec(i);return o==null?i+"&"+t:i.replace(o[0].substr(1),t)},getHashParameterByName:function(e){var t=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),n=new RegExp("[\\#&]"+t+"=([^&#]*)"),r=n.exec(location.hash);return r==null?null:decodeURIComponent(r[1].replace(/\+/g," "))},replaceHashParameterByName:function(e,t){var n=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),r=new RegExp("[\\#&]"+n+"=([^&#]*)"),i=r.exec(location.hash);return location.hash.replace(i[0].substr(1),t)},parseTemplate:function(e){var t=null;return typeof e=="function"&&(t=e),typeof e=="string"&&(t=_.template(e)),t},renderT:function(e,t,n,r,i){if(!e)return!1;t||(t={});var s=r||null,o=$.extend(!0,{},t);s&&typeof _gDebug!="undefined"&&_gDebug&&_g.debug&&_g.debug.enabled&&_g.debug.query_user_template(s)&&!i&&(e=_g.debug.query_user_template(s));if(n){var u={};u[n]=o,o=u}var a=_g.parseTemplate(e);s&&_g.debug&&_g.debug.enabled&&(_g.debug.template[s]={data:o,template:typeof e=="string"?e:e.textsource,debug:!0});var f=$(a(o));return s&&_g.debug&&_g.debug.enabled&&(_g.debug.template[s].el=f),_g.generator&&(_g.generator.autoWidget(f),(f.hasClass("c-slimscroll")||f.find(".c-slimscroll").length)&&_g.generator.autoScroll(f)),f.find("[data-toggle=tooltip],.c-tooltip-btn").each(function(){var e=$(this),t=$(this).data().template;t?require(["text!"+t],function(){var n=require("text!"+t);e.tooltip({template:n})}):$(this).tooltip()}),f},domExist:function(e,t){return t||(t=document),typeof e=="string"&&(e=$(e)),jQuery.contains(t.documentElement,e[0])},browserSupport:function(e){var t=!1,n={msie:1,chrome:1,mozilla:1,safari:1,opera:1,success:null,fail:null};e=e?$.extend(!0,{},n,e):$.extend(!0,{},n);var r=parseInt($.browser.version,10);return $.browser.msie&&e.msie==1||$.browser.chrome&&e.chrome==1||$.browser.mozilla&&e.mozilla==1||$.browser.safari&&e.safrai==1&&$.browser.opera&&e.opera==1?t=!0:$.browser.msie&&e.msie==0||$.browser.chrome&&e.chrome==0||$.browser.mozilla&&e.mozilla==0||$.browser.safari&&e.safrai==0&&$.browser.opera&&e.opera==0?t=!1:($.browser.msie&&(t=r>=e.msie),$.browser.chrome&&(t=r>=e.chrome),$.browser.mozilla&&(t=r>=e.mozilla),$.browser.opera&&(t=r>=e.opera),$.browser.safari&&(t=r>=e.safari)),t?e.success&&e.success():e.fail&&e.fail(),t},array:{moveup:function(e,t){var n=e.indexOf(t);return n>0&&(e=_g.array.swap(e,n,n-1)),e},movedown:function(e,t){var n=e.indexOf(t);return n<e.length&&(e=_g.array.swap(e,n,n+1)),e},swap:function(e,t,n){return e[t]=e.splice(n,1,e[t])[0],e},move2first:function(e,t){var n=[];n.push(t);for(i=0;i<e.length;i++)e[i]!=t&&n.push(e[i]);return n},move2last:function(e,t){var n=[];for(i=0;i<e.length;i++)e[i]!=t&&n.push(e[i]);return n.push(t),n},randomPick:function(e){return e[Math.floor(Math.random()*e.length)]},maptree:function(e){var t={treesource:null,mapdata:null,idAttribute:"id"};e=e?$.extend(!0,{},t,e):$.extend(!0,{},t);if(!e.treesource||!e.mapdata)return[];var n=[];return _.each(e.treesource,function(t){t.children&&(t.children=_g.array.maptree({treesource:t.children,mapdata:e.mapdata,idAttribute:e.idAttribute}));var r=_.find(e.mapdata,function(n){return n[e.idAttribute]==t[e.idAttribute]});r&&(t=$.extend(!0,t,r)),n.push(t)}),n},toDict:function(e,t){var n={},r;for(i=0;i<e.length;i++)r=e[i][t],n[r]=e[i];return n},treeToList:function(e,t,n){var r={childrenKey:"children",parentKey:"parent",idAttribute:"id"};t=t?$.extend(!0,{},r,t):$.extend(!0,{},r);if(!e)return[];var i=[];return _.each(e,function(r){if(r[t.childrenKey].length){var s=_g.array.toTreeList(r[t.childrenKey],t,n?n:e);for(j=0;j<s.length;j++)i.push(s[j]);r.children=_.pluck(r.children,"id")}else delete r.children;i.push(r)}),i},listToTree:function(e,t,n){var r={childrenKey:"children",parentKey:"parent",idAttribute:"id"};t=t?$.extend(!0,{},r,t):$.extend(!0,{},r);var i=[];return n&&(e=_.map(e,function(e){return typeof e=="string"&&(e=_.find(n,function(n){return n[t.idAttribute]==e})),e})),_.each(e,function(r){var s=$.extend(!0,{},r);n||s[t.parentKey],s[t.childrenKey]&&s[t.childrenKey].length?(s[t.childrenKey]=_g.array.listToTree(s[t.childrenKey],t,n?n:e),i.push(s)):i.push(s)}),i}},object:{jsonparse:function(e){if(!e)return null;try{return a=JSON.parse(e),a}catch(t){return e}},equal:function(e,t){},treeToArray:function(e){},getKeyByValue:function(e,t){try{var n=_.keys(e)[_.values(e).indexOf(t)];return n}catch(r){return undefined}}},string:{randomGenerate:function(e){e=e?e:10;var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890";for(var r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t},getUrlExt:function(e){return e.match(/(.[^.]+|)$/)[0]},getUrlNameWithOutExt:function(e){return e.substr(0,e.lastIndexOf("."))||e},getFileNameByPath:function(e){return e.replace(/^.*[\\\/]/,"")},string2boolean:function(e){return e=="true"?!0:!1},capitalize:function(e){return e=e.substring(0,1).toUpperCase()+e.substring(1),e},rmfirst:function(e){return e.replace(/^.(\s+)?/,"")},rmlast:function(e){return e.replace(/(\s+)?.$/,"")},isPureEng:function(e){var t=0,n=e;if(n=="")return!0;for(var r=0;r<n.length;r++)if(!(n.charCodeAt(r)>=48&&n.charCodeAt(r)<=57||n.charCodeAt(r)>=65&&n.charCodeAt(r)<=90||n.charCodeAt(r)>=97&&n.charCodeAt(r)<=122))return!1;return!0},isEng:function(e){var t=0,n=e;if(n=="")return!0;for(var r=0;r<n.length;r++)if(!(n.charCodeAt(r)==32||n.charCodeAt(r)>=48&&n.charCodeAt(r)<=57||n.charCodeAt(r)>=65&&n.charCodeAt(r)<=90||n.charCodeAt(r)>=97&&n.charCodeAt(r)<=122))return!1;return!0},isPureChi:function(e){var t=0,n=e;if(n=="")return!0;for(var r=0;r<n.length;r++)if(!(n.charCodeAt(r)>=19968&&n.charCodeAt(r)<=64041))return!1;return!0},isChi:function(e){var t=0,n=e;if(n=="")return!0;for(var r=0;r<n.length;r++)if(!(n.charCodeAt(r)==32||n.charCodeAt(r)>=19968&&n.charCodeAt(r)<=64041))return!1;return!0},autoName:function(e,t,n,r){e||(e=""),n||(n=""),r||(r=1);var i=e+r+n;return t.indexOf(i)!=-1?_g.string.autoName(e,t,n,r+1):i}},"boolean":{randomPick:function(){return!!Math.round(Math.random()*1)}},number:{random:function(e,t){return typeof e=="undefined"&&(e=0),typeof t=="undefined"&&(t=100),Math.random()*(t-e)+e},randomInt:function(e,t){return typeof e=="undefined"&&(e=0),typeof t=="undefined"&&(t=100),Math.floor(Math.random()*(t-e+1))+e},round:function(e,t){var n=e;typeof t==undefined&&(t=.5);var r=parseInt(e),i=e-r;i<t?n=r:n=r+1},rgbToHex:function(e,t,n){return"#"+((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)},hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,n,r){return t+t+n+n+r+r});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null},decimal:function(e,t){return Number(e.toFixed(t))}},hasTouch:function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}(),inIframe:function(){try{return window.self!==window.top}catch(e){return!0}},supportFlash:function(){return typeof swfobject!="undefined"&&swfobject.getFlashPlayerVersion().major!==0?!0:!1},isMSIE11:function(){return!!navigator.userAgent.match(/Trident\/7\./)},getRGBA:function(e,t){t=t!=undefined?Number(t):1;if(!e)return"transparent";var n=_g.number.hexToRgb(e);if(n)var r="rgba("+n.r+","+n.g+","+n.b+","+t+")";else r="rgba(255,255,255,1)";return r},weixinShare:function(){if(typeof wx_permissions!="undefined"&&wx_permissions.onMenuShareTimeline){var e=message_link+(message_link.indexOf("disableHistoryStart=0")>=0?"#page/"+interaction_view.currentPage:""),t=shareTitle==bookTitle?descContent:shareTitle;wx.onMenuShareAppMessage({title:bookTitle,desc:t,link:e,imgUrl:imgUrl,trigger:function(e){_gaq.push(["_trackEvent","weixin","share","appmessage","click"])},success:function(e){_gaq.push(["_trackSocial","Wechat","appmessage",ga_opt_target,ga_opt_pagePath])},cancel:function(e){_gaq.push(["_trackEvent","weixin","share","appmessage","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","appmessage",JSON.stringify(e)])}}),wx.onMenuShareTimeline({title:shareTitle,link:e,imgUrl:imgUrl,trigger:function(e){_gaq.push(["_trackEvent","weixin","share","timeline","click"])},success:function(e){_gaq.push(["_trackSocial","Wechat","timeline",ga_opt_target,ga_opt_pagePath])},cancel:function(e){_gaq.push(["_trackEvent","weixin","share","timeline","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","timeline",JSON.stringify(e)])}}),wx.onMenuShareQQ({title:bookTitle,desc:t,link:e,imgUrl:imgUrl,trigger:function(e){_gaq.push(["_trackEvent","weixin","share","QQ","click"])},complete:function(e){_gaq.push(["_trackEvent","weixin","share","QQ","complete"])},success:function(e){_gaq.push(["_trackSocial","Wechat","QQ",ga_opt_target,ga_opt_pagePath])},cancel:function(e){_gaq.push(["_trackEvent","weixin","share","QQ","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","QQ",JSON.stringify(e)])}}),wx.onMenuShareWeibo({title:shareTitle,desc:descContent,link:message_link,imgUrl:imgUrl,trigger:function(e){_gaq.push(["_trackEvent","weixin","share","Weibo","click"])},complete:function(e){_gaq.push(["_trackEvent","weixin","share","Weibo","complete"])},success:function(e){_gaq.push(["_trackSocial","Wechat","Weibo",ga_opt_target,ga_opt_pagePath])},cancel:function(e){_gaq.push(["_trackEvent","weixin","share","Weibo","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","Weibo",JSON.stringify(e)])}})}}};typeof require=="undefined"?(window._g||(window._g={}),window._g=$.extend(!0,{},window._g,e),e=undefined):define("_g/base",["jquery","backbone"],function(){return window._g||(window._g={}),window._g=$.extend(!0,{},window._g,e),e=undefined,window._g})})(window);(function(){var e={log:function(e){console.log(e)},serverError:function(e){$(document).trigger("serverError"),_g.error[e]&&_g.error[e]()}};typeof require=="undefined"?(window._g||(window._g={}),window._g.error=e):define("_g/error",["_g/base"],function(){return window._g.error=e,window._g.error})})(window);(function(){var e={buttonGroupT:['<div class="_g_btn_group <%=opts.className||""%>">',"</div>"].join(""),buttonT:'   <button class="btn _g_btn _g_btn_confirm <%=opts.className||""%>" type="button" data-name="<%=opts.name%>"><%=opts.name%></button>',buttonGroupList:[],scale:function(e,t){$(e).css("zoom",t).css("-moz-transform","scale("+t+")").css("-o-transform","scale("+t+")")},center:function(e){var t={containment:null};typeof e=="string"?e={containments:null,Item:e}:e=e?$.extend({},t,e):t;if(!e.Item)return!1;$(e.Item).css({left:"50%",top:"50%","margin-top":function(){return-($(this).height()/2)},"margin-left":function(){return-($(this).width()/2)}})},centerImage:function(e){var t={containment:null,parentWidth:null,parentHeight:null,width:null,height:null,setParent:!0};e=e?$.extend({},t,e):t;if(!e.Item||!e.containment)return!1;var n=0,r=0;return e.setParent&&$(e.containment).css({"line-height":e.parentHeight+"px","text-align":"center"}),e.width/e.height>=e.parentWidth/e.parentHeight?($(e.Item).css({width:"100%",height:"auto","verticle-align":"middle"}),r=e.parentWidth,height=e.parentWidth/(e.width/e.height)):($(e.Item).css({width:"auto",height:"100%","verticle-align":"middle"}),height=e.parentHeight,r=e.parentHeight*(e.width/e.height)),{width:r,height:height}},fitImage:function(e){if(!e||!e.items)return!1;e.fit||(e.fit=0),$(e.items).each(function(){var t=$(this);e.width==undefined&&(e.width=$(this).width()),e.height==undefined&&(e.height=$(this).height());var n=e.width,r=e.height,i=$(this).parent();e.parentHeight=e.parentHeight||i.height(),e.parentWidth=e.parentWidth||i.width(),e.fit==0&&(t.css({width:"100%",height:"100%",top:"",left:""}),n=e.parentWidth,r=e.parentHeight);if(e.fit==1){i.css({"line-height":e.parentHeight-(e.borderH||0)+"px"}),e.useMargin||i.css("text-align","center");if(e.width/e.height>=e.parentWidth/e.parentHeight){n=e.parentWidth,r=e.parentWidth/(e.width/e.height),t.css({width:"100%",height:"auto","vertical-align":"middle",left:"",top:"",display:"inline-block",position:"relative"});if(e.useMargin){var s=e.parentWidth/(e.width/e.height);t.css("margin-top",(e.parentHeight-s)/2+"px"),t.css("margin-bottom",(e.parentHeight-s)/2+"px"),t.css({"margin-left":0,"margin-right":0}),t.css("position","absolute")}}else{r=e.parentHeight,n=e.parentHeight*(e.width/e.height),t.css({width:"auto",height:"100%","vertical-align":"top",left:"",top:"",display:"inline-block",position:"relative"});if(e.useMargin){var o=e.parentHeight*(e.width/e.height);t.css("margin-left",(e.parentWidth-o)/2+"px"),t.css("margin-right",(e.parentWidth-o)/2+"px"),t.css({"margin-top":0,"margin-bottom":0}),t.css("position","absolute")}}}e.fit==2&&(i.css({"line-height":e.parentHeight+"px","text-align":"center",overflow:"hidden"}),e.width/e.height>=e.parentWidth/e.parentHeight?(t.css({width:e.parentHeight*e.width/e.height+"px",height:e.parentHeight+"px","verticle-align":"middle",position:"absolute",left:"-"+(e.parentHeight*e.width/e.height-e.parentWidth)/2+"px",top:0,"max-width":"none"}),e.useMargin&&(t.css("left",""),t.css("margin-left","-"+(e.parentHeight*e.width/e.height-e.parentWidth)/2+"px"))):(t.css({position:"absolute",width:e.parentWidth+"px",height:e.parentWidth/(e.width/e.height)+"px","verticle-align":"middle",top:"-"+(e.parentWidth/(e.width/e.height)-e.parentHeight)/2+"px",left:0,"max-height":"none"}),e.useMargin&&(t.css("top",""),t.css("margin-top","-"+(e.parentWidth/(e.width/e.height)-e.parentHeight)/2+"px")))),e.explicitSize&&t.css({width:n,height:r})})},opacity:function(e,t){},addShade:function(e){var t={name:"_g_shadow",zindex:99999,color:"#000000",opacity:.8,containment:"body"};e=e?$.extend({},t,e):t,$(containment).append('<div id="'+e.name+'" style="z-index:'+e.zindex+";background:"+e.color+";opacity:"+e.opacity+';"></div>')},addButtonGroup:function(e){var t={containment:null,position:0,name:"_g_button"+_g.uuid(),className:null,confirmButton:{name:"确认",enable:!0,className:"btn-small btn-primary",onClick:null},cancelButton:{name:"取消",enable:!0,className:"btn-small",onClick:null},remove:function(){e.$el&&e.$el.remove()},getButton:function(t){return e.$el.find('[data-name="'+t+'"]')},addButton:function(t){var n={name:null,className:null,onClick:null};t=t?$.extend(!0,{},n,t):n;if(!t.name)return!1;e.$el.append(_.template(_g.ui.buttonT,{opts:t})),t.onClick&&e.getButton(t.name).on("click",function(){t.onClick()})},removeButton:function(t){if(!t)return;e.$el.find('[data-name="'+t+'"]').remove()}};return e=e?$.extend(!0,{},t,e):$.extend(!0,{},t),e.containment?(e.position==0?($(e.containment).append(_.template(_g.ui.buttonGroupT,{opts:e})),e.$el=$(e.containment).children("._g_btn_group")):($(_.template(_g.ui.buttonGroupT,{opts:e})).insertAfter($(e.containment)),e.$el=$(e.containment).next("._g_btn_group")),e.confirmButton.enable&&e.addButton(e.confirmButton),e.cancelButton.enable&&e.addButton(e.cancelButton),e):!1},contenteditable:function(e){var t={eventType:0,mutiple:0,element:null,callback:null,type:0,enableControl:!1};e=e?$.extend(!0,{},t,e):$.extend(!0,{},t),e.onKeyDown=function(t,n){var r=t.keyCode?t.keyCode:t.which;r==13&&e.mutiple==0&&(e.enableClose=!0,e.$this.blur(),$(document).off("keydown",e.onKeyDown),e.result())},e.result=function(){if(e.$this.data("before")!==e.$this.html()){e.$this.data("before",e.$this.html());var t=e.type==0?e.$this.text():e.$this.html();e.callback&&e.callback(t)}},e.enableEdit=!1;if(!e.element)return!1;e.element&&(e.$this=$(e.element),e.$this.addClass("_g_contenteditable"),e.eventType==0&&$(e.element).attr("contenteditable","true"),e.eventType==1&&($(e.element).attr("contenteditable","false"),$(e.element).on("dblclick",function(){$(this).attr("contenteditable","true"),$(this).focus()})),$(e.element).on("focus",function(){return e.focus?!1:(e.focus=!0,e.$this.data("before",e.$this.html()),$(document).on("keydown",e.onKeyDown),e.enableControl&&(e.buttonGroup=_g.ui.addButtonGroup({containment:e.$this,position:1,confirmButton:{onClick:function(){e.enableClose=!0,e.$this.blur()}},cancelButton:{onClick:function(){e.enableClose=!0,e.$this.html(e.$this.data("before")),e.$this.blur()}}})),e.$this)}).on("blur",function(t){if(e.enableControl){if(!e.enableClose)return e.$this.focus(),!1;e.enableClose=!1,e.buttonGroup.remove()}return e.focus=!1,$(document).off("keydown",e.onKeyDown),e.eventType==1&&$(e.element).attr("contenteditable","false"),e.result(),!1}))},sortByIds:function(e){var t={containment:null,items:"li",ids:null};e=e?$.extend({},t,e):t;if(!e.containment||!e.ids)return;_.each(e.ids,function(t){if($(e.containment).children(e.items+'[id="'+t+'"]').length>0){var n=$(e.containment).children(e.items+'[id="'+t+'"]').detach();$(e.containment).append(n)}})},sortTreeByIds:function(e,t){var n={containment:null,items:"li",ids:null,childrenKey:"children",wrap:"ul",wrapClass:null};e=e?$.extend({},n,e):n;if(!e.containment||!e.ids)return;e.root=t||e.containment,_.each(e.ids,function(n){if($(e.root).find(e.items+'[id="'+n.id+'"]').length>0){var r=$(e.root).find(e.items+'[id="'+n.id+'"]').detach();!$(e.containment).is(e.wrap)&&!$(e.containment).children(e.wrap).length&&($(e.containment).append(document.createElement(e.wrap)),e.wrapClass&&$(e.containment).children(e.wrap).addClass(e.wrapClass),e.containment=$(e.containment).children(e.wrap)),$(e.containment).append(r)}n[e.childrenKey]&&_g.ui.sortTreeByIds({containment:$(e.containment).find(e.items+'[id="'+n.id+'"]'),items:e.items,ids:n[e.childrenKey],childrenKey:e.childrenKey},t?t:e.containment)})},findById:function(e){var t={containment:null,id:null};return e=e?$.extend({},t,e):t,!e.containment||!e.id?[]:$(e.containment).find('[id="'+e.id+'"],[data-id="'+e.id+'"]').first()},moveTo:function(e){var t={containment:null,sourceId:null,targetId:null,wrap:null,wrapClass:null,position:0};e=e?$.extend({},t,e):t;if(!e.containment)return!1;var n=_g.ui.findById({containment:e.containment,id:e.sourceId}),r=_g.ui.findById({containment:e.containment,id:e.targetId});e.wrap&&(r.has(e.wrap).length==0?(r.append(document.createElement(e.wrap)),r=r.children(e.wrap),e.wrapClass&&r.addClass(e.wrapClass)):r=r.children(e.wrap));var i=n.detach();e.position==0?r.prepend(i):r.append(i)},getTreeIds:function(e){var t={containment:null,items:null,idAttribute:"id",wrap:"ul"};e=e?$.extend({},t,e):t;var n=[];if(!e.containment||!e.items)return!1;if(e.wrap&&!$(e.containment).is(e.wrap)){if(!($(e.containment).children("ul").length>0))return[];e.containment=$(e.containment).children("ul")}return $(e.containment).children(e.items).each(function(){var t={};t.id=$(this).attr(e.idAttribute),t.children=_g.ui.getTreeIds({containment:$(this),items:e.items,idAttribute:e.idAttribute,wrap:e.wrap}),n.push(t)}),n},dialog:function(e){var t={className:null}},createDomMask:function(e){var t={containment:null,item:null,x:null,y:null,height:null,width:null,moveTo:function(t){e.offsetX=0-t.x,e.offsetY=0-t.y,$(e.item).css("left",e.offsetX),$(e.item).css("top",e.offsetY)},resize:function(t){$(e.containment).width(t.w),$(e.containment).height(t.h)}};return e=e?$.extend({},t,e):t,!e.containment||!e.item?!1:($(e.containment).css("overflow","hidden"),e.moveTo({x:e.x,y:e.y}),e.resize({w:e.width,h:e.height}),e)},clearSelection:function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var e=window.getSelection();e.removeAllRanges()}},isOverflowed:function(e){var t={x:!1,y:!1},n=0;return $.zoom&&$.zoom!=1&&(n=2),$(e)[0].offsetHeight+n<$(e)[0].scrollHeight&&(t.y=$(e)[0].scrollHeight||1),$(e)[0].offsetWidth+n<$(e)[0].scrollWidth&&(t.x=$(e)[0].scrollWidth||1),t}};typeof require=="undefined"?(window._g||(window._g={}),window._g.ui=e):define("_g/ui",["jquery","_g/base","_g/error"],function(){return window._g.ui=e,window._g.ui})})(window);(function(){var e={getValueByType:function(e,t){t=t?t.toLowerCase():t;switch(t){case"number":return Number(e);case"boolean":if(e=="false")return!1;if(e=="true")return!0;return Boolean(e);case"numberboolean":if(e=="false")return 0;if(e=="true")return 1;return Boolean(e)?1:0;case"string":return String(e);case"object":return _g.object.jsonparse(e);default:return e}},bindPopOver:function(e){var t={containment:null,trigger:"click",getData:null,callback:null,onChange:null};e=e?$.extend(!0,{},t,e):t;if(!e.containment)return!1;$(e.containment).find(".c-popover-btn").on(e.trigger,function(){var t=$(this).data();if(e.getData){var n=require("text!"+t.template),r=e.getData(this);t.content=_g.renderT(n,r,"data","text!"+t.template)}t.container=t.container?$(t.container):$(this).closest(".c-popover-containment")[0],t.container||(t.container="body"),t.viewport={selector:$(this).closest(".c-popover-viewport")[0],padding:t.padding||0},t.viewport.selector||(t.viewport.selector="body"),t.elm=$(this),t.callback=e.callback,t.beforeClose=e.beforeClose,t.onChange=e.onChange,t.onShow=e.onShow,t.onClose=e.onClose,t.getContent=function(){var t=e.getData(this);return _g.renderT(n,t,"data")};var i=_g.form.popover(t);return!1})},bindListAction:function(e){var t={containment:null,listClass:".c-list",callback:null};e=e?$.extend(!0,{},t,e):t;if(!e.containment)return!1;if(!e.containment.hasClass(e.listClass)&&!e.containment.find(e.listClass).length)return!1;var n=e.containment.hasClass(e.listClass)?e.containment.data():e.containment.find(e.listClass).first().data();e.containment.find(".c-list-add").on("click",function(t){if(e.callback){var r=_g.util.serializeValue({containment:e.containment});e.callback("add",n.target,r,t.currentTarget)}return!1}),e.containment.find(".c-list-remove").on("click",function(t){return e.callback&&callback("remove",n.target,t.currentTarget),!1})},bindFormChange:function(e){var t={containment:null,$item:null,callback:null,silentDisplay:!1};e=e?$.extend(!0,{},t,e):t;if(!e.containment)return!1;$(e.containment).find(".slider").each(function(){var t=$(this).find("input"),n=t.data();if(n.target){var r=$(e.containment).find('[name="'+n.target+'"]');r.on("change",function(){var e=t.slider("getValue");e!=Number($(this).val())&&t.slider("setValue",Number($(this).val()))}),t.on("slide",function(e){var t=Number(r.val());t!=e.value&&(r.closest(".spinner").spinner("value",e.value),r.trigger("change"))})}}),$(e.containment).find("[rel=form]").each(function(){var t=$(this).data();if(t.value!=undefined){$(this).find("[data-value]").removeClass("active");if(t.mutiple||t.multiple){var n=t.value.split(",");for(i=0;i<n.length;i++)$(this).find('[data-value="'+n[i]+'"]').addClass("active")}else $(this).find('[data-value="'+t.value+'"]').addClass("active")}var r=$(this);$(this).find("[data-value]").on("click",function(){var n=!1,i=$(this).data("value");t.silentdisplay||r.find("[data-show]").text($(this).text()||i);if(!t.multiple&&!t.mutiple)$(this).hasClass("active")||(i=_g.util.getValueByType(i,t.type),r.data("value",i),$(this).addClass("active"),$(this).siblings().length?$(this).siblings().removeClass("active"):$(this).parent().siblings().children().removeClass("active"),t.value=i,n=!0);else{$(this).hasClass("active")?$(this).removeClass("active"):t.silentdisplay||$(this).addClass("active");var s=[];r.find("[data-value]").each(function(){var e=$(this).data("value");$(this).hasClass("active")&&s.push(_g.util.getValueByType(e,t.type))}),s=s.join(","),console.log(s),r.data("value",s),t.value=s,n=!0}e.callback&&n&&e.callback(r,e,t)})});var n=e.$item?e.$item:"input,textarea,select";$(e.containment).find(n).on("change",function(){var t=$(this).data();t.name=$(this).attr("name")||$(this).attr("id"),e.callback&&e.callback($(this),e,t)})},serializeValue:function(e){var t={containment:null,typeAttr:"data-type",attrAttr:"data-attr",allowEmpty:!0};e=e?$.extend({},t,e):t;if(!e.containment)return!1;var n=e.containment,r={},i=function(t,n){if(t.attr("disabled")=="disabled")return;var i=t.attr("name")||t.attr("id"),s=t.attr(e.typeAttr),o=t.attr(e.attrAttr);if(!i)return;o?(typeof r[o]!="object"&&(r[o]={}),r[o][i]=n):r[i]=n},s=function(e,t){if(e.attr("disabled")=="disabled")return;var n=e.data(),i=n.name,s=n.type,o=n.attr;if(!i)return;o?(typeof r[o]!="object"&&(r[o]={}),r[o][i]=t):r[i]=t};return $(n).find('input[type="text"],input[type="email"],input[type="tel"],input[type="hidden"],textarea').each(function(){var t=$(this).attr("name")||$(this).attr("id"),n=$(this).attr(e.typeAttr),r=$(this).attr(e.attrAttr),s=_g.util.getValueByType($(this).val(),n);i($(this),s)}),$(n).find('input[type="checkbox"]').each(function(){var t=$(this).attr("name")||$(this).attr("id"),n=$(this).attr(e.typeAttr),s=$(this).attr(e.attrAttr);s&&typeof r[s]!="object"&&(r[s]={});var o=s?r[s][t]?r[s][t]:[]:r[t]?r[t]:[];if($(this).attr("checked")=="checked")n=="boolean"||n=="numberboolean"?o=_g.util.getValueByType($(this).attr("data-reverse")?!1:!0,n):o.push(_g.util.getValueByType($(this).val(),n));else if(n=="boolean"||n=="numberboolean")o=_g.util.getValueByType($(this).attr("data-reverse")?!0:!1,n);i($(this),o)}),$(n).find('input[type="radio"]:checked').each(function(){var t=$(this).attr("name")||$(this).attr("id"),n=$(this).attr(e.typeAttr),r=$(this).attr(e.attrAttr),s=_g.util.getValueByType($(this).val(),n);i($(this),s)}),$(n).find("select").each(function(){var t=$(this).attr("name")||$(this).attr("id"),n=$(this).attr(e.typeAttr),s=$(this).attr(e.attrAttr),o=Boolean($(this).attr("data-mutiple")),u;o?(s&&typeof r[s]!="object"&&(r[s]={}),u=s?r[s][t]?r[s][t]:[]:r[t]?r[t]:[],u.push($(this).val())):u=_g.util.getValueByType($(this).val(),n),i($(this),u)}),$(n).find("[rel=form]").each(function(){var e=$(this).data();if(e.mutiple||e.multiple)if(e.value!=undefined)var t=e.value;else var t="";else var t=_g.util.getValueByType(e.value,e.type);s($(this),t)}),r},disableLink:function(e){var t={containment:null,linkitem:"a",enabled:!0},n=e.linkitem||t.linkitem;return e=e?$.extend(!0,{},t,e):t,e.linkitem=n,e.containment?(e.func=function(){return!1},e.enable=function(){$(e.containment).find(e.linkitem).each(function(){$(this).on("click",e.func),e.enabled=!0})},e.disable=function(){$(e.containment).find(e.linkitem).each(function(){$(this).off("click",e.func),e.enabled=!1})},e.enable(),e):!1},domExist:function(e,t){return t||(t=document),typeof e=="string"&&(e=$(e)),jQuery.contains(t.documentElement,e[0])},getImageSizeBySrc:function(e,t,n){var r=new Image;r.onload=function(){if(n&&(this.width>n||this.height>n)){var e=this.width/this.height;e>1?(this.width=n,this.height=this.width/e):(this.height=n,this.width=this.height*e)}t&&t(this.width,this.height)},r.src=e},htmlspecialchars:function(e){function t(e,t,n){var r=e.length;for(var i=0;i<r;i++)re=new RegExp(e[i],"ig"),n=n.replace(re,typeof t=="string"?t:t[i]?t[i]:t[0]);return n}return t(["&","<",">",'"',"&lt;br&gt;"],["&amp;","&lt;","&gt;","&quot;","<br>"],e)},toggleActive:function(e){$(e).css("-moz-transition","all 0.5s").css("-webkit-transition","all 0.5s").css("-ms-transition","all 0.5s").css("-o-transition","all 0.5s").css("transition","all 0.5s"),$(e).css("opacity","0.5").css("background-color","#f80"),setTimeout(function(){$(e).css("opacity","1").css("background-color","#fff")},500);return}};typeof require=="undefined"?(window._g||(window._g={}),window._g.util=e,e=undefined):define("_g/util",["jquery","_g/base"],function(){return window._g.util=e,e=undefined,window._g.util})})(window);(function(){var _g_mvc={_loadTemplate:function(e,t){},_CollectionforSaveAll:function(){var e=Backbone.Model.extend({initialize:function(){this.set("id","GlobalSave")},sync:function(e,t,n){var r=this.data;this.attributes=r;if(e=="create")return;e=="update"&&(n.url=this.url);if(e=="delete")return;if(e=="read")return;Backbone.emulateHTTP=!0,Backbone.emulateJSON=!0,Backbone.sync(e,t,n)}});return new e},createModel:function(opts){var defaults={defaults:{},autoIndex:!0,autoUpdate:!0,autoRemove:!0,enableSync:!0,createUrl:null,updateUrl:null,removeUrl:null,fetchUrl:null,staticFetchUrl:null,staticRemoveUrl:null,staticCreateUrl:null,staticUpdateUrl:null,fetchUrlName:null,removeUrlName:null,createUrlName:null,updateUrlName:null,restful:!1,debug:!1,bindChange:null,bindRemove:null,callback:null,initView:null,patchKeys:null,initialize:function(){this.iViewlist=[],this.iCollectionlist=[];if(!this.get("id")){this.set("isNew",!0);if(this.autoIndex){var prefix=this.get("type")||this.get("iType")||"M";this.set("id",prefix+"_"+_g.uuid()),this.preset()}else this.save({},{wait:!0,success:function(model,response){var returned=eval(response);(returned.Status=="Success"||returned.code==200)&&model.set("id",returned.ID.toString()),model.preset()}})}else this.preset()},patchSave:function(callback,opts){opts||(opts={});if(this.patchKeys&&this.patchKeys.length){var values=_.pick(this.toJSON(),this.patchKeys);this.save(values,{wait:!0,silent:opts.silent,patch:!0,success:function(model,response){if(callback){var returned=eval(response);callback(returned)}},error:function(e,t){_g.error.serverError("save_"+e.name),opts.onError&&opts.onError()}})}else this.save()},sync:function(e,t,n){var r,i=typeof _gDebug!="undefined"&&_gDebug||this.debug;if(!this.enableSync)return!1;if(e=="create"){var s=this.createUrlName||this.createUrl;_g.debug&&_g.debug.enabled&&(_g.debug.data[s]={}),r=i?_g.debug&&_g.debug.query_user_data(s)?_g.debug.query_user_data(s):this.staticCreateUrl||this.createUrl:this.createUrl;if(!r)return;n.url=r}if(e=="update"||e=="patch"){var s=this.updateUrlName||this.updateUrl;_g.debug&&_g.debug.enabled&&(_g.debug.data[s]={}),r=i?_g.debug&&_g.debug.query_user_data(s)?_g.debug.query_user_data(s):this.staticUpdateUrl||this.updateUrl:this.updateUrl;if(!r)return;n.url=r}if(e=="delete"){var s=this.removeUrlName||this.removeUrl;_g.debug&&_g.debug.enabled&&(_g.debug.data[s]={}),r=i?_g.debug&&_g.debug.query_user_data(s)?_g.debug.query_user_data(s):this.staticRemoveUrl||this.removeUrl:this.removeUrl;if(!r)return;n.url=r}if(e=="read"){var s=this.fetchUrlName||this.fetchUrl;r=i?this.staticFetchUrl:this.fetchUrl,_g.debug&&_g.debug.enabled&&(_g.debug.data[s]={}),r=i?_g.debug&&_g.debug.query_user_data(s)?_g.debug.query_user_data(s):this.staticFetchUrl||this.fetchUrl:this.fetchUrl;if(!r)return;n.url=r}n.url=typeof n.url=="string"?n.url:n.url(t.attributes),this.restful||(Backbone.emulateHTTP=!0,Backbone.emulateJSON=!0),Backbone.sync(e,t,n)},addView:function(e,t){typeof t=="function"&&(this[e]=new t({model:this}));if(typeof t=="object"){var n=_g.mvc.createView(t);this[e]=new n({model:this})}this[e]&&this.iViewlist.push(this[e])},addCollection:function(e,t){typeof t=="function"&&(this[e]=new t);if(typeof view=="object"){var n=_g.mvc.createCollection(t);this[e]=new n}this[e]&&this.iCollectionlist.push(this[e])},preset:function(){this.callback&&this.callback(this);var e=this;this.autoUpdate&&this.on("change",function(){e.updateAllViews()}),this.autoRemove&&this.on("destroy",function(e,t,n){e.removeAllViews(),e.bindRemove&&e.bindRemove(e,n)}),this.bindChange&&this.bindChange(),this.initView&&this.addView("iview",this.initView)},updateAllViews:function(){_.each(this.iViewlist,function(e){e.$el&&e.update()})},removeView:function(e){this[e]&&(this[e].$el.remove(),this.iViewlist=_.reject(this.iViewlist,function(t){return t==this[e]}),this[e]=null)},removeAllViews:function(e){_.each(this.iViewlist,function(t){t.$el&&(e?t.undelegateEvents():t.$el.remove())})}};opts=opts?$.extend(!0,{},defaults,opts):defaults;var Model=Backbone.Model.extend(opts);return Model},createView:function(e){var t={template:null,className:null,containment:null,wrap:null,wrapClassName:null,autoRender:!0,position:1,parseData:null,callback:null,bindChange:null,parseTemplate:null,templateKey:null,templateName:null,afterRender:null,afterUpdate:null,initialize:function(){_.bindAll(this),this.autoRender&&this.render(),this.callback&&this.callback(this)},createEl:function(){var e=this.model.toJSON(),t;return this.parseData&&(e=this.parseData()),this.parseTemplate?t=this.parseTemplate(this.template):t=this.template,_g.renderT(t,e,this.templateKey,this.templateName)},render:function(e,t){var n=this;if(!this.model||!this.template)return!1;if(!_g.util.domExist(this.$el)){if(!e&&!this.containment)return!1;e||(e=$(this.containment)),t||(t=this.position),this.wrap&&!$(this.containment).is(this.wrap)&&($(this.containment).children(this.wrap).length==0&&$(this.containment).append(document.createElement(this.wrap)),e=$(this.containment).children(this.wrap),this.containment&&this.wrapClassName&&e.addClass(this.wrapClassName));var r=this.createEl(),i=r;return this.setElement(i),t==1?e.append(i):e.prepend(i),this.className&&this.$el.addClass(this.className),this.afterRender&&this.afterRender(this),this}var r=this.createEl(),i=r;this.$el.replaceWith(i),this.setElement(i),this.afterUpdate&&this.afterUpdate(this)},update:function(){this.render()},afterUpdate:function(){this.afterRender&&this.afterRender(this)},events:{}};e=e?$.extend(!0,{},t,e):t;var n=Backbone.View.extend(e);return n},createCollection:function(e){var t={enableSync:!1,fetchUrl:null,staticFetchUrl:null,saveUrl:null,staticSaveUrl:null,debug:!1,bindRemove:!1,bindReset:!0,bindAdd:null,callback:null,patchKeys:null,name:null,initialize:function(){var e=this;this.bindRemove&&this.on("remove",function(t){typeof e.bindRemove=="function"?e.bindRemove(t):t.removeAllViews()}),this.bindReset&&this.on("reset",function(t,n){typeof e.bindReset=="function"?e.bindReset(t,n):_.each(n.previousModels,function(e){e.removeAllViews()}),e.afterReset&&e.afterReset(t,n)}),this.bindAdd&&this.on("add",function(t){e.bindAdd()}),this.callback&&this.callback(this)},sortByIds:function(e){var t=this;this.reset(_.map(e,function(e){return t.get(e)}),{silent:!0})},sync:function(e,t,n){var r=typeof _gDebug!="undefined"&&_gDebug||this.debug;if(!this.enableSync)return!1;if(e=="read"){var i=r?this.staticFetchUrl?this.staticFetchUrl:this.fetchUrl:this.fetchUrl?this.fetchUrl:this.staticFetchUrl;if(!i)return;n.url=i}if(!n.url)return!1;n.url=typeof n.url=="string"?n.url:n.url(t.toJSON()),this.resetful||(Backbone.emulateHTTP=!0,Backbone.emulateJSON=!0),Backbone.sync(e,t,n)},getAll:function(e){var t=this;this.fetch({success:function(t,n){e&&e(n)},error:function(){_g.error.serverError("get_"+t.name)}})},saveAll:function(e){var t=this,n=typeof _gDebug!="undefined"&&_gDebug||this.debug,r=n?this.staticSaveUrl?this.staticSaveUrl:this.saveUrl:this.saveUrl?this.saveUrl:this.staticSaveUrl;if(!r)return!1;var i=_g.mvc._CollectionforSaveAll();this.patchKeys&&this.patchKeys.length?i.data=_.map(this.toJSON(),function(e){var n=$.extend(!0,{},e);return n=_.pick(n,t.patchKeys),n}):i.data=this.toJSON(),i.url=r,i.save({},{wait:!0,success:function(t,n){e&&e(n)},error:function(){_g.error.serverError("save_"+t.name)}})},refreshView:function(e){var t={containment:null,viewname:null};e=e?$.extend({},t,e):t,this.length>0&&(_.each(this.at(0).iViewlist,function(t){containment=e.containment||t.containment,containment&&(t.wrap&&!$(containment).is(t.wrap)?$(containment).children(t.wrap).empty():$(containment).empty())}),this.each(function(t){e.containment&&(t.iview.containment=e.containment),e.viewname?t[viewname].update():t.iview.update()}))},removeAllViews:function(e){this.each(function(t){t.removeAllViews(e)})}};e=e?$.extend(!0,{},t,e):t;var n=Backbone.Collection.extend(e);return n},createTreeByData:function(e){var t={collection:null,data:null,treeLevel:0,parent:null},n=e.parent,r;e=e?$.extend(!0,{},t,e):t,e.parent=n;if(!e.collection||!e.data)return null;var i=$.extend(!0,[],e.data);if(typeof e.collection=="function")r=new e.collection;else{var s=_g.mvc.createCollection(e.collection);r=new s}return r.parent=n,r.refreshTreeView=function(e){this.refreshView(e),this.each(function(t){t.icollection.refreshTreeView({containment:t.iview.$el,viewname:e?e.viewname:null})})},r.getModels=function(){var e=_g.mvc.getTreeModels(r);return e},r.getModelsJSON=function(){var e=r.getModels();return e=_.map(e,function(e){return e.toJSON()}),e},r.getModel=function(e){return _g.mvc.getTreeModel(r,e)},r.on("add",function(t){t.treeLevel=e.treeLevel,t.icollection=_g.mvc.createTreeByData({collection:e.collection,data:[],treeLevel:e.treeLevel+1}),r.parent&&(r.View=typeof r.View=="object"?$.extend(!0,{},r.View,{containment:r.parent.iview.$el}):r.View.extend({containment:r.parent.iview.$el})),t.addView("iview",r.View),_g.ui.sortByIds({containment:t.iview.wrap?t.iview.$el.parent(t.iview.wrap):t.iview.$el.parent(),ids:r.pluck("id")}),t.icollection.parent=t,t.icollection.View=r.View}),r.saveAll=function(e){var t=typeof _gDebug!="undefined"&&_gDebug||this.debug,n=t?this.staticSaveUrl?this.staticSaveUrl:this.saveUrl:this.saveUrl;if(!n)return!1;var r=_g.mvc._CollectionforSaveAll();r.data=_g.mvc.getTreeData(this),r.url=n,r.save({},{wait:!0,success:function(t,n){e&&e(n)},error:function(){}})},_.each(i,function(t){var n;t.children?n=$.extend(!0,[],t.children):n=[],delete t.children,r.add(t,{silent:!0});var i=r.at(r.length-1);i.treeLevel=e.treeLevel,console.log(n),i.icollection=_g.mvc.createTreeByData({collection:e.collection,data:n,treeLevel:e.treeLevel+1,parent:i})}),r},createTreeView:function(e){var t={collection:null,view:null,containment:null,wrap:null,wrapClassName:null,template:null,className:null,parseTemplate:null,templateKey:null,templateName:null,update:function(e){if(!this.model||!this.template||!this.containment)return!1;if(!_g.util.domExist(this.$el))this.render();else{var t=this.createEl(),n=null;this.wrap&&(n=this.$el.children(this.wrap).detach()),this.$el.replaceWith(t),this.setElement(t)}this.afterUpdate&&this.afterUpdate(this)}},n=e.collection;e=e?$.extend(!0,{},t,e):t;var r={};e.collection=n;if(!e.collection||!e.view)return!1;e.containment&&(r.containment=e.containment),e.wrap&&(r.wrap=e.wrap),e.template&&(r.template=e.template),e.templateKey&&(r.templateKey=e.templateKey),e.templateName&&(r.templateName=e.templateName),e.parseTemplate&&(r.parseTemplate=e.parseTemplate),e.parseData&&(r.parseData=e.parseData),e.callback&&(r.callback=e.callback),e.wrapClassName&&(r.wrapClassName=e.wrapClassName),e.className&&(r.className=e.className),r.update=e.update;var i=typeof e.view=="function"?e.view.extend(r):$.extend(!0,e.view,r);e.collection.View=i,e.collection.each(function(t){t.addView("iview",i);if(t.icollection){if(!e.useJquerySel){typeof e.containment!="string"&&(e.containment=e.containment.selector);var n=e.containment+(e.wrap?" >"+e.wrap:"")+' >[id="'+t.id+'"]'}else{var n=e.containment.children('[id="'+t.id+'"]');if(e.wrap)if(!n.children(e.wrap+e.wrapClassName?"."+e.wrapClassName:"").length){var r=$(document.createElement(e.wrap));n.append(r),e.wrapClassName&&r.addClass(e.wrapClassName),n=r}else n=n.children(e.wrap+e.wrapClassName?"."+e.wrapClassName:"")}_g.mvc.createTreeView({collection:t.icollection,view:e.view,wrapClassName:e.wrapClassName,containment:n,wrap:e.wrap||null,template:e.template||null,useJquerySel:e.useJquerySel})}})},sortTreeByIds:function(e){var t=function(n,r,s){return n?(n.reset([],{silent:e.silent}),_.each(r,function(r){r.children=r.children||[];var o=i.get(r.id);o.treeLevel=s,o.icollection=t(o.icollection,r.children,s+1),n.add(o,{silent:e.silent}),o.collection=n}),n):null},n={collection:null,ids:null,treeLevel:0,silent:!0},r=e.collection;e=e?$.extend(!0,{},n,e):n,e.collection=r;if(!e.collection||!e.ids)return!1;var i=new Backbone.Collection;i.add(_g.mvc.getTreeModels(e.collection));var s=t(e.collection,e.ids,e.treeLevel);return s},getTreeModels:function(e){var t=[];return e.each(function(e){t.push(e);if(e.icollection){var n=_g.mvc.getTreeModels(e.icollection);for(var r=0;r<n.length;r++)t.push(n[r])}}),t},getTreeModel:function(e,t){if(!e||!t)return!1;var n=_g.mvc.getTreeModels(e);return _.find(n,function(e){return e.id==t})},getTreeData:function(e,t){var n=[];return e.each(function(e){var r=$.extend(!0,{},e.toJSON());t&&t.filter&&(r=_.pick(r,t.filter)),e.icollection&&(r.children=_g.mvc.getTreeData(e.icollection,t)),n.push(r)}),n},moveTo:function(e){e.silent==undefined&&(e.silent=!0);var t=null;if(e.fromIndex!=undefined&&e.toIndex!=undefined)t=e.collection.at(e.fromIndex),e.collection.remove(t,{silent:e.silent}),e.collection.add(t,{at:e.toIndex,silent:e.silent});else if(e.sourceId!=undefined&&e.targetId!=undefined&&e.position!=undefined){t=e.collection.get(e.sourceId),e.collection.remove(t,{silent:e.silent});var n=e.collection.get(e.targetId),r=e.collection.indexOf(n);if(e.position==-1)var i=r;else var i=r+1;e.collection.add(t,{at:i,silent:e.silent})}}};typeof require=="undefined"?(window._g||(window._g={}),window._g.mvc=_g_mvc,_g_mvc=undefined):define("_g/mvc",["jquery","backbone","_g/base","_g/ui","_g/util"],function(){return window._g.mvc=_g_mvc,_g_mvc=undefined,window._g.mvc})})(window);define("text!interaction_view/template/page.js",[],function(){return'<section class="Presentation" id="<%=id%>">\n    <div class="interaction-area typo">\n      <div class="interaction-view"></div>\n   </div>\n</section>'});define("text!interaction_view/template/pagegroup.js",[],function(){return'<section class="group" id="<%=id%>"></section>'});define("interaction_view/view/page",["_g/mvc","text!interaction_view/template/page.js","text!interaction_view/template/pagegroup.js"],function(){var e={template:require("text!interaction_view/template/page.js"),className:null,containment:"div.slides",wrap:null,wrapClassName:null,autoRender:!0,position:1,parseData:null,callback:function(){this.model.get("type")!="page_group"&&(this.overlays=this.model.get("overlays"),this.animations=this.model.get("animations"),this.actions=this.model.get("actions")),this.model.get("type")=="page"&&this.renderbg()},bindChange:null,parseTemplate:function(){var e=this.model.get("type");return e=="page_group"?_g.parseTemplate(require("text!interaction_view/template/pagegroup.js")):_g.parseTemplate(require("text!interaction_view/template/page.js"))},render:function(e,t){var n=this;if(!this.model||!this.template)return!1;if(!_g.util.domExist(this.$el)){if(!e&&!this.containment)return!1;e||(e=$(this.containment)),t||(t=this.position),this.wrap&&!$(this.containment).is(this.wrap)&&($(this.containment).children(this.wrap).length==0&&$(this.containment).append(document.createElement(this.wrap)),e=$(this.containment).children(this.wrap),this.containment&&this.wrapClassName&&e.addClass(this.wrapClassName));var r,i;return $("section#"+this.model.id).length>0?(r=$("section#"+this.model.id)[0],i=r,this.setElement(i)):(r=this.createEl(),i=r,this.setElement(i),t==1?e.append(i):e.prepend(i)),this.className&&this.$el.addClass(this.className),this.afterRender&&this.afterRender(this),this}var r=this.createEl(),i=r;this.$el.replaceWith(i),this.setElement(i),this.afterUpdate&&this.afterUpdate(this)},renderbg:function(){var e=this.$el;interaction_view.screen_mode==2&&(e=this.$el.children()),this.model.get("picture")&&e.css({"background-image":"url("+this.model.get("picture")+")","background-size":"contain","background-position":"center center","background-repeat":"no-repeat"});var t=this.model.get("bg_color"),n=this.model.get("bg_opacity"),r=t.indexOf("rgba")==-1?_g.getRGBA(t,n):t;e.css({"background-color":r})},prepareLoad:function(){var e=this,t=[];for(var n=0;n<e.animations.length;n++){var r=$.extend(!0,{},e.animations[n]);r.pageid=e.model.id,e.isMaster&&(r.pagetype="master"),e.isBackground&&(r.pagetype="background"),t.push(r)}e.model.iAnimationlist.reset(t);var i=[];for(var n=0;n<e.overlays.length;n++){var r=$.extend(!0,{},e.overlays[n]);r.pageid=e.model.id,r.zIndex=n,e.isMaster&&(r.pagetype="master",r.iType=="Audio"&&r.iDetail.iAutoplay&&!interaction_view.hasbgsound&&(interaction_view.hasbgsound=!0,r.isBgsound=!0)),i.push(new interaction_view.model[r.iType](r))}e.model.iOverlaylist.reset(i),e.model.iOverlaylist.each(function(e){e.iview.setZindex()});var s=[];for(var n=0;n<e.actions.length;n++){var r=$.extend(!0,{},e.actions[n]);r.pageid=e.model.id,e.isMaster&&(r.pagetype="master"),s.push(r)}e.model.iActionlist.reset(s)},startLoad:function(){var e=this;this.model.ipreloadlist.length==0?interaction_view.finishPagePreload(this.model.id,this.model):this.model.ipreloadlist.preload()},afterpreload:function(){var e=this;e.model.iOverlaylist.each(function(e){e.iview.preloaded||e.iview.afterpreload()}),e.hasRenderActionlist?e.model.iActionlist.each(function(e){e.iview&&_.include([0,1,2,4,14,15,20,21],e.get("iType"))&&e.iview.render()}):(e.model.iActionlist.each(function(e){e.iview&&e.iview.render()}),e.hasRenderActionlist=!0)},clearPageLoad:function(){if(this.model.get("loaded")){var e=this.$el.find(".interaction-view");e.empty(),this.model.iAnimationlist&&this.model.iAnimationlist.timeline&&this.model.iAnimationlist.timeline.kill(),this.model.isStartLoad=!1,this.model.playFinished=!1,this.ipreloadlist=new interaction_view.collection.Preload,this.model.unset("loaded",{silent:!0})}presentation.pageClearCenter(this.model.id)}};return e});define("interaction_view/view/subcontainer",["interaction_view/view/page"],function(){var e=require("interaction_view/view/page"),t=$.extend({},e,{template:null,className:null,containment:null,wrap:null,wrapClassName:null,autoRender:!1,position:1,parseData:null,afterload:function(){var e=this;overlays=_.filter(e.model.suboverlays,function(t){return t.path=e.model.iOverlaylist.path,t.isSubOverlay=!0,interaction_view.model[t.iType]}),overlays=_.map(overlays,function(e){return new interaction_view.model[e.iType](e)}),e.model.iOverlaylist.reset(overlays),e.startSubLoad()},startSubLoad:function(){var e=this;e.model.ipreloadlist.length==0?e.model.iview.afterSubOverlayPreload():e.model.ipreloadlist.preload()}});return t});(function(e,t){"use strict";function r(){if(n.READY)return;n.event.determineEventTypes(),n.utils.each(n.gestures,function(e){n.detection.register(e)}),n.event.onTouch(n.DOCUMENT,n.EVENT_MOVE,n.detection.detect),n.event.onTouch(n.DOCUMENT,n.EVENT_END,n.detection.detect),n.READY=!0}var n=function(e,t){return new n.Instance(e,t||{})};n.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},n.HAS_POINTEREVENTS=e.navigator.pointerEnabled||e.navigator.msPointerEnabled,n.HAS_TOUCHEVENTS="ontouchstart"in e,n.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android|silk/i,n.NO_MOUSEEVENTS=n.HAS_TOUCHEVENTS&&e.navigator.userAgent.match(n.MOBILE_REGEX),n.EVENT_TYPES={},n.DIRECTION_DOWN="down",n.DIRECTION_LEFT="left",n.DIRECTION_UP="up",n.DIRECTION_RIGHT="right",n.POINTER_MOUSE="mouse",n.POINTER_TOUCH="touch",n.POINTER_PEN="pen",n.EVENT_START="start",n.EVENT_MOVE="move",n.EVENT_END="end",n.DOCUMENT=e.document,n.plugins=n.plugins||{},n.gestures=n.gestures||{},n.READY=!1,n.utils={extend:function(n,r,i){for(var s in r){if(n[s]!==t&&i)continue;n[s]=r[s]}return n},each:function(e,n,r){var i,s;if("forEach"in e)e.forEach(n,r);else if(e.length!==t){for(i=0,s=e.length;i<s;i++)if(n.call(r,e[i],i,e)===!1)return}else for(i in e)if(e.hasOwnProperty(i)&&n.call(r,e[i],i,e)===!1)return},hasParent:function(e,t){while(e){if(e==t)return!0;e=e.parentNode}return!1},getCenter:function(t){var r=[],i=[];return n.utils.each(t,function(e){r.push(typeof e.clientX!="undefined"?e.clientX:e.pageX),i.push(typeof e.clientY!="undefined"?e.clientY:e.pageY)}),{pageX:(Math.min.apply(Math,r)+Math.max.apply(Math,r))/2,pageY:(Math.min.apply(Math,i)+Math.max.apply(Math,i))/2}},getVelocity:function(t,n,r){return{x:Math.abs(n/t)||0,y:Math.abs(r/t)||0}},getAngle:function(t,n){var r=n.pageY-t.pageY,i=n.pageX-t.pageX;return Math.atan2(r,i)*180/Math.PI},getDirection:function(t,r){var i=Math.abs(t.pageX-r.pageX),s=Math.abs(t.pageY-r.pageY);return i>=s?t.pageX-r.pageX>0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT:t.pageY-r.pageY>0?n.DIRECTION_UP:n.DIRECTION_DOWN},getDistance:function(t,n){var r=n.pageX-t.pageX,i=n.pageY-t.pageY;return Math.sqrt(r*r+i*i)},getScale:function(t,n){return t.length>=2&&n.length>=2?this.getDistance(n[0],n[1])/this.getDistance(t[0],t[1]):1},getRotation:function(t,n){return t.length>=2&&n.length>=2?this.getAngle(n[1],n[0])-this.getAngle(t[1],t[0]):0},isVertical:function(t){return t==n.DIRECTION_UP||t==n.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(t,r){if(!r||!t||!t.style)return;n.utils.each(["webkit","khtml","moz","Moz","ms","o",""],function(e){n.utils.each(r,function(n,r){e&&(r=e+r.substring(0,1).toUpperCase()+r.substring(1)),r in t.style&&(t.style[r]=n)})}),r.userSelect=="none"&&(t.onselectstart=function(){return!1}),r.userDrag=="none"&&(t.ondragstart=function(){return!1})}},n.Instance=function(e,t){var i=this;return r(),this.element=e,this.enabled=!0,this.options=n.utils.extend(n.utils.extend({},n.defaults),t||{}),this.options.stop_browser_behavior&&n.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),n.event.onTouch(e,n.EVENT_START,function(e){i.enabled&&n.detection.startDetect(i,e)}),this},n.Instance.prototype={on:function(t,r){var i=t.split(" ");return n.utils.each(i,function(e){this.element.addEventListener(e,r,!1)},this),this},off:function(t,r){var i=t.split(" ");return n.utils.each(i,function(e){this.element.removeEventListener(e,r,!1)},this),this},trigger:function(t,r){r||(r={});var i=n.DOCUMENT.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=r;var s=this.element;return n.utils.hasParent(r.target,s)&&(s=r.target),s.dispatchEvent(i),this},enable:function(t){return this.enabled=t,this},reset:function(){i=null,s=!1,o=!1,n.PointerEvent.reset()}};var i=null,s=!1,o=!1;n.event={bindDom:function(e,t,r){var i=t.split(" ");n.utils.each(i,function(t){e.addEventListener(t,r,!1)})},onTouch:function(t,r,u){var a=this;this.bindDom(t,n.EVENT_TYPES[r],function(f){var l=f.type.toLowerCase();if(l.match(/mouse/)&&o)return;l.match(/touch/)||l.match(/pointerdown/)||l.match(/mouse/)&&f.which===1?s=!0:l.match(/mouse/)&&!f.which&&(s=!1),l.match(/touch|pointer/)&&(o=!0);var c=0;if(s){n.HAS_POINTEREVENTS&&r!=n.EVENT_END?c=n.PointerEvent.updatePointer(r,f):l.match(/touch/)?c=f.touches.length:o||(c=l.match(/up/)?0:1),c>0&&r==n.EVENT_END?r=n.EVENT_MOVE:c||(r=n.EVENT_END);if(c||i===null)i=f;u.call(n.detection,a.collectEventData(t,r,a.getTouchList(i,r),f)),n.HAS_POINTEREVENTS&&r==n.EVENT_END&&(c=n.PointerEvent.updatePointer(r,f))}c||(i=null,s=!1,o=!1,n.PointerEvent.reset())})},determineEventTypes:function(){var t;n.HAS_POINTEREVENTS?t=n.PointerEvent.getEvents():n.NO_MOUSEEVENTS?t=["touchstart","touchmove","touchend touchcancel"]:t=["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],n.EVENT_TYPES[n.EVENT_START]=t[0],n.EVENT_TYPES[n.EVENT_MOVE]=t[1],n.EVENT_TYPES[n.EVENT_END]=t[2]},getTouchList:function(t){return n.HAS_POINTEREVENTS?n.PointerEvent.getTouchList():t.touches?t.touches:(t.identifier=1,[t])},collectEventData:function(t,r,i,s){var o=n.POINTER_TOUCH;if(s.type.match(/mouse/)||n.PointerEvent.matchType(n.POINTER_MOUSE,s))o=n.POINTER_MOUSE;return{center:n.utils.getCenter(i),timeStamp:(new Date).getTime(),target:s.target,touches:i,eventType:r,pointerType:o,srcEvent:s,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return n.detection.stopDetect()}}}},n.PointerEvent={pointers:{},getTouchList:function(){var e=this,t=[];return n.utils.each(e.pointers,function(e){t.push(e)}),t},updatePointer:function(e,t){return e==n.EVENT_END?this.pointers={}:(t.identifier=t.pointerId,this.pointers[t.pointerId]=t),Object.keys(this.pointers).length},matchType:function(e,t){if(!t.pointerType)return!1;var r=t.pointerType,i={};return i[n.POINTER_MOUSE]=r===t.MSPOINTER_TYPE_MOUSE||r===n.POINTER_MOUSE,i[n.POINTER_TOUCH]=r===t.MSPOINTER_TYPE_TOUCH||r===n.POINTER_TOUCH,i[n.POINTER_PEN]=r===t.MSPOINTER_TYPE_PEN||r===n.POINTER_PEN,i[e]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},n.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(t,r){if(this.current)return;this.stopped=!1,this.current={inst:t,startEvent:n.utils.extend({},r),lastEvent:!1,name:""},this.detect(r)},detect:function(t){if(!this.current||this.stopped)return;t=this.extendEventData(t);var r=this.current.inst.options;return n.utils.each(this.gestures,function(e){if(!this.stopped&&r[e.name]!==!1&&e.handler.call(e,t,this.current.inst)===!1)return this.stopDetect(),!1},this),this.current&&(this.current.lastEvent=t),t.eventType==n.EVENT_END&&!t.touches.length-1&&this.stopDetect(),t},stopDetect:function(){this.previous=n.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(t){var r=this.current.startEvent;r&&(t.touches.length!=r.touches.length||t.touches===r.touches)&&(r.touches=[],n.utils.each(t.touches,function(e){r.touches.push(n.utils.extend({},e))}));var i=t.timeStamp-r.timeStamp,s=t.center.pageX-r.center.pageX,o=t.center.pageY-r.center.pageY,u=n.utils.getVelocity(i,s,o),a,f;return t.eventType==="end"?(a=this.current.lastEvent&&this.current.lastEvent.interimAngle,f=this.current.lastEvent&&this.current.lastEvent.interimDirection):(a=this.current.lastEvent&&n.utils.getAngle(this.current.lastEvent.center,t.center),f=this.current.lastEvent&&n.utils.getDirection(this.current.lastEvent.center,t.center)),n.utils.extend(t,{deltaTime:i,deltaX:s,deltaY:o,velocityX:u.x,velocityY:u.y,distance:n.utils.getDistance(r.center,t.center),angle:n.utils.getAngle(r.center,t.center),interimAngle:a,direction:n.utils.getDirection(r.center,t.center),interimDirection:f,scale:n.utils.getScale(r.touches,t.touches),rotation:n.utils.getRotation(r.touches,t.touches),startEvent:r}),t},register:function(r){var i=r.defaults||{};return i[r.name]===t&&(i[r.name]=!0),n.utils.extend(n.defaults,i,!0),r.index=r.index||1e3,this.gestures.push(r),this.gestures.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this.gestures}},n.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:e.navigator.userAgent.toLowerCase().indexOf("android")!==-1?5:10,correct_for_drag_min_distance:!0,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(t,r){if(n.detection.current&&n.detection.current.name!=this.name&&this.triggered){r.trigger(this.name+"end",t),this.triggered=!1;return}if(r.options.drag_max_touches>0&&t.touches.length>r.options.drag_max_touches)return;switch(t.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:if(t.distance<r.options.drag_min_distance&&n.detection.current.name!=this.name)return;if(n.detection.current.name!=this.name){n.detection.current.name=this.name;if(r.options.correct_for_drag_min_distance&&t.distance>0){var i=Math.abs(r.options.drag_min_distance/t.distance);n.detection.current.startEvent.center.pageX+=t.deltaX*i,n.detection.current.startEvent.center.pageY+=t.deltaY*i,t=n.detection.extendEventData(t)}}if(n.detection.current.lastEvent.drag_locked_to_axis||r.options.drag_lock_to_axis&&r.options.drag_lock_min_distance<=t.distance)t.drag_locked_to_axis=!0;var s=n.detection.current.lastEvent.direction;t.drag_locked_to_axis&&s!==t.direction&&(n.utils.isVertical(s)?t.direction=t.deltaY<0?n.DIRECTION_UP:n.DIRECTION_DOWN:t.direction=t.deltaX<0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT),this.triggered||(r.trigger(this.name+"start",t),this.triggered=!0),r.trigger(this.name,t),r.trigger(this.name+t.direction,t),(r.options.drag_block_vertical&&n.utils.isVertical(t.direction)||r.options.drag_block_horizontal&&!n.utils.isVertical(t.direction))&&t.preventDefault();break;case n.EVENT_END:this.triggered&&r.trigger(this.name+"end",t),this.triggered=!1}}},n.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:800,hold_threshold:1},timer:null,handler:function(t,r){switch(t.eventType){case n.EVENT_START:clearTimeout(this.timer),n.detection.current.name=this.name,this.timer=setTimeout(function(){n.detection.current&&n.detection.current.name=="hold"&&r.trigger("hold",t)},r.options.hold_timeout);break;case n.EVENT_MOVE:t.distance>r.options.hold_threshold&&clearTimeout(this.timer);break;case n.EVENT_END:clearTimeout(this.timer)}}},n.gestures.Release={name:"release",index:Infinity,handler:function(t,r){t.eventType==n.EVENT_END&&r.trigger(this.name,t)}},n.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_min_touches:1,swipe_max_touches:1,swipe_velocity:.7},handler:function(t,r){if(t.eventType==n.EVENT_END){if(r.options.swipe_max_touches>0&&t.touches.length<r.options.swipe_min_touches&&t.touches.length>r.options.swipe_max_touches)return;if(t.velocityX>r.options.swipe_velocity||t.velocityY>r.options.swipe_velocity)r.trigger(this.name,t),r.trigger(this.name+t.direction,t)}}},n.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(t,r){if(t.eventType==n.EVENT_END&&t.srcEvent.type!="touchcancel"){var i=n.detection.previous,s=!1;if(t.deltaTime>r.options.tap_max_touchtime||t.distance>r.options.tap_max_distance)return;i&&i.name=="tap"&&t.timeStamp-i.lastEvent.timeStamp<r.options.doubletap_interval&&t.distance<r.options.doubletap_distance&&(r.trigger("doubletap",t),s=!0);if(!s||r.options.tap_always)n.detection.current.name="tap",r.trigger(n.detection.current.name,t)}}},n.gestures.Touch={name:"touch",index:-Infinity,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(t,r){if(r.options.prevent_mouseevents&&t.pointerType==n.POINTER_MOUSE){t.stopDetect();return}r.options.prevent_default&&t.preventDefault(),t.eventType==n.EVENT_START&&r.trigger(this.name,t)}},n.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(t,r){if(n.detection.current.name!=this.name&&this.triggered){r.trigger(this.name+"end",t),this.triggered=!1;return}if(t.touches.length<2)return;r.options.transform_always_block&&t.preventDefault();switch(t.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:var i=Math.abs(1-t.scale),s=Math.abs(t.rotation);if(i<r.options.transform_min_scale&&s<r.options.transform_min_rotation)return;n.detection.current.name=this.name,this.triggered||(r.trigger(this.name+"start",t),this.triggered=!0),r.trigger(this.name,t),s>r.options.transform_min_rotation&&r.trigger("rotate",t),i>r.options.transform_min_scale&&(r.trigger("pinch",t),r.trigger("pinch"+(t.scale<1?"in":"out"),t));break;case n.EVENT_END:this.triggered&&r.trigger(this.name+"end",t),this.triggered=!1}}},typeof define=="function"&&define.amd?define("hammerjs",[],function(){return n}):typeof module=="object"&&module.exports?module.exports=n:e.Hammer=n})(window);(function(e,t){"use strict";function n(e,n){e.event.bindDom=function(e,r,i){n(e).on(r,function(e){var n=e.originalEvent||e;n.pageX===t&&(n.pageX=e.pageX,n.pageY=e.pageY),n.target||(n.target=e.target),n.which===t&&(n.which=n.button),n.preventDefault||(n.preventDefault=e.preventDefault),n.stopPropagation||(n.stopPropagation=e.stopPropagation),i.call(this,n)})},e.Instance.prototype.on=function(e,t){return n(this.element).on(e,t)},e.Instance.prototype.off=function(e,t){return n(this.element).off(e,t)},e.Instance.prototype.trigger=function(e,t){var r=n(this.element);return r.has(t.target).length&&(r=n(t.target)),r.trigger({type:e,gesture:t})},n.fn.hammer=function(t){return this.each(function(){var r=n(this),i=r.data("hammer");i?t=="reset"?e.detection.current=null:i&&t&&e.utils.extend(i.options,t):r.data("hammer",new e(this,t||{}))})}}typeof define=="function"&&typeof define.amd=="object"&&define.amd?define("jquery.hammer",["hammerjs","jquery"],n):n(e.Hammer,e.jQuery||e.Zepto)})(this);(function(e){function r(e){if(e in t.style)return e;var n=["Moz","Webkit","O","ms"],r=e.charAt(0).toUpperCase()+e.substr(1);if(e in t.style)return e;for(var i=0;i<n.length;++i){var s=n[i]+r;if(s in t.style)return s}}function i(){return t.style[n.transform]="",t.style[n.transform]="rotateY(90deg)",t.style[n.transform]!==""}function f(e){return typeof e=="string"&&this.parse(e),this}function l(e,t,n){t===!0?e.queue(n):t?e.queue(t,n):n()}function c(t){var n=[];return e.each(t,function(t){t=e.camelCase(t),t=e.transit.propertyMap[t]||e.cssProps[t]||t,t=d(t),e.inArray(t,n)===-1&&n.push(t)}),n}function h(t,n,r,i){var s=c(t);e.cssEase[r]&&(r=e.cssEase[r]);var o=""+m(n)+" "+r;parseInt(i,10)>0&&(o+=" "+m(i));var u=[];return e.each(s,function(e,t){u.push(t+" "+o)}),u.join(", ")}function p(t,r){r||(e.cssNumber[t]=!0),e.transit.propertyMap[t]=n.transform,e.cssHooks[t]={get:function(n){var r=e(n).css("transit:transform");return r.get(t)},set:function(n,r){var i=e(n).css("transit:transform");i.setFromString(t,r),e(n).css({"transit:transform":i})}}}function d(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function v(e,t){return typeof e=="string"&&!e.match(/^[\-0-9\.]+$/)?e:""+e+t}function m(t){var n=t;return e.fx.speeds[n]&&(n=e.fx.speeds[n]),v(n,"ms")}e.transit={version:"0.9.9",propertyMap:{marginLeft:"margin",marginRight:"margin",marginBottom:"margin",marginTop:"margin",paddingLeft:"padding",paddingRight:"padding",paddingBottom:"padding",paddingTop:"padding"},enabled:!0,useTransitionEnd:!1};var t=document.createElement("div"),n={},s=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;n.transition=r("transition"),n.transitionDelay=r("transitionDelay"),n.transform=r("transform"),n.transformOrigin=r("transformOrigin"),n.transform3d=i();var o={transition:"transitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",msTransition:"MSTransitionEnd"},u=n.transitionEnd=o[n.transition]||null;for(var a in n)n.hasOwnProperty(a)&&typeof e.support[a]=="undefined"&&(e.support[a]=n[a]);t=null,e.cssEase={_default:"ease","in":"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",easeOutCubic:"cubic-bezier(.215,.61,.355,1)",easeInOutCubic:"cubic-bezier(.645,.045,.355,1)",easeInCirc:"cubic-bezier(.6,.04,.98,.335)",easeOutCirc:"cubic-bezier(.075,.82,.165,1)",easeInOutCirc:"cubic-bezier(.785,.135,.15,.86)",easeInExpo:"cubic-bezier(.95,.05,.795,.035)",easeOutExpo:"cubic-bezier(.19,1,.22,1)",easeInOutExpo:"cubic-bezier(1,0,0,1)",easeInQuad:"cubic-bezier(.55,.085,.68,.53)",easeOutQuad:"cubic-bezier(.25,.46,.45,.94)",easeInOutQuad:"cubic-bezier(.455,.03,.515,.955)",easeInQuart:"cubic-bezier(.895,.03,.685,.22)",easeOutQuart:"cubic-bezier(.165,.84,.44,1)",easeInOutQuart:"cubic-bezier(.77,0,.175,1)",easeInQuint:"cubic-bezier(.755,.05,.855,.06)",easeOutQuint:"cubic-bezier(.23,1,.32,1)",easeInOutQuint:"cubic-bezier(.86,0,.07,1)",easeInSine:"cubic-bezier(.47,0,.745,.715)",easeOutSine:"cubic-bezier(.39,.575,.565,1)",easeInOutSine:"cubic-bezier(.445,.05,.55,.95)",easeInBack:"cubic-bezier(.6,-.28,.735,.045)",easeOutBack:"cubic-bezier(.175, .885,.32,1.275)",easeInOutBack:"cubic-bezier(.68,-.55,.265,1.55)",epubOut:"cubic-bezier(.3,1,.0,1)"},e.cssHooks["transit:transform"]={get:function(t){return e(t).data("transform")||new f},set:function(t,r){var i=r;i instanceof f||(i=new f(i)),n.transform==="WebkitTransform"&&!s?t.style[n.transform]=i.toString(!0):t.style[n.transform]=i.toString(),e(t).data("transform",i)}},e.cssHooks.transform={set:e.cssHooks["transit:transform"].set},e.fn.jquery<"1.8"&&(e.cssHooks.transformOrigin={get:function(e){return e.style[n.transformOrigin]},set:function(e,t){e.style[n.transformOrigin]=t}},e.cssHooks.transition={get:function(e){return e.style[n.transition]},set:function(e,t){e.style[n.transition]=t}}),p("scale"),p("translate"),p("translateZ"),p("rotate"),p("rotateX"),p("rotateY"),p("rotate3d"),p("perspective"),p("skewX"),p("skewY"),p("x",!0),p("y",!0),f.prototype={setFromString:function(e,t){var n=typeof t=="string"?t.split(","):t.constructor===Array?t:[t];n.unshift(e),f.prototype.set.apply(this,n)},set:function(e){var t=Array.prototype.slice.apply(arguments,[1]);this.setter[e]?this.setter[e].apply(this,t):this[e]=t.join(",")},get:function(e){return this.getter[e]?this.getter[e].apply(this):this[e]||0},setter:{rotate:function(e){this.rotate=v(e,"deg")},rotateX:function(e){this.rotateX=v(e,"deg")},rotateY:function(e){this.rotateY=v(e,"deg")},scale:function(e,t){t===undefined&&(t=e),this.scale=e+","+t},skewX:function(e){this.skewX=v(e,"deg")},skewY:function(e){this.skewY=v(e,"deg")},perspective:function(e){this.perspective=v(e,"px")},x:function(e){this.set("translate",e,null)},y:function(e){this.set("translate",null,e)},translate:function(e,t){this._translateX===undefined&&(this._translateX=0),this._translateY===undefined&&(this._translateY=0),e!==null&&e!==undefined&&(this._translateX=v(e,"px")),t!==null&&t!==undefined&&(this._translateY=v(t,"px")),this.translate=this._translateX+","+this._translateY},translateZ:function(e){this.translateZ=v(e,"px")}},getter:{x:function(){return this._translateX||0},y:function(){return this._translateY||0},translateZ:function(){return this.translateZ||0},scale:function(){var e=(this.scale||"1,1").split(",");return e[0]&&(e[0]=parseFloat(e[0])),e[1]&&(e[1]=parseFloat(e[1])),e[0]===e[1]?e[0]:e},rotate3d:function(){var e=(this.rotate3d||"0,0,0,0deg").split(",");for(var t=0;t<=3;++t)e[t]&&(e[t]=parseFloat(e[t]));return e[3]&&(e[3]=v(e[3],"deg")),e}},parse:function(e){var t=this;e.replace(/([a-zA-Z0-9]+)\((.*?)\)/g,function(e,n,r){t.setFromString(n,r)})},toString:function(e){var t=[];for(var r in this)if(this.hasOwnProperty(r)){if(!n.transform3d&&(r==="rotateX"||r==="rotateY"||r==="translateZ"||r==="perspective"||r==="transformOrigin"))continue;r[0]!=="_"&&(e&&r==="scale"?t.push(r+"3d("+this[r]+",1)"):e&&r==="translate"?t.push(r+"3d("+this[r]+",0)"):t.push(r+"("+this[r]+")"))}return t.join(" ")}},e.fn.transition=e.fn.transit=function(t,r,i,s){var o=this,a=0,f=!0;typeof r=="function"&&(s=r,r=undefined),typeof i=="function"&&(s=i,i=undefined),typeof t.easing!="undefined"&&(i=t.easing,delete t.easing),typeof t.duration!="undefined"&&(r=t.duration,delete t.duration),typeof t.complete!="undefined"&&(s=t.complete,delete t.complete),typeof t.queue!="undefined"&&(f=t.queue,delete t.queue),typeof t.delay!="undefined"&&(a=t.delay,delete t.delay),typeof r=="undefined"&&(r=e.fx.speeds._default),typeof i=="undefined"&&(i=e.cssEase._default),e.fx.off&&(r=0),r=m(r);var c=h(t,r,i,a),p=e.transit.enabled&&n.transition,d=p?parseInt(r,10)+parseInt(a,10):0;if(d===0){var v=function(e){o.css(t),s&&s.apply(o),e&&e()};return l(o,f,v),o}var g={},y=function(r){var i=!1,a=function(){i&&o.unbind(u,a),d>0&&o.each(function(){this.style[n.transition]=g[this]||null}),typeof s=="function"&&s.apply(o),typeof r=="function"&&r()};d>0&&u&&e.transit.useTransitionEnd?(i=!0,o.bind(u,a)):window.setTimeout(a,d),o.each(function(){d>0&&(this.style[n.transition]=c),e(this).css(t)})},b=function(e){this.offsetWidth,y(e)};return l(o,f,b),this},e.transit.getTransitionValue=h})(jQuery),define("jquery.transit",function(){}),define("/Users/blues/projects/epub360/1-src/epub360-built/html/common/js/transit/jquery.transit.js",function(){});(function(e,t,n){function s(e,n){this.wrapper=typeof e=="string"?t.querySelector(e):e,this.scroller=this.wrapper.children[0],this.scrollerStyle=this.scroller.style,this.options={resizeScrollbars:!0,mouseWheelSpeed:20,snapThreshold:.334,startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:"",preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:!0,useTransition:!0,useTransform:!0};for(var r in n)this.options[r]=n[r];this.translateZ=this.options.HWCompositing&&i.hasPerspective?" translateZ(0)":"",this.options.useTransition=i.hasTransition&&this.options.useTransition,this.options.useTransform=i.hasTransform&&this.options.useTransform,this.options.eventPassthrough=this.options.eventPassthrough===!0?"vertical":this.options.eventPassthrough,this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault,this.options.scrollY=this.options.eventPassthrough=="vertical"?!1:this.options.scrollY,this.options.scrollX=this.options.eventPassthrough=="horizontal"?!1:this.options.scrollX,this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough,this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold,this.options.bounceEasing=typeof this.options.bounceEasing=="string"?i.ease[this.options.bounceEasing]||i.ease.circular:this.options.bounceEasing,this.options.resizePolling=this.options.resizePolling===undefined?60:this.options.resizePolling,this.options.tap===!0&&(this.options.tap="tap"),this.options.shrinkScrollbars=="scale"&&(this.options.useTransition=!1),this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1,this.options.probeType==3&&(this.options.useTransition=!1),this.x=0,this.y=0,this.directionX=0,this.directionY=0,this._events={},this._init(),this.refresh(),this.scrollTo(this.options.startX,this.options.startY),this.enable()}function o(e,n,r){var i=t.createElement("div"),s=t.createElement("div");return r===!0&&(i.style.cssText="position:absolute;z-index:9999",s.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px"),s.className="iScrollIndicator",e=="h"?(r===!0&&(i.style.cssText+=";height:7px;left:2px;right:2px;bottom:0",s.style.height="100%"),i.className="iScrollHorizontalScrollbar"):(r===!0&&(i.style.cssText+=";width:7px;bottom:2px;top:2px;right:1px",s.style.width="100%"),i.className="iScrollVerticalScrollbar"),i.style.cssText+=";overflow:hidden",n||(i.style.pointerEvents="none"),i.appendChild(s),i}function u(n,r){this.wrapper=typeof r.el=="string"?t.querySelector(r.el):r.el,this.wrapperStyle=this.wrapper.style,this.indicator=this.wrapper.children[0],this.indicatorStyle=this.indicator.style,this.scroller=n,this.options={listenX:!0,listenY:!0,interactive:!1,resize:!0,defaultScrollbars:!1,shrink:!1,fade:!1,speedRatioX:0,speedRatioY:0};for(var s in r)this.options[s]=r[s];this.sizeRatioX=1,this.sizeRatioY=1,this.maxPosX=0,this.maxPosY=0,this.options.interactive&&(this.options.disableTouch||(i.addEvent(this.indicator,"touchstart",this),i.addEvent(e,"touchend",this)),this.options.disablePointer||(i.addEvent(this.indicator,"MSPointerDown",this),i.addEvent(e,"MSPointerUp",this)),this.options.disableMouse||(i.addEvent(this.indicator,"mousedown",this),i.addEvent(e,"mouseup",this))),this.options.fade&&(this.wrapperStyle[i.style.transform]=this.scroller.translateZ,this.wrapperStyle[i.style.transitionDuration]=i.isBadAndroid?"0.001s":"0ms",this.wrapperStyle.opacity="0")}var r=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){e.setTimeout(t,1e3/60)},i=function(){function o(e){return s===!1?!1:s===""?e:s+e.charAt(0).toUpperCase()+e.substr(1)}var r={},i=t.createElement("div").style,s=function(){var e=["t","webkitT","MozT","msT","OT"],t,n=0,r=e.length;for(;n<r;n++){t=e[n]+"ransform";if(t in i)return e[n].substr(0,e[n].length-1)}return!1}();r.getTime=Date.now||function(){return(new Date).getTime()},r.extend=function(e,t){for(var n in t)e[n]=t[n]},r.addEvent=function(e,t,n,r){e.addEventListener?e.addEventListener(t,n,!!r):e.attachEvent(t,n)},r.removeEvent=function(e,t,n,r){e.removeEventListener?e.removeEventListener(t,n,!!r):e.detachEvent(t,n)},r.momentum=function(e,t,r,i,s,o){var u=e-t,a=n.abs(u)/r,f,l;return o=o===undefined?6e-4:o,f=e+a*a/(2*o)*(u<0?-1:1),l=a/o,f<i?(f=s?i-s/2.5*(a/8):i,u=n.abs(f-e),l=u/a):f>0&&(f=s?s/2.5*(a/8):0,u=n.abs(e)+f,l=u/a),{destination:n.round(f),duration:l}};var u=o("transform");return r.extend(r,{hasTransform:u!==!1,hasPerspective:o("perspective")in i,hasTouch:"ontouchstart"in e,hasPointer:navigator.msPointerEnabled,hasTransition:o("transition")in i}),r.isBadAndroid=/Android /.test(e.navigator.appVersion)&&!/Chrome\/\d/.test(e.navigator.appVersion),r.extend(r.style={},{transform:u,transitionTimingFunction:o("transitionTimingFunction"),transitionDuration:o("transitionDuration"),transitionDelay:o("transitionDelay"),transformOrigin:o("transformOrigin")}),r.hasClass=function(e,t){var n=new RegExp("(^|\\s)"+t+"(\\s|$)");return n.test(e.className)},r.addClass=function(e,t){if(r.hasClass(e,t))return;var n=e.className.split(" ");n.push(t),e.className=n.join(" ")},r.removeClass=function(e,t){if(!r.hasClass(e,t))return;var n=new RegExp("(^|\\s)"+t+"(\\s|$)","g");e.className=e.className.replace(n," ")},r.offset=function(e){var t=-e.offsetLeft,n=-e.offsetTop;while(e=e.offsetParent)t-=e.offsetLeft,n-=e.offsetTop;return{left:t,top:n}},r.preventDefaultException=function(e,t){for(var n in t)if(t[n].test(e[n]))return!0;return!1},r.extend(r.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3}),r.extend(r.ease={},{quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(e){return e*(2-e)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn:function(e){return n.sqrt(1- --e*e)}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn:function(e){var t=4;return(e-=1)*e*((t+1)*e+t)+1}},bounce:{style:"",fn:function(e){return(e/=1)<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}},elastic:{style:"",fn:function(e){var t=.22,r=.4;return e===0?0:e==1?1:r*n.pow(2,-10*e)*n.sin((e-t/4)*2*n.PI/t)+1}}}),r.tap=function(e,n){var r=t.createEvent("Event");r.initEvent(n,!0,!0),r.pageX=e.pageX,r.pageY=e.pageY,e.target.dispatchEvent(r)},r.click=function(e){var n=e.target,r;/(SELECT|INPUT|TEXTAREA)/i.test(n.tagName)||(r=t.createEvent("MouseEvents"),r.initMouseEvent("click",!0,!0,e.view,1,n.screenX,n.screenY,n.clientX,n.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null),r._constructed=!0,n.dispatchEvent(r))},r}();s.prototype={version:"5.1.1",_init:function(){this._initEvents(),(this.options.scrollbars||this.options.indicators)&&this._initIndicators(),this.options.mouseWheel&&this._initWheel(),this.options.snap&&this._initSnap(),this.options.keyBindings&&this._initKeys()},destroy:function(){this._initEvents(!0),this._execEvent("destroy")},_transitionEnd:function(e){if(e.target!=this.scroller||!this.isInTransition)return;this._transitionTime(),this.resetPosition(this.options.bounceTime)||(this.isInTransition=!1,this._execEvent("scrollEnd"))},_start:function(e){if(i.eventType[e.type]!=1&&e.button!==0)return;if(!this.enabled||this.initiated&&i.eventType[e.type]!==this.initiated)return;this.options.preventDefault&&!i.isBadAndroid&&!i.preventDefaultException(e.target,this.options.preventDefaultException)&&e.preventDefault();var t=e.touches?e.touches[0]:e,r;this.initiated=i.eventType[e.type],this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,this._transitionTime(),this.startTime=i.getTime(),this.options.useTransition&&this.isInTransition?(this.isInTransition=!1,r=this.getComputedPosition(),this._translate(n.round(r.x),n.round(r.y)),this._execEvent("scrollEnd")):!this.options.useTransition&&this.isAnimating&&(this.isAnimating=!1,this._execEvent("scrollEnd")),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=t.pageX,this.pointY=t.pageY,this._execEvent("beforeScrollStart")},_move:function(e){if(!this.enabled||i.eventType[e.type]!==this.initiated)return;this.options.preventDefault&&e.preventDefault();var t=e.touches?e.touches[0]:e,r=t.pageX-this.pointX,s=t.pageY-this.pointY,o=i.getTime(),u,a,f,l;this.pointX=t.pageX,this.pointY=t.pageY,this.distX+=r,this.distY+=s,f=n.abs(this.distX),l=n.abs(this.distY);if(o-this.endTime>300&&f<10&&l<10)return;!this.directionLocked&&!this.options.freeScroll&&(f>l+this.options.directionLockThreshold?this.directionLocked="h":l>=f+this.options.directionLockThreshold?this.directionLocked="v":this.directionLocked="n");if(this.directionLocked=="h"){if(this.options.eventPassthrough=="vertical")e.preventDefault();else if(this.options.eventPassthrough=="horizontal"){this.initiated=!1;return}s=0}else if(this.directionLocked=="v"){if(this.options.eventPassthrough=="horizontal")e.preventDefault();else if(this.options.eventPassthrough=="vertical"){this.initiated=!1;return}r=0}r=this.hasHorizontalScroll?r:0,s=this.hasVerticalScroll?s:0,(this.options.scrollX&&r||this.options.scrollY&&s)&&e.stopPropagation(),u=this.x+r,a=this.y+s;if(u>0||u<this.maxScrollX)u=this.options.bounce?this.x+r/3:u>0?0:this.maxScrollX;if(a>0||a<this.maxScrollY)a=this.options.bounce?this.y+s/3:a>0?0:this.maxScrollY;this.directionX=r>0?-1:r<0?1:0,this.directionY=s>0?-1:s<0?1:0,this.moved||this._execEvent("scrollStart"),this.moved=!0,this._translate(u,a),o-this.startTime>300&&(this.startTime=o,this.startX=this.x,this.startY=this.y,this.options.probeType==1&&this._execEvent("scroll")),this.options.probeType>1&&this._execEvent("scroll")},_end:function(e){if(!this.enabled||i.eventType[e.type]!==this.initiated)return;this.options.preventDefault&&!i.preventDefaultException(e.target,this.options.preventDefaultException)&&e.preventDefault();var t=e.changedTouches?e.changedTouches[0]:e,r,s,o=i.getTime()-this.startTime,u=n.round(this.x),a=n.round(this.y),f=n.abs(u-this.startX),l=n.abs(a-this.startY),c=0,h="";this.isInTransition=0,this.initiated=0,this.endTime=i.getTime();if(this.resetPosition(this.options.bounceTime))return;this.scrollTo(u,a);if(!this.moved){this.options.tap&&i.tap(e,this.options.tap),this.options.click&&i.click(e),this._execEvent("scrollCancel");return}if(this._events.flick&&o<200&&f<100&&l<100){this._execEvent("flick");return}this.options.momentum&&o<300&&(r=this.hasHorizontalScroll?i.momentum(this.x,this.startX,o,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:u,duration:0},s=this.hasVerticalScroll?i.momentum(this.y,this.startY,o,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:a,duration:0},u=r.destination,a=s.destination,c=n.max(r.duration,s.duration),this.isInTransition=1);if(this.options.snap){var p=this._nearestSnap(u,a);this.currentPage=p,c=this.options.snapSpeed||n.max(n.max(n.min(n.abs(u-p.x),1e3),n.min(n.abs(a-p.y),1e3)),300),u=p.x,a=p.y,this.directionX=0,this.directionY=0,h=this.options.bounceEasing}if(u!=this.x||a!=this.y){if(u>0||u<this.maxScrollX||a>0||a<this.maxScrollY)h=i.ease.quadratic;this.scrollTo(u,a,c,h);return}this._execEvent("scrollEnd")},_resize:function(){var e=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){e.refresh()},this.options.resizePolling)},resetPosition:function(e){var t=this.x,n=this.y;return e=e||0,!this.hasHorizontalScroll||this.x>0?t=0:this.x<this.maxScrollX&&(t=this.maxScrollX),!this.hasVerticalScroll||this.y>0?n=0:this.y<this.maxScrollY&&(n=this.maxScrollY),t==this.x&&n==this.y?!1:(this.scrollTo(t,n,e,this.options.bounceEasing),!0)},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},refresh:function(){var e=this.options.scrollerHeight||this.wrapper.offsetHeight;this.wrapperWidth=this.options.wrapperWidth||this.wrapper.clientWidth,this.wrapperHeight=this.options.wrapperHeight||this.wrapper.clientHeight,this.scrollerWidth=this.options.scrollerWidth||this.scroller.offsetWidth,this.scrollerHeight=this.options.scrollerHeight||this.scroller.offsetHeight,this.maxScrollX=this.wrapperWidth-this.scrollerWidth,this.maxScrollY=this.wrapperHeight-this.scrollerHeight,this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0,this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=i.offset(this.wrapper),this._execEvent("refresh"),this.resetPosition()},on:function(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)},off:function(e,t){if(!this._events[e])return;var n=this._events[e].indexOf(t);n>-1&&this._events[e].splice(n,1)},_execEvent:function(e){if(!this._events[e])return;var t=0,n=this._events[e].length;if(!n)return;for(;t<n;t++)this._events[e][t].apply(this,[].slice.call(arguments,1))},scrollBy:function(e,t,n,r){e=this.x+e,t=this.y+t,n=n||0,this.scrollTo(e,t,n,r)},scrollTo:function(e,t,n,r){r=r||i.ease.circular,this.isInTransition=this.options.useTransition&&n>0,!n||this.options.useTransition&&r.style?(this._transitionTimingFunction(r.style),this._transitionTime(n),this._translate(e,t)):this._animate(e,t,n,r.fn)},scrollToElement:function(e,t,r,s,o){e=e.nodeType?e:this.scroller.querySelector(e);if(!e)return;var u=i.offset(e);u.left-=this.wrapperOffset.left,u.top-=this.wrapperOffset.top,r===!0&&(r=n.round(e.offsetWidth/2-this.wrapper.offsetWidth/2)),s===!0&&(s=n.round(e.offsetHeight/2-this.wrapper.offsetHeight/2)),u.left-=r||0,u.top-=s||0,u.left=u.left>0?0:u.left<this.maxScrollX?this.maxScrollX:u.left,u.top=u.top>0?0:u.top<this.maxScrollY?this.maxScrollY:u.top,t=t===undefined||t===null||t==="auto"?n.max(n.abs(this.x-u.left),n.abs(this.y-u.top)):t,this.scrollTo(u.left,u.top,t,o)},_transitionTime:function(e){e=e||0,this.scrollerStyle[i.style.transitionDuration]=e+"ms",!e&&i.isBadAndroid&&(this.scrollerStyle[i.style.transitionDuration]="0.001s");if(this.indicators)for(var t=this.indicators.length;t--;)this.indicators[t].transitionTime(e)},_transitionTimingFunction:function(e){this.scrollerStyle[i.style.transitionTimingFunction]=e;if(this.indicators)for(var t=this.indicators.length;t--;)this.indicators[t].transitionTimingFunction(e)},_translate:function(e,t){this.options.useTransform?this.scrollerStyle[i.style.transform]="translate("+e+"px,"+t+"px)"+this.translateZ:(e=n.round(e),t=n.round(t),this.scrollerStyle.left=e+"px",this.scrollerStyle.top=t+"px"),this.x=e,this.y=t;if(this.indicators)for(var r=this.indicators.length;r--;)this.indicators[r].updatePosition()},_initEvents:function(t){var n=t?i.removeEvent:i.addEvent,r=this.options.bindToWrapper?this.wrapper:e;n(e,"orientationchange",this),n(e,"resize",this),this.options.click&&n(this.wrapper,"click",this,!0),this.options.disableMouse||(n(this.wrapper,"mousedown",this),n(r,"mousemove",this),n(r,"mousecancel",this),n(r,"mouseup",this)),i.hasPointer&&!this.options.disablePointer&&(n(this.wrapper,"MSPointerDown",this),n(r,"MSPointerMove",this),n(r,"MSPointerCancel",this),n(r,"MSPointerUp",this)),i.hasTouch&&!this.options.disableTouch&&(n(this.wrapper,"touchstart",this),n(r,"touchmove",this),n(r,"touchcancel",this),n(r,"touchend",this)),n(this.scroller,"transitionend",this),n(this.scroller,"webkitTransitionEnd",this),n(this.scroller,"oTransitionEnd",this),n(this.scroller,"MSTransitionEnd",this)},getComputedPosition:function(){var t=e.getComputedStyle(this.scroller,null),n,r;return this.options.useTransform?(t=t[i.style.transform].split(")")[0].split(", "),n=+(t[12]||t[4]),r=+(t[13]||t[5])):(n=+t.left.replace(/[^-\d.]/g,""),r=+t.top.replace(/[^-\d.]/g,"")),{x:n,y:r}},_initIndicators:function(){function a(e){for(var t=i.indicators.length;t--;)e.call(i.indicators[t])}var e=this.options.interactiveScrollbars,t=typeof this.options.scrollbars!="string",n=[],r,i=this;this.indicators=[],this.options.scrollbars&&(this.options.scrollY&&(r={el:o("v",e,this.options.scrollbars),interactive:e,defaultScrollbars:!0,customStyle:t,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenX:!1},this.wrapper.appendChild(r.el),n.push(r)),this.options.scrollX&&(r={el:o("h",e,this.options.scrollbars),interactive:e,defaultScrollbars:!0,customStyle:t,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenY:!1},this.wrapper.appendChild(r.el),n.push(r))),this.options.indicators&&(n=n.concat(this.options.indicators));for(var s=n.length;s--;)this.indicators.push(new u(this,n[s]));this.options.fadeScrollbars&&(this.on("scrollEnd",function(){a(function(){this.fade()})}),this.on("scrollCancel",function(){a(function(){this.fade()})}),this.on("scrollStart",function(){a(function(){this.fade(1)})}),this.on("beforeScrollStart",function(){a(function(){this.fade(1,!0)})})),this.on("refresh",function(){a(function(){this.refresh()})}),this.on("destroy",function(){a(function(){this.destroy()}),delete this.indicators})},_initWheel:function(){i.addEvent(this.wrapper,"wheel",this),i.addEvent(this.wrapper,"mousewheel",this),i.addEvent(this.wrapper,"DOMMouseScroll",this),this.on("destroy",function(){i.removeEvent(this.wrapper,"wheel",this),i.removeEvent(this.wrapper,"mousewheel",this),i.removeEvent(this.wrapper,"DOMMouseScroll",this)})},_wheel:function(e){if(!this.enabled)return;var t,r,i,s,o=this;"deltaX"in e?(t=-e.deltaX,r=-e.deltaY):"wheelDeltaX"in e?(t=e.wheelDeltaX/120*this.options.mouseWheelSpeed,r=e.wheelDeltaY/120*this.options.mouseWheelSpeed):"wheelDelta"in e?t=r=e.wheelDelta/120*this.options.mouseWheelSpeed:"detail"in e?t=r=-e.detail/3*this.options.mouseWheelSpeed:t=r=undefined;if(t&&!this.options.scrollX&&!this.wheelTimeout)return;if(r&&!this.options.scrollY&&!this.wheelTimeout)return;e.preventDefault(),e.stopPropagation(),this.wheelTimeout===undefined&&o._execEvent("scrollStart"),clearTimeout(this.wheelTimeout),this.wheelTimeout=setTimeout(function(){o._execEvent("scrollEnd"),o.wheelTimeout=undefined},400);if(t==undefined&&r==undefined)return;t*=this.options.invertWheelDirection,r*=this.options.invertWheelDirection,this.hasVerticalScroll||(r=0),this.hasHorizontalScroll||(t=0);if(this.options.snap){i=this.currentPage.pageX,s=this.currentPage.pageY,t>0?i--:t<0&&i++,r>0?s--:r<0&&s++,this.goToPage(i,s);return}i=this.x+n.round(this.hasHorizontalScroll?t:0),s=this.y+n.round(this.hasVerticalScroll?r:0),i>0?i=0:i<this.maxScrollX&&(i=this.maxScrollX),s>0?s=0:s<this.maxScrollY&&(s=this.maxScrollY),this.scrollTo(i,s,0),this.options.probeType>1&&this._execEvent("scroll")},_initSnap:function(){this.currentPage={},typeof this.options.snap=="string"&&(this.options.snap=this.scroller.querySelectorAll(this.options.snap)),this.on("refresh",function(){var e=0,t,r=0,i,s,o,u=0,a,f=this.options.snapStepX||this.wrapperWidth,l=this.options.snapStepY||this.wrapperHeight,c;this.pages=[];if(!this.wrapperWidth||!this.wrapperHeight||!this.scrollerWidth||!this.scrollerHeight)return;if(this.options.snap===!0){s=n.round(f/2),o=n.round(l/2);while(u>-this.scrollerWidth){this.pages[e]=[],t=0,a=0;while(a>-this.scrollerHeight)this.pages[e][t]={x:n.max(u,this.maxScrollX),y:n.max(a,this.maxScrollY),width:f,height:l,cx:u-s,cy:a-o},a-=l,t++;u-=f,e++}}else{c=this.options.snap,t=c.length,i=-1;for(;e<t;e++){if(e===0||c[e].offsetLeft<=c[e-1].offsetLeft)r=0,i++;this.pages[r]||(this.pages[r]=[]),u=n.max(-c[e].offsetLeft,this.maxScrollX),a=n.max(-c[e].offsetTop,this.maxScrollY),s=u-n.round(c[e].offsetWidth/2),o=a-n.round(c[e].offsetHeight/2),this.pages[r][i]={x:u,y:a,width:c[e].offsetWidth,height:c[e].offsetHeight,cx:s,cy:o},u>this.maxScrollX&&r++}}this.goToPage(this.currentPage.pageX||0,this.currentPage.pageY||0,0),this.options.snapThreshold%1===0?(this.snapThresholdX=this.options.snapThreshold,this.snapThresholdY=this.options.snapThreshold):(this.snapThresholdX=n.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width*this.options.snapThreshold),this.snapThresholdY=n.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height*this.options.snapThreshold))}),this.on("flick",function(){var e=this.options.snapSpeed||n.max(n.max(n.min(n.abs(this.x-this.startX),1e3),n.min(n.abs(this.y-this.startY),1e3)),300);this.goToPage(this.currentPage.pageX+this.directionX,this.currentPage.pageY+this.directionY,e)})},_nearestSnap:function(e,t){if(!this.pages.length)return{x:0,y:0,pageX:0,pageY:0};var r=0,i=this.pages.length,s=0;if(n.abs(e-this.absStartX)<this.snapThresholdX&&n.abs(t-this.absStartY)<this.snapThresholdY)return this.currentPage;e>0?e=0:e<this.maxScrollX&&(e=this.maxScrollX),t>0?t=0:t<this.maxScrollY&&(t=this.maxScrollY);for(;r<i;r++)if(e>=this.pages[r][0].cx){e=this.pages[r][0].x;break}i=this.pages[r].length;for(;s<i;s++)if(t>=this.pages[0][s].cy){t=this.pages[0][s].y;break}return r==this.currentPage.pageX&&(r+=this.directionX,r<0?r=0:r>=this.pages.length&&(r=this.pages.length-1),e=this.pages[r][0].x),s==this.currentPage.pageY&&(s+=this.directionY,s<0?s=0:s>=this.pages[0].length&&(s=this.pages[0].length-1),t=this.pages[0][s].y),{x:e,y:t,pageX:r,pageY:s}},goToPage:function(e,t,r,i){i=i||this.options.bounceEasing,e>=this.pages.length?e=this.pages.length-1:e<0&&(e=0),t>=this.pages[e].length?t=this.pages[e].length-1:t<0&&(t=0);var s=this.pages[e][t].x,o=this.pages[e][t].y;r=r===undefined?this.options.snapSpeed||n.max(n.max(n.min(n.abs(s-this.x),1e3),n.min(n.abs(o-this.y),1e3)),300):r,this.currentPage={x:s,y:o,pageX:e,pageY:t},this.scrollTo(s,o,r,i)},next:function(e,t){var n=this.currentPage.pageX,r=this.currentPage.pageY;n++,n>=this.pages.length&&this.hasVerticalScroll&&(n=0,r++),this.goToPage(n,r,e,t)},prev:function(e,t){var n=this.currentPage.pageX,r=this.currentPage.pageY;n--,n<0&&this.hasVerticalScroll&&(n=0,r--),this.goToPage(n,r,e,t)},_initKeys:function(t){var n={pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40},r;if(typeof this.options.keyBindings=="object")for(r in this.options.keyBindings)typeof this.options.keyBindings[r]=="string"&&(this.options.keyBindings[r]=this.options.keyBindings[r].toUpperCase().charCodeAt(0));else this.options.keyBindings={};for(r in n)this.options.keyBindings[r]=this.options.keyBindings[r]||n[r];i.addEvent(e,"keydown",this),this.on("destroy",function(){i.removeEvent(e,"keydown",this)})},_key:function(e){if(!this.enabled)return;var t=this.options.snap,r=t?this.currentPage.pageX:this.x,s=t?this.currentPage.pageY:this.y,o=i.getTime(),u=this.keyTime||0,a=.25,f;this.options.useTransition&&this.isInTransition&&(f=this.getComputedPosition(),this._translate(n.round(f.x),n.round(f.y)),this.isInTransition=!1),this.keyAcceleration=o-u<200?n.min(this.keyAcceleration+a,50):0;switch(e.keyCode){case this.options.keyBindings.pageUp:this.hasHorizontalScroll&&!this.hasVerticalScroll?r+=t?1:this.wrapperWidth:s+=t?1:this.wrapperHeight;break;case this.options.keyBindings.pageDown:this.hasHorizontalScroll&&!this.hasVerticalScroll?r-=t?1:this.wrapperWidth:s-=t?1:this.wrapperHeight;break;case this.options.keyBindings.end:r=t?this.pages.length-1:this.maxScrollX,s=t?this.pages[0].length-1:this.maxScrollY;break;case this.options.keyBindings.home:r=0,s=0;break;case this.options.keyBindings.left:r+=t?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.up:s+=t?1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.right:r-=t?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.down:s-=t?1:5+this.keyAcceleration>>0;break;default:return}if(t){this.goToPage(r,s);return}r>0?(r=0,this.keyAcceleration=0):r<this.maxScrollX&&(r=this.maxScrollX,this.keyAcceleration=0),s>0?(s=0,this.keyAcceleration=0):s<this.maxScrollY&&(s=this.maxScrollY,this.keyAcceleration=0),this.scrollTo(r,s,0),this.keyTime=o},_animate:function(e,t,n,s){function c(){var h=i.getTime(),p,d,v;if(h>=l){o.isAnimating=!1,o._translate(e,t),o.resetPosition(o.options.bounceTime)||o._execEvent("scrollEnd");return}h=(h-f)/n,v=s(h),p=(e-u)*v+u,d=(t-a)*v+a,o._translate(p,d),o.isAnimating&&r(c),o.options.probeType==3&&o._execEvent("scroll")}var o=this,u=this.x,a=this.y,f=i.getTime(),l=f+n;this.isAnimating=!0,c()},handleEvent:function(e){switch(e.type){case"touchstart":case"MSPointerDown":case"mousedown":this._start(e);break;case"touchmove":case"MSPointerMove":case"mousemove":this._move(e);break;case"touchend":case"MSPointerUp":case"mouseup":case"touchcancel":case"MSPointerCancel":case"mousecancel":this._end(e);break;case"orientationchange":case"resize":this._resize();break;case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this._transitionEnd(e);break;case"wheel":case"DOMMouseScroll":case"mousewheel":this._wheel(e);break;case"keydown":this._key(e);break;case"click":e._constructed||(e.preventDefault(),e.stopPropagation())}}},u.prototype={handleEvent:function(e){switch(e.type){case"touchstart":case"MSPointerDown":case"mousedown":this._start(e);break;case"touchmove":case"MSPointerMove":case"mousemove":this._move(e);break;case"touchend":case"MSPointerUp":case"mouseup":case"touchcancel":case"MSPointerCancel":case"mousecancel":this._end(e)}},destroy:function(){this.options.interactive&&(i.removeEvent(this.indicator,"touchstart",this),i.removeEvent(this.indicator,"MSPointerDown",this),i.removeEvent(this.indicator,"mousedown",this),i.removeEvent(e,"touchmove",this),i.removeEvent(e,"MSPointerMove",this),i.removeEvent(e,"mousemove",this),i.removeEvent(e,"touchend",this),i.removeEvent(e,"MSPointerUp",this),i.removeEvent(e,"mouseup",this)),this.options.defaultScrollbars&&this.wrapper.parentNode.removeChild(this.wrapper)},_start:function(t){var n=t.touches?t.touches[0]:t;t.preventDefault(),t.stopPropagation(),this.transitionTime(),this.initiated=!0,this.moved=!1,this.lastPointX=n.pageX,this.lastPointY=n.pageY,this.startTime=i.getTime(),this.options.disableTouch||i.addEvent(e,"touchmove",this),this.options.disablePointer||i.addEvent(e,"MSPointerMove",this),this.options.disableMouse||i.addEvent(e,"mousemove",this),this.scroller._execEvent("beforeScrollStart")},_move:function(e){var t=e.touches?e.touches[0]:e,n,r,s,o,u=i.getTime();this.moved||this.scroller._execEvent("scrollStart"),this.moved=!0,n=t.pageX-this.lastPointX,this.lastPointX=t.pageX,r=t.pageY-this.lastPointY,this.lastPointY=t.pageY,s=this.x+n,o=this.y+r,this._pos(s,o),this.scroller.options.probeType==1&&u-this.startTime>300?(this.startTime=u,this.scroller._execEvent("scroll")):this.scroller.options.probeType>1&&this.scroller._execEvent("scroll"),e.preventDefault(),e.stopPropagation()},_end:function(t){if(!this.initiated)return;this.initiated=!1,t.preventDefault(),t.stopPropagation(),i.removeEvent(e,"touchmove",this),i.removeEvent(e,"MSPointerMove",this),i.removeEvent(e,"mousemove",this);if(this.scroller.options.snap){var r=this.scroller._nearestSnap(this.scroller.x,this.scroller.y),s=this.options.snapSpeed||n.max(n.max(n.min(n.abs(this.scroller.x-r.x),1e3),n.min(n.abs(this.scroller.y-r.y),1e3)),300);if(this.scroller.x!=r.x||this.scroller.y!=r.y)this.scroller.directionX=0,this.scroller.directionY=0,this.scroller.currentPage=r,this.scroller.scrollTo(r.x,r.y,s,this.scroller.options.bounceEasing)}this.moved&&this.scroller._execEvent("scrollEnd")},transitionTime:function(e){e=e||0,this.indicatorStyle[i.style.transitionDuration]=e+"ms",!e&&i.isBadAndroid&&(this.indicatorStyle[i.style.transitionDuration]="0.001s")},transitionTimingFunction:function(e){this.indicatorStyle[i.style.transitionTimingFunction]=e},refresh:function(){this.transitionTime(),this.options.listenX&&!this.options.listenY?this.indicatorStyle.display=this.scroller.hasHorizontalScroll?"block":"none":this.options.listenY&&!this.options.listenX?this.indicatorStyle.display=this.scroller.hasVerticalScroll?"block":"none":this.indicatorStyle.display=this.scroller.hasHorizontalScroll||this.scroller.hasVerticalScroll?"block":"none",this.scroller.hasHorizontalScroll&&this.scroller.hasVerticalScroll?(i.addClass(this.wrapper,"iScrollBothScrollbars"),i.removeClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="8px":this.wrapper.style.bottom="8px")):(i.removeClass(this.wrapper,"iScrollBothScrollbars"),i.addClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="2px":this.wrapper.style.bottom="2px"));var e=this.wrapper.offsetHeight;this.options.listenX&&(this.wrapperWidth=this.options.wrapperWidth||this.wrapper.clientWidth,this.options.resize?(this.indicatorWidth=n.max(n.round(this.wrapperWidth*this.wrapperWidth/(this.scroller.scrollerWidth||this.wrapperWidth||1)),8),this.indicatorStyle.width=this.indicatorWidth+"px"):this.indicatorWidth=this.indicator.clientWidth,this.maxPosX=this.wrapperWidth-this.indicatorWidth,this.options.shrink=="clip"?(this.minBoundaryX=-this.indicatorWidth+8,this.maxBoundaryX=this.wrapperWidth-8):(this.minBoundaryX=0,this.maxBoundaryX=this.maxPosX),this.sizeRatioX=this.options.speedRatioX||this.scroller.maxScrollX&&this.maxPosX/this.scroller.maxScrollX),this.options.listenY&&(this.wrapperHeight=this.options.wrapperHeight||this.wrapper.clientHeight,this.options.resize?(this.indicatorHeight=n.max(n.round(this.wrapperHeight*this.wrapperHeight/(this.scroller.scrollerHeight||this.wrapperHeight||1)),8),this.indicatorStyle.height=this.indicatorHeight+"px"):this.indicatorHeight=this.indicator.clientHeight,this.maxPosY=this.wrapperHeight-this.indicatorHeight,this.options.shrink=="clip"?(this.minBoundaryY=-this.indicatorHeight+8,this.maxBoundaryY=this.wrapperHeight-8):(this.minBoundaryY=0,this.maxBoundaryY=this.maxPosY),this.maxPosY=this.wrapperHeight-this.indicatorHeight,this.sizeRatioY=this.options.speedRatioY||this.scroller.maxScrollY&&this.maxPosY/this.scroller.maxScrollY),this.updatePosition()},updatePosition:function(){var e=this.options.listenX&&n.round(this.sizeRatioX*this.scroller.x)||0,t=this.options.listenY&&n.round(this.sizeRatioY*this.scroller.y)||0;this.options.ignoreBoundaries||(e<this.minBoundaryX?(this.options.shrink=="scale"&&(this.width=n.max(this.indicatorWidth+e,8),this.indicatorStyle.width=this.width+"px"),e=this.minBoundaryX):e>this.maxBoundaryX?this.options.shrink=="scale"?(this.width=n.max(this.indicatorWidth-(e-this.maxPosX),8),this.indicatorStyle.width=this.width+"px",e=this.maxPosX+this.indicatorWidth-this.width):e=this.maxBoundaryX:this.options.shrink=="scale"&&this.width!=this.indicatorWidth&&(this.width=this.indicatorWidth,this.indicatorStyle.width=this.width+"px"),t<this.minBoundaryY?(this.options.shrink=="scale"&&(this.height=n.max(this.indicatorHeight+t*3,8),this.indicatorStyle.height=this.height+"px"),t=this.minBoundaryY):t>this.maxBoundaryY?this.options.shrink=="scale"?(this.height=n.max(this.indicatorHeight-(t-this.maxPosY)*3,8),this.indicatorStyle.height=this.height+"px",t=this.maxPosY+this.indicatorHeight-this.height):t=this.maxBoundaryY:this.options.shrink=="scale"&&this.height!=this.indicatorHeight&&(this.height=this.indicatorHeight,this.indicatorStyle.height=this.height+"px")),this.x=e,this.y=t,this.scroller.options.useTransform?this.indicatorStyle[i.style.transform]="translate("+e+"px,"+t+"px)"+this.scroller.translateZ:(this.indicatorStyle.left=e+"px",this.indicatorStyle.top=t+"px")},_pos:function(e,t){e<0?e=0:e>this.maxPosX&&(e=this.maxPosX),t<0?t=0:t>this.maxPosY&&(t=this.maxPosY),e=this.options.listenX?n.round(e/this.sizeRatioX):this.scroller.x,t=this.options.listenY?n.round(t/this.sizeRatioY):this.scroller.y,this.scroller.scrollTo(e,t)},fade:function(e,t){if(t&&!this.visible)return;clearTimeout(this.fadeTimeout),this.fadeTimeout=null;var n=e?250:500,r=e?0:300;e=e?"1":"0",this.wrapperStyle[i.style.transitionDuration]=n+"ms",this.fadeTimeout=setTimeout(function(e){this.wrapperStyle.opacity=e,this.visible=+e}.bind(this,e),r)}},s.utils=i,typeof module!="undefined"&&module.exports?module.exports=s:e.IScroll=s})(window,document,Math),define("iScroll",function(){}),define("/Users/blues/projects/epub360/1-src/epub360-built/html/common/js/iscroll/iscroll-probe.js",function(){});(function(){var e=function(e){this.init(e)};e.prototype={init:function(e){var t={containment:".mask",contentel:".layer-content",mask_width:200,mask_height:100,content_width:1024,content_height:768,content_x:0,content_y:0,throw_enabled:!0,scrollX:!0,scrollY:!0,onScrollStart:null,onScrolling:null,onScrollEnd:null};return this.options=e?$.extend(!0,{},t,e):t,_.bindAll(this),this._initVaribles(),this._initScrollItems(),this.iScroll},_initVaribles:function(){this.dragged=!1,this.dragstart=!1,this.dragging=!1,this.sliding=!1},_initScrollItems:function(){var e=this;this.containment=this.mask=$(this.options.containment),this.content=$(this.options.contentel),this.containment.css({width:this.options.mask_width,height:this.options.mask_height,overflow:"hidden"}),this.content.css({width:this.options.content_width,height:this.options.content_height}),this.iScroll=new IScroll(this.containment[0],{mouseWheel:!0,probeType:3,click:!0,scrollX:this.options.scrollX,scrollY:this.options.scrollY,wrapperWidth:this.options.mask_width,wrapperHeight:this.options.mask_height,scrollerWidth:this.options.content_width,scrollerHeight:this.options.content_height}),this.iScroll.scrollTo(this.options.content_x,this.options.content_y),this.iScroll.on("scrollStart",function(){e.options.onScrollStart&&e.options.onScrollStart()}),this.iScroll.on("scroll",function(){var t=!1;console.log(this.y),e.dragstart&&(t=!0),e.options.onScrolling&&e.options.onScrolling({deltaX:this.x,deltaY:this.y,controller:t})}),this.iScroll.on("scrollEnd",function(){e.options.onScrollend&&e.options.onScrollend&&e.options.onScrollend({deltaX:this.x,deltaY:this.y})})},_checkX:function(e){return e-this.options.mask_width<-this.options.content_width&&(e=this.options.mask_width-this.options.content_width),e>0&&(e=0),e},_checkY:function(e){return e-this.options.mask_height<-this.options.content_height&&(e=this.options.mask_height-this.options.content_height),e>0&&(e=0),e},_getCurrentPosition:function(){var e={x:0,y:0};return e.x=this.iScroll.x,e.y=this.iScroll.y,e}},typeof require=="undefined"?(window._g||(window._g={}),window._g.scrollview=e):define("_g/scrollview",["_g/base","jquery.hammer","underscore","jquery.transit","iScroll"],function(){return window._g.scrollview=e,window._g.scrollview})})(window);var eT={RichText:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iText nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow:hidden;padding:0;margin:0;">',"<% if(iDetail.iStaticImage&&iDetail.iImg&&iDetail.iImg[0]){%>",'<img src="<%=iDetail.iImg[0].picture%>" style="width:100%;height:auto;"/>',"<% }else{%>","<%=iDetail.iText%>","<% } %>","</div>      ","</div>"].join(""),Paragraph:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iParagraph nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow:hidden;padding:0;margin:0;">',"<% if(iDetail.iStaticImage&&iDetail.iImg&&iDetail.iImg[0]){%>",'<img src="<%=iDetail.iImg[0].picture%>" style="width:100%;height:auto;"/>',"<% }else{%>",'<p style="width:100%;height:100%;<%=iDetail.iStyle%>" class="iText"><%=iDetail.iText%></p>',"<% } %>","</div>","</div>"].join(""),TextLabel:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iTextLabel nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow:hidden;">',"<% if(iDetail.iStaticImage&&iDetail.iImg&&iDetail.iImg[0]){%>",'<img src="<%=iDetail.iImg[0].picture%>" style="width:100%;height:auto;"/>',"<% }else{%>","<%=iDetail.iText%>","<% } %>","</div>      ","</div>"].join(""),Image:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iImage Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iMask?"overflow:hidden;":""%>">',"<%if(iDetail.iImg&&iDetail.iImg[0]){%>",'<%if(typeof isSubOverlay!="undefined"&&isSubOverlay&&(typeof isLayerOverlay=="undefined"||!isLayerOverlay)){%>',"<% if(iDetail.iMask){%>",'<img draggable="false" class="Context" style="width:<%=iDetail.iMask_data.width%>px;height:<%=iDetail.iMask_data.height%>px;position:absolute;max-width:none;" src="<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>">',"<%}else{%>",'<img draggable="false" class="Context" style="width:100%;height:100%;position:absolute;" src="<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>">',"<% } %>","<%}else{ %>","<% if(iDetail.iMask){%>",'<img draggable="false" class="Context" style="width:<%=iDetail.iMask_data.width%>px;height:<%=iDetail.iMask_data.height%>px;position:absolute;max-width:none;" src="<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>">',"<%}else{%>",'<img draggable="false" class="Context" style="width:100%;height:100%;position:absolute;" src="<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>">',"<% } %>","<%}%>","<%}%>","</div>","</div>"].join(""),ImageBlock:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iImageBlock Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow:hidden;<%=iDetail.iStyle%>">',"<%if(iDetail.iImg&&iDetail.iImg[0]){%>",'<%if(typeof isSubOverlay!="undefined"&&isSubOverlay&&(typeof isLayerOverlay=="undefined"||!isLayerOverlay)){%>',"<% if(iDetail.iMask){%>",'<img draggable="false" class="Context" style="width:<%=iDetail.iMask_data.width%>px;height:<%=iDetail.iMask_data.height%>px;position:absolute;max-width:none;" src="<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>">',"<%}else{%>",'<img draggable="false" class="Context" style="width:100%;height:100%;position:absolute;" src="<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>">',"<% } %>","<%}else{ %>","<% if(iDetail.iMask){%>",'<img draggable="false" class="Context" style="width:<%=iDetail.iMask_data.width%>px;height:<%=iDetail.iMask_data.height%>px;position:absolute;max-width:none;" src="<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>">',"<%}else{%>",'<img draggable="false" class="Context" style="width:100%;height:100%;position:absolute;" src="<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>">',"<% } %>","<%}%>","<%}%>","</div>","</div>"].join(""),Link:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iLink Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;"></div>',"</div>"].join(""),SearchInput:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iSearchInput Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<form class="search" style="position:relative; cursor:default;">','<input type="text" autofocus placeholder="输入关键字" class="input-medium search-query" style="cursor:default; width:<%=iCommon[iPageDirection].iWidth-14%>px; height:<%=iCommon[iPageDirection].iHeight-2%>px; line-height:<%=iCommon[iPageDirection].iHeight-2%>px; border-radius:8px; border-color:<%=iDetail.border_color%>; color:<%=iDetail.text_color%>; background-color:transparent;">','<button class="btn" type="submit" style="cursor:default; position:absolute; top:0; right:0; display:block; width:30px; height:<%=iCommon[iPageDirection].iHeight-2%>px; line-height:30px; background:none; border:none; margin:0 0 0 -30px; padding:0; text-shadow:none; color:#ccc;">','<i class="icon-search"></i>',"</button>","</form>        ","</div>","</div>"].join(""),Input:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iInput Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<input type="text" placeholder="<%=iDetail.placeholder%>" class="input-medium search-query" style="cursor:default; width:<%=iCommon[iPageDirection].iWidth%>px; height:<%=iCommon[iPageDirection].iHeight%>px; line-height:<%=iCommon[iPageDirection].iHeight%>px; ','border-radius:<%=iDetail.corner_radius||0%>px; border-color:<%=iDetail.border_color%>; border-style:<%=iDetail.border_style||"solid"%>;border-width:<%=_.isNumber(iDetail.border_width)?iDetail.border_width:"1"%>px;','color:<%=iDetail.text_color%>; background-color:<%=_g.getRGBA(iDetail.bg_color,iDetail.bg_opacity)||"#FFFFFF"%>;','font-size:<%=iDetail.font_size||"12"%>px;font-weight:<%=iDetail.font_weight||"normal"%>;font-family:<%=iDetail.font_family||"Hiragino Sans GB,Microsoft YaHei,SimHei,STHeiti"%>;padding:5px;margin:0;">          ',"</div>","</div>"].join(""),Textarea:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iTextarea Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<textarea placeholder="<%=iDetail.placeholder%>" style="cursor:default; width:<%=iCommon[iPageDirection].iWidth%>px; height:<%=iCommon[iPageDirection].iHeight%>px; ','border-radius:<%=iDetail.corner_radius||0%>px; border-color:<%=iDetail.border_color%>; border-style:<%=iDetail.border_style||"solid"%>;border-width:<%=_.isNumber(iDetail.border_width)?iDetail.border_width:"1"%>px;','color:<%=iDetail.text_color%>; background-color:<%=_g.getRGBA(iDetail.bg_color,iDetail.bg_opacity)||"#FFFFFF"%>;','font-size:<%=iDetail.font_size||"12"%>px;font-weight:<%=iDetail.font_weight||"normal"%>;font-family:<%=iDetail.font_family||"Hiragino Sans GB,Microsoft YaHei,SimHei,STHeiti"%>;padding:5px;margin:0;"></textarea>     ',"</div>","</div>"].join(""),SelectBox:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iSelectBox Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<input type="<%=iDetail.type%>" class="input-medium search-query" style="','vertical-align:"middle";font-size:<%=iDetail.font_size||"12"%>px;','padding:0px;margin:0;" id="<%=id+"box"%>"> <label for="<%=id+"box"%>" ><span style="display:inline;color:<%=iDetail.text_color%>; background-color:<%=_g.getRGBA(iDetail.bg_color,iDetail.bg_opacity)||"#FFFFFF"%>;','font-size:<%=iDetail.font_size||"12"%>px;font-weight:<%=iDetail.font_weight||"normal"%>;font-family:<%=iDetail.font_family||"Hiragino Sans GB,Microsoft YaHei,SimHei,STHeiti"%>;"><%=iDetail.label%></span></label>',"</div>","</div>"].join(""),Tree:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iTree Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">       ',"</div>","</div>"].join(""),Grid:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iGrid Element" style="overflow:hidden;position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">',"</div>","</div>"].join(""),Gallery:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iGallery Element nanoscrollbar" style="overflow:hidden;position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow:hidden;">',"</div>","</div>"].join(""),PageIndex:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iPageIndex Element nanoscrollbar" style="overflow:hidden;position:absolute;left: -<%=parseInt(iCommon[iPageDirection].iWidth/2,10)-0.5%>px; top: -<%=parseInt(iCommon[iPageDirection].iHeight/2,10)-0.5%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">',"</div>","</div>"].join(""),Cell:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iCell Element" style="overflow:hidden;position:absolute;left: -<%=parseInt(iCommon[iPageDirection].iWidth/2,10)+1%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth+1.5%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow:hidden;">',"</div>","</div>"].join(""),TabBar:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iTabBar Element" style="overflow:hidden;position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow:hidden;">',"</div>","</div>"].join(""),WebContent:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="i<%=iType%> nanoscrollbar Element iMouseWheel disableMouseWheelY disableMouseWheelX disableDragX disableDragY" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;-webkit-overflow-scrolling:touch;overflow:auto;">','<iframe style="position:absolute;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;min-height:<%=iCommon[iPageDirection].iHeight%>px;height:100%;border:none;overflow:visible;"></iframe>',"</div>      ","</div>"].join(""),Slide:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iSlide Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="slidecontent" style="position:absolute;width:100%;height:100%;line-height:<%=iCommon[iPageDirection].iHeight%>px;">',"<%if(iDetail.iImg){%>","<%_.each(iDetail.iImg,function(i,index){%>",'<%if(_g.getUrlParameterByName("-playmode")=="1"){%>','<img data-index="<%=index%>" id="<%=preload_id[index]%>" class="Context" style="width:100%;height:100%;position:absolute;margin:auto;display:inline;verticle-align:middle;">',"<%}else{ %>",'<img data-index="<%=index%>" id="<%=preload_id[index]%>" class="Context" style="width:100%;height:100%;position:absolute;margin:auto;display:inline;verticle-align:middle;">',"<%}%>               ","<%})%>","<%}%>","</div>","</div>","</div>"].join(""),CycleImage:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iCycleImage Element" style="overflow:hidden;position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="slidecontent" style="position:absolute;width:100%;height:100%;line-height:<%=iCommon[iPageDirection].iHeight%>px;">',"</div>","</div>","</div>"].join(""),Video:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iVideo Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">',"</div>","</div>"].join(""),Audio:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iAudio Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">',"</div>","</div>"].join(""),Button:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iButton Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">',"<%if(iDetail.iconNormal&&iDetail.iconNormal[0]){%>",'<img class="Context iconNormal" id="<%=preload_id[0]%>" style="width:100%;height:100%;position:absolute;">',"<%}%>","<%if(iDetail.iconActive&&iDetail.iconActive[0]){%>",'<img class="Context iconActive" id="<%=preload_id[1]%>" style="width:100%;height:100%;position:absolute;display:none;">',"<%}%>","</div>","</div>"].join(""),Map:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iMap nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<iframe style="width: 100%; height: 100%;" src="<%=iDetail.iText + "&view=view"%>" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe>',"</div>","</div>"].join(""),LayerRef:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iLayerRef Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="layer-mask" style="position:absolute;width:100%;height:100%;overflow:hidden;">',"<%if(iDetail.layer_ids&&iDetail.layer_ids.length>0){%>",'<div class="layer-content" style="position:absolute;width:100%;height:100%;">',"<% _.each(iDetail.layer_ids,function(layerid){ %>","<% if(interaction_view.ilayerlist.get(layerid)){ %>",'<div class="layer-item" data-index="<%=iDetail.layer_ids.indexOf(layerid)%>" data-id="<%=layerid%>" style="position:absolute;opacity:0;width:<%=interaction_view.ilayerlist.get(layerid).toJSON().layer_width%>px;height:<%=interaction_view.ilayerlist.get(layerid).toJSON().layer_height%>px;left:0px;right:0px;">','<div href="" class="layer-bg" style="position:absolute;width:100%;height:100%;text-align:center;line-height:<%=interaction_view.ilayerlist.get(layerid).toJSON().layer_height%>px;background-color:<%=interaction_view.ilayerlist.get(layerid).toJSON().bg_color%>;opacity:<%=interaction_view.ilayerlist.get(layerid).toJSON().bg_opacity%>">','<% if(interaction_view.ilayerlist.get(layerid).get("picture")){ %>','<img src="<%=interaction_view.ilayerlist.get(layerid).get("picture")%>" style="<%=(interaction_view.ilayerlist.get(layerid).toJSON().layer_width>=interaction_view.ilayerlist.get(layerid).toJSON().layer_height)?"width:auto;height:100%;":"width:100%;height:auto;"%>margin:auto">',"<% } %>","</div>                         ","</div>","<% } %>","<% }) %>             ","</div>","<% } %>","</div>  ","</div>    ","</div>"].join(""),ComponentRef:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iLayerRef Element" style="position:absolute;left: 0px; top: 0px;background-color:transparent;width:100%;height:100%;">',"<%if(iDetail.layer_ids&&iDetail.layer_ids.length>0){%>",'<div class="layer-content" style="position:absolute;width:100%;height:100%;">',"<% _.each(iDetail.layer_ids,function(layerid){ %>","<% if(interaction_view.iComponentlist.get(layerid)){ %>","<% var _layer=interaction_view.iComponentlist.get(layerid).toJSON(); %>",'<div class="layer-item" data-index="<%=iDetail.layer_ids.indexOf(layerid)%>" data-id="<%=layerid%>" style="position:absolute;opacity:0;width:100%;height:100%;left:0px;right:0px;">',"</div>","<% } %>","<% }) %>","</div>","<% } %>","</div>","</div>"].join(""),Shape:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<% if (_g.device.svg()){%><div class="iShape nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">',"<%=iDetail.iSvg%>","</div><% }else{ %>",'<div class="iImage Element" style="position:absolute;left: <%=-iCommon[iPageDirection].iWidth/2%>px; top: <%=-iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<img draggable="false" class="Context" style="width:100%;height:100%;position:absolute;" src="<%=iDetail.iImg[0].picture%>">  ',"</div><% } %>","</div>"].join(""),DragDrop:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iDragDrop Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">',"<%if(iDetail.iconNormal&&iDetail.iconNormal[0]){%>",'<img class="Context iconNormal" id="<%=preload_id[0]%>" style="width:100%;height:100%;position:absolute;">',"<%}%>","<%if(iDetail.iconActive&&iDetail.iconActive[0]){%>",'<img class="Context iconActive" id="<%=preload_id[1]%>" style="width:100%;height:100%;position:absolute;display:none;">',"<%}%>","</div>","</div>"].join(""),Variable:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iVariable nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">',"<%=iDetail.initial%>","</div>","</div>"].join(""),Timer:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iTimer nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">',"<%=iDetail.formatTime%>","</div>","</div>"].join(""),InfoList:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iInfoList Element" style="overflow:hidden;position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="info-content iMouseWheel disableMouseWheelY disableDragY" style="min-width:100%;">','<div style="margin-top: -38px;height: 38px;color:#999;">','<div style="text-align: center; font-size: 12px;height:19px;">E<% if (typeof epub360!="undefined"&&epub360.settings&& ["USER_FREE","USER_BASIC"].indexOf(epub360.settings.billing_type) >=0 ){ %>Epub360技术支持<% } %></div>','<div class="pullDown" style="text-align: center;font-size: 12px;">下拉刷新</div>',"</div>",'<div class="lists"></div>','<div class="pullUp" style="display:none;text-align: center;font-size: 12px; color:#999;">上拉加载更多</div>',"</div>","</div>","</div>"].join(""),ChartList:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iChartList Element" style="overflow:hidden;position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="info-content iMouseWheel disableMouseWheelY disableDragY" style="min-width:100%;">','<div style="margin-top: -38px;height: 38px;color:#999;">','<div style="text-align: center; font-size: 12px;height:19px;"><% if (typeof epub360!="undefined"&&epub360.settings&& ["USER_FREE","USER_BASIC"].indexOf(epub360.settings.billing_type) >=0 ){ %>Epub360技术支持<% } %></div>','<div class="pullDown" style="text-align: center;font-size: 12px;">下拉刷新</div>',"</div>",'<div class="lists"></div>',"</div>","</div>","</div>"].join(""),UserSVG:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iUserSVG Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">',"<%=iDetail.iSvg%>","</div>","</div>"].join(""),FormView:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="i<%=iType%> nanoscrollbar Element iMouseWheel disableMouseWheelY disableMouseWheelX disableDragX disableDragY" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;-webkit-overflow-scrolling:touch;overflow:auto;">',"<% if(interaction_view.getWebContentSrc(iDetail)&&interaction_view.getWebContentSrc(iDetail).src){%>",'<iframe src="<%=interaction_view.getWebContentSrc(iDetail).src||""%>" style="position:absolute;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;min-height:<%=iCommon[iPageDirection].iHeight%>px;height:100%;border:none;overflow:visible;"></iframe>',"<% } %>","<% if(interaction_view.getWebContentSrc(iDetail)&&interaction_view.getWebContentSrc(iDetail).content){%>",'<iframe style="position:absolute;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;min-height:<%=iCommon[iPageDirection].iHeight%>px;height:100%;border:none;overflow:visible;"></iframe>',"<% } %>                           ","</div>      ","</div>"].join("")};eT.TextButton=eT.Paragraph,eT.BookButton=eT.TextLabel,eT.Vote=eT.SelectButton=eT.SubmitButton=eT.WeixinCamera=eT.WeixinVoice=eT.Button,eT.LayerSlide=eT.LayerRef,eT.others=['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">',"</div>"].join(""),define("interaction_view/template/t",function(){}),define("/Users/blues/projects/epub360/1-src/epub360-built/html/common/js/interaction_view/template/t.js",function(){});var _gsScope=typeof module!="undefined"&&module.exports&&typeof global!="undefined"?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";function e(e,t,n,r){return n=parseFloat(n)-parseFloat(e),r=parseFloat(r)-parseFloat(t),Math.sqrt(n*n+r*r)}function t(e){if(typeof e=="string"||!e.nodeType)e=_gsScope.TweenLite.selector(e),e.length&&(e=e[0]);return e}function n(e,t,n){var r=e.indexOf(" "),i,s;return r===-1?(i=n!==undefined?n+"":e,s=e):(i=e.substr(0,r),s=e.substr(r+1)),i=i.indexOf("%")!==-1?parseFloat(i)/100*t:parseFloat(i),s=s.indexOf("%")!==-1?parseFloat(s)/100*t:parseFloat(s),i>s?[s,i]:[i,s]}function r(n){if(!n)return 0;n=t(n);var r=n.tagName.toLowerCase(),i,s,o,u,a,f,l,c;if(r==="path")i=n.getTotalLength()||0;else if(r==="rect")s=n.getBBox(),i=(s.width+s.height)*2;else if(r==="circle")i=Math.PI*2*parseFloat(n.getAttribute("r"));else if(r==="line")i=e(n.getAttribute("x1"),n.getAttribute("y1"),n.getAttribute("x2"),n.getAttribute("y2"));else if(r==="polyline"||r==="polygon"){o=n.getAttribute("points").split(" "),i=0,a=o[0].split(","),r==="polygon"&&(o.push(o[0]),o[0].indexOf(",")===-1&&o.push(o[1]));for(f=1;f<o.length;f++)u=o[f].split(","),u.length===1&&(u[1]=o[f++]),u.length===2&&(i+=e(a[0],a[1],u[0],u[1])||0,a=u)}else r==="ellipse"&&(l=parseFloat(n.getAttribute("rx")),c=parseFloat(n.getAttribute("ry")),i=Math.PI*(3*(l+c)-Math.sqrt((3*l+c)*(l+3*c))));return i||0}function o(e,n){if(!e)return[0,0];e=t(e),n=n||r(e)+1;var s=i(e),o=s.strokeDasharray||"",u=parseFloat(s.strokeDashoffset);return o=o.indexOf(" ")===-1?n:parseFloat(o.split(" ")[0])||1e-5,o>n&&(o=n),[Math.max(0,-u),o-u]}var i=document.defaultView?document.defaultView.getComputedStyle:function(){},s;s=_gsScope._gsDefine.plugin({propName:"drawSVG",API:2,version:"0.0.4",global:!0,overwriteProps:["drawSVG"],init:function(e,t,i){if(!e.getBBox)return!1;var s=r(e)+1,u,a,f;return this._style=e.style,t===!0||t==="true"?t="0 100%":t?(t+"").indexOf(" ")===-1&&(t="0 "+t):t="0 0",u=o(e,s),a=n(t,s,u[0]),this._length=s+10,u[0]===0&&a[0]===0?(f=Math.max(1e-5,a[1]-s),this._dash=s+f,this._offset=s-u[1]+f,this._addTween(this,"_offset",this._offset,s-a[1]+f,"drawSVG")):(this._dash=u[1]-u[0]||1e-6,this._offset=-u[0],this._addTween(this,"_dash",this._dash,a[1]-a[0]||1e-5,"drawSVG"),this._addTween(this,"_offset",this._offset,-a[0],"drawSVG")),!0},set:function(e){this._firstPT&&(this._super.setRatio.call(this,e),this._style.strokeDashoffset=this._offset,this._style.strokeDasharray=this._dash+" "+this._length)}}),s.getLength=r,s.getPosition=o}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),define("greensock/plugins/DrawSVGPlugin",function(){}),define("/Users/blues/projects/epub360/1-src/epub360-built/html/thirdparty/GreenSock-JS-1.13.2/src/uncompressed/plugins/DrawSVGPlugin.js",function(){});define("interaction_view/model/base",["jquery","backbone","greensock/TweenMax","text!interaction_view/template/staticitem_view.js","text!interaction_view/template/message.js","text!interaction_view/template/slidenumber.js","text!interaction_view/template/imgpreview.js","interaction_view/view/subcontainer","_g/scrollview","interaction_view/template/t","greensock/plugins/DrawSVGPlugin"],function(){var e=require("text!interaction_view/template/staticitem_view.js"),t=require("text!interaction_view/template/message.js"),n=require("text!interaction_view/template/slidenumber.js"),r=require("text!interaction_view/template/imgpreview.js"),s={};_.each(eT,function(e,t){s[t]=_.template(e)}),window.interaction_view={model:{Base:Backbone.Model.extend({defaults:{iType:"iBasetype",iCommon:null,iDetail:null,iPage:null,iParentModel:null,template:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,callback:null},options:{createwait:!0},initialize:function(){this.options=this.get("iOptions");if(!this.id){this.beforecreate();var e=this;this.set("id",this.get("iType")+"_"+this.cid),this.setcollection(),this.setmodel()}else this.setcollection(),this.setmodel()},beforecreate:function(){},savemodel:function(e){},setmodel:function(){this.page=interaction_view.ipagelist.getPage(this.get("pageid"))||interaction_view.imasterlist.get(this.get("pageid"))||interaction_view.ibackgroundlist.get(this.get("pageid")),this.setlist(),this.setview(),this.setsyncmodel()},createPath:function(){var e=interaction_view.createPath({path:this.get("path"),isSubOverlay:this.get("isSubOverlay"),page_id:this.get("pageid"),model:this});return e},setSubOverlays:function(){var e=this;e.suboverlays=this.getSubOverlays(),e.iOverlaylist=new interaction_view.collection.list,e.iAnimationlist=new interaction_view.collection.Animation,e.iActionlist=new interaction_view.collection.Action,e.ipreloadlist=new interaction_view.collection.Preload,e.subcontainer=e.ipreloadlist.subcontainer=e.iOverlaylist.subcontainer=e.iAnimationlist.subcontainer=e.iActionlist.subcontainer=!0,e.ipreloadlist.path=e.iOverlaylist.path=e.iAnimationlist.path=e.iActionlist.path=this.createPath(),e.ipreloadlist.pagetype=e.iOverlaylist.pagetype=e.iAnimationlist.pagetype=e.iActionlist.pagetype="sub"},getSubOverlays:function(){return this.get("suboverlays")},setlist:function(){},setresourcesmodel:function(){},validate:function(e){},setsyncmodel:function(){},setcollection:function(){},setview:function(){},url:function(){},sync:function(e,t,n){}})},collection:{Base:Backbone.Collection.extend({iSync:!1,initialize:function(){this.setonadd(),this.setonremove()},setonadd:function(){},setonremove:function(){},url:"",sync:function(e,t,n){},parse:function(e){},resetViewStatus:function(){this.each(function(e){e.iview.resetStatus()})}}),list:Backbone.Collection.extend({iSync:!0,url:"",setonadd:function(){this.on("add",function(e){})},setonremove:function(){},sync:function(e,t,n){e=="read"&&(n.url=context_url+"/overlayinit.json"),Backbone.emulateHTTP=!0,Backbone.emulateJSON=!0,Backbone.sync(e,t,n)},parse:function(e){},resetViewStatus:function(){this.each(function(e){e.iview.resetStatus()})},resetBindings:function(){this.each(function(e){e.get("iType")=="Binding"&&e.iview.resetBindingStatus()})}})},view:{Base:Backbone.View.extend({initialize:function(e){_.bindAll(this),this.initstart()},initstart:function(){this.preload(),this.renderDynamicElement(),this.render()},events:{},options:{},change:function(e){},bindImageSwitch:function(e,t){$("body > #imagepreview").find("button.preview-left").on("click",function(){return e.iview.preview_left(t),!1}),$("body > #imagepreview").find("button.preview-right").on("click",function(){return e.iview.preview_right(t),!1});if(interaction_view.ismobile){var n=this;$("body > #imagepreview").hammer().on("dragleft",function(e){return n.dragimage="left",e.gesture.preventDefault(),!1}),$("body > #imagepreview").hammer().on("dragright",function(e){return n.dragimage="right",e.gesture.preventDefault(),!1}),$("body > #imagepreview").hammer().on("dragend",function(r){return n.dragimage=="right"&&e.iview.preview_left(t),n.dragimage=="left"&&e.iview.preview_right(t),n.dragimage=null,r.gesture.preventDefault(),!1})}},initPage:function(){var e=this.model.get("pageid");this.model.iPageId=e,this.model.set("isMasterOverlay",!1),this.model.set("isBackgroundOverlay",!1),this.pagetype=this.model.get("pagetype"),this.iType=this.model.get("iType");if(this.pagetype=="LayerRef"){var t=this.model.get("parentpageid"),n=this.model.get("layerid"),r=interaction_view.getParentpage(t);this.model.page=r.iOverlaylist.get(e).layer[n];var i=r.iOverlaylist.get(e);this.container=i.iview.$el.find(".layer-content").children(".layer-item[data-id="+n+"]"),this.model.iPageId=t}else if(this.pagetype=="master")interaction_view.touchview?this.container=$(".reveal"):this.container=$('.Presentation[id="'+interaction_view.currentPage+'"]').find(".interaction-view"),this.model.set("isMasterOverlay",!0),this.model.isMasterOverlay=!0;else if(this.pagetype=="background")interaction_view.touchview?this.container=$(".reveal"):this.container=$('.Presentation[id="'+interaction_view.currentPage+'"]').find(".interaction-view"),this.model.set("isBackgroundOverlay",!0),this.model.isBackgroundOverlay=!0;else if(this.model.get("isSubOverlay")){this.path=this.model.get("path");var s=interaction_view.getContainerModelByPath(this.path);this.container=s.iview.$el.children(".Element"),this.model.page=interaction_view.getContainerModelByPath(this.path)}else e?this.container=$('.Presentation[id="'+this.model.get("pageid")+'"]').find(".interaction-view"):this.container=$(".interaction-view")},renderStaticElement:function(){},renderDynamicElement:function(){this.initPage();var t=this.iType,n=this.model.toJSON();this.detail=n.iDetail,this.zIndex=n.zIndex,this.iSlideNumber=n.iSlideNumber,this.isStatic=n.isStatic;if(this.model.get("isStatic"))var r=_.template(e,n);else var r=s[t]?s[t](this.model.toJSON()):s.others(n);this.container.append(r),this.setElement(this.container.find('div.iView[id="'+this.model.id+'"]').first());var i=this.common=this.getcommon();this.x=i.iStartx+i.iWidth/2,this.y=i.iStarty+i.iHeight/2,this.staticX=i.iStartx,this.staticY=i.iStarty,this.originWidth=i.iWidth,this.originHeight=i.iHeight,this.setSizeAdapt(),this.setScreenAdapt(),this.isStatic||TweenMax.set(this.$el[0],{x:this.x,y:this.y}),this.pagetype=="master"&&this.$el.addClass("master masterhide"),this.pagetype=="background"&&this.$el.addClass("background"),(t=="CycleImage"||t=="Slide"||t=="Button")&&this.setRatiofixxed(),this.iSlideNumber&&this.renderSlideNumber()},setSizeAdapt:function(){if(typeof Reveal=="undefined"||!Reveal.adapt)return!1;var e=this.detail;if(!e.iSizeAdapt||!_.isObject(e.iSizeAdapt_data)||!_.keys(e.iSizeAdapt_data).length)return;var t=!1,n=null;e.iScreenAdapt&&(t=!0),e.iSizeAdapt&&(e.iScreenAdapt=!0,this.model.set("iDetail",e,{silent:!0}));if(t)switch(e.iScreenAdapt_data){case 1:e.iSizeAdapt_data.left=!0,e.iSizeAdapt_data.top=!0;break;case 2:e.iSizeAdapt_data.top=!0;break;case 3:e.iSizeAdapt_data.top=!0,e.iSizeAdapt_data.right=!0;break;case 4:e.iSizeAdapt_data.left=!0;break;case 5:break;case 6:e.iSizeAdapt_data.right=!0;break;case 7:e.iSizeAdapt_data.left=!0,e.iSizeAdapt_data.bottom=!0;break;case 8:e.iSizeAdapt_data.bottom=!0;break;case 9:e.iSizeAdapt_data.bottom=!0,e.iSizeAdapt_data.right=!0}e.iSizeAdapt_data.left&&e.iSizeAdapt_data.right&&e.iSizeAdapt_data.top&&e.iSizeAdapt_data.bottom?n=12:e.iSizeAdapt_data.top&&e.iSizeAdapt_data.bottom&&e.iSizeAdapt_data.left?n=15:e.iSizeAdapt_data.top&&e.iSizeAdapt_data.bottom&&e.iSizeAdapt_data.right?n=16:e.iSizeAdapt_data.bottom&&e.iSizeAdapt_data.right&&e.iSizeAdapt_data.left?n=13:e.iSizeAdapt_data.top&&e.iSizeAdapt_data.right&&e.iSizeAdapt_data.left?n=14:e.iSizeAdapt_data.left&&e.iSizeAdapt_data.right?n=10:e.iSizeAdapt_data.top&&e.iSizeAdapt_data.bottom?n=11:(e.iSizeAdapt_data.top&&(n=17),e.iSizeAdapt_data.left&&(n=20),e.iSizeAdapt_data.right&&(n=18),e.iSizeAdapt_data.bottom&&(n=19)),n&&(e.iScreenAdapt_data=n,this.model.set("iDetail",e,{silent:!0}))},setScreenAdapt:function(){if(typeof Reveal=="undefined"||!Reveal.adapt)return!1;var e=this.detail;if(!this.model.isMasterOverlay&&!this.model.isBackgroundOverlay&&!e.iScreenAdapt)return!1;if(!this.model.isMasterOverlay||!this.model.isBackgroundOverlay)this.$el.addClass("fixed"),this.model.get("isStatic")||this.$el.css({left:0,top:0});if(e.iScreenAdapt){var t=e.iScreenAdapt_data;t!=1&&interaction_view.adapt.elements.push({model:this.model,view:this,type:interaction_view.getPageType2(this.model),adapt:t}),interaction_view.adapt.adjustElement({model:this.model,view:this,type:interaction_view.getPageType2(this.model),adapt:t})}else t=e.iScreenAdapt?e.iScreenAdapt_data:null,interaction_view.adapt.elements.push({model:this.model,view:this,type:interaction_view.getPageType2(this.model),adapt:t}),interaction_view.adapt.adjustElement({model:this.model,view:this,type:interaction_view.getPageType2(this.model),adapt:t});interaction_view.adapt.excute({view:this,adapt:t,type:interaction_view.getPageType2(this.model),model:this.model})},renderSlideNumber:function(){if(!this.model.get("iSlideNumber"))return;var e=this.getdetail(),t=this;this.$el.parent().find('nav.slidenumber[data-id="'+this.model.id+'"]').remove();if(this.getSlideLength()>1){var r=this.model.toJSON();r.slidelength=this.getSlideLength(),this.$el.parent().append(_.template(n,r)),this.setSlideNumberPosition()}},renderBackGroud:function(){var e=this.getdetail(),t=e.bg_color,n=e.bg_opacity!=undefined?Number(e.bg_opacity):1;if(!t)t="transparent";else{var r=_g.number.hexToRgb(t);t="rgba("+r.r+","+r.g+","+r.b+","+n+")"}this.$el.children(".Element").css({background:t})},setSlideNumberPosition:function(){this.$el.parent().find('nav.slidenumber[data-id="'+this.model.id+'"]').each(function(){$(this).css({left:parseInt($(this).css("left"),10)-$(this).actual("outerWidth",{includeMargin:!0})/2,top:parseInt($(this).css("top"),10)-$(this).actual("outerHeight",{includeMargin:!0})/2})})},setSlideNumberDisplay:function(){this.getSlideLength()>1&&(this.$el.children(".Element").is(":hidden")?this.$el.parent().find('nav.slidenumber[data-id="'+this.model.id+'"]').hide():this.$el.parent().find('nav.slidenumber[data-id="'+this.model.id+'"]').show())},setFullView:function(e){var t=this;$("body").children("#imagepreview").remove(),$("body").append('<div id="imagepreview" style="z-index:10000;width:100%;height:100%;position:absolute;left:0;top:0;background:#000;"><button type="button" class="close" style="display:block;position: absolute; top: 10px; right: 10px; z-index: 9999; width: 32px; height: 32px; line-height: 32px; margin: 0; padding: 0; font-size: 32px; color: #ddd; box-shadow: 0; text-shadow: 0 1px 0 white; text-align: center; filter: alpha(opacity=100); -khtml-opacity: 1; opacity: 1;">×</button><img src="'+e.picture+'"</div>'),t.isFullSwitch()&&($("body > #imagepreview").append(r),t.bindImageSwitch(e.model,e.index)),_g.ui.fitImage({fit:1,items:"#imagepreview > img",width:e.width,height:e.height}),$("#imagepreview").on("click",function(){$(this).remove()}).css("line-height","initial"),$("#imagepreview button.close").on("click",function(){$(this).remove()})},fullviewIndex:function(e){var t=this,n=this.getdetail();if(typeof wx_permissions!="undefined"&&wx_permissions.previewImage)wx.previewImage({current:n.iImg[e].picture,urls:_.map(n.iImg,function(e){return e.picture})});else{var r={picture:n.iImg[e].picture,width:n.iImg[e].width,height:n.iImg[e].height,model:t.model,index:e};t.setFullView(r)}},preload:function(){},afterpreload:function(){this.setZindex(),this.setElementDisplay(),this.model.get("iSlideNumber")&&this.setSlideNumberDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".Element").attr("style"),this.preloaded=!0},setSlideImageDisplay:function(){var e=this,t=this.getdetail();this.imageDisplay=t.iDisplay;if(!t.iImg||t.iImg.length==0)return;if(!this.imageDisplay)return!1;var n=this.getcommon();_.each(t.iImg,function(r){var i=_g.ui.fitImage({items:e.$el.find(".slidecontent").children()[t.iImg.indexOf(r)],parentWidth:n.iWidth,parentHeight:n.iHeight,width:r.width,height:r.height,fit:e.imageDisplay,useMargin:!0})})},setRatiofixxed:function(){var e=this,t=this.getdetail();if(!t.ratiofixxed||!t.iImg||t.iImg.length==0)return;var n=this.getcommon();_.each(t.iImg,function(r){var i=_g.ui.centerImage({containment:e.$el.find(".slidecontent"),Item:e.$el.find(".slidecontent").children()[t.iImg.indexOf(r)],parentWidth:n.iWidth,parentHeight:n.iHeight,width:r.width,height:r.height,setParent:!1});i.width<n.iWidth&&(e.$el.find(".slidecontent").children("[data-index="+t.iImg.indexOf(r)+"]").css("margin-left",(n.iWidth-i.width)/2+"px"),e.$el.find(".slidecontent").children("[data-index="+t.iImg.indexOf(r)+"]").css("margin-right",(n.iWidth-i.width)/2+"px")),i.height<n.iHeight&&(e.$el.find(".slidecontent").children("[data-index="+t.iImg.indexOf(r)+"]").css("margin-top",(n.iHeight-i.height)/2+"px"),e.$el.find(".slidecontent").children("[data-index="+t.iImg.indexOf(r)+"]").css("margin-bottom",(n.iHeight-i.height)/2+"px"))})},setElementDisplay:function(){this.$el.children(".Element").length>0&&TweenMax.set(this.$el.children(".Element")[0],{scale:1});var e=this.model.toJSON().iDetail,t=e.iHidden||!1;if(!_.isNaN(Number(e.init_opacity))){var n=Number(e.init_opacity);n<=1&&n>=0&&TweenMax.set(this.$el[0],{opacity:Number(e.init_opacity)})}if(!_.isNaN(Number(e.init_rotation))){var r=Number(e.init_rotation);r<=360&&r>=-360&&TweenMax.set(this.$el.children(".Element")[0],{rotation:Number(e.init_rotation)})}var i=this.model.page.iAnimationlist.where({overlay_id:this.model.id}),s=!1;if(i&&i[0]&&_.include([101,102,103,104,601,701],i[0].toJSON().iType)||s){var o=i&&i[0]&&_.include([101,102,103,104,601,701],i[0].toJSON().iType)?i[0]:s[0],u=-9999,a=-9999;o._animation&&o._animation.css&&(u=o._animation.css.x,a=o._animation.css.y);if(o.toJSON().iType==101){t&&this.$el.addClass("hide");var f=this.getcommon().iWidth,l=this.getcommon().iHeight;_g.browserSupport({msie:9})?TweenMax.set(this.$el[0],{x:u,y:a}):$(this.$el[0]).css("margin",u+"px 0px 0px "+a+"px").removeClass("hide").show()}o.toJSON().iType==102&&_g.browserSupport({msie:9})&&(t&&this.$el.addClass("hide"),TweenMax.set(this.$el.children(".Element")[0],{scale:0})),o.toJSON().iType==103&&(t&&this.$el.addClass("hide"),TweenMax.set(this.$el[0],{opacity:0})),o.toJSON().iType==104&&(this.$el.addClass("hide"),_g.browserSupport({msie:9})&&t&&this.$el.addClass("hide")),o.toJSON().iType==601&&(this.$el.addClass("hide"),_g.browserSupport({msie:9})&&t&&this.$el.addClass("hide")),i[0].toJSON().iType==701&&(t&&this.$el.addClass("hide"),TweenMax.set(this.$el.find("svg").find("rect, circle, ellipse, polyline, path, line, polygon"),{drawSVG:"0%",force3D:interaction_view.force3D}))}else t?this.$el.addClass("hide"):this.model.get("iType")!="Video"&&this.$el.removeClass("hide");this.Clone=this.$el.clone()},setOtherDisplay:function(){},setZindex:function(){if(this.iType=="Binding"||this.iType=="DragDropGroup")return!1;if(this.iType=="Audio"&&!this.detail.iControl)return!1;var e=this.zIndex;this.pagetype=="master"?e+=2e3:this.pagetype!="background"&&(e+=1e3),this.$el&&this.$el.css("z-index",e),this.iSlideNumber&&this.$el.parent().children('nav.slidenumber[data-id="'+this.model.id+'"]').css("z-index",e)},setMaskSlipable:function(e){var t=this,n=this.getMoveRange();n.x&&e.containment.addClass("iMouseWheel disableMouseWheelX disableDragX"),n.y&&e.containment.addClass("iMouseWheel disableMouseWheelY disableDragY");if(!n.x&&!n.y)return;var r=0,i=0,s,o;this.scrollview=new _g.scrollview({containment:e.containment,contentel:e.contentel,mask_width:this.$el.children(".Element").width(),mask_height:this.$el.children(".Element").height(),content_width:this.getLayerContentSize().width,content_height:this.getLayerContentSize().height,content_x:e.content_x,content_y:e.content_y,scrollX:n.x>0?!0:!1,scrollY:n.y>0?!0:!1,onScrollStart:function(){r=t.scrollview._getCurrentPosition().x,i=t.scrollview._getCurrentPosition().y},onScrolling:function(s){if(n.x>0){s.controller?t.scrollstart=!0:t.scrollstart=!1;var o=s.deltaX-r;(Math.abs(s.deltaX)>n.x+30||s.deltaX>30)&&e.containment.addClass("is_exceededX");var u=Math.abs(s.deltaX)/n.x;t.onBindingChangeTo({type:0,delta:o,deltarate:u,cdirection:0})}if(n.y>0){var a=s.deltaY-i;(Math.abs(s.deltaY)>n.y+30||s.deltaY>30)&&e.containment.addClass("is_exceededY");var u=Math.abs(s.deltaY)/n.y;t.onBindingChangeTo({type:0,delta:a,deltarate:u,cdirection:1})}},onScrollEnd:function(){t.scrollstart=!1,e.containment.removeClass("is_exceededY"),e.containment.removeClass("is_exceededX")}}),this.getdetail().iGravity&&_g.orientation.orientationEvents.push({scrollX:n.x>0?!0:!1,scrollY:n.y>0?!0:!1,speed:n.y?n.y/1200:n.x/1200,func:function(e,r){if(interaction_view.currentPage==t.model.iPageId||t.model.get("pagetype")=="background"){if(t.scrollstart)return;e&&(t.scrollview.iScroll.x+e>0&&(e=-t.scrollview.iScroll.x),t.scrollview.iScroll.x+e<-n.x&&(e=-t.scrollview.iScroll.x-n.x)),r&&(t.scrollview.iScroll.y+r>0&&(r=-t.scrollview.iScroll.y),t.scrollview.iScroll.y+r<-n.y&&(r=-t.scrollview.iScroll.y-n.y));if(n.x>0){var i=e,s=Math.abs(t.scrollview.iScroll.x+e)/n.x;t.onBindingChangeTo({type:0,delta:e,deltarate:s,cdirection:0})}if(n.y>0){var o=r,s=Math.abs(t.scrollview.iScroll.y+r)/n.y;t.onBindingChangeTo({type:0,delta:r,deltarate:s,cdirection:1})}t.scrollview.iScroll.scrollBy(e,r)}}}),this.$el.addClass("hascontrols")},getMoveRange:function(){var e=this.getLayerContentSize(),t=e.width,n=e.height,r=this.getcommon();return{x:t-r.iWidth,y:n-r.iHeight}},checkMaskPos:function(e,t){var n=this.getdetail(),r=!0,i=this.getLayerContentSize(),s=i.width,o=i.height;return e.left>0&&(e.left=0,r=!1),e.top>0&&(e.top=0,r=!1),Math.abs(e.left)+t.width>s&&(e.left=-(s-t.width),r=!1),Math.abs(e.top)+t.height>o&&(e.top=-(o-t.height),r=!1),r?null:{left:e.left,top:e.top}},render:function(){},renderCentrolPos:function(e){document.getElementById(this.model.id).style.left=e.x-100+"px",document.getElementById(this.model.id).style.top=e.x-100+"px"},destroy:function(e,t){},updateposition:function(){var e=this.getcommon();e&&(this.$el.css("left",e.iStartx+"px"),this.$el.css("top",e.iStarty+"px"),this.$el.width(e.iWidth),this.$el.height(e.iHeight))},updateel:function(){this.model.get("iTemplate")&&this.$el.html(this.model.get("iTemplate")(this.model.toJSON()))},getAnimations:function(){var e=this.model.page.iAnimationlist.where({overlay_id:this.model.id});return e.length?e:null},getcommon:function(){var e=null;return e=this.model.get("iCommon")[iPageDirection],e},getdetail:function(){return this.model.get("iDetail")},resetStatus:function(){this.$el.attr("style",this.copyelstyle),this.$el.children(".Element").attr("style",this.copyelementstyle),this.setElementDisplay(),this.model.get("iSlideNumber")&&this.setSlideNumberDisplay(),this.resetOtherStatus&&this.resetOtherStatus()},sendToPreload:function(e){var t=$.extend({},{parentpageid:this.model.get("parentpageid"),overlay_id:this.model.id,elementtype:this.model.get("iType"),pageid:this.model.get("pageid"),pagetype:this.model.get("pagetype"),layerid:this.model.get("layerid")},e),n=new interaction_view.model.Preload(t);return this.preloadmodel=n,n},playTimeline:function(){if(this.autoplay){if(this.timeline){if(this.$el.children(".Element").is(":hidden"))return;!this.repeat&&this.timeline.time()==this.timeline.duration()?this.timeline.play(0,!1):this.timeline.play(null,!1)}}else{this.autoplay=!0;if(this.useIndex)this._setCanvasLoopSwitch(),this.timeline.play();else{this.timeline&&this.timeline.kill(),this.timeline=new TimelineMax({paused:!0,repeat:this.repeat,onComplete:this.setRewind}),this.setTimeline(),this.setSlideDisplayAll();if(this.$el.children(".Element").is(":hidden"))return;this.timeline&&this.timeline.play(null,!1)}}},pauseTimeline:function(){this.timeline&&this.timeline.pause()},stopTimeline:function(){this.autoplay=!1,this.useIndex?(this.timeline.pause(),this.currentIndex=this._start,this.ctx.clearRect(0,0,this.canvas_width,this.canvas_height),this.drawCanvas(this.img_src[this._start],this._start)):(this.timeline.kill(),this.timeline=new TimelineMax({paused:!0,repeat:this.repeat}),this.setTimeline(),this.timeline.pause(1e-5),this.setSlideElementsDisplay&&this.setSlideElementsDisplay())},setRewind:function(){if(!this.timeline)return!1;var e=this,t=this.getdetail(),n=this.delay,r=function(){setTimeout(function(){e.useIndex?(e.timeline.pause(),e.currentIndex=e._start,e.drawCanvas(e.img_src[e.currentIndex],e.currentIndex)):(e.timeline.pause(1e-5),e.currentIndex=0)},n*1e3)},i=t.iRepeat?-1:0,s=t.iRewind;this.model.onAnimationStart&&(interaction_view.events.onAnimationEnd(this.model.onAnimationStart),this.model.onAnimationStart=null);if(!!i||!s)return null;r()},_setCanvasLoopSwitch:function(e){var t=this,n=this.delay,r=this.getdetail(),i=0,s=0;this.autoplay||(n=2);var o=this._start;return this.currentIndex>this._start&&this.currentIndex<this._end&&(o=this.currentIndex),e&&this.timeline&&(this.timeline.kill(),this.timeline=null),this.timeline=interaction_view.createLoop({delay:n,paused:!0,repeat:this.repeat,onComplete:this.setRewind,duration:this.repeat?this.slidelength*n:(this.slidelength+1)*n,callback:function(){var e=r.iImg[o].picture;t.drawCanvas(e,o),t.onTimelineUpdate(o),t.onChangeSlideTo(o);if(o==t._end&&!t.repeat){t.timeline.pause(),t.setRewind();return}o=t.direction?o-1>=t._end?o-1:t._start:o+1<=t._end?o+1:t._start},time:function(){}}),o},setNone:function(){var e=this,t=0,n=this.delay;this.autoplay||(n=.5);for(i=0;i<this.slidelength;i++){if(i==this.slidelength-1&&!this.repeat)return;var r=this.slideel.children('[data-index="'+i+'"]');this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:1}}),t),this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:0},onUpdateParams:[i+1<this.slidelength?i+1:0],onUpdate:this.onTimelineUpdate}),t+1e-5+n);var s=this.slideel.children('[data-index="'+(i+1<this.slidelength?i+1:0)+'"]');this.timeline.add(TweenMax.to(s,1e-5,{css:{opacity:0}}),t),this.timeline.add(TweenMax.to(s,1e-5,{css:{opacity:1},onCompleteParams:[i+1<this.slidelength?i+1:0],onComplete:e.onChangeSlideTo}),t+1e-5+n),i==this.slidelength-1&&this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:0}}),t+1e-5+n),t+=n+2e-5}},setFade:function(){var e=this,t=0,n=this.delay,r,s;this.autoplay||(n=0);for(i=0;i<this.slidelength;i++){i==0&&(r=this.slideel.children('[data-index="'+i+'"]'),this.timeline.add(TweenMax.to(r,0,{css:{opacity:1},onCompleteParams:[0],onComplete:e.onChangeSlideTo}),t),t+=n);if(i==this.slidelength-1){if(!this.repeat)break;r=this.slideel.children('[data-index="'+i+'"]'),this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:1}}),t),this.timeline.add(TweenMax.fromTo(r,.5,{opacity:1},{opacity:0,onUpdateParams:[i+1<this.slidelength?i+1:0],onUpdate:this.onTimelineUpdate,ease:"Linear.easeNone",immediateRender:!1}),t+1e-5),this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:0}}),t+.50001),s=this.slideel.children('[data-index="'+(i+1<this.slidelength?i+1:0)+'"]'),this.timeline.add(TweenMax.to(s,1e-5,{css:{opacity:1}}),t),this.timeline.add(TweenMax.fromTo(s,.5,{opacity:1},{opacity:1,ease:"Linear.easeNone",immediateRender:!1}),t+1e-5),this.timeline.add(TweenMax.to(s,1e-5,{css:{opacity:1},onCompleteParams:[i+1<this.slidelength?i+1:0],onComplete:e.onChangeSlideTo}),t+.50001),t+=n+.50002}else r=this.slideel.children('[data-index="'+i+'"]'),this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:1}}),t),this.timeline.add(TweenMax.fromTo(r,.5,{opacity:1},{opacity:1,onUpdateParams:[i+1<this.slidelength?i+1:0],onUpdate:this.onTimelineUpdate,ease:"Linear.easeNone",immediateRender:!1}),t+1e-5),this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:0}}),t+.50001),s=this.slideel.children('[data-index="'+(i+1<this.slidelength?i+1:0)+'"]'),this.timeline.add(TweenMax.to(s,1e-5,{css:{opacity:0}}),t),this.timeline.add(TweenMax.fromTo(s,.5,{opacity:0},{opacity:1,ease:"Linear.easeNone",immediateRender:!1}),t+1e-5),this.timeline.add(TweenMax.to(s,1e-5,{css:{opacity:1},onCompleteParams:[i+1<this.slidelength?i+1:0],onComplete:e.onChangeSlideTo}),t+.50001),t+=n+.50002}},setSlip:function(){var e=this,t=0,n=this.delay,r,s;this.autoplay||(n=0);for(i=0;i<this.slidelength;i++){if(i==this.slidelength-1&&!this.repeat)break;var o=this.getParamsForSlide(i).param,u=this.getParamsForSlide(i+1<this.slidelength?i+1:0).param1;o.onUpdateParams=[i+1<this.slidelength?i+1:0],o.onUpdate=this.onTimelineUpdate,o.immediateRender=!1,u.immediateRender=!1;var a=_g.number.decimal(t,5);i==0&&(r=this.slideel.children('[data-index="'+i+'"]'),this.timeline.add(TweenMax.to(r,0,{css:{opacity:1},immediateRender:!1,onCompleteParams:[0],onComplete:e.onChangeSlideTo}),a),t+=n);var a=_g.number.decimal(t,5),f=_g.number.decimal(t+1e-5,5),l=_g.number.decimal(t+.50001,5);r=this.slideel.children('[data-index="'+i+'"]'),this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:1}}),a),this.timeline.add(TweenMax.fromTo(r,.5,{css:{left:"0%",top:"0%",ease:"Linear.easeNone"},immediateRender:!1},_.clone(o)),f),this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:0}}),l),s=this.slideel.children('[data-index="'+(i+1<this.slidelength?i+1:0)+'"]'),this.timeline.add(TweenMax.to(s,1e-5,{css:{opacity:1}}),a),this.timeline.add(TweenMax.fromTo(s,.5,_.clone(u),{top:"0%",left:"0%",ease:"Linear.easeNone",immediateRender:!1}),f),this.timeline.add(TweenMax.to(s,1e-5,{css:{opacity:1},onCompleteParams:[i+1<this.slidelength?i+1:0,i],onComplete:e.onChangeSlideTo}),l),i==this.slidelength-1&&this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:0}}),l),t+=n+.50002}},setFlip:function(){var e=this,t=0,n=this.delay,r,s,o,u=this.getdetail(),a=u.iSlidetype?u.iSlidetype:0,f=180;a=="横向"||Number(a)==0?(a=0,o={rotationY:0},TweenLite.set(this.slideel,{rotationY:0})):(a=1,o={rotationX:0},TweenLite.set(this.slideel,{rotationX:0})),this.autoplay||(n=0),TweenLite.set(this.$el.children(".Element"),{perspective:800}),TweenLite.set(this.slideel,{transformStyle:"preserve-3d"}),TweenLite.set(this.slideel.children(),{backfaceVisibility:"hidden"});for(i=0;i<this.slidelength;i++){if(i==this.slidelength-1&&!this.repeat)break;o.onUpdateParams=[i+1<this.slidelength?i+1:0],o.onUpdate=this.onTimelineUpdate,a?o.rotationX="+=180cw":o.rotationY="-=180cw",i==0&&(r=this.slideel.children('[data-index="'+i+'"]'),a?this.timeline.add(TweenMax.to(r,0,{rotationX:f==180?0:180,opacity:1,onCompleteParams:[0],onComplete:e.onChangeSlideTo}),t):this.timeline.add(TweenMax.to(r,0,{rotationY:f==180?0:180,opacity:1,onCompleteParams:[0],onComplete:e.onChangeSlideTo}),t),t+=n);var l=_g.number.decimal(t,5),c=_g.number.decimal(t+1e-5,5),h=_g.number.decimal(t+.50001,5);r=this.slideel.children('[data-index="'+i+'"]'),s=this.slideel.children('[data-index="'+(i+1<this.slidelength?i+1:0)+'"]'),a?this.timeline.add(TweenMax.to(r,1e-5,{rotationX:f==180?0:180,opacity:1}),l):this.timeline.add(TweenMax.to(r,1e-5,{rotationY:f==180?0:180,opacity:1}),l),this.timeline.add(TweenMax.to(this.slideel,.5,_.clone(o)),c),this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:0}}),h),a?this.timeline.add(TweenMax.to(s,1e-5,{css:{rotationX:f,opacity:1}}),l):this.timeline.add(TweenMax.to(s,1e-5,{css:{rotationY:f,opacity:1}}),l),this.timeline.add(TweenMax.to(s,1e-5,{onCompleteParams:[i+1<this.slidelength?i+1:0],onComplete:e.onChangeSlideTo}),h),i==this.slidelength-1&&this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:0}}),h),t+=n+.50002,f=f==180?0:180}},setFlow:function(){function r(t){e.setElementTo(t),!e.getdetail().iRepeat&&e.getdetail().iRewind&&t>=e.slidelength-1&&TweenMax.to(e.slideel.find('[data-index="'+t+'"]'),.3,{opacity:1,onComplete:function(){e.CoverFlow.coverflow("select",0)}})}var e=this,t=0,n=this.delay;this.autoplay||(n=0);for(i=0;i<this.slidelength;i++){if(i==this.slidelength-1&&!this.repeat)break;i==0&&(t+=n);var s=this.slideel.find('[data-index="'+i+'"]');this.timeline.add(TweenMax.to(s,.3,{opacity:1,onUpdateParams:[i+1<e.slidelength?i+1:0],onUpdate:r}),t),t+=n+.3}},onBindingChangeTo:function(e){interaction_view.events.onBingChangeTo({type:e.type,page_id:this.model.page.id?this.model.page.id:this.model.get("layerid"),id:this.model.id,delta:e.delta,deltarate:e.deltarate,cdirection:e.cdirection})},onTimelineUpdate:function(e){var t=this.timeline.time();interaction_view.events.onBingChangeTo({type:0,page_id:this.model.page.id?this.model.page.id:this.model.get("layerid"),id:this.model.id,delta:-1,deltarate:t/this.timeline.duration(),cdirection:null})},onChangeSlideTo:function(e,t){this.currentIndex=e,this.model.trigger("slideTo",e),this.model.get("iSlideNumber")&&this.changeSlideNumber()},changeSlideNumber:function(){var e=this.$el.parent().children('nav.slidenumber[data-id="'+this.model.id+'"]').children(":nth-child("+(this.currentIndex+1)+")");e.each(function(){$(this).addClass("active").siblings().removeClass("active")})},onExecuteBinding:function(e){if(this.model.get("iType")=="LayerRef"){this.onExecuteBindingForLayerRef(e);return}var t=this;if(this.slideel&&this.slidelength>1&&this.timeline){var n=this.timeline.duration();this.repeat?singletime=n/this.slidelength:singletime=n/(this.slidelength-1);if(e.type==0){t.useIndex||t.setSlideDisplayAll(),i=e.deltarate*n;var r=parseInt(i/singletime,10);t.slideChangePatch(e.delta,r),t.onChangeSlideTo(r),t.useIndex?(t.indexTime=i,t.drawCanvas(t.img_src[r],r),t.autoplay&&(t.autoplay=!1,t.timeline.pause(i))):t.timeline.seek(i)}else{if(t.useIndex)var i=t.indexTime;else var i=t.timeline.time();console.log("stop at delta"+e.delta),t.model.get("iType")!="CycleImage"&&(i/singletime-parseInt(i/singletime,10)<.2?(i=parseInt(i/singletime,10)*singletime,r=parseInt(i/singletime,10)):i/singletime-parseInt(i/singletime,10)>.8?(i=(parseInt(i/singletime,10)+1)*singletime,r=parseInt(i/singletime,10)):(i=parseInt(i/singletime,10)*singletime,r=parseInt(i/singletime,10),e.delta<0&&i<n&&(i+=singletime,r=parseInt(i/singletime,10)))),console.log(i);if(i==0||i==1e-5)i=1e-5,e.reset&&e.revert&&(t.repeat?i=1e-5:i=t.timeline.duration(),r=parseInt(i/singletime,10));r>t.slidelength-1&&(r=0),t.useIndex?(t.indexTime=i,r!=undefined&&t.drawCanvas(t.img_src[r],r)):t.timeline.seek(i),t.useIndex||t.setSlideDisplay(r),t.onChangeSlideTo(r)}}},setSlideDisplay:function(e,t){this.autoplay||(this.slideel.children('[data-index="'+e+'"]').css({display:"block",opacity:1}),t&&this.slideel.children('[data-index="'+e+'"]').css("opacity",1),this.model.get("iType")=="LayerSlide"&&(this.onShow(e),this.onBeforeHide(e)),this.slideel.children('[data-index="'+e+'"]').siblings().hide(),t&&this.slideel.children('[data-index="'+e+'"]').siblings().css("opacity",0),this.model.get("iType")=="LayerSlide"&&this.onHide(e))},setSlideDisplayAll:function(){this.slideel.children().css("display","block")},setElementTo:function(e){var t=this,n=this.getdetail();if(n.iFade=="Flow"){var r=t.CoverFlow.children(".ui-state-active").index(),i=n.iImg.length-1;e=="prev"?e=r<=0?i:r-1:e=="next"?e=r>=i?0:r+1:e=="first"?e=0:e=="last"&&(e=i),e<0&&(e=0),e>i&&(e=i),t.CoverFlow.coverflow("select",e);return}if(!_.include(["first","last","prev","next"],e)){if(Number(e)==NaN||this.currentIndex==Number(e))return;e=Number(e)}var s=n.iRepeat,o=!1,u=null,a;if(!this.slidelength||e>=this.slidelength)return;var f=_g.number.decimal(this.timeline.duration(),5);s?a=_g.number.decimal(f/this.slidelength,5):a=_g.number.decimal(f/(this.slidelength-1),5);if(e=="first")u=1e-5;else if(e=="last")u=(this.slidelength-1)*a;else if(e=="prev"){o=!0;var l=!0;if(!s&&this.currentIndex==0)return!1;var c=this.currentIndex==0?this.slidelength-1:this.currentIndex-1;u=c*a,u==1e-5&&(u=0)}else if(e=="next"){o=!0;var h=!0;if(!s&&this.currentIndex==this.slidelength-1)return!1;var c=this.currentIndex==this.slidelength-1?0:this.currentIndex+1;u=c*a,u==1e-5&&(u=0)}else{if(!(Number(e)>=0&&Number(e)<this.slidelength))return!1;u=a*parseInt(e,10)+1e-5}console.log(u),u==0&&(u=1e-5),e=parseInt(u/a,10),e>this.slidelength-1&&(e=0);if(this.iFade!="None"&&this.iFade!="LoopSwitch"&&o){t.setSlideDisplayAll();if(h)var p=u==1e-5?f:u;if(l){var d=_g.number.decimal(t.timeline.time(),5);(d==0||d==1e-5)&&t.timeline.seek(f);var p=u}this.timeline.tweenTo(p,{onComplete:function(){h&&u==1e-5&&t.timeline.seek(1e-5),console.log("stop at "+t.timeline.time()),t.setSlideDisplay(e),t.onChangeSlideTo(e),t.onBindingChangeTo({type:1,delta:0})}})}else{t.useIndex?(t.indexTime=u,t.drawCanvas(t.img_src[e],e),t.autoplay&&(t.autoplay=!1,t.timeline.pause(u))):t.timeline.seek(u,!1);var v=Math.abs(this.timeline.time()/this.timeline.duration());t.useIndex||this.setSlideDisplay(e),this.onChangeSlideTo(e),this.onBindingChangeTo({type:1,delta:0})}},slideChangePatch:function(e,t){var n=this;if(e>0)for(i=n.currentIndex;i>t;i--)i<0&&(i=n.slidelength-1),i!=n.currentIndex&&n.onChangeSlideTo(i);if(e<0)for(i=n.currentIndex;i<t;i++)i>n.slidelength-1&&(i=0),i!=n.currentIndex&&n.onChangeSlideTo(i)},addControlClass:function(){var e=this.getdetail(),t=e.iSlidetype?e.iSlidetype:0;this.$el.children(".Element").addClass("iMouseWheel"),t=="横向"||Number(t)==0?this.$el.children(".Element").addClass("enableMouseWheelX disableDragX"):this.$el.children(".Element").addClass("enableMouseWheelY disableDragY")},removeControlClass:function(){this.$el.children(".Element").removeClass("iMouseWheel").removeClass("enableMouseWheelX disableDragX").removeClass("enableMouseWheelY disableDragY")},control:function(){if(this.controled){this.canSlip?this.addControlClass():this.removeControlClass();return}var e=_g.touch.support,t="touchstart",n="touchmove",r="touchend";eCancel="touchcancel";var i=this,s=this.getdetail(),o=0,u=0,a;this.indexTime=0;var f=0,l=0,c=0,h,p=0,d=!1,v=!1,m=null,g=null,y=null,b=this.$el.children(".Element").width(),w=s.iSlidetype?s.iSlidetype:0,E=this.timeline.duration(),S=w=="横向"||Number(w)==0?0:1;this.repeat?a=this.singletime=E/this.slidelength:a=this.singletime=E/(this.slidelength-1);var x=this.repeat,T=function(e){if(i.model.get("iType")=="Slide"&&!i.canSlip)return;h=0,p=0,i.autoplay&&(i.indexTime=i.timeline.time()),i.useIndex?o=i.indexTime:o=i.timeline.time(),d=!0,y=i.slideel.children(":visible").first().index(),console.log("control start")},N=function(e,t,n){if(i.model.get("iType")=="Slide"&&!i.canSlip)return;i.useIndex||i.setSlideDisplayAll(),e>E&&(x?e-=E:(p+=1,p>5&&i.model.get("iSlideNumber")&&(S==0?i.$el.children(".Element").addClass("is_exceededX"):i.$el.children(".Element").addClass("is_exceededY")),e=E)),e<0&&(x?e=E+e:(p+=1,console.log(E-e),p>5&&i.model.get("iSlideNumber")&&(S==0?i.$el.children(".Element").addClass("is_exceededX"):i.$el.children(".Element").addClass("is_exceededY")),e=1e-5));var r=e/E;i.onBindingChangeTo({type:0,delta:t,deltarate:r,cdirection:S});if(i.model.get("iType")=="CycleImage"){var s=parseInt(e/a);s>i.slidelength-1&&(s=0);if(s==i.currentIndex)return e;n||i.slideChangePatch(t,s),i.onChangeSlideTo(s)}return console.log(e),i.useIndex?(i.indexTime=e,i.drawCanvas(i.img_src[s],s),i.autoplay&&(i.autoplay=!1,i.timeline.pause(o))):i.timeline.seek(e),e},C=function(e){if(i.model.get("iType")=="Slide"&&!i.canSlip)return;if(i.model.get("iType")=="CycleImage")return;var t;i.useIndex?o=i.indexTime:o=i.timeline.time(),i.model.get("iType")!="CycleImage"?(o==1e-5&&(o=0),o/a-parseInt(o/a,10)<.2?(o=parseInt(o/a,10)*a,t=parseInt(o/a,10)):o/a-parseInt(o/a,10)>.8?(o=(parseInt(o/a,10)+1)*a,t=parseInt(o/a,10)):(o=parseInt(o/a,10)*a,t=parseInt(o/a,10),e<0&&o<E&&(o+=a,t+=1)),o=Math.round(o/a)*a+1e-5):t=parseInt(o/a,10),console.log("final time is"+o),o==0&&(o=1e-5),t>i.slidelength-1&&(t=0),i.useIndex?(i.drawCanvas(i.img_src[t],t),i.onChangeSlideTo(t),i.onBindingChangeTo({type:1,delta:e})):i.timeline.tweenTo(o,{onComplete:function(){i.useIndex||i.setSlideDisplay(t),i.onChangeSlideTo(t),i.onBindingChangeTo({type:1,delta:e})}})};if(_g.touch.support){var k,L,A;this.$el.children(".Element").on(t,function(e){e=e.originalEvent.touches[0];if(!i.testControl(e.target))return!1;if($(this).hasClass("is_exceededX")||$(this).hasClass("is_exceededY"))return;m=f=e.pageX,g=l=e.pageY,k=e.pageX,L=e.pageY,A=!0;var t=e.target;u=0,T(),setTimeout(function(){k===f&&!A&&L===l&&$(t).trigger("click")},200)}),this.$el.children(".Element").on(n,function(e){e=e.originalEvent.touches[0];if($(this).hasClass("is_exceededX")||$(this).hasClass("is_exceededY")){d=!1;return}if(d&&m!=null){h=w=="横向"||Number(w)==0?e.pageX-m:e.pageY-g,c=w=="横向"||Number(w)==0?e.pageX-f:e.pageY-l,moveOppositeDirection=w=="横向"||Number(w)==0?e.pageY-l:e.pageX-f,console.log("direction"+c),console.log("oppsite"+moveOppositeDirection);if(Math.abs(c)<=2&&Math.abs(moveOppositeDirection)>12){var t=w=="横向"||Number(w)==0?"is_exceededX":"is_exceededY";$(this).addClass(t);return}f=e.pageX,l=e.pageY;if(h==0)return;return i.model.get("iType")=="CycleImage"?u=o-h/b*E:u=o-h/b*a,N(u,c),!1}}),this.$el.children(".Element").on(r,function(e){e=e.originalEvent.touches[0],A=!1;if(d)return h!=0?(C(h),$(Reveal.options.containment).hammer("reset")):(i.setSlideDisplay(y),interaction_view.ismobile&&i.$el.children(".Element").trigger("click")),d=!1,console.log("control stop"),$(Reveal.options.containment).hammer().trigger("dragend"),!1;$(this).removeClass("is_exceededX"),$(this).removeClass("is_exceededY"),p=0}),this.$el.children(".Element").on(eCancel,function(e){e=e.originalEvent.touches[0];if(d)return h!=0?(C(h),$(Reveal.options.containment).hammer("reset")):i.setSlideDisplay(y),d=!1,console.log("control cancel"),!1;$(this).removeClass("is_exceededX"),$(this).removeClass("is_exceededY"),p=0})}this.$el.children(".Element").on("mousedown",function(e){if(!i.testControl(e.target))return!1;if($(this).hasClass("is_exceededX")||$(this).hasClass("is_exceededY"))return;u=0,m=f=e.pageX,g=l=e.pageY,T()}),this.$el.children(".Element").on("mousemove",function(e){if($(this).hasClass("is_exceededX")||$(this).hasClass("is_exceededY")){d=!1;return}if(d&&m!=null){h=w=="横向"||Number(w)==0?e.pageX-m:e.pageY-g,c=w=="横向"||Number(w)==0?e.pageX-f:e.pageY-l,f=e.pageX,l=e.pageY;if(h==0)return;return i.model.get("iType")=="CycleImage"?u=o-h/b*E:u=o-h/b*a,N(u,c),e.preventDefault(),!1}}),this.$el.children(".Element").on("mouseup",function(e){if(d)return h!=0?(C(h),e.preventDefault(),e.stopPropagation(),$(Reveal.options.containment).hammer("reset")):(i.setSlideDisplay(y),$(e.currentTarget).trigger("click")),d=!1,console.log("control stop"),!1;$(this).removeClass("is_exceededX"),$(this).removeClass("is_exceededY"),p=0}),this.$el.children(".Element").on("mouseleave",function(e){if(d)return h!=0?(C(h),e.preventDefault(),$(Reveal.options.containment).hammer("reset")):i.setSlideDisplay(y),d=!1,console.log("control cancel"),!1;$(this).removeClass("is_exceededX"),$(this).removeClass("is_exceededY"),p=0}),this.$el.children(".Element").on("wheelstart",function(e,t){if(!$(e.target).is(this))return;u=0,m=f=0,g=l=0,h=0,i.useIndex?o=i.indexTime:o=i.timeline.time(),y=i.slideel.children(":visible").first().index(),v=!0,console.log("control start")}),this.$el.children(".Element").on("wheelmove",function(e,t){if(!$(e.target).is(this))return;if(!v)return!1;var n=_g.mousewheel.getMouseWheel(t),r=n.x,s=n.y;if(r==undefined&&s==undefined)return;var p=Math.max(-1,Math.min(1,r)),d=Math.max(-1,Math.min(1,s)),m=30;console.log("before currentX is "+f),f+=p*m,l+=d*m,console.log("after currentX is "+f),console.log("wheelX is"+p),h=w=="横向"||Number(w)==0?p:d,console.log("control moving");var g=1;if(h){c=w=="横向"||Number(w)==0?p:d;var y=w=="横向"||Number(w)==0?f:l;if(y){i.model.get("iType")=="CycleImage"&&(g=i.slidelength>50?i.slidelength/50:1);var b=w=="横向"||Number(w)==0?g*$(this).width():g*$(this).height();y>b&&(y=b),y<-b&&(y=-b),w=="横向"||Number(w)==0?f=y:l=y,i.model.get("iType")=="CycleImage"?u=o-y/b*E:u=o-y/$(this).width()*a,N(u,c)}}}),this.$el.children(".Element").on("wheelend",function(e,t){if(!v)return!1;var n=w=="横向"||Number(w)==0?f:l;C(n),console.log("control end"),f=l=0,v=!1});if(i.model.get("iType")=="CycleImage"&&s.iGravity){var O=i.slidelength>50?i.slidelength/50:1;_g.orientation.orientationEvents.push({scrollX:w=="横向"||Number(w)==0,scrollY:w!="横向"&&Number(w)!=0,page_id:i.model.iPageId,speed:1,func:function(e,t,n,r){if(interaction_view.currentPage==i.model.iPageId){var s=i.$el.children(".Element"),a=w=="横向"||Number(w)==0?e:t;if(!a)return;a=parseInt(a),deltaend=-a;var f=w=="横向"||Number(w)==0?O*s.width():O*s.height();u=o-deltaend/f*E,console.log(u),i.indexTime=o=N(u,a,!0)}}})}this.controled=!0},getParamsForFade:function(e){param.opacity=1,param1.opacity=0},getParamsForSlide:function(e){var t=this.getdetail(),n=t.iSlidetype?t.iSlidetype:0,r=this.slideel.children('[data-index="'+e+'"]');_.include(["Slide","Gallery","CycleImage"],this.model.get("iType"))&&(r=this.slideel);var i={ease:"Linear.easeNone"},s={ease:"Linear.easeNone"};return n=="横向"||Number(n)==0?(i.opacity=1,i.left="-100%",s.left="100%",s.opacity=1):(i.opacity=1,i.top="-"+r.css("height"),s.top=r.css("height"),s.opacity=1),{param:i,param1:s}},getParamsForSlip:function(e){return param},getSlideDuration:function(){var e=this.getdetail(),t;return this.slidelength==0?0:(this.model.get("iType")!="CycleImage"?t=(this.delay+.50002)*this.slidelength:t=(this.delay+2e-5)*this.slidelength,t)},onShow:function(){this.model.get("iSlideNumber")&&this.setSlideNumberDisplay(),_.include(["Slide","LayerSlide"],this.model.get("iType"))&&this.autoplay&&this.playTimeline(),_.include(["PageIndex","Gallery","Grid"],this.model.get("iType"))&&this.resetOtherStatus(),this.otherOnShow&&this.otherOnShow()},onBeforeHide:function(){_.include(["Slide","LayerSlide"],this.model.get("iType"))&&this.timeline&&(this.timeline.paused()||this.timeline.pause())},onHide:function(){this.model.get("iSlideNumber")&&this.setSlideNumberDisplay()},loadSubOverlay:function(e){var t=require("interaction_view/view/subcontainer");t=_g.mvc.createView(t),this.subview=new t({model:this.model}),this.preloadmodel=e,this.subview.afterload()},clearPreload:function(){this.$el.children(".Element").length&&this.$el.children(".Element").find("img").each(function(){$(this).attr("src","")})}})}},window.iOverlaylist=new interaction_view.collection.Base,interaction_view.iOverlaylist=new interaction_view.collection.list,interaction_view.currentPage=null});var _gsScope=typeof module!="undefined"&&module.exports&&typeof global!="undefined"?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";var e=function(t){var n=t.nodeType,r="";if(n===1||n===9||n===11){if(typeof t.textContent=="string")return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)r+=e(t)}else if(n===3||n===4)return t.nodeValue;return r},t=_gsScope._gsDefine.plugin({propName:"text",API:2,version:"0.5.1",init:function(t,n,r){var i,s;if("innerHTML"in t){this._target=t,typeof n!="object"&&(n={value:n});if(n.value===undefined)return this._text=this._original=[""],!0;this._delimiter=n.delimiter||"",this._original=e(t).replace(/\s+/g," ").split(this._delimiter),this._text=n.value.replace(/\s+/g," ").split(this._delimiter),this._runBackwards=r.vars.runBackwards===!0,this._runBackwards&&(i=this._original,this._original=this._text,this._text=i),typeof n.newClass=="string"&&(this._newClass=n.newClass,this._hasClass=!0),typeof n.oldClass=="string"&&(this._oldClass=n.oldClass,this._hasClass=!0),i=this._original.length-this._text.length,s=i<0?this._original:this._text,this._fillChar=n.fillChar||(n.padSpace?"&nbsp;":""),i<0&&(i=-i);while(--i>-1)s.push(this._fillChar);return!0}return!1},set:function(e){e>1?e=1:e<0&&(e=0),this._runBackwards&&(e=1-e);var t=this._text.length,n=e*t+.5|0,r,i,s;this._hasClass?(r=this._newClass&&n!==0,i=this._oldClass&&n!==t,s=(r?"<span class='"+this._newClass+"'>":"")+this._text.slice(0,n).join(this._delimiter)+(r?"</span>":"")+(i?"<span class='"+this._oldClass+"'>":"")+this._delimiter+this._original.slice(n).join(this._delimiter)+(i?"</span>":"")):s=this._text.slice(0,n).join(this._delimiter)+this._delimiter+this._original.slice(n).join(this._delimiter),this._target.innerHTML=this._fillChar==="&nbsp;"&&s.indexOf("  ")!==-1?s.split("  ").join("&nbsp;&nbsp;"):s}}),n=t.prototype;n._newClass=n._oldClass=n._delimiter=""}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),define("greensock/plugins/TextPlugin",function(){}),define("/Users/blues/projects/epub360/1-src/epub360-built/html/thirdparty/GreenSock-JS-1.13.2/src/uncompressed/plugins/TextPlugin.js",function(){});define("interaction_view/ui/animation",["jquery","backbone","greensock/plugins/TextPlugin"],function(){window.animation=function(e){this.defaults={countTime:0,currentFrame:0,path:null,raster:null,animation:null},this.options=e,this.options=$.extend(!0,{},this.defaults,typeof e=="object"&&e),this.page=this.options.collection.page,this.options.old_animation=$.extend(!0,{},this.options.animation),this.init()},window.animation.prototype={init:function(){_.bindAll(this),this.handleVars(),this.options.animation.iKind==0&&this.setparam(),this.options.animation.iKind==1&&this.setgroupparam()},refresh:function(){this.options.animation=$.extend(!0,{},this.options.old_animation),this.init()},handleVars:function(){var e=this.options.animation,t=interaction_view.getVarsOp(this.page.id,[0,2]);_.each(this.options.animation.iTiming,function(n,r){typeof n!="object"&&(e.iTiming[r]=Number(t.var2val(n)))}),_.each(this.options.animation.iDetail,function(n,r){var i=String(n);!!i.length&&i[i.length-1]!="%"&&typeof n!="object"&&(e.iDetail[r]=Number(t.var2val(n)))})},cssTovalue:function(e){var t=e;return t=Number(e.split("px")[0]),t},EaseTypes:{0:"Linear.easeNone",1:"Power0.easeIn",2:"Power0.easeInOut",3:"Power0.easeOut",4:"Power1.easeIn",5:"Power1.easeInOut",6:"Power1.easeOut",7:"Power2.easeIn",8:"Power2.easeInOut",9:"Power2.easeOut",10:"Power3.easeIn",11:"Power3.easeInOut",12:"Power3.easeOut",13:"Power4.easeIn",14:"Power4.easeInOut",15:"Power4.easeOut",16:"Quad.easeIn",17:"Quad.easeInOut",18:"Quad.easeOut",19:"Cubic.easeIn",20:"Cubic.easeInOut",21:"Cubic.easeOut",22:"Quart.easeIn",23:"Quart.easeInOut",24:"Quart.easeOut",25:"Quint.easeIn",26:"Quint.easeInOut",27:"Quint.easeOut",28:"Strong.easeIn",29:"Strong.easeInOut",30:"Strong.easeOut",31:"Back.easeIn",32:"Back.easeInOut",33:"Back.easeOut",34:"Bounce.easeIn",35:"Bounce.easeInOut",36:"Bounce.easeOut",37:"Circ.easeIn",38:"Circ.easeInOut",39:"Circ.easeOut",40:"Elastic.easeIn",41:"Elastic.easeInOut",42:"Elastic.easeOut",43:"Expo.easeIn",44:"Expo.easeInOut",45:"Expo.easeOut",46:"Sine.easeIn",47:"Sine.easeInOut",48:"Sine.easeOut",49:"SlowMo.ease"},getTypeName:function(e){switch(e){case 100:return"出现动画";case 101:return"飞入";case 102:return"放大";case 103:return"渐现";case 104:return"缩小出现";case 200:return"消失动画";case 201:return"飞出";case 202:return"缩小";case 203:return"渐隐";case 204:return"放大消失";case 300:return"运动路径";case 301:return"直线运动";case 302:return"曲线运动";case 400:return"强调动画";case 401:return"放大缩小";case 402:return"透明";case 403:return"旋转";case 500:return"媒体动画";case 501:return"播放";case 502:return"暂停";case 503:return"结束";case 601:return"逐字出现";case 701:return"SVG动画"}},setpathparam:function(e){var t=this,n;this.pathoriginalpoint={};var r=this.page.iOverlaylist.get(this.options.animation.overlay_id);this.obj=r.iview.$el[0];var i=r.get("_offset_x")||0,s=r.get("_offset_y")||0,o=this.options.animation.iDetail.autoRotate||!1;if(o)var u=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el[0];var a=this.options.animation.iDetail.closed;if(e==302){if(this.options.animation.iDetail.path.length<2)return this.param=null,!1;n=[],_.each(this.options.animation.iDetail.path,function(e,t,r){if(t!=0&&e.handleIn){var o={};o.x=e.handleIn.x+e.point.x+i,o.y=e.handleIn.y+e.point.y+s,n.push(o)}n.push({x:e.point.x+i,y:e.point.y+s});if(e.handleOut){var u={};u.x=e.handleOut.x+e.point.x+i,u.y=e.handleOut.y+e.point.y+s,n.push(u)}if(t==r.length-1&&a&&e.handleOut&&r[0].handleIn){var f=r[0].handleIn,l=r[0].point,o={};o.x=f.x+l.x+i,o.y=f.y+l.y+s,n.push(o),n.push(l)}}),this.param.bezier={values:n,type:"cubic",autoRotate:o}}if(e==301){if(this.options.animation.iDetail.path.length<2)return this.param=null,!1;n=[];var f;for(f=0;f<this.options.animation.iDetail.path.length;f++){if(f!=0){var l=this.options.animation.iDetail.path[f-1],c=this.options.animation.iDetail.path[f],h={x:(l.point.x+c.point.x)/2+i,y:(l.point.y+c.point.y)/2+s};n.push(h)}n.push({x:this.options.animation.iDetail.path[f].point.x+i,y:this.options.animation.iDetail.path[f].point.y+s});if(f==this.options.animation.iDetail.path.length-1&&a){var l=this.options.animation.iDetail.path[f],c=this.options.animation.iDetail.path[0],h={x:(l.point.x+c.point.x)/2+i,y:(l.point.y+c.point.y)/2+s};n.push(h),n.push({x:this.options.animation.iDetail.path[0].point.x+i,y:this.options.animation.iDetail.path[0].point.y+s})}}this.param.bezier={values:n,type:"quadratic",autoRotate:o}}},setappearparam:function(e){this.startshow=!0,this.fromparam={},this.toparam={},this.toparam.onStart=this.onStart,this.toparam.immediateRender=!1,this.toparam.onComplete=this.param.onComplete,this.toparam.delay=this.param.delay,this.toparam.repeat=this.param.repeat,this.toparam.ease=this.param.ease;var t,n,r;if(e==101){this.stopshow=!0,t=this.options.animation.iDetail.direction||0;var i=this.options.animation.iDetail.pathlength||0,s=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.x,o=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.y,u=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.find(".Element").first().width(),a=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.find(".Element").first().height();n={};switch(t){case 0:i?n.y=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.y-i:n.y="-"+a,n.x=s;break;case 1:i?n.x=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.x+i:n.x=interaction_view.size.x+u,n.y=o;break;case 2:i?n.y=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.y+i:n.y=interaction_view.size.y+a,n.x=s;break;case 3:i?n.x=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.x-i:n.x="-"+u,n.y=o}this.param.css=n,this.fromparam.css={x:Number(n.x),y:Number(n.y)},this.toparam.css={x:Number(s),y:Number(o)},i&&(this.fromparam.css.opacity=0,this.toparam.css.opacity=1),this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el[0],this.toparam.css.force3D=interaction_view.force3D}if(e==102){this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.children(".Element")[0],t=this.options.animation.iDetail.direction||0,r={},n={};var f=this.page.iOverlaylist.get(this.options.animation.overlay_id);r.scale=0,this.param.css=r,this.fromparam.css={scale:0},this.toparam.css={scale:1},this.toparam.css.force3D=interaction_view.force3D,interaction_view.force3D&&_g.device.android()&&TweenLite.set(this.obj,{transformPerspective:2e3})}e==103&&(t=this.options.animation.iDetail.direction||0,r={},this.param.css={opacity:0},this.fromparam.css={opacity:0},this.toparam.css={opacity:1},this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el[0],this.toparam.css.force3D=interaction_view.force3D);if(e==104){this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.children(".Element")[0];var l=Number(this.options.animation.iDetail.scale)||2,c=Number(this.options.animation.iDetail.opacity)||.5;r={},n={};var f=this.page.iOverlaylist.get(this.options.animation.overlay_id);r.scale=0,this.param.css=r,this.fromparam.css={scale:l,opacity:c},this.toparam.css={scale:1,opacity:1},this.toparam.css.force3D=interaction_view.force3D,interaction_view.force3D&&_g.device.android()&&TweenLite.set(this.obj,{transformPerspective:2e3})}},setdisappearparam:function(e){var t={};if(e==201){var n=this.options.animation.iDetail.direction||0;this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el[0];var r=this.options.animation.iDetail.pathlength||0,i=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.find(".Element").first().width()*2,s=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.find(".Element").first().height()*2;switch(n){case 0:r?t.y=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.y-r:t.y="-"+s;break;case 1:r?t.x=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.x+r:t.x=interaction_view.size.x+i;break;case 2:r?t.y=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.y+r:t.y=interaction_view.size.y+s;break;case 3:r?t.x=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.x-r:t.x="-"+i}this.param.css=t,r&&(this.param.css.opacity=0)}if(e==202){this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.children(".Element")[0];var o=this.page.iOverlaylist.get(this.options.animation.overlay_id);t.scale=0,this.param.css=t}e==203&&(this.param.css={opacity:0},this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el[0]);if(e==204){var u=Number(this.options.animation.iDetail.scale)||2,a=Number(this.options.animation.iDetail.opacity)||0;this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.children(".Element")[0];var o=this.page.iOverlaylist.get(this.options.animation.overlay_id);t.scale=u,t.opacity=a,this.param.css=t}this.stophide=!0},setstrongparam:function(e){this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el[0];if(e==401){this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.children(".Element")[0];var t=this.page.iOverlaylist.get(this.options.animation.overlay_id),n={};n.scale=_.isNumber(this.options.animation.iDetail.scale)?Number(this.options.animation.iDetail.scale):1,this.param.css=n}if(e==402){var r=this.options.animation.iDetail.opacity||0;this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el[0],this.param.css={opacity:r}}if(e==403){this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.children(".Element")[0];var i=_.isNumber(this.options.animation.iDetail.rotation)?Number(this.options.animation.iDetail.rotation):0,s=this.options.animation.iDetail.axial||0,o=this.options.animation.iDetail.transformOrigin||0,u="_cw",a="+";i<0&&(u="_ccw"),i<0&&(a="-");var n={};s==0&&(n.rotation=a+"="+Math.abs(i)+u),s==1&&(n.rotationX=a+"="+Math.abs(i)+u),s==2&&(n.rotationY=a+"="+Math.abs(i)+u),this.param.css=n;switch(o){case 0:this.param.css.transformOrigin="50% 50%";break;case 1:s==0?this.param.css.transformOrigin="0% 50%":this.param.css.transformOrigin="left";break;case 2:s==0?this.param.css.transformOrigin="100% 50%":this.param.css.transformOrigin="right";break;case 3:s==0?this.param.css.transformOrigin="50% 100%":this.param.css.transformOrigin="bottom center";break;case 4:s==0?this.param.css.transformOrigin="50% 0%":this.param.css.transformOrigin="top center";break;case 5:this.param.css.transformOrigin="0% 0%";break;case 6:this.param.css.transformOrigin="100% 0%";break;case 7:this.param.css.transformOrigin="0% 100%";break;case 8:this.param.css.transformOrigin="100% 100%";break;default:this.param.css.transformOrigin="50% 50%"}_g.device.android()&&TweenLite.set(this.obj,{transformPerspective:2e3})}this.param.css.force3D=interaction_view.force3D},settextparam:function(e){this.startshow=!0;if(e==601){var t=this.page.iOverlaylist.get(this.options.animation.overlay_id);if(t.get("iType")=="Paragraph"){var n=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.children(".Element")[0];this.obj=$(n).find("p.iText"),this.param.text=t.get("iDetail").iText,$(this.obj).html("")}}},setgroupparam:function(){var e=this;this.param={},this.param.data=this.options.animation,this.param.onStartParams=["{self}"],this.param.onStart=this.onStart,this.param.onComplete=this.stop,this.param.onCompleteParams=["{self}"];var t=this.options.animation.iTiming.repeat||0;t==-1?this.param.repeat=-1:t&&t!=-2?this.param.repeat=t-1:t==-2&&(this.param.repeat=-1)},setsvgparam:function(e){this.startshow=!0;if(e==701){this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.children(".Element").find("svg").find("rect, circle, ellipse, polyline, path, line, polygon");var t=this.page.iOverlaylist.get(this.options.animation.overlay_id);this.fromparam={},this.toparam={},this.toparam.onStart=this.onStart,this.toparam.immediateRender=!1,this.toparam.onComplete=this.param.onComplete,this.toparam.delay=this.param.delay,this.toparam.repeat=this.param.repeat,this.toparam.ease=this.param.ease,this.fromparam.drawSVG=this.param.data.iDetail.startx+" "+this.param.data.iDetail.starty,this.toparam.drawSVG=this.param.data.iDetail.endx+" "+this.param.data.iDetail.endy}},setparam:function(){var e=this;this.param={},this.param.data=this.options.animation;var t=this.page.iOverlaylist.get(this.options.animation.overlay_id);this.overlaymodel=t,this.param.onStartParams=["{self}"],this.param.onStart=this.onStart,this.param.onUpdate=this.onUpdate,this.param.onComplete=this.stop,this.param.onCompleteParams=["{self}"],this.param.ease=this.EaseTypes[this.options.animation.iTiming.ease||0];var n=this.options.animation.iTiming.repeat||0;n==-1?this.param.repeat=-1:n&&n!=-2?this.param.repeat=n-1:n==-2&&(this.param.repeat=-1);switch(this.options.animation.iType){case 100:return"出现动画";case 101:this.setappearparam(101);break;case 102:this.setappearparam(102);break;case 103:this.setappearparam(103);break;case 104:this.setappearparam(104);break;case 200:return"消失动画";case 201:this.setdisappearparam(201);break;case 202:this.setdisappearparam(202);break;case 203:this.setdisappearparam(203);break;case 204:this.setdisappearparam(204);break;case 300:return"运动路径";case 301:this.setpathparam(301);break;case 302:this.setpathparam(302);break;case 400:return"强调动画";case 401:this.setstrongparam(401);break;case 402:this.setstrongparam(402);break;case 403:this.setstrongparam(403);break;case 500:return"媒体动画";case 501:this.setmedia(501);break;case 502:this.setmedia(502);break;case 503:this.setmedia(503);break;case 700:return"SVG动画";case 701:this.setsvgparam(701);break;case 600:return"文字动画";case 601:this.settextparam(601)}this.param&&this.param.css&&(this.param.css.force3D=interaction_view.force3D,this.param.css.force3D&&this.obj&&_g.device.android())},setmedia:function(e){this.overlaymodel.get("iType")=="Audio"&&(this.isAudio=!0,e==501)},pathstop:function(e){var t=this.options.animation.iTiming.rewind||!1;t&&this.options.animation.iTiming.repeat!=-1&&this.options.animation.iTiming.repeat!=-2&&this.options.animation.iDetail.path&&this.options.animation.iDetail.path[0]&&e.pause(0)},animationstop:function(e){var t=this.options.animation.iTiming.rewind||!1;t&&e&&e.pause(0)},stop:function(e){this.stopshow&&this.showelement(),this.stophide&&this.hideelement(),this.animationstop(e),interaction_view.events.onAnimationEnd({overlay_id:this.options.animation.overlay_id,animation_id:this.options.animation.id,page_id:this.page.id,layer_id:this.options.collection.layerid})},forcestop:function(e){var t=this.options.animation.iTiming.rewind||!1;t?e.pause(0):e.pause(this.options.animation.iTiming.duration),this.options.collection.onComplete(this.options.animation.id)},addclickcontrol:function(){this.options.collection.addclickstop(this.options.animation.id)},onStart:function(e){this.startshow&&this.showelement(),interaction_view.events.onAnimationStart({overlay_id:this.options.animation.overlay_id,animation_id:this.options.animation.id,page_id:this.page.id,layer_id:this.options.collection.layerid})},onUpdate:function(e){},showelement:function(){var e=this.page.iOverlaylist.get(this.options.animation.overlay_id);e.iview.onBeforeShow&&e.iview.onBeforeShow(),e.iview.$el.removeClass("hide"),e.iview.onShow&&e.iview.onShow()},hideelement:function(){var e=this.page.iOverlaylist.get(this.options.animation.overlay_id);e.iview.onBeforeHide&&e.iview.onBeforeHide(),e.iview.$el.addClass("hide"),e.iview.onHide&&e.iview.onHide()}}});define("interaction_view/model/action",["interaction_view/model/base","interaction_view/ui/animation"],function(){interaction_view.model.Action=interaction_view.model.Base.extend({defaults:{page_id:null,ref_id:null,index:null,layer_id:null,overlay_id:null},setcollection:function(){},setview:function(e){this.pageid=this.get("pageid"),this.parentpageid=this.get("parentpageid"),this.iPage_id=this.pageid,this.app_id=this.get("app_id");if(this.get("pagetype")=="LayerRef"){var t=this.get("parentpageid"),n=this.get("layerid"),r=interaction_view.getParentpage(t);this.parentpage=r,this.page=r.iOverlaylist.get(this.pageid).layer[n],this.iPage_id=t}else this.get("path")?(this.path=this.get("path"),this.page=interaction_view.getContainerModelByPath(this.path)):this.page=interaction_view.getParentpage(this.pageid);this.iview=new interaction_view.view.Action({model:this})},setsyncmodel:function(){},actionpatch:function(){var e=this,t=this.get("iDetail");this.get("pagetype")=="LayerRef"&&(this.get("layer_id")||this.set("layer_id",this.get("layerid"))),t.results[0].iAction!=5&&t.results[0].iAction<7&&(t.results[0].iAction==6&&typeof t.results[0].values=="string"&&(t.results[0].values=[{id:t.results[0].values,page_id:e.pageid}]),t.results[0].values=_.map(t.results[0].values,function(t){return typeof t!="object"?{id:t,page_id:e.pageid}:t})),this.set("iDetail",t)}}),interaction_view.collection.Action=interaction_view.collection.Base.extend({initialize:function(){this.setonadd(),this.setonremove()},model:interaction_view.model.Action,setonadd:function(){this.on("add",function(e){})},onSingleComplete:function(){},onUpdate:function(){},onTotalComplete:function(){},resetStatus:function(){this.each(function(e){e.iview.resetStatus()})}}),interaction_view.view.Action=interaction_view.view.Base.extend({initstart:function(){},renderanimations:function(){this.timeline&&this.timeline.clear();var e=this,t=this.model.toJSON(),n=this.values;n&&n.length&&(e.timeline=interaction_view.generateTimeline({onStart:null,ids:n,iPage_id:this.model.iPage_id,page:this.model.page,paused:!0,foraction:!0}),e.timeline&&e.timeline.play(0))},onComplete:function(){},events:{},renderDynamicElement:function(){},getClassification:function(){if(!this.ref_id){if(_.isNumber(this.index)&&this.overlaymodel)return 4;if(this.animation_id)return 5;if(!_.isNumber(this.index)&&this.overlaymodel)return 1;if(!this.overlaymodel){if(this.overlay_id==this.model.page.id)return 2;if(interaction_view.ilayerlist.get(this.overlay_id)||interaction_view.iComponentlist.get(this.overlay_id))return 3}}if(this.ref_id&&this.model.get("pagetype")=="LayerRef"&&this.model.pageid==this.ref_id&&this.model.parentpageid==this.page_id){if(_.isNumber(this.index)&&this.overlaymodel)return 4;if(this.animation_id)return 5;if(!_.isNumber(this.index)&&this.overlaymodel)return 1;if(!this.overlaymodel){if(this.overlay_id==this.model.page.id)return 2;if(interaction_view.ilayerlist.get(this.overlay_id)||interaction_view.iComponentlist.get(this.overlay_id))return 3}}return 0},render:function(){this.app_id=this.model.toJSON().app_id,this.iType=this.model.toJSON().iType,this.overlay_id=this.model.toJSON().overlay_id,this.page_id=this.model.toJSON().page_id,this.ref_id=this.model.toJSON().ref_id,this.index=this.model.toJSON().index,this.animation_id=this.model.toJSON().animation_id,this.layer_id=this.model.toJSON().layer_id;var e=this.model.toJSON().iDetail;if(!e||!e.results)return;var t=this;this.actiontype=e.results[0].iAction,this.values=e.results[0].values;if(this.app_id){this.renderforapplication();return}this.overlaymodel=this.model.page.iOverlaylist.get(this.overlay_id);var n=this.getClassification();if(!n)return;switch(n){case 1:this.renderforoverlay();break;case 2:this.renderforpage();break;case 3:this.renderforlayer();break;case 4:this.renderforslideindex();break;case 5:this.renderforanimationaction()}},renderforoverlay:function(){var e=this,t={type:this.iType,page_id:this.page_id,overlay_id:this.overlay_id,layer_id:this.layer_id,func:function(){e.executeAction(e)}};switch(this.iType){case 8:case 9:case 10:case 11:case 12:t.drop_type=this.iType,t.path=this.path,_.include([11,12],this.iType)?(t.type="dragdropgroup",interaction_view.events.dragDropGroupEvents.push(t)):(t.type="dragdrop",interaction_view.events.dragDropEvents.push(t));break;case 18:case 19:case 16:case 17:t.condition=String(this.model.attributes.condition),interaction_view.events.timerEvents.push(t);break;case 22:t.condition=String(this.model.attributes.condition),interaction_view.events.variableEvents.push(t);break;case 23:interaction_view.events.voteEvents.push(t);break;case 54:interaction_view.events.paragraphEvents.push(t);break;case 41:interaction_view.events.eraserEvents.push(t);break;case 71:case 72:interaction_view.events.WeixinCameraEvents.push(t);break;case 73:interaction_view.events.collisionEvents.push(t);break;default:var n="tap",r=this.overlaymodel.iview.$el;if(this.iType==20)n="mouseenter";else if(this.iType==21)n="mouseleave";else if(this.iType==14||this.iType==15)n="hold";this.overlaymodel.iview.$el.css("cursor","pointer"),this.overlaymodel.iview.$el.addClass("hasaction"),_.include(["Slide","LayerSlide","CycleImage","Vote"],this.overlaymodel.iview.iType)&&(r=r.children(".Element")),_.include(["Button"],this.overlaymodel.iview.iType)&&console.log("button"),this.iType==1&&(r=this.overlaymodel.iview.$el.find("img.iconNormal")),this.iType==2&&(r=this.overlaymodel.iview.$el.find("img.iconActive"));if(!r)return;r.hammer().on(n,function(t){if(e.iType==0&&_.include(["Paragraph"],e.overlaymodel.iview.iType)&&interaction_view.environment.Paragraph.state()&&!e.overlaymodel.attributes.iDetail.iStaticImage)return!1;if(_.include(["Slide","LayerSlide","CycleImage","Button","Vote"],e.overlaymodel.iview.iType)&&e.overlaymodel.iview.slipable&&!$(t.target).is(t.currentTarget))return!1;if(e.iType==15){var n=!1;$(document).one("mouseup touchend touchcancel",function(){!n&&e.executeAction(e)&&(n=!0)})}else e.executeAction(e)})}},renderforanimationaction:function(){var e=this,t=this.model.page.iAnimationlist.get(this.animation_id);if(t){var n={type:"animation",page_id:this.page_id,overlay_id:this.overlay_id,animation_id:this.animation_id,path:this.path,layer_id:this.layer_id,func:function(){e.executeAction(e)}};this.iType==6&&interaction_view.events.animationStartEvents.push(n),this.iType==7&&interaction_view.events.animationEndEvents.push(n)}},renderforlayer:function(){var e=this,t=this.model.get("layerid"),n=this.model.parentpage.iOverlaylist.get(this.model.get("pageid")).toJSON().iDetail.layer_ids.indexOf(t);if(n==-1)return!1;this.iType==0&&this.model.parentpage&&this.model.parentpage.iOverlaylist.get(this.model.get("pageid")).iview.$el.children(".Element").on("click",function(t){if(!$(t.target).is(t.currentTarget)&&$(t.currentTarget).find(".layer-content").first().children().length>1)return!1;e.model.parentpage.iOverlaylist.get(e.model.get("pageid")).iview.currentIndex==n&&e.testControlforLayer(t)&&e.executeAction(e)}),this.iType==3&&interaction_view.events.pageStartEvents.push({type:"page",page_id:e.model.pageid,layer_id:this.model.get("layerid"),func:function(){e.executeAction(e)}}),this.iType==4&&this.model.parentpage&&(this.model.parentpage.iOverlaylist.get(this.model.get("pageid")).iview.$el.addClass("hasDblClick"),this.model.parentpage.iOverlaylist.get(this.model.get("pageid")).iview.$el.children(".Element").on("dblclick",function(t){if($(t.target).closest(".layer-item").index()!=e.model.parentpage.iOverlaylist.get(e.model.get("pageid")).iview.currentIndex)return;e.model.parentpage.iOverlaylist.get(e.model.get("pageid")).iview.currentIndex==n&&e.testControlforLayer(t)&&e.executeAction(e)}),interaction_view.touchview&&this.model.parentpage.iOverlaylist.get(this.model.get("pageid")).iview.$el.children(".Element").hammer().on("doubletap",function(t){if($(t.target).closest(".layer-item").index()!=e.model.parentpage.iOverlaylist.get(e.model.get("pageid")).iview.currentIndex)return;e.model.parentpage.iOverlaylist.get(e.model.get("pageid")).iview.currentIndex==n&&e.testControlforLayer(t)&&e.executeAction(e)}))},renderforpage:function(){var e=this;this.iType==0&&interaction_view.events.pageClickEvents.push({type:interaction_view.getPageType(e),page_id:e.model.page.id,func:function(){e.executeAction(e)}}),this.iType==3&&interaction_view.events.pageStartEvents.push({type:"page",page_id:e.model.page.id,func:function(){e.executeAction(e)}}),this.iType==4&&interaction_view.events.pageDblClickEvents.push({type:interaction_view.getPageType(e),page_id:e.model.page.id,func:function(){e.executeAction(e)}}),this.iType==51&&interaction_view.events.pageWXShareSuccessEvents.push({type:interaction_view.getPageType(e),page_id:e.model.page.id,func:function(){e.executeAction(e)}}),_.include([36,37,38,39],this.iType)&&interaction_view.events.pageSwipeEvents.push({type:interaction_view.imasterlist.length&&e.model.page.id==interaction_view.imasterlist.at(0).id?"master":"page",page_id:e.model.page.id,func:function(){e.executeAction(e)},swipeType:this.iType}),_.include([40],this.iType)&&interaction_view.events.pageShakeEvents.push({type:interaction_view.imasterlist.length&&e.model.page.id==interaction_view.imasterlist.at(0).id?"master":"page",page_id:e.model.page.id,func:function(){e.executeAction(e)}})},renderforslideindex:function(){this.overlaymodel.iview.iType!="CycleImage"&&this.overlaymodel.iview.iType!="Slide";if(!(this.overlaymodel.iview.slideel&&this.overlaymodel.iview.slidelength>0&&this.overlaymodel.iview.slidelength>this.index))return!1;var e=this;this.iType==0&&(this.overlaymodel.iview.slideel.find('[data-index="'+this.index+'"]').addClass("hasaction"),this.overlaymodel.iview.useIndex&&this.overlaymodel.iview.$el.children(".Element").addClass("hasaction"),this.overlaymodel.iview.detail.iFade=="Flow"?this.overlaymodel.iview.slideel.find('[data-index="'+this.index+'"]').hammer().on("tap",function(t){e.overlaymodel.iview.currentIndex==e.index&&!e.overlaymodel.iview.CoverFlow.data("CoverFlowDisableClick")&&setTimeout(function(){e.executeAction(e)},300)}):this.overlaymodel.iview.$el.children(".Element").on("click",function(t){if(e.overlaymodel.iview.slipable&&!$(t.target).is(t.currentTarget))return!1;e.overlaymodel.iview.currentIndex==e.index&&setTimeout(function(){e.executeAction(e)},300)})),this.iType==5&&interaction_view.events.elementChangeToEvents.push({type:"slide",page_id:e.model.pageid,overlay_id:this.overlaymodel.id,index:this.index,func:function(){e.executeAction(e)}}),this.iType==4&&(this.overlaymodel.iview.$el.addClass("hasDblClick"),this.overlaymodel.iview.useIndex?(this.overlaymodel.iview.$el.children(".Element").on("dblclick",function(t){e.overlaymodel.iview.currentIndex==e.index&&e.executeAction(e)}),interaction_view.ismobile&&this.overlaymodel.iview.$el.children(".Element").hammer().on("doubletap",function(t){e.overlaymodel.iview.currentIndex==e.index&&e.executeAction(e)})):(this.overlaymodel.iview.slideel.find('[data-index="'+this.index+'"]').on("dblclick",function(t){e.executeAction(e)}),interaction_view.ismobile&&this.overlaymodel.iview.slideel.find('[data-index="'+this.index+'"]').hammer().on("doubletap",function(t){e.executeAction(e)})))},renderforapplication:function(){var e=this;this.iType==70&&interaction_view.events.formSubmitEvents.push({type:70,id:this.app_id,func:function(){e.executeAction(e)}})},executeAction:function(e){if(typeof Reveal!="undefined"&&Reveal&&Reveal.isOverview()&&e.iType!=3)return!1;e.actiontype==0&&e.renderanimations(),e.actiontype==1&&e.rendershow(),e.actiontype==2&&e.renderhide(),e.actiontype==6&&e.setElementTo(),e.actiontype==5&&(interaction_view.foredit?global.message("warning","请使用playAll模式预览该功能"):e.renderpage()),e.actiontype==7&&(interaction_view.foredit?global.message("warning","请使用playAll模式预览该功能"):e.renderoverview()),e.actiontype==8&&(interaction_view.foredit?global.message("warning","请使用playAll模式预览该功能"):e.rendershare()),e.actiontype==10&&(interaction_view.foredit?global.message("warning","请使用playAll模式预览该功能"):e.renderurl()),e.actiontype==16&&(interaction_view.foredit?global.message("warning","请使用playAll模式预览该功能"):e.rendertel());if(e.actiontype==15&&_g.device.android()&&window.collecting&&window.collecting.startFunction){var t=interaction_view.currentPage,n=interaction_view.ipagelist.getPage(t);if(!n)return;var r=n.toJSON().nav&&n.toJSON().nav.thumbnail?n.toJSON().nav.thumbnail:null,i=interaction_view.doc.toJSON().title;window.collecting.startFunction(i,r,t)}this.overlaymodel&&this.overlaymodel.toJSON().iType=="Button"&&this.overlaymodel.get("isTabBarButton")&&this.syncTabButtons(),_.include([17,18,19,20,21,52,53,60,72,73],e.actiontype)&&e.renderNormal(e.actiontype),_.include([51],e.actiontype)&&e.renderWXShare(e.actiontype),_.include([56,57],e.actiontype)&&e.renderParagraph(e.actiontype),_.include([58],e.actiontype)&&e.setButtonToActive(e.actiontype),e.actiontype==70&&window.setTimeout(function(){e.submitForm(e.actiontype)},500),e.actiontype==71&&e.setFormValue(e.actiontype),_.include([59],e.actiontype)&&e.renderreplaceresource(),e.actiontype==61&&e.playElementTo()},rendershare:function(){interaction_view.ismobile||share(interaction_view.doc.toJSON().title,context_url+"/player")},renderoverview:function(){Reveal.toggleOverview(!0)},renderclick:function(){},rendershow:function(){var e=this,t=this.values;t&&_.each(t,function(t){var n=t.page_id,r=interaction_view.getAnimationPage(n,e.model.page),i=r.iOverlaylist.get(t.id);i&&i.iview&&i.iview.$el&&(i.iview.onBeforeShow&&i.iview.onBeforeShow(),i.iview.$el.removeClass("hide"),i.iview.onShow&&i.iview.onShow())})},renderhide:function(){var e=this,t=this.values;t&&_.each(t,function(t){var n=t.page_id,r=interaction_view.getAnimationPage(n,e.model.page),i=r.iOverlaylist.get(t.id);i&&i.iview&&i.iview.$el&&(i.iview.onBeforeHide&&i.iview.onBeforeHide(),i.iview.$el.addClass("hide"),i.iview.onHide&&i.iview.onHide())})},renderpage:function(){var e=this.model.toJSON().iDetail,t=this.values,n=e.results[0].iActionDetail?e.results[0].iActionDetail.transition:0,r=null,i=null,n=e.results[0].iActionDetail?e.results[0].iActionDetail.transition?e.results[0].iActionDetail.transition:0:0,s=interaction_view.getVarsOp(interaction_view.currentPage,[0,2]);if(s.beginWithAT(t)){var o=interaction_view.ipagelist.length;t=Math.round(s.var2val(t)),t<0&&(t=0),t>o-1&&(t=o-1),t=interaction_view.ipagelist.at(t).id}if(n==0||n)if(!_.include(["first","last","prev","next"],t)){var u=interaction_view.ipagelist.getPage(t);u&&(n<4?interaction_view.ipagelist.getPage(t).iview.$el.attr("data-transition","linear"):n<8?interaction_view.ipagelist.getPage(t).iview.$el.attr("data-transition","page"):n==8?interaction_view.ipagelist.getPage(t).iview.$el.attr("data-transition","fade"):interaction_view.ipagelist.getPage(t).iview.$el.removeAttr("data-transition"))}var a=interaction_view.ipagelist.length;switch(t){case"first":t=Reveal.getFirst();break;case"last":t=Reveal.getLast();break;case"prev":t=Reveal.getPrev();break;case"next":t=Reveal.getNext();break;default:}t&&presentation.gotopage(t,n)},renderurl:function(){if(this.values.length==0||_.isEmpty(this.values[0].url))return;var e=this.values[0].url;if(e.indexOf("@")==0){window.open(e,"_blank");return}e.indexOf("://")==-1&&(e="http://"+e),window.location.href.indexOf("query_string")>0&&(e+=e.indexOf("?")>=0&&"&"+window.location.search.replace("?","")||window.location.search),window.open(e,"_blank")},rendertel:function(){if(!interaction_view.ismobile)return;if(this.values.length==0||_.isEmpty(this.values[0].url))return;var e=this.values[0].url;window.location="tel:"+e},renderNormal:function(e){var t=this,n=this.values;n&&_.each(n,function(n){var r=n.page_id,i=interaction_view.getAnimationPage(r,t.model.page),s=i.iOverlaylist.get(n.id);if(s&&s.iview)switch(e){case 17:s.iview.startTimer();break;case 18:s.iview.stopTimerSimple();break;case 19:s.iview.resetTimer();break;case 20:if(s.iview.setVariable)s.iview.setVariable(n.oper,n.value);else if(s.iview.updateText){var o=interaction_view.getVarsOp(r,[0,1,2],interaction_view.environment.Votes.get());s.iview.updateText(o.var2val(n.value,!0),addtourl=1)}break;case 21:interaction_view.events.onVariableChanged(s.iview);break;case 52:interaction_view.media.play(s);break;case 53:interaction_view.media.pause(s);break;case 60:s.iview.activeEdit&&setTimeout(function(){s.iview.activeEdit(!0)},500);break;case 72:s.iview.getInfo();break;case 73:s.iview.postInfo()}})},renderWXShare:function(e){var t=this,n=this.values;if(n){var r=n.page_id,i=n.value;console.log("set sharing: "+i);if(_g.device.mobile()||_g.device.tablet()){var s=interaction_view.getVarsOp(r,[0,1,2],interaction_view.environment.Votes.get());i=s.var2val(i,!0)}i=i.replace(/<br>+/g," ").replace(/"+/g,"'"),shareTitle=i,document.title=shareTitle,interaction_view.weixin.share()}},renderParagraph:function(e){switch(e){case 56:interaction_view.environment.Paragraph.enable();break;case 57:interaction_view.environment.Paragraph.disable()}},setButtonToActive:function(){if(!this.values||this.values.length==0)return;var e=this,t=this.model.toJSON().iDetail,n=this.values[0].id,r=this.values[0].page_id,i=interaction_view.getAnimationPage(r,e.model.page);if(n){var s=i.iOverlaylist.get(n);s&&!s.iview.active&&s.iview.$el.find("img.iconNormal").length&&s.iview.$el.find("img.iconNormal").trigger("click")}},renderreplaceresource:function(){if(!this.values||this.values.length==0)return;var e=this,t,n=this.model.toJSON().iDetail;overlay_id=this.values[0].id,pageid=this.values[0].page_id,page=interaction_view.getAnimationPage(pageid,e.model.page),overlay_id&&(t=page.iOverlaylist.get(overlay_id));if(!t)return;var r=t.get("iType"),i=n.results[0].iActionDetail?n.results[0].iActionDetail.replace:null,s=n.results[0].iActionDetail?n.results[0].iActionDetail.url:null;if(!i)return;i==1&&r=="ImageBlock"&&(typeof wx_permissions!="undefined"&&wx_permissions.chooseImage?interaction_view.localIds?setTimeout(function(){t.iview.setweixinimage(interaction_view.localIds[0])},100):interaction_view.weixin.chooseimage(function(e){e&&(interaction_view.localIds=e,t.iview.setweixinimage(e[0]))}):_g.device.isWeixin()?interaction_view.errorAlert("开启微信功能失败"):interaction_view.errorAlert("请在微信中操作"));if(i==2&&r=="Audio")if(typeof wx_permissions!="undefined"&&wx_permissions.startRecord){var o=function(){if(!interaction_view.voicelocalId)return;var e=t.iview.getdetail();if(t.voicelocalId==interaction_view.voicelocalId)return;interaction_view.voiceUploader(interaction_view.voicelocalId,function(n){t.media&&(interaction_view.media.changeSrc(t,n),interaction_view.media.play(t)),t.voicelocalId=interaction_view.voicelocalId,t.voiceUrl=n,e.iFile[0].file=n,t.iview.addToUrl(n)})};interaction_view.voicelocalId?o(interaction_view.voicelocalId):interaction_view.voiceEditor(function(){o()})}else _g.device.isWeixin()?interaction_view.errorAlert("开启微信功能失败"):interaction_view.errorAlert("请在微信中操作");if(i==3||i==4){if(!s)return;if(r=="ImageBlock"){var u=t.iview.$el.children(".Element").children("img"),a=t.iview.getdetail();s=="reset"?(typeof a.iImg[0].origin!="undefined"?(u.attr("src",a.iImg[0].origin),a.iImg[0].picture=a.iImg[0].origin):(u.attr("src",""),a.iImg[0].picture=""),typeof t.iview.removeFromUrl!="undefined"&&t.iview.removeFromUrl()):(u.attr("src",s),a.iImg[0].picture=s,t.iview.addToUrl(s,0,0,1,0))}else if(r=="Audio"){var a=t.iview.getdetail();t.media&&(interaction_view.media.changeSrc(t,s),interaction_view.media.play(t)),a.iFile[0].file=s,t.iview.addToUrl(s)}}},setElementTo:function(){if(!this.values||this.values.length==0)return;var e=this,t=this.model.toJSON().iDetail,n=this.values[0].id,r=this.values[0].page_id,i=interaction_view.getAnimationPage(r,e.model.page),s=t.results[0].iActionDetail?t.results[0].iActionDetail.index:null,o=interaction_view.getVarsOp(interaction_view.currentPage,[0,2]);o.beginWithAT(s)&&(s=o.var2val(s));if(n){var u=i.iOverlaylist.get(n);u&&u.iview&&u.iview.setElementTo(s)}if(this.overlaymodel&&this.overlaymodel.toJSON().iType=="Button"){var a=this.syncbuttons(i,this.model.toJSON().overlay_id,this.values[0]);a>0&&(this.overlaymodel.iview.groupcontrol=!0)}},playElementTo:function(){if(!this.values||this.values.length==0)return;var e=this,t=this.model.toJSON().iDetail,n=this.values[0].id,r=this.values[0].page_id,i=interaction_view.getAnimationPage(r,e.model.page),s=t.results[0].iActionDetail?t.results[0].iActionDetail.mode:0,o=t.results[0].iActionDetail?t.results[0].iActionDetail.repeat?-1:0:0,u=t.results[0].iActionDetail?t.results[0].iActionDetail.p_from:0,a=t.results[0].iActionDetail?t.results[0].iActionDetail.p_to:0;if(n){var f=i.iOverlaylist.get(n);if(f&&f.iview){s==4&&f.iview.timeline&&f.iview.timeline.pause();if(s==0||s==1){var l=f.toJSON().iDetail.iImg.length;if(!l)return;s==0?(f.iview._start=0,f.iview._end=l-1,f.iview.direction=0):(f.iview.direction=1,f.iview._start=l-1,f.iview._end=0),f.iview.autoplay=!0,f.iview.repeat=o;var c=f.iview._setCanvasLoopSwitch(!0);f.iview.timeline.play(c)}if(s==2){f.iview._start=u,f.iview._end=a,f.iview.direction=u-a>0?1:0,f.iview.autoplay=!0,f.iview.repeat=o;var c=f.iview._setCanvasLoopSwitch(!0);f.iview.timeline.play(c)}if(s==3){f.iview.currentIndex||(f.iview.currentIndex=0),f.iview._start=f.iview.currentIndex,f.iview._end=a,f.iview.direction=f.iview.currentIndex-a>0?1:0,f.iview.autoplay=!0,f.iview.repeat=o;var c=f.iview._setCanvasLoopSwitch(!0);f.iview.timeline.play(c)}}}},syncbuttons:function(e,t,n){var r=this,i=0,s=_.filter(this.model.page.iActionlist.toJSON(),function(e){return r.model.page.iOverlaylist.get(e.overlay_id)&&r.model.page.iOverlaylist.get(e.overlay_id).get("iType")=="Button"&&e.iDetail.results[0].iAction==6});return _.each(s,function(e){if(e.overlay_id!=t){var s=r.model.page.iOverlaylist.get(e.overlay_id);s&&s.toJSON().iDetail.isSwitch&&e.iDetail.results&&e.iDetail.results[0].values[0].id==n.id&&e.iDetail.results[0].values[0].page_id==n.page_id&&(i+=1,s.iview.resetButtonStatus())}}),i},syncTabButtons:function(){var e=this,t=this.overlaymodel.get("path"),n=interaction_view.getContainerModelByPath(t);n.iOverlaylist.each(function(t){t.id!=e.overlaymodel.id&&t.iview.resetButtonStatus()})},resetStatus:function(){this.overlaymodel.iview.$el.off("click")},testControlforLayer:function(e){var t=$(e.target).closest(".iView");if($(e.target).closest(".iView").hasClass("hasaction"))return!1;if(t){var n=t.attr("data-type");if(n=="Slide"||n=="CycleImage")if(t.attr("data-iSlipable"))return!1}return!0},submitForm:function(){var e=this;if(!this.values)return!1;interaction_view.application.submitForm(this.values)},setFormValue:function(){var e=this,t=this.model.toJSON().iDetail;VarOPobj=interaction_view.getVarsOp(interaction_view.currentPage,[0,1,2]);if(!this.values)return!1;var n=t.results[0].cid,r=t.results[0].vT,i=t.results[0].vV;i=VarOPobj.var2val(i,!0),interaction_view.application.setFormData(this.values,n,Number(r),i)}}),interaction_view.iActionlist=new interaction_view.collection.Action});define("interaction_view/model/animation_view",["interaction_view/model/base","interaction_view/ui/animation"],function(){interaction_view.model.Animation=interaction_view.model.Base.extend({defaults:{},setcollection:function(){},setmodel:function(){}}),interaction_view.collection.Animation=interaction_view.collection.Base.extend({initialize:function(){},model:interaction_view.model.Animation,setonadd:function(){this.on("add",function(e){})},setParams:function(e){this.repeatTweens=[];if(this.where({iKind:0}).length==0)return;var t=this;this.each(function(e){e.tween=null;var n=e.toJSON();if(n.iKind==0&&!t.page.iOverlaylist.get(n.overlay_id))return;e._animation=new animation({collection:t,animation:e.toJSON()})})},setPlay:function(e){if(this.length==0)return;var t=this,n=function(){};this.timeline=interaction_view.generateTimeline({onStart:n,animations:this.models,iPage_id:this.iPage_id,page:this.page,paused:!0})},play:function(){if(this.length==0)return;this.setPlay(),this.timeline.play(0)},playMain:function(){if(this.length==0)return;this.setParams(),this.setPlay(),this.timeline.play(0,!1),this.afterTimeLineCreated&&this.afterTimeLineCreated()},AddClickTween:function(e,t,n,r){if(interaction_view.SinglePreview)return;e.pause(r),console.log(r),$('section[id="'+t+'"]').children(".interaction-view").css("cursor","pointer"),interaction_view.events.pageClickEvents.push({type:"waitaction",page_id:t,func:function(){console.log(n),_.include([101,102,103,104],n.attributes.iType)&&(n.attributes.iTiming.delay?_g.device.android()&&n.attributes.iType==101&&window.setTimeout(function(){n._animation.showelement()},n.attributes.iTiming.delay):n._animation.showelement()),$('section[id="'+t+'"]').children(".interaction-view").css("cursor","auto"),e.resume()}})},AddPageSwipeTween:function(e,t,n,r,i){if(interaction_view.SinglePreview)return;console.log(i),e.pause(i),$('section[id="'+t+'"]').children(".interaction-view").css("cursor","pointer"),interaction_view.events.pageSwipeEvents.push({type:"waitaction",page_id:t,func:function(){_.include([101,102,103,104],r.attributes.iType)&&(r.attributes.iTiming.delay?_g.device.android()&&r.attributes.iType==101&&window.setTimeout(function(){r._animation.showelement()},r.attributes.iTiming.delay):r._animation.showelement()),$('section[id="'+t+'"]').children(".interaction-view").css("cursor","auto"),e.resume()},swipeType:n+33})},AddPageShakeTween:function(e,t,n,r,i){if(interaction_view.SinglePreview)return;console.log(i),e.pause(i),interaction_view.events.pageShakeEvents.push({type:"waitaction",page_id:t,func:function(){_.include([101,102,103,104],r.attributes.iType)&&(r.attributes.iTiming.delay?_g.device.android()&&r.attributes.iType==101&&window.setTimeout(function(){r._animation.showelement()},r.attributes.iTiming.delay):r._animation.showelement()),$('section[id="'+t+'"]').children(".interaction-view").css("cursor","auto"),e.resume()}})},AddRepeatClickTween:function(e,t,n,r){if(interaction_view.SinglePreview)return;$('section[id="'+t+'"]').children(".interaction-view").css("cursor","pointer"),interaction_view.events.pageClickEvents.push({type:"waitaction",page_id:t,func:function(){$('section[id="'+t+'"]').children(".interaction-view").css("cursor","auto"),n.pause(),r._animation.stop(n)}})},AddRepeatTween:function(e){var t=e._animation.obj,n=$.extend(!0,{},e._animation.param),r=e.toJSON().iTiming.duration||0,i=e.toJSON().iTiming.repeat||0;_.include([101,102,103,104],e.get("iType"))?e.tween=TweenMax.fromTo(t,r,e._animation.fromparam,e._animation.toparam):e.tween=TweenMax.to(t,r,n),i==-2&&$(".interaction-view").one("click",function(){e._animation.forcestop(e.tween)}),e.collection.repeatTweens.push(e.tween)},AddMediaTween:function(e){var t=e.collection.page;if(interaction_view.SinglePreview){var n=t.iAnimationlist.timeline.getLabelTime(interaction_view.PreviewItemId+"_start"),r=t.iAnimationlist.timeline.getLabelTime(e.id+"_start");if(n>r)return}var i=t.iOverlaylist.get(e.get("overlay_id")),s=e.get("iType");i.onAnimationStart={overlay_id:e.get("overlay_id"),animation_id:e.id,page_id:t.id,layer_id:e.collection.layerid},interaction_view.events.onAnimationStart(i.onAnimationStart),s==501&&(i.get("iType")=="Audio"||i.get("iType")=="Video"?interaction_view.media.play(i):i.iview.playTimeline()),s==502&&(i.get("iType")=="Audio"||i.get("iType")=="Video"?i.loaded&&(interaction_view.media.pause(i),i.iview.slider&&i.iview.sliderstop()):i.iview.pauseTimeline()),s==503&&(i.get("iType")=="Audio"||i.get("iType")=="Video"?i.loaded&&i.media&&(i.iview.resetOtherStatus(),i.iview.slider&&(i.iview.sliderstop(),i.iview.onSliderChange(0))):i.iview.stopTimeline()),(s==502||s==503)&&i.onAnimationStart&&(interaction_view.events.onAnimationEnd(i.onAnimationStart),i.onAnimationStart=null),t.iAnimationlist.onComplete(e.id)},getMediaTime:function(e){var t=0,n=e.collection.page.iOverlaylist.get(e.toJSON().overlay_id);if(n.media){if(n.get("iType")=="Audio"||n.get("iType")=="Video")t=n.hls?n.media.getDuration():n.media.duration}else _.include(["CycleImage","Slide","LayerSlide"],n.get("iType"))&&(t=n.iview.getSlideDuration());return t},onSingleComplete:function(){},onUpdate:function(){},onTotalComplete:function(){},onComplete:function(e){},resetAnimationStatus:function(){_.each(this.repeatTweens,function(e){e.kill()}),this.repeatTweens=[],this.timeline&&this.timeline.pause(0)}}),interaction_view.view.Animation=interaction_view.view.Base.extend({initstart:function(){}})});define("text!interaction_view/template/audiocontrol.js",[],function(){return'<div class="audiobar disableDragX disableDragY" style="height: 31px;width: 100%;position: absolute;">\n  <span class="audio-control status-play"></span>\n  <% if((iCommon[iPageDirection].iWidth-45)>0){%>\n  <span class="ui-slider-green ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" aria-disabled="false" style="width:<%=(iCommon[iPageDirection].iWidth-45)>0?(iCommon[iPageDirection].iWidth-45):0%>px;left: 45px;">\n    <div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min g-slider-range" style="width: 0%;background-color: #444444;">\n    </div>\n    <a class="ui-slider-handle ui-state-default ui-corner-all g-slider-handle" href="#" style="left: 0%;">\n    </a>\n  </span>\n  <% } %>\n</div>'});(function(){var e={addEvent:function(e,t,n,r){e.addEventListener?e.addEventListener(t,n,!!r):$(e).on(t,n)},removeEvent:function(e,t,n,r){e.removeEventListener?e.removeEventListener(t,n,!!r):$(e).off(t,n)},document:{disable_contextmenu:function(e){e||(e=document),e.oncontextmenu=function(e){return e&&e.preventDefault(),!1}},enable_contextmenu:function(e){e||(e=document),e.oncontextmenu=function(e){}},onCopy:function(e,t){$(document).on("copy",function(e){console.log(e)})},disable_paste:function(){document.disable_paste=!0},enable_paste:function(){document.disable_paste=!1}}};typeof require=="undefined"?(window._g||(window._g={}),window._g.event=e):define("_g/event",["_g/base"],function(){return window._g.event=e,window._g.event})})(window);(function(){var e=function(e){this.init(e)};e.prototype={percent:0,init:function(e){var t={containment:".g-slider",handle:".g-slider-handle",range:".g-slider-range"};return this.options=e?$.extend(!0,{},t,e):t,_.bindAll(this),this.handle=$(this.options.containment).find(this.options.handle).first(),this.range=$(this.options.containment).find(this.options.range).first(),this._bindControl(),this},_bindControl:function(){var e=this;this.handle.hammer().on("dragstart",function(t){e.dragstart=!0,e.startleft=parseInt(e.handle.css("left"),10)}),this.handle.hammer().on("drag",function(t){return console.log("dragleft"),e.dragstart=!0,e._doDragingEvent(t),t.gesture.preventDefault(),!1}),this.handle.hammer().on("dragend",function(t){if(!e.dragstart)return;return e.dragstart=!1,e._doDragEndEvent(t),t.gesture.preventDefault(),!1})},_doDragingEvent:function(e){console.log(e);var t=this.startleft,n=this.handle.parent().width(),r=$.zoom||1;t+=e.gesture.deltaX/r,t<0&&(t=0),t>n&&(t=n),this.percent=_g.number.decimal(t/n,2)*100,this.handle.css("left",this.percent+"%"),this.range.css("width",this.percent+"%")},_doDragEndEvent:function(e){this.options.onChange&&this.options.onChange(this.percent)},change:function(e){this.dragstart||(this.handle.css("left",e+"%"),this.range.css("width",e+"%"))}},typeof require=="undefined"?(window._g||(window._g={}),window._g.slider=e):define("_g/slider",["_g/base","_g/event","jquery.hammer"],function(){return window._g.slider=e,window._g.slider})})(window);define("interaction_view/model/audio",["interaction_view/model/base","text!interaction_view/template/audiocontrol.js","_g/slider"],function(){var e=require("text!interaction_view/template/audiocontrol.js");interaction_view.model.Audio=interaction_view.model.Base.extend({defaults:{iType:"Audio",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Audio({model:this})},setsyncmodel:function(){}}),interaction_view.view.Audio=interaction_view.view.Base.extend({events:{},bindSliderControl:function(){var e=this;this.$el.find(".audio-control").css("cursor","pointer"),this.$el.find(".audio-control").on("click",function(){return $(this).hasClass("status-play")?e.model.media&&interaction_view.media.play(e.model):$(this).hasClass("status-pause")&&(e.model.media&&interaction_view.media.pause(e.model),e.sliderstop()),!1})},render:function(t){var n=this.getdetail();n.iControl&&this.file&&(this.$el.children(".Element").append(_.template(e,this.model.toJSON())),this.$el.removeClass("hide"))},preload:function(){var e=this.getdetail();this.model.played=!1,this.model.time=0;var t;e.iFile&&e.iFile[0]&&(audio_url_src=this.getFromUrl(),audio_url_src!=""?t=audio_url_src:typeof epub360!="undefined"&&epub360.settings&&epub360.settings.disable_stream_media?t=e.iFile[0].file:typeof cbt_data=="undefined"||interaction_view.forpreview?_g.getUrlParameterByName("-playmode")=="1"?t=(e.iFile[0].file||e.iFile[0].content)+"_audio.m3u8":_g.getUrlParameterByName("-playmode")=="2"?t=e.iFile[0].file||e.iFile[0].content+"?avthumb/mp3/ab/32k":t=e.iFile[0].file||e.iFile[0].content+"?avthumb/mp3/ab/32k":t=e.iFile[0].file||e.iFile[0].content,this.sendToPreload({file:t}),this.file=t)},setOtherDisplay:function(){var e=this.getdetail(),t=this;e.iControl&&this.file&&(this.slider=new _g.slider({containment:this.$el,onChange:function(e){t.model.media&&interaction_view.media.seek(t.model,null,e)}}),this.bindSliderControl())},resetStatus:function(){this.resetOtherStatus()},resetOtherStatus:function(){if(this.model.isBgsound){this.$el.find(".status-play").addClass("status-pause").removeClass("status-play");return}this.model.media&&(this.model.hls?interaction_view.media.audio.resetH(this.model):interaction_view.media.audio.reset(this.model),this.slider&&(this.sliderstop(),this.onSliderChange(0)))},sliderplay:function(){this.$el.find(".audio-control").addClass("status-pause").removeClass("status-play")},sliderstop:function(){this.$el.find(".audio-control").removeClass("status-pause").addClass("status-play")},onSliderChange:function(e){console.log("time change "+e),this.slider.change(e)},getFromUrl:function(){var e=_g.getUrlParameterByName(this.model.id,message_link);return e||(e=_g.getHashParameterByName(this.model.id)),decodeURI(e||"")},addToUrl:function(e){var t=this,n=this.getdetail();if(e==n.iFile[0].origin)return!1;var r=this.model.id+"="+encodeURI(e),i=_g.getUrlParameterByName(this.model.id,message_link),s=0;if(!i){var o="?";message_link.indexOf("?")>=0&&(o="&"),message_link+=o+r,interaction_view.weixin.share()}else encodeURI(i)!=encodeURI(e)?(message_link=_g.replaceUrlParameterByName(this.model.id,r,message_link),interaction_view.weixin.share()):s=1;if(!interaction_view.forpreview){var u=_g.getHashParameterByName(this.model.id);u?encodeURI(u)!=encodeURI(e)?window.history.replaceState({},"",_g.replaceHashParameterByName(this.model.id,r)):s=1:window.history&&(document.location.hash?window.history.replaceState({},"",document.location.hash+="&"+r):window.history.replaceState({},"","#"+r))}return s?!1:!0}})});define("interaction_view/model/chapter",["interaction_view/model/base"],function(){interaction_view.model.Chapter=interaction_view.model.Base.extend({defaults:{},setcollection:function(){},setmodel:function(){this.setview()},setview:function(e){this.icollection=new interaction_view.collection.Chapter,this.iview=new interaction_view.view.Chapter({model:this})},setsyncmodel:function(){}}),interaction_view.collection.Chapter=interaction_view.collection.Base.extend({initialize:function(){},model:interaction_view.model.Chapter}),interaction_view.view.Chapter=interaction_view.view.Base.extend({initstart:function(){},events:{},renderDynamicElement:function(){},render:function(e){}}),interaction_view.iChapter=new interaction_view.model.Chapter({id:"chapter"})});define("interaction_view/model/cycleimage",["interaction_view/model/base","interaction_view/ui/animation","_g/base"],function(){interaction_view.model.CycleImage=interaction_view.model.Base.extend({defaults:{iType:"CycleImage",iLock:!0,iVisibility:!0,iCommon:{},iDetail:{},iSync:!1,isSlide:!0,iZindex:"-1",iUrl:null,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.loaded=[],this.loaded_index=0,this.iImgs=[],this.iview=new interaction_view.view.CycleImage({model:this})},setsyncmodel:function(){}}),interaction_view.view.CycleImage=interaction_view.view.Base.extend({events:{},render:function(e){var t=this,n=this.getdetail();this.currentSlideIndex=null,this.model.on("slideTo",function(e){if(t.currentSlideIndex!=null&&t.currentSlideIndex==e)return!1;t.preloaded&&(interaction_view.events.onChangeTo(t.model.iPageId,t.model.id,e),t.currentSlideIndex=e)})},preload:function(){var e=this;this.preloaded=!1;var t,n=this.getdetail();this.img_src=[],this.img_loaded=[];var r=[];if(n.iImg&&n.iImg.length){this.model._img_preload=!0;for(var i=0;i<n.iImg.length;i++)t=n.iImg[i].picture,e.img_src.push(t),e.img_loaded.push(!1);e.useIndex=!0}},afterpreload:function(e){this.slideel=this.$el.children(".Element").find(".slidecontent").first(),this.setZindex(),this.setElementDisplay(),this.renderCanvas(),this.playAnimation(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style"),this.preloaded=!0},playAnimation:function(){var e=this,t=0,n=this.detail,r=n.iSlidetype;r==null&&(r=0),this.delay=Number(n.iInterval)||.01,this.autoplay=n.iAutoplay;var i=n.iRepeat?-1:0;this.slidelength=n.iImg&&n.iImg.length||0,this.repeat=this.init_repeat=i,this.iRewind=n.iRewind,this.slipable=n.iSlipable,this.p_mode=n.p_mode||0,this.p_from=Number(n.p_from)||0,this.p_to=Number(n.p_to)||0,this.direction=this.init_direction=0,this.slidelength&&(this.p_to<0&&(this.p_to=0),this.p_from<0&&(this.p_from=0),this.p_to>this.slidelength-1&&(this.p_to=this.slidelength-1),this.p_from>this.slidelength-1&&(this.p_from=this.slidelength-1),this.p_mode||(this.p_from=0,this.p_to=this.slidelength-1),this.p_mode==1&&(this.direction=this.init_direction=1,this.p_from=this.slidelength-1,this.p_to=0),this.p_mode==2&&(this.direction=this.init_direction=this.p_from-this.p_to>0?1:0),this._start=this.p_from,this._end=this.p_to,this.setTimeline(),this.autoplay&&(this.model._autoplay=!0),this.img_preload(20,null,function(){e.drawCanvas(e.img_src[e.p_from],e.p_from),e.img_preload()}),this.onChangeSlideTo(this.p_from),this.slipable&&(this.control(),this.autoplay||this.$el.attr("data-iSlipable",!0)))},_autoplay:function(){this.timeline&&(this.$el.children(".Element").is(":hidden")||this.timeline.play())},exeutePlay:function(){},setTimeline:function(){this.iFade="LoopSwitch",this._setCanvasLoopSwitch()},testControl:function(){return!0},resetOtherStatus:function(){if(!this.slideel)return;var e=this.getdetail();this.autoplay=e.iAutoplay,this.repeat=this.init_repeat,this.direction=this.init_direction,this._start=this.p_from,this._end=this.p_to,this.currentIndex=this.p_from,this.useIndex&&(this.indexTime=this.p_from),this.timeline&&(this._setCanvasLoopSwitch(!0),this.ctx.clearRect(0,0,this.canvas_width,this.canvas_height),this.drawCanvas(this.img_src[this.p_from],this.p_from))},renderCanvas:function(){var e=this.getcommon();this.canvasId="canvas_"+_g.uuid(),this.slideel.append('<canvas id="'+this.canvasId+'" width="'+e.iWidth+'" height="'+e.iHeight+'" style="pointer-events:none"></canvas>'),this.canvas=document.getElementById(this.canvasId),this.canvas_width=e.iWidth,this.canvas_height=e.iHeight,this.canvas&&(this.ctx=this.canvas.getContext("2d")),this.useIndex&&this.slideel.children("img").hide()},drawCanvas:function(e,t){if(!e||e=="")return;var n=this;this.ctx||(this.ctx=this.canvas.getContext("2d"));if(!this.ctx)return!1;ctx=this.ctx,interaction_view.drawImg(n,e,t,ctx)},otherOnShow:function(){this.img_src.length&&(this._setCanvasLoopSwitch(),this.drawCanvas(this.img_src[this.currentIndex],this.currentIndex),this.autoplay&&this.timeline.play())},img_preload:function(e,t,n){var r=this;if(!r.slidelength)return;var i=r.model.loaded_index,s=1;r.slidelength==1&&(s=0);var o=i;if(i>r.slidelength-1){r.model.loaded_all=!0;return}var u=r.slidelength-i>=20?i+20-1:r.slidelength-1;r.model.loaded_index=u+1;var a=0,f=u-i+1;for(;i<=u;i++){if(interaction_view.iImgs[r.img_src[i]]){r.model.iImgs[i]=interaction_view.iImgs[r.img_src[i]],r.model.loaded[i]=!0,n&&a==s&&n(),++a>=f&&(t&&t(),e||r.img_preload());continue}r.model.iImgs[i]=new Image,r.model.iImgs[i].onload=function(){r.model.loaded[i]=!0,interaction_view.iImgs[this.src]=this,n&&a==s&&n(),++a>=f&&(e||r.img_preload())},r.model.iImgs[i].src=r.img_src[i]}}})});define("text!interaction_view/template/imageitem.js",[],function(){return'<%if(iDetail.iImg&&iDetail.iImg[0]){%>\n    <%if(typeof isSubOverlay!="undefined"&&isSubOverlay&&(typeof isLayerOverlay=="undefined"||!isLayerOverlay)){%>\n        <% if(iDetail.iMask){%>\n            <img draggable="false" class="Context" src="<%=iDetail.iImg[0].thumbnail%>" style="width:<%=iDetail.iMask_data.width%>px;height:<%=iDetail.iMask_data.height%>px;position:absolute;max-width:none;">\n        <%}else{%>\n            <img draggable="false" class="Context" src="<%=iDetail.iImg[0].thumbnail%>" style="width:100%;height:100%;position:absolute;">\n        <% } %>\n    <%}else{ %>\n        <% if(iDetail.iMask){%>\n            <img draggable="false" class="Context" src="<%=iDetail.iImg[0].picture%>" style="width:<%=iDetail.iMask_data.width%>px;height:<%=iDetail.iMask_data.height%>px;position:absolute;max-width:none;">\n        <%}else{%>\n            <img draggable="false" class="Context" src="<%=iDetail.iImg[0].picture%>" style="width:100%;height:100%;position:absolute;">\n        <% } %>\n    <%}%>\n<%}%>'});define("interaction_view/model/image",["interaction_view/model/base","text!interaction_view/template/imageitem.js"],function(){var e=require("text!interaction_view/template/imageitem.js");interaction_view.model.Image=interaction_view.model.Base.extend({defaults:{iType:"Image",iLock:!0,iVisibility:!0,iCommon:null,iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParentModel:null,iTemplate:null,iParentdiv:".interaction-view",iSync:!1,iZindex:"-1",callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Image({model:this})},setsyncmodel:function(){}}),interaction_view.view.Image=interaction_view.view.Base.extend({events:{},render:function(e){this.renderMask(),this.renderDraggable(),this.firstRender=!0,this.isEraserSet=!1},renderMask:function(){var e=this.getdetail();e.iMask&&(this.$el.children(".Element").children().css({translate:[e.iMask_data.x,e.iMask_data.y]}),this.iScrollview&&this.iScrollview.scrollTo(e.iMask_data.x,e.iMask_data.y))},preload:function(){},getLayerContentSize:function(){var e=this.getdetail(),t={};return e.iImg&&e.iImg.length>0?(t.width=e.iMask_data.width,t.height=e.iMask_data.height,t):null},setOtherDisplay:function(){var e=this.getdetail();e.iImg&&e.iImg.length>0&&e.iMask&&e.iMask_data.iSlipable&&(this.renderMask(),this.setMaskSlipable({items:this.$el.children(".Element").children("img"),containment:this.$el.children(".Element"),contentel:this.$el.children(".Element").children(),content_x:e.iMask_data.x,content_y:e.iMask_data.y})),e.iDisplay&&e.iImg&&e.iImg.length>0&&_g.ui.fitImage({fit:Number(e.iDisplay),width:e.iImg[0].width,height:e.iImg[0].height,items:this.$el.children(".Element").children("img")}),e.iFullview&&this.fullview(),e.iEraser&&(this.model._reset=!0,this.el_str=this.$el.children(".Element").html(),this.setEraser())},resetOtherStatus:function(){this.$el.removeClass("invisible noevents"),this.resetEraser(),this.resetDragDrop()},fullview:function(){if(typeof wx_permissions!="undefined"&&wx_permissions.previewImage)return;var e=this,t=this.getdetail();t.iImg&&t.iImg.length>0&&(this.$el.addClass("hasaction"),this.$el.children(".Element").on("click",function(n){opts={picture:t.iImg[0].picture,width:t.iImg[0].width,height:t.iImg[0].height,model:e.getGalleryModel(),index:e.model.get("GalleryIndex")},e.setFullView(opts)}))},setEraser:function(){var e=this.getdetail();if(!e.iEraser)return;var t=this.getcommon();this.$el.children(".Element").css("cursor","pointer"),this.$el.children(".Element").addClass("disableDragX disableDragY"),this.$el.find("img").first().is(":hidden")?this.isEraserSet=!1:(interaction_view.eraser.set(this.$el.find("img").first(),t.iWidth,t.iHeight,this),this.isEraserSet=!0)},resetEraser:function(){this.firstRender||this.onShow(),this.isEraserSet||this.setEraser(),this.firstRender=!1},isFullSwitch:function(){if(this.model.get("GalleryIndex")!=null)return!0},getGalleryModel:function(){var e=[];for(i=0;i<this.path.length;i++){if(this.path[i].type=="Gallery"){e.push(this.path[i]);break}e.push(this.path[i])}var t=interaction_view.getContainerModelByPath(e);return t},repaint:function(){this.$el.children(".Element").html(this.el_str)},onShow:function(){var e=this.getdetail();e.iEraser&&(this.repaint(),this.setEraser())},getDragCopy:function(){var e=$("<div></div>").addClass("DragCopy").attr({id:this.model.id+"_drag_copy"}).css({position:"absolute",opacity:this.$el.css("opacity")});return e.html($("<div/>").attr({style:this.$el.children(".Element").attr("style")})),e.children().html($("<img/>").attr({src:this.$el.find("img").attr("src"),style:this.$el.find("img").attr("style")})),e},getClientXY:function(e){return"ontouchend"in document?{x:e.clientX,y:e.clientY}:{x:e.gesture.center.pageX,y:e.gesture.center.pageY}},resetDragDrop:function(){if(!this.getdetail().draggable)return;var e=this;typeof e.DragDrops=="undefined"&&(e.DragDrops=e.model.page.iOverlaylist.where({iType:"DragDrop"}),!e.DragDrops.length&&(e.DragDrops=!1)),e.DragDrops&&(typeof e.MaxZindex=="undefined"&&(e.MaxZindex=parseInt(e.model.page.iOverlaylist.models[e.model.page.iOverlaylist.models.length-1].iview.$el.css("z-index"))),e.Status=0,this.getdetail().dragend==1&&(e.Status=2)),e.Pos={left:e.x,top:e.y},e.Drag_opacity=.8999,e.$el.siblings(".DragCopy").remove()},setDraggable:function(e,t,n,r){function c(){o&&(a=e.css("z-index"),o=!1),interaction_view.events.onDragStart(l),u=e.position(),f=e.css("opacity"),e.css({"z-index":i.MaxZindex+100,opacity:e.css("opacity")>=1?i.Drag_opacity:e.css("opacity")}),n(e),e.stop(!0,!0),i.resetDragDropStatus()}function h(t,n,r){if(!u||!u.left)return;var o=$.zoom?$.zoom:1,a=u.left+t/o,f=u.top+n/o,c,h=e.css("transform").split(",");s.limit=="vertical"?c={y:f}:s.limit=="horizontal"?c={x:a}:c={x:a,y:f},TweenMax.set(e,_.extend(c,{force3D:interaction_view.force3D})),interaction_view.events.onDragging(l),i.activeDragDrop(e,r)}function p(){interaction_view.events.onDragEnd(l),e.css({"z-index":a,opacity:e.css("opacity")-i.Drag_opacity<1e-5?f:e.css("opacity")}),r(e)}var i=this,s=this.getdetail(),o=!0,u,a=e.css("z-index"),f;e.data({Drop:t}).addClass("disableDragX disableDragY");var l={page_id:i.model.page.id,overlay_id:i.model.id,layer_id:i.model.get("layer_id")};if("ontouchend"in document){var d=!1,v=0,m=0;e.on("touchstart",function(e){e=e.originalEvent.touches[0],d=!0,v=e.clientX,m=e.clientY,c()}).on("touchmove",function(e){return e=e.originalEvent.touches[0],h(e.clientX-v,e.clientY-m,e),!1}).on("touchend touchcancel",function(e){e=e.originalEvent.touches[0],d&&p(),d=!1})}else e.hammer().on("dragstart",c).on("drag",function(e){h(e.gesture.deltaX,e.gesture.deltaY,e)}).on("dragend",p)},activeDragDrop:function(e,t){if(!this.DragDrops)return;var n=this,r=$.zoom?$.zoom:1,i=this.getClientXY(t);$.each(n.DragDrops,function(e,t){var s=t.iview.$el.children(".Element"),o={x:s.offset().left*r,y:s.offset().top*r},u={x:o.x+s.width()*r,y:o.y+s.height()*r};i.x>=o.x&&i.x<=u.x&&i.y>=o.y&&i.y<=u.y?(n.$el.parent().children("#"+n.model.id+t.id).length==0&&!t.iview.active&&n.trigger_dragin_event(t),t.iview.changeStatus(!1)):t.iview.changeStatus(!0)})},getDropXY:function(e){var t=e.iview.getcommon(),n=e.iview.$el.children(".Element").offset(),r=e.iview.$el.parents(".interaction-area:first").offset();return{x:n.left-r.left+t.iWidth/2,y:n.top-r.top+t.iHeight/2}},resetDragDropStatus:function(){var e=this;$.each(e.DragDrops,function(t,n){n.iview.Status=0;var r=e.$el.parent().children("[data-drop="+n.id+"]");if(r.length){n.iview.Status=2;var i=r.attr("data-drag");_.include(n.iview.getdetail().element_ids,i)&&(n.iview.Status=1)}})},renderDraggable:function(){function n(n){if(t.dragstart==1){var r=e.getDragCopy();n.before(r),TweenMax.to(r,0,{x:n.position().left,y:n.position().top,force3D:interaction_view.force3D})}e.Status==0&&(e.Pos=n.position())}function r(n){var r=0;$.each(e.DragDrops,function(i,s){if(s.iview.active){s.iview.changeStatus();var o=s.iview.getdetail(),u=e.$el.parent().children("#"+e.model.id+s.id);if(o.onlyright&&!_.include(o.element_ids,e.model.id)||u.length!=0)return r=1,u.length!=0&&t.dragin==0&&(r=3,n.css({"z-index":parseInt(s.iview.$el.css("z-index"))+1}),TweenMax.to(n,.4,e.getDropXY(s))),!1;r=2,s.iview.Status!=0&&e.old_transit_back(s),e.drag_dragin(s)}}),r<2&&e.drag_dragend(r==1?1:null)}var e=this,t=this.getdetail();if(!t.draggable)return;this.model._reset=!0,e.setDraggable(e.$el,null,n,r)},drag_dragend:function(e){var t=this.$el,n=t.position(),r=t.parent().children("#"+this.model.id+"_drag_copy");this.Status==1&&(this.Status=0),this.lastCopy&&this.lastCopy.remove()&&(this.lastCopy=null),(e||parseInt(this.getdetail().dragend))==1?(n=this.Pos,TweenMax.to(t,.4,{x:n.left,y:n.top})):this.Status==0&&(this.Pos=t.position()),TweenMax.to(r,.4,{x:n.left,y:n.top,opacity:0,force3D:interaction_view.force3D,onComplete:function(){r.remove()}})},drag_dragin:function(e){var t=this,n=this.getdetail(),r=t.$el.parent().children("#"+t.model.id+"_drag_copy");switch(parseInt(n.dragin)){case 0:t.Status==0&&(t.Status=1);if(t.$el.parent().children("#"+t.model.id+e.id).length==0){t.lastCopy&&t.lastCopy.remove()&&t.resetDragDropStatus();var i=t.getDragCopy().attr({id:t.model.id+e.id,"data-drop":e.id,"data-drag":t.model.id}).hide();t.$el.before(i),t.lastCopy=i}t.$el.css("z-index",parseInt(e.iview.$el.css("z-index"))+1),TweenMax.to(t.$el,.4,_.extend(t.getDropXY(e),{force3D:interaction_view.force3D,onComplete:function(){t.trigger_drop_event(e)}})),n.dragstart==1&&TweenMax.to(r,.4,_.extend(t.getDropXY(e),{opacity:0,force3D:interaction_view.force3D,onComplete:function(){r.remove()}}));break;case 1:n.dragstart!=1&&(r=t.getDragCopy(),t.$el.before(r)),r.attr({id:t.model.id+e.id,"data-drop":e.id,"data-drag":t.model.id}).css({"z-index":parseInt(e.iview.$el.css("z-index"))+1,opacity:r.css("opacity")-t.Drag_opacity<1e-5?1:r.css("opacity")}),TweenMax.to(r,0,{x:t.$el.position().left,force3D:interaction_view.force3D,y:t.$el.position().top}),TweenMax.to(t.$el,.4,{x:t.Pos.left,y:t.Pos.top,force3D:interaction_view.force3D}),TweenMax.to(r,.4,_.extend(t.getDropXY(e),{force3D:interaction_view.force3D,onComplete:function(){t.trigger_drop_event(e),t.renderCopyDraggable(e,r)}}));break;case 2:r.remove(),r=t.getDragCopy().attr({id:t.model.id+e.id,"data-drop":e.id,"data-drag":t.model.id}).hide(),t.$el.before(r),TweenMax.to(t.$el,0,{x:t.Pos.left,y:t.Pos.top,force3D:interaction_view.force3D,onComplete:function(){t.trigger_drop_event(e)}})}},renderCopyDraggable:function(e,t){function r(){n.getdetail().dragstart==0&&n.$el.hide()}var n=this;this.setDraggable(t,e,r,n.copy_dragend)},copy_dragend:function(e){var t=this,n=this.getdetail(),r=e.data("Drop"),i=0;$.each(t.DragDrops,function(n,s){if(s.id==r.id)s.iview.active&&(TweenMax.to(e,.4,t.getDropXY(r)),s.iview.changeStatus(),i=1);else if(s.iview.active){r.iview.Status=0,s.iview.changeStatus();var o=s.iview.getdetail();if(o.onlyright&&!_.include(o.element_ids,t.model.id))return i=1,t.old_transit_back(r,t.model.id),!1;s.iview.Status!=0&&t.old_transit_back(s),TweenMax.to(e,.4,t.getDropXY(s)),t.$el.siblings("#"+t.model.id+s.id).remove(),e.attr({id:t.model.id+s.id,"data-drop":s.id,"data-drag":t.model.id}).css("z-index",parseInt(s.iview.$el.css("z-index"))+1),e.data("Drop",s),i=1,t.trigger_drop_event(s)}}),n.dragstart==0&&t.$el.show();if(i==0){var s=e.position();n.dragend==0&&n.dragstart==1?(TweenMax.to(e,.4,{opacity:0,force3D:interaction_view.force3D,onComplete:function(){e.remove()}}),TweenMax.to(t.$el,.4,{x:s.left,y:s.top,force3D:interaction_view.force3D})):(TweenMax.to(t.$el,0,{x:e.position().left,y:e.position().top,force3D:interaction_view.force3D}),n.dragend==1&&n.dragstart==1?TweenMax.to(e,0,{x:t.Pos.left,y:t.Pos.top,force3D:interaction_view.force3D,onComplete:function(){TweenMax.to(e,.4,{opacity:0,force3D:interaction_view.force3D,onComplete:function(){e.remove()}})}}):e.remove()),t.drag_dragend()}},old_transit_back:function(e,t){var n=e.iview.$el.parent().children("[data-drop="+e.id+"]"),t=t||n.attr("data-drag");n.attr("id",t+"_drag_copy"),this.model.page.iOverlaylist.where({id:t})[0].iview.drag_dragend(1)},trigger_dragin_event:function(e){interaction_view.events.onDragDrop(e,this.model,0)},trigger_drop_event:function(e){interaction_view.events.onDragDrop(e,this.model),interaction_view.events.onDragDropGroup(e)}})});define("interaction_view/model/page",["_g/mvc","interaction_view/view/page"],function(){var e={defaults:{iType:"Page",position:0,description:"",title:"untitled",picture:null,preview:'<img src="/staticfs/admin-epub360/img/thumb.png">',thumbnail:null,width:null,height:null,bg_color:"#FFFFFF",bg_opacity:1,show_master:!0},autoIndex:!0,callback:function(){this.get("type")!="page_group"&&(this.iOverlaylist=new interaction_view.collection.list,this.iAnimationlist=new interaction_view.collection.Animation,this.iActionlist=new interaction_view.collection.Action,this.ipreloadlist=new interaction_view.collection.Preload,this.ipreloadlist.pageid=this.iOverlaylist.pageid=this.iAnimationlist.pageid=this.iActionlist.pageid=this.id,this.iAnimationlist.iPage_id=this.id,this.iAnimationlist.page=this)},overlays:[],actions:[],animations:[]};return _g.mvc.createModel(e)});define("interaction_view/collection/page",["_g/mvc","interaction_view/model/page"],function(){var e={enableSync:!1,model:require("interaction_view/model/page"),getPages:function(){var e=_g.mvc.getTreeModels(interaction_view.ipagelist);return e=_.reject(e,function(e){return e.toJSON().type=="page_group"}),e},getPagesJSON:function(){var e=_g.mvc.getTreeModels(interaction_view.ipagelist);return e=_.reject(e,function(e){return e.toJSON().type=="page_group"}),e=_.map(e,function(e){return e.toJSON()}),e},getPage:function(e){return _g.mvc.getTreeModel(interaction_view.ipagelist,e)},getIndexPages:function(){var e=this.getPages();return _.filter(e,function(e){return e.get("is_index")})},getElement:function(e,t,n){if(interaction_view.ipagelist.getPage(t)||interaction_view.imasterlist.get(t)){var r=interaction_view.ipagelist.getPage(t)||interaction_view.imasterlist.get(t);return r.iOverlaylist.get(n)}return e.iOverlaylist.get(n)}};return _g.mvc.createCollection(e)});define("interaction_view/model/layer",["interaction_view/model/page"],function(){var e=require("interaction_view/model/page"),t=e.extend({defaults:{iType:"Layer",position:0,description:"",title:"untitled",picture:null,preview:'<img src="/staticfs/admin-epub360/img/thumb.png">',thumbnail:null,width:null,height:null,layer_width:1024,layer_height:768,bg_color:"#FFFFFF",bg_opacity:1},callback:function(){this.actions=this.get("actions"),this.animations=this.get("animations"),this.overlays=this.get("overlays")}});return t});define("interaction_view/collection/layer",["interaction_view/collection/page","interaction_view/model/layer"],function(){var e=require("interaction_view/collection/page"),t=e.extend({model:require("interaction_view/model/layer")});return t});define("interaction_view/model/master",["interaction_view/model/page"],function(){var e=require("interaction_view/model/page"),t=e.extend({defaults:{iType:"Master",position:0,description:"",title:"untitled",picture:null,preview:'<img src="/staticfs/admin-epub360/img/thumb.png">',thumbnail:null,width:null,height:null,bg_color:"#FFFFFF",bg_opacity:1,pageno_horizontal:{show:!1,x:500,y:20},pageno_vertical:{show:!1,x:20,y:300}}});return t});define("interaction_view/view/master",["interaction_view/view/page"],function(){var e=require("interaction_view/view/page"),t=$.extend({},e,{template:null,className:null,containment:null,wrap:null,wrapClassName:null,autoRender:!1,position:1,parseData:null,isMaster:!0});return t});define("interaction_view/collection/master",["interaction_view/collection/page","interaction_view/model/master","interaction_view/view/master"],function(){var e=require("interaction_view/collection/page"),t=e.extend({model:require("interaction_view/model/master")});return t});define("interaction_view/model/background",["interaction_view/model/page"],function(){var e=require("interaction_view/model/page"),t=e.extend({defaults:{iType:"Background",position:0,description:"",title:"untitled",picture:null,preview:'<img src="/staticfs/admin-epub360/img/thumb.png">',thumbnail:null,width:null,height:null,bg_color:"#FFFFFF",bg_opacity:1,pageno_horizontal:{show:!1,x:500,y:20},pageno_vertical:{show:!1,x:20,y:300}}});return t});define("interaction_view/view/background",["interaction_view/view/page"],function(){var e=require("interaction_view/view/page"),t=$.extend({},e,{template:null,className:null,containment:null,wrap:null,wrapClassName:null,autoRender:!1,position:1,parseData:null,isBackground:!0,prepareLoad:function(){var e=this,t=this.model;if(!t)return;e.animations=_.map(e.animations,function(t){return t.pageid=e.model.id,t.pagetype="background",t}),e.model.iAnimationlist.reset(e.animations),overlays=_.filter(e.overlays,function(t){return t.pageid=e.model.id,t.pagetype="background",interaction_view.model[t.iType]}),overlays=_.map(overlays,function(e){return new interaction_view.model[e.iType](e)}),e.model.iOverlaylist.reset(overlays),e.model.iOverlaylist.each(function(e){e.iview.setZindex()}),e.actions=_.map(e.actions,function(t){return t.pageid=e.model.id,t.pagetype="background",t}),e.model.iActionlist.reset(e.actions)}});return t});define("interaction_view/collection/background",["interaction_view/collection/page","interaction_view/model/background","interaction_view/view/background"],function(){var e=require("interaction_view/collection/page"),t=e.extend({model:require("interaction_view/model/background")});return t});define("interaction_view/model/component",["interaction_view/model/page"],function(){var e=require("interaction_view/model/page"),t=e.extend({defaults:{iType:"Component",bg_color:"#FFFFFF",bg_opacity:1},callback:function(){this.actions=this.get("actions"),this.animations=this.get("animations"),this.overlays=this.get("overlays")}});return t});define("interaction_view/collection/component",["interaction_view/collection/page","interaction_view/model/component"],function(){var e=require("interaction_view/collection/page"),t=e.extend({model:require("interaction_view/model/component")});return t});define("interaction_view/model/doc",["_g/mvc","interaction_view/collection/page","interaction_view/view/page","interaction_view/collection/layer","interaction_view/collection/master","interaction_view/collection/background","interaction_view/collection/component"],function(){var e={defaults:{id:"doc",play_mode:0},autoUpdate:!1,fetchUrl:context_url+"index.json",staticFetchUrl:"/staticfs/common/js/interaction_view/data/index.json",parse:function(e){var t=this;console.log("fetch data:"+e);if(e.code==200)return e.data?(interaction_view.size={x:e.data.width||1024,y:e.data.height||768},interaction_view.screen_mode=e.data.screen_mode,e.data.force_3d&&interaction_view.ismobile?interaction_view.force3D="auto":interaction_view.force3D=!1,this.initMasters(e),workEnd("-------- 1.1.1 touchinit 1 initMasters --------"),this.initBackgrounds(e),workEnd("-------- 1.1.2 touchinit 1 initBackgrounds --------"),this.initLayers(e),workEnd("-------- 1.1.3 touchinit 1 initLayers --------"),this.initPages(e),workEnd("-------- 1.1.4 touchinit 1 initPages --------"),this.initComponents(e),this.initApplications(e),workEnd("-------- 1.1.5 touchinit 1 initApplications --------"),!interaction_view.ismobile&&!interaction_view.forpreview&&(e.data.bg_color=e.data.desktop_bg_color!=undefined?e.data.desktop_bg_color:e.data.bg_color,e.data.bg_opacity=e.data.desktop_bg_opacity!=undefined?e.data.desktop_bg_opacity:e.data.bg_opacity,e.data.screen_mode=e.data.desktop_screen_mode!=undefined?e.data.desktop_screen_mode:e.data.screen_mode,e.data.show_excontent=e.data.desktop_show_excontent!=undefined?e.data.desktop_show_excontent:e.data.show_excontent,e.data.adapt=e.data.desktop_adapt!=undefined?e.data.desktop_adapt:e.data.adapt),_.omit(e.data,"layers","masters","chapter","organization","applications")):{}},initMasters:function(e){var t=require("interaction_view/collection/master");e.data.masters||(e.data.masters=[]),interaction_view.imasterlist=_g.mvc.createTreeByData({collection:t,data:e.data.masters})},initBackgrounds:function(e){var t=require("interaction_view/collection/master");e.data.backgrounds||(e.data.backgrounds=[]),interaction_view.ibackgroundlist=_g.mvc.createTreeByData({collection:t,data:e.data.backgrounds})},initLayers:function(e){var t=require("interaction_view/collection/layer");e.data.layers||(e.data.layers=[]),interaction_view.ilayerlist=_g.mvc.createTreeByData({collection:t,data:e.data.layers})},initComponents:function(e){var t=require("interaction_view/collection/component");e.data.components||(e.data.components=[]),interaction_view.iComponentlist=_g.mvc.createTreeByData({collection:t,data:e.data.components})},initPages:function(e){var t=this,n,r=require("interaction_view/collection/page");n=e.data.chapter,workEnd("-------- 1.1.4.2 touchinit pagedata parseOrgnization--------"),interaction_view.ipagelist=_g.mvc.createTreeByData({collection:r,data:n}),workEnd("-------- 1.1.4.3 touchinit interaction_view ipagelist--------"),_g.mvc.createTreeView({collection:interaction_view.ipagelist,view:require("interaction_view/view/page"),containment:"div.slides",wrap:null}),workEnd("-------- 1.1.4.4 touchinit interaction_view createTreeView--------")},initApplications:function(e){interaction_view.applications=e.data.applications,interaction_view.actionforapp={},_.each(interaction_view.applications,function(e){e.type=="form"&&interaction_view.application.initForm(e),e.actions&&e.actions.length&&(interaction_view.actionforapp[e.id]=new interaction_view.collection.Action,interaction_view.actionforapp[e.id].add(e.actions),interaction_view.actionforapp[e.id].each(function(e){e.iview.render()}))})},callback:function(){}};return _g.mvc.createModel(e)});define("text!interaction_view/template/preload.js",[],function(){return'<img src="<%=file%>" width="1" height="1" id="<%=id%>"/>'});define("interaction_view/model/preload",["interaction_view/model/base","text!interaction_view/template/preload.js"],function(){var e=require("text!interaction_view/template/preload.js");interaction_view.model.Preload=interaction_view.model.Base.extend({defaults:{iType:"Preload",iCommon:null,iDetail:null,iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!0,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null,loaded:!1},setcollection:function(){this.pageid=this.get("pageid");if(this.get("pagetype")=="LayerRef"){var e=this.get("parentpageid"),t=this.get("layerid"),n=interaction_view.getParentpage(e);this.page=n.iOverlaylist.get(this.pageid).layer[t]}else this.get("isSubOverlay")?(this.path=this.get("path"),this.page=interaction_view.getContainerModelByPath(this.path)):this.page=interaction_view.getParentpage(this.pageid);this.page.ipreloadlist.get(this.id)||this.page.ipreloadlist.add(this)},setview:function(e){this.pageid=this.get("pageid");if(this.get("pagetype")=="LayerRef"){var t=this.get("parentpageid"),n=this.get("layerid"),r=interaction_view.getParentpage(t);this.page=r.iOverlaylist.get(this.pageid).layer[n]}else this.get("isSubOverlay")?(this.path=this.get("path"),this.page=interaction_view.getContainerModelByPath(this.path)):this.page=interaction_view.getParentpage(this.pageid);this.get("pagetype")=="master"&&(this.isMasterOverlay=!0),this.iview=new interaction_view.view.Preload({model:this})},setsyncmodel:function(){}}),interaction_view.collection.Preload=interaction_view.collection.Base.extend({preloadcheck:function(e,t,n){var r=this.where({loaded:!0});!interaction_view.ismobile&&t==0&&interaction_view.message("alert","图像或媒体资源加载失败，可能会影响动画效果"),n.iview.afterpreload(e);if(this.where({loaded:false}).length==0)if(this.pagetype=="LayerRef"){var i=this.parentpageid,s=this.layerid,o=interaction_view.getParentpage(i);refmodel=o.iOverlaylist.get(this.pageid),refmodel.iview.afterlayerload(s)}else if(this.subcontainer){var u=interaction_view.getContainerModelByPath(this.path);u.iview.afterSubOverlayPreload()}else interaction_view.finishPagePreload(this.pageid)},preload:function(){this.each(function(e){e.get("loaded")||e.iview.render()})}}),interaction_view.view.Preload=interaction_view.view.Base.extend({events:{},initstart:function(){},renderDynamicElement:function(){},render:function(){var e=this,t=this.elementmodel=e.model.page.iOverlaylist.get(this.model.get("overlay_id"));if(this.model.get("elementtype")=="Audio")console.info("Audio"),this.audioPreload();else if(this.model.get("elementtype")=="Video")this.videoPreload();else if(this.model.get("elementtype")=="LayerRef"||this.model.get("elementtype")=="LayerSlide"||this.model.get("elementtype")=="ComponentRef")this.layerPreload(this.model);else if(this.model.get("subcontainer"))this.subcontainerPreload(this.model);else{var n=e.model.toJSON().file;n.indexOf("qn.media")>0&&n.indexOf("origin.jpg")>0&&(n+="_501.png"),$('img[id="'+this.model.id+'"]').attr("src",n),e.model.set("loaded",!0),workEnd("-------- 4 "+this.model.id+" = "+n),e.model.page.ipreloadlist.preloadcheck(e.model.toJSON().file,!0,t)}},audioPreload:function(){interaction_view.media.audio.init(this.model,this.elementmodel,this.model.isMasterOverlay)},videoPreload:function(){var e=this;interaction_view.media.video.init(this.model,this.elementmodel,this.model.toJSON().file)},layerPreload:function(){this.elementmodel.iview.loadLayer(this.model)},subcontainerPreload:function(){this.elementmodel.iview.loadSubOverlay(this.model)}}),interaction_view.ipreloadlist=new interaction_view.collection.Preload});define("interaction_view/model/richtext",["interaction_view/model/base"],function(){interaction_view.model.RichText=interaction_view.model.Base.extend({defaults:{iType:"RichText",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.RichText({model:this})},setsyncmodel:function(){}}),interaction_view.view.RichText=interaction_view.view.Base.extend({events:{},render:function(e){interaction_view.ismobile,this.scrollEl=this.$el.children(".Element"),this.model._reset=!0},resetOtherStatus:function(){var e=this;if(_g.ui.isOverflowed(this.$el.children(".Element")).y){if(!this.$el.children(".Element").hasClass("disableDragY")){var t=this.$el.children(".Element").height();this.$el.children(".Element").wrapInner('<div class="iContent"></div>');var n=_g.ui.isOverflowed(this.$el.children(".Element")).y-t;this.scrollView=new IScroll(this.$el.children(".Element")[0],{mouseWheel:!0,click:!0,probeType:3}),this.scrollView.on("scroll",function(){console.log(this.y),n&&n>0&&(this.y>0?this.y>30&&e.scrollEl.addClass("is_exceededY"):Math.abs(this.y)-n>30&&e.scrollEl.addClass("is_exceededY"))}),this.scrollEl=this.$el.children(".Element"),this.$el.children(".Element").addClass("disableDragY iMouseWheel disableMouseWheelY")}this.$el.children(".Element").removeClass("is_exceededX"),this.$el.children(".Element").removeClass("is_exceededY")}},otherOnShow:function(){this.resetOtherStatus()}})});define("interaction_view/model/slide",["interaction_view/model/base"],function(){interaction_view.model.Slide=interaction_view.model.Base.extend({defaults:{iType:"Slide",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSlideNumber:!0,isSlide:!0,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){var t=this.get("iDetail");t.show_title&&this.setSubOverlays(),this.iview=new interaction_view.view.Slide({model:this})},setsyncmodel:function(){}}),interaction_view.view.Slide=interaction_view.view.Base.extend({events:{},render:function(e){var t=this,n=this.getdetail();this.renderBackGroud(),this.currentSlideIndex=null,this.model.on("slideTo",function(e){if(t.currentSlideIndex!=null&&t.currentSlideIndex==e)return!1;t.preloaded&&(interaction_view.events.onChangeTo(t.model.get("pageid"),t.model.id,e),t.currentSlideIndex=e,t.setTitle(e)),t.rmbLast=e,n.iRememberLast&&interaction_view.environment.Paragraph.state()&&t.addToUrl(e)}),this.model._reset=!0},getSlideLength:function(){var e=this.getdetail();return e.iImg?e.iImg.length:0},preload:function(){var e=this,t=this.getdetail(),n;this.checkImglist=_.pluck(t.iImg,_g.getUrlParameterByName("-playmode")=="1"?"thumbnail":"picture"),this.preloaded=!1;var r=[];t.iImg&&t.iImg.length&&(_.each(t.iImg,function(t){_g.getUrlParameterByName("-playmode")=="1"?n=t.thumbnail:n=t.picture;var i=e.sendToPreload({file:n});r.push(i.id)}),t.show_title&&this.sendToPreload({file:null,subcontainer:!0,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")})),this.model.set("preload_id",r)},checkImgload:function(e){return this.checkImglist=_.reject(this.checkImglist,function(t){return t==e}),this.checkImglist.length==0?!0:!1},afterpreload:function(e){if(e&&this.preloaded)return;e&&(this.preloaded=this.checkImgload(e));if(this.preloaded){var t=this,n=this.getdetail();this.setZindex(),this.setElementDisplay(),this.setSlideImageDisplay(),this.slideel=this.$el.children(".Element").find(".slidecontent").first(),this.slidelength=this.getdetail().iImg.length,this.fullview(),this.playAnimation(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style");if(n.iRememberLast&&n.iFade!="Flow"){t.rmbLast=t.getFromUrl(),t.setElementTo(t.rmbLast);return}}},afterSubOverlayPreload:function(){this.preloadmodel&&(this.model.iOverlaylist.each(function(e){e.iview.preloaded||e.iview.afterpreload()}),this.model.iActionlist.each(function(e){e.iview.render()}),this.setTitle(0),this.preloadmodel.set("loaded",!0),this.preloadmodel.page.ipreloadlist.preloadcheck(null,!0,this.model))},playAnimation:function(){this.timeline&&this.timeline.clear();var e=this,t=0,n=this.getdetail(),r=n.iSlidetype,i=!1;this.$el.children(".Element").is(":hidden")&&(i=!0),this.delay=Number(n.iInterval)||2,this.autoplay=n.iAutoplay;var s=n.iRepeat?-1:0;this.iFade=n.iFade||0,this.timeline=new TimelineMax({paused:!0,repeat:s,onComplete:this.setRewind}),this.repeat=s,this.iRewind=n.iRewind,this.slipable=n.iSlipable,this.canSlip=!0,this.iDisplay=n.iDisplay,this.setTimeline();if(n.iFade=="Flow")return;this.autoplay?this.model._autoplay=!0:this.setSlideDisplay(0),this.onChangeSlideTo(0),this.slipable&&(this.control(),this.autoplay||this.$el.attr("data-iSlipable",!0))},_autoplay:function(){var e=!1;this.$el.children(".Element").is(":hidden")&&(e=!0),this.timeline&&(!e||interaction_view.ismobile)&&this.timeline.play(0)},setTimeline:function(){if(this.iFade=="Fade"||0)this.setFade();else if(this.iFade=="Slip")this.slideel.css("overflow","hidden"),this.setSlip();else if(this.iFade=="None")this.setNone();else{if(this.iFade!="Flip"){if(this.iFade=="Flow"){this.setFlowAll();return}return}this.iDisplay==2&&(this.slideel.wrapInner('<div class="slidewrap" style="width:100%;height:100%;position:absolute;"></div>'),this.slideel=this.slideel.children(".slidewrap")),this.setFlip()}this.slideel.children().first().css({opacity:1,left:0,top:0}).nextAll().css("opacity",0)},setFlowAll:function(){function o(e){var t=$(e).height()||r/e.width*e.height,n=$("<canvas></canvas>").attr({width:r,height:t}).css({"float":"left"});$(e).after(n),TweenMax.to(n,0,{transform:"matrix(1, 0, 0, -1, 0, 0)"});var i=n[0].getContext("2d");i.drawImage(e,0,0,r,t);var s=i.createLinearGradient(0,0,0,t);i.globalCompositeOperation="destination-in",s.addColorStop(1,"rgba(0,0,0,0.4)"),s.addColorStop(.6,"rgba(0,0,0,0)"),s.addColorStop(0,"rgba(0,0,0,0)"),i.fillStyle=s,i.fillRect(0,0,r,t)}function a(){u++;if(e.slidelength<=u){e.slideel.children().find("img").css({width:r}).each(function(e,t){o(t)}),e.slideel.children().animate({opacity:1});var n=e.slideel.parents("section.Presentation:first").attr("style");e.slideel.parents("section.Presentation:first").css({display:"block",visibility:"hidden"}),e.CoverFlow=e.slideel.children().coverflow({active:Math.floor((e.slidelength-1)/2),overlap:.3,perspectiveY:22,duration:300,beforeselect:function(t,n){e.model.trigger("slideTo",n.index)},select:function(t,n){e.currentIndex=n.index}}).width("+=100").height("100%"),e.slideel.children().children().each(function(e,n){var i=$(n).find("img").height();$(n).width(r),$(n).children().css({position:"absolute"}),$(n).find("img").css({bottom:t*.3+"px"}),$(n).find("canvas").css({bottom:t*.3-i+"px"})}),e.slideel.parents("section.Presentation:first").attr("style",n),e.setFlow(),f(),i.iRememberLast&&(e.rmbLast=e.getFromUrl(),e.setElementTo(e.rmbLast))}}function f(){if(e.slipable){var t=["mousedown","mousemove","mouseup"];e.isTouch()&&(t=["touchstart","touchmove","touchend touchcancel"]);var n=e.CoverFlow.parent().width();e.CoverFlow.on(t[0],function(r){function u(t){e.isTouch()&&(t=t.originalEvent.touches[0]);var r=(t.clientX-i)/n;return e.isTouch()&&(r*=2),r=Math.round(r*e.slidelength),r=o-r,r<0&&(r=0),r>=e.slidelength&&(r=e.slidelength-1),e.CoverFlow.coverflow("select",r),s=!0,!1}e.isTouch()&&(r=r.originalEvent.touches[0]);var i=r.clientX,s=!1,o=e.CoverFlow.children(".ui-state-active").index();$(document).on(t[1],u),$(document).one(t[2],function(){function n(){e.CoverFlow.data("CoverFlowDisableClick",!1)}return $(document).off(t[1],u),s&&e.CoverFlow.data("CoverFlowDisableClick",!0)&&setTimeout(n,10),!1}),e.isTouch()&&!s&&e.CoverFlow.coverflow("select",$(r.target).parent().index());if(!e.isTouch())return!1});var r=e.getdetail().iSlidetype?e.getdetail().iSlidetype:0;r=="横向"||Number(r)==0?e.$el.children(".Element").addClass("enableMouseWheelX disableDragX"):e.$el.children(".Element").addClass("enableMouseWheelY disableDragY")}}var e=this,t=this.getcommon().iHeight,n=this.getcommon().iWidth,r=n*.7,i=this.getdetail();e.slideel.children().removeAttr("style").wrap("<div></div>"),e.slideel.wrapInner("<div></div>"),e.slideel.children().css({opacity:0});var s=_.pluck(i.iImg,_g.getUrlParameterByName("-playmode")=="1"?"thumbnail":"picture");_.each(s,function(e,n){var i=new Image;i.src=e,i.onload=function(){i.height/i.width*r>t*.7&&(r=t*.7/i.height*i.width),a()}});var u=0},isTouch:function(){return"ontouchend"in document},testControl:function(){return!0},resetOtherStatus:function(){if(!this.slideel)return;var e=this,t=this.getdetail();t.iFade!="Flow"&&this.slideel.children().first().css({opacity:1,left:0,top:0}),this.autoplay=t.iAutoplay,this.currentIndex=0,this.currentSlideIndex=null,this.changeSlideNumber(),this.$el.children(".Element").removeClass("is_exceededX"),this.$el.children(".Element").removeClass("is_exceededY");if(this.timeline){var n=Math.floor((this.slidelength-1)/2);this.timeline.pause(1e-5);if(t.iRememberLast){e.rmbLast=e.getFromUrl(),e.setElementTo(e.rmbLast);return}if(t.iFade=="Flow"&&this.CoverFlow){this.currentIndex=n;try{this.CoverFlow.coverflow("select",n),this.currentIndex=n}catch(r){}}if(this.autoplay&&(!this.$el.children(".Element").is(":hidden")||interaction_view.ismobile)){if(t.iFade=="Flow"){this.timeline.play((n-1)*.3+n*this.delay);return}this.timeline.play(0)}else this.setSlideDisplay(0)}},fullview:function(){var e=this,t=this.getdetail();if(t.iFullview&&t.iImg&&t.iImg.length){this.$el.addClass("hasaction");if(t.iFade=="Flow"){e.isTouch()?e.slideel.hammer().on("tap",".ui-state-active",function(){e.fullviewIndex($(this).index())}):e.slideel.on("click",".ui-state-active",function(){e.fullviewIndex($(this).index())});return}this.$el.children(".Element").on("click",function(t){return e.stopFullviewByFlow?(e.stopFullviewByFlow=!1,!1):e.slipable&&!$(t.target).is(t.currentTarget)?!1:(e.currentIndex!=null&&e.currentIndex!="undefined"&&e.fullviewIndex(e.currentIndex),!1)})}},isFullSwitch:function(){var e=this.getdetail();return e.iSlipable},preview_left:function(e){e>0&&this.fullviewIndex(e-1)},preview_right:function(e){var t=this.getdetail();e<t.iImg.length-1&&this.fullviewIndex(e+1)},setTitle:function(e){var t=this.getdetail();if(!t.show_title)return;if(t.iImg&&t.iImg.length&&t.iImg[e]){var n=this.model.get("suboverlays"),r=interaction_view.formatLabel({text:t.iImg[e].title,font_size:n[0].iDetail.font_size,text_color:n[0].iDetail.text_color,iPosition:n[0].iDetail.iPosition});this.$el.find(".iTextLabel.Element").html(r)}},getFromUrl:function(e){var t=_g.getUrlParameterByName(this.model.id,e);return t||(t=_g.getHashParameterByName(this.model.id)),t},addToUrl:function(e){var t=this.getdetail();if(!t.iRememberLast)return!1;typeof message_link=="undefined"&&(message_link=document.location.href,interaction_view.weixin.share()),typeof e=="undefined"&&(e=this.currentIndex);var n=0,r=this.model.id+"="+encodeURI(e),i=_g.getUrlParameterByName(this.model.id,message_link);if(!i){var s="?";message_link.indexOf("?")>=0&&(s="&"),message_link+=s+r,interaction_view.weixin.share()}else encodeURI(i)!=encodeURI(e)?(message_link=_g.replaceUrlParameterByName(this.model.id,r,message_link),interaction_view.weixin.share()):n=1;if(!interaction_view.forpreview){var o=_g.getHashParameterByName(this.model.id);o?encodeURI(o)!=encodeURI(e)?window.history.replaceState({},"",_g.replaceHashParameterByName(this.model.id,r)):n=1:window.history&&(document.location.hash?window.history.replaceState({},"",document.location.hash+="&"+r):window.history.replaceState({},"","#"+r))}return n?!1:!0},setControl:function(e){var t=this.getdetail();this.addToUrl(),this.control(),this.canSlip=!0,!e&&!this.slipable&&(this.canSlip=!1)}})});define("interaction_view/model/video",["interaction_view/model/base"],function(){interaction_view.model.Video=interaction_view.model.Base.extend({defaults:{iType:"Video",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null,iBackground:"rgba(62,189,255,0.5)",iResourcesProperties:[{id:"iImg",type:"single"}],iAnimationProperties:[{id:"iAnimation",type:"object"}]},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Video({model:this})},setsyncmodel:function(){},getFile:function(){var e=this.get("iDetail");return e.iFile&&e.iFile[0]?e.iFile[0].file:null}}),interaction_view.view.Video=interaction_view.view.Base.extend({events:{},render:function(e){this.file,this.model._reset=!0},setOtherDisplay:function(){this.model.media&&interaction_view.media.pause(this.model)},preload:function(){var e,t=this.getdetail();t.iFile&&t.iFile[0]&&(typeof epub360!="undefined"&&epub360.settings&&epub360.settings.disable_stream_media?e=t.iFile[0].file:typeof cbt_data=="undefined"||interaction_view.forpreview?_g.getUrlParameterByName("-playmode")=="1"?e=(t.iFile[0].file||t.iFile[0].content)+"_video.m3u8":_g.getUrlParameterByName("-playmode")=="2"?e=(t.iFile[0].file||t.iFile[0].content)+"_origin.mp4":interaction_view.ismobile?e=(t.iFile[0].file||t.iFile[0].content)+"_origin.mp4":e=(t.iFile[0].file||t.iFile[0].content)+"_videohd.m3u8":e=t.iFile[0].file||t.iFile[0].content,this.file=e),this.file&&(this.preloadmodel=this.sendToPreload({file:this.file}))},resetOtherStatus:function(){if(!this.model.hided&&this.model.media){this.model.hls?interaction_view.media.video.resetH(this.model,this):interaction_view.media.video.reset(this.model);var e=this.model.get("iDetail").iAutohide;e==null&&(e=!0),e?this.$el.addClass("hide"):this.model.get("iDetail").iControl&&this.$el.find(".jwdisplayIcon").css({opacity:1})}}})});define("interaction_view/model/button",["interaction_view/model/base"],function(){interaction_view.model.Button=interaction_view.model.Base.extend({defaults:{iType:"Button",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){var t=this.get("iDetail");t.isSwitch&&(this.isSwitch=!0),this.iview=new interaction_view.view.Button({model:this})},setsyncmodel:function(){}}),interaction_view.view.Button=interaction_view.view.Base.extend({events:{},render:function(e){this.model._reset=!0},preload:function(){this.preloaded=!1,this.checkImglist=[];var e=this.getdetail(),t=[null,null];if(e.iconNormal&&e.iconNormal[0]){this.checkImglist.push(e.iconNormal[0].picture);var n=this.sendToPreload({file:e.iconNormal[0].picture,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")});t[0]=n.id}if(e.iconActive&&e.iconActive[0]){this.checkImglist.push(e.iconActive[0].picture);var n=this.sendToPreload({file:e.iconActive[0].picture,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")});t[1]=n.id}this.model.set("preload_id",t)},checkImgload:function(e){return this.checkImglist=_.reject(this.checkImglist,function(t){return t==e}),this.checkImglist.length==0?!0:!1},afterpreload:function(e){if(e&&this.preloaded)return;e&&!this.preloaded&&(this.preloaded=this.checkImgload(e)),this.preloaded&&(this.setZindex(),this.setElementDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style"))},setOtherDisplay:function(){this.active=!1,this.buttonon=!1;var e=this;this.$el.css("cursor","pointer");var t=this.getdetail();if(t.isSwitch)this.$el.on("click",function(t){e.changeStatus()});else{if(interaction_view.ismobile)var n="touchstart",r="touchend";else var n="mousedown",r="mouseup";this.$el.on(n,function(t){e.buttonon=!0,e.changeStatus()}),this.$el.on(r,function(t){e.buttonon&&(e.buttonon=!1,e.changeStatus())})}},changeStatus:function(){var e=this.getdetail(),t=this;if(!t.active)t.$el.find("img.iconActive").show(),t.$el.find("img.iconNormal").hide(),t.active=!0;else{if(t.groupcontrol&&e.isSwitch)return;if(t.model.get("isTabBarButton"))return;t.$el.find("img.iconActive").hide(),t.$el.find("img.iconNormal").show(),t.active=!1}},setActiveStatus:function(){var e=this;e.$el.find("img.iconActive").show(),e.$el.find("img.iconNormal").hide(),e.active=!0},resetOtherStatus:function(){this.resetButtonStatus()},resetButtonStatus:function(){this.$el.find("img.iconActive").hide(),this.$el.find("img.iconNormal").show(),this.active=!1}})});define("interaction_view/model/map",["interaction_view/model/base"],function(){interaction_view.model.Map=interaction_view.model.Base.extend({defaults:{iType:"Map",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Map({model:this})},setsyncmodel:function(){}}),interaction_view.view.Map=interaction_view.view.Base.extend({events:{},render:function(e){}})});define("interaction_view/model/pay",["interaction_view/model/base"],function(){interaction_view.model.Pay=interaction_view.model.Base.extend({defaults:{iType:"Pay",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Pay({model:this})},setsyncmodel:function(){}}),interaction_view.view.Pay=interaction_view.view.Base.extend({events:{},render:function(e){}})});define("interaction_view/model/link",["interaction_view/model/base"],function(){interaction_view.model.Link=interaction_view.model.Base.extend({defaults:{iType:"Link",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Link({model:this})},setsyncmodel:function(){}}),interaction_view.view.Link=interaction_view.view.Base.extend({events:{},render:function(e){}})});define("interaction_view/view/layer",["interaction_view/view/page"],function(){var e=require("interaction_view/view/page"),t=$.extend({},e,{template:null,className:null,containment:null,wrap:null,wrapClassName:null,autoRender:!1,position:1,parseData:null,afterload:function(){var e=this,t=this.model.get("iDetail").layer_ids,n=this.model.offset?this.model.offset:{x:0,y:0};if(!t||t.length==0)return;_.each(t,function(t){var r=interaction_view.ilayerlist.get(t)||interaction_view.iComponentlist.get(t);if(!r)return;e.animations=_.map(r.animations,function(n){return n.pageid=e.model.id,n.parentpageid=e.model.get("pageid"),n.pagetype="LayerRef",n.layerid=t,n}),e.model.layer[t].iAnimationlist.reset(e.animations),overlays=_.filter(r.overlays,function(e){return interaction_view.model[e.iType]}),overlays=_.map(overlays,function(r){var i=$.extend(!0,{},r);return i.pageid=e.model.id,i.parentpageid=e.model.get("pageid"),i.pagetype="LayerRef",i.layerid=t,i.path=e.model.layer[t].iOverlaylist.path,i.isSubOverlay=!0,i.isLayerOverlay=!0,n.x&&(i._offset_x=n.x),n.y&&(i._offset_y=n.y),i.iCommon.landscape.iStarty=i.iCommon.landscape.iStarty+n.y,i.iCommon.landscape.iStartx=i.iCommon.landscape.iStartx+n.x,new interaction_view.model[r.iType](i)}),e.model.layer[t].iOverlaylist.reset(overlays),e.model.layer[t].iOverlaylist.each(function(e){e.iview.setZindex()}),e.actions=_.map(r.actions,function(n){return n.pageid=e.model.id,n.parentpageid=e.model.get("pageid"),n.pagetype="LayerRef",n.layerid=t,n}),e.model.layer[t].iActionlist.reset(r.actions)}),e.startLayerLoad()},startLayerLoad:function(){var e=this;_.each(this.model.layer,function(t,n){t.ipreloadlist.length==0?e.model.iview.afterlayerload(n):t.ipreloadlist.preload()})}});return t});define("interaction_view/model/layerref",["interaction_view/model/base","interaction_view/view/layer"],function(){interaction_view.model.LayerRef=interaction_view.model.Base.extend({defaults:{iType:"LayerRef",iCommon:null,iDetail:null,iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){var t=this.get("iDetail"),n=this;n.layer={},this.filterlayers(),t.layer_ids&&t.layer_ids.length>0&&_.each(t.layer_ids,function(e){n.layer[e]={},n.layer[e].iOverlaylist=new interaction_view.collection.list,n.layer[e].iAnimationlist=new interaction_view.collection.Animation,n.layer[e].iActionlist=new interaction_view.collection.Action,n.layer[e].ipreloadlist=new interaction_view.collection.Preload,n.layer[e].subcontainer=n.layer[e].ipreloadlist.subcontainer=n.layer[e].iOverlaylist.subcontainer=n.layer[e].iAnimationlist.subcontainer=n.layer[e].iActionlist.subcontainer=n.id,n.layer[e].ipreloadlist.path=n.layer[e].iOverlaylist.path=n.layer[e].iAnimationlist.path=n.layer[e].iActionlist.path=n.createPath(e),n.layer[e].ipreloadlist.pageid=n.layer[e].iOverlaylist.pageid=n.layer[e].iAnimationlist.pageid=n.layer[e].iActionlist.pageid=n.id,n.layer[e].ipreloadlist.pagetype=n.layer[e].iOverlaylist.pagetype=n.layer[e].iAnimationlist.pagetype=n.layer[e].iActionlist.pagetype="LayerRef",n.layer[e].ipreloadlist.parentpageid=n.layer[e].iOverlaylist.parentpageid=n.layer[e].iAnimationlist.parentpageid=n.layer[e].iActionlist.parentpageid=n.get("pageid"),n.layer[e].ipreloadlist.layerid=n.layer[e].iOverlaylist.layerid=n.layer[e].iAnimationlist.layerid=n.layer[e].iActionlist.layerid=e,n.layer[e].iAnimationlist.page=n.layer[e],n.layer[e].iAnimationlist.iPage_id=n.get("pageid")}),this.setiview()},createPath:function(e){var t=interaction_view.createPath({path:this.get("path"),isSubOverlay:this.get("isSubOverlay"),page_id:this.get("pageid"),model:this,layer_id:e});return t},setiview:function(){this.iview=new interaction_view.view.LayerRef({model:this})},setsyncmodel:function(){},filterlayers:function(){var e=this.get("iDetail"),t=e.layer_ids;e.layer_ids&&e.layer_ids.length>0&&(t=_.filter(t,function(e){return interaction_view.ilayerlist.get(e)})),e.layer_ids=t,this.set("iDetail",e)}}),interaction_view.view.LayerRef=interaction_view.view.Base.extend({events:{},render:function(e){this.renderMask(),this.model._reset=!0},renderMask:function(){var e=this.getdetail();e.layer_ids&&e.layer_ids.length>0&&(this.$el.children(".Element").children().children().css({translate:[e.x,e.y]}),this.scrollview&&(this.$el.children(".Element").children().removeClass("is_exceededX"),this.$el.children(".Element").children().removeClass("is_exceededY"),this.scrollview.iScroll.scrollTo(e.x,e.y)))},preload:function(){var e=this.model.get("iDetail");e.layer_ids&&e.layer_ids.length>0&&this.sendToPreload({file:null})},loadLayer:function(e){var t=this.getdetail();this.layerCheckList=_.clone(t.layer_ids),this.firstlayer=t.layer_ids?t.layer_ids[0]:null,this.preloadmodel=e;var n=require("interaction_view/view/layer");n=_g.mvc.createView(n),this.layerview=new n({model:this.model}),this.layerview.afterload()},afterlayerload:function(e){console.log(e);if(this.preloadmodel){this.layerCheckList=_.reject(this.layerCheckList,function(t){return t==e}),this.model.layer[e].iOverlaylist.each(function(e){e.iview.preloaded||e.iview.afterpreload()}),this.model.layer[e].iActionlist.each(function(e){e.iview.render()});var t=this.model.toJSON().iDetail.iHidden||!1;this.layerCheckList.length==0&&(this.$el.addClass("hide").css("opacity",""),this.slideel=this.$el.find(".layer-content").first(),this.slideel.children(".layer-item").first().show(),this.slidestyle=this.slideel.attr("style"),this.playAnimation(),this.firstlayer&&this.model.get("iType")=="LayerRef"&&(this.model.layer[this.firstlayer].isLayer=!0),this.preloadmodel.set("loaded",!0),this.preloadmodel.page.ipreloadlist.preloadcheck(null,!0,this.model))}},playLayer:function(){this.firstlayer&&interaction_view.play(this.model.layer[this.firstlayer])},playAnimation:function(){var e=this,t=this.getdetail();this.$el.find(".layer-content").children().css("opacity",1);var n=this.getLayerContentSize(),r=this.getcommon();if(n.width==r.iWidth&&n.height==r.iHeight)return!1;this.setMaskSlipable({items:this.$el.find(".layer-content"),containment:this.$el.children(".Element").children(),contentel:this.$el.children(".Element").children().children(),content_x:t.x,content_y:t.y})},onExecuteBindingForLayerRef:function(e){var t=this,n=this.getMoveRange();if(e.type==1)return;e.cdirection||n.x>0&&this.scrollview&&this.scrollview.iScroll.scrollTo(-e.deltarate*n.x,this.getCurrentPosition().top),e.cdirection&&n.y>0&&this.scrollview&&this.scrollview.iScroll.scrollTo(this.getCurrentPosition().left,-e.deltarate*n.y)},getCurrentPosition:function(){if(this.$el.find(".layer-content").length>0){var e={left:0,top:0};return this.scrollview&&(e={left:this.scrollview.iScroll.x,top:this.scrollview.iScroll.y}),e}return{left:0,top:0}},getCurrentPositionRate:function(){var e=0,t=0,n=this.getMoveRange(),r=this.getCurrentPosition();return n.x&&(e=-r.left/n.x),n.y&&(t=-r.top/n.y),{left:e,top:t}},getLayerContentSize:function(){var e=this.getdetail(),t={};if(!e.layer_ids||e.layer_ids.length>0){var n=_.map(e.layer_ids,function(e){return interaction_view.ilayerlist.get(e).toJSON()});return t.width=_.max(_.pluck(n,"layer_width")),t.height=_.max(_.pluck(n,"layer_height")),t}return null},stoplayer:function(){var e=this,t=this.getdetail();t.layer_ids&&t.layer_ids.length>0&&_.each(t.layer_ids,function(t){e.model.layer[t].iAnimationlist.timeline&&e.model.layer[t].iAnimationlist.timeline.pause(0),e.model.layer[t].iOverlaylist.resetViewStatus(),interaction_view.bezierPatch&&interaction_view.bezierPatch(e.model.layer[t])})},resetlayer:function(){var e=this,t=this.getdetail();t.layer_ids&&t.layer_ids.length>0&&(_.each(t.layer_ids,function(t){e.model.layer[t].iAnimationlist.resetAnimationStatus(),e.model.layer[t].iOverlaylist.resetViewStatus()}),!this.model.bindingfixed&&this.slideel&&this.slideel.attr("style",this.slidestyle),e.currentIndex=0)},resetOtherStatus:function(){this.resetlayer(),this.model.get("iType")=="LayerRef"&&this.renderMask()},onShow:function(e){var t=this.getdetail(),n=this;t.layer_ids&&t.layer_ids.length>0&&_.each(t.layer_ids,function(r){e&&t.layer_ids.indexOf(r)==e?n.model.layer[r].iOverlaylist.each(function(e){e.iview.onShow()}):n.model.layer[r].iOverlaylist.each(function(e){e.iview.onShow()})})},onBeforeHide:function(e){var t=this.getdetail(),n=this;t.layer_ids&&t.layer_ids.length>0&&_.each(t.layer_ids,function(r){(!e||t.layer_ids.indexOf(r)!=e)&&n.model.layer[r].iOverlaylist.each(function(e){e.iview.onBeforeHide(),_.include(["RichText","Region"],e.get("iType"))&&e.iview.resetOtherStatus()})})},onHide:function(e){var t=this.getdetail(),n=this;t.layer_ids&&t.layer_ids.length>0&&_.each(t.layer_ids,function(r){(!e||t.layer_ids.indexOf(r)!=e)&&n.model.layer[r].iOverlaylist.each(function(e){e.iview.onHide()})})},onSizeAdaptChange:function(){this.$el.children(".Element").children(".layer-mask").css({width:this.originWidth,height:this.originHeight})}})});define("interaction_view/model/layerslide",["interaction_view/model/layerref"],function(){interaction_view.model.LayerSlide=interaction_view.model.LayerRef.extend({defaults:{iType:"LayerSlide",iCommon:null,iDetail:null,iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSlideNumber:!0,isSlide:!0,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setiview:function(){this.iview=new interaction_view.view.LayerSlide({model:this})}}),interaction_view.view.LayerSlide=interaction_view.view.LayerRef.extend({render:function(e){var t=this,n=this.getdetail();this.currentSlideIndex=null,this.model.on("slideTo",function(e){console.log(e);if(t.currentSlideIndex!=null&&t.currentSlideIndex==e)return!1;if(t.currentSlideIndex!=null&&t.currentSlideIndex!=e){var r=n.layer_ids[t.currentSlideIndex];interaction_view.stopPlay(t.model.layer[r])}if(t.preloaded){var i=n.layer_ids[e];if(!t.model.layer[i])return;t.model.layer[i].isLayer=!0,interaction_view.play(t.model.layer[i]),t.currentSlideIndex=e,t.model.layer[i].playFinished=!0}}),this.model._reset=!0},playAnimation:function(){var e=this,t=0,n=this.getdetail(),r=n.iSlidetype;this.delay=Number(n.iInterval)||2,this.autoplay=n.iAutoplay;var i=n.iRepeat?-1:0;this.iFade=n.iFade||0,this.iRewind=n.iRewind,this.timeline=new TimelineMax({paused:!0,repeat:i,onComplete:this.setRewind}),this.slideel=e.$el.children(".Element").find(".layer-content").first(),this.slidelength=n.layer_ids.length;if(this.slidelength<2)return!1;this.repeat=i,this.slipable=n.iSlipable,this.setTimeline(),this.autoplay?this.timeline&&(!this.$el.children(".Element").is(":hidden")||interaction_view.ismobile)&&this.timeline.play(0):this.setSlideDisplay(0),this.slipable?(this.control(),this.$el.addClass("hascontrols")):this.slideel&&this.slideel.on("click",function(){e.$el.children(".Element").trigger("click")})},playLayer:function(){this.autoplay&&this.timeline&&!this.$el.children(".Element").is(":hidden")&&this.timeline.play(0),this.slidelength>0&&this.model.trigger("slideTo",0)},setTimeline:function(){if(this.iFade=="Fade"||0)this.setFade();else if(this.iFade=="Slip")this.setSlip();else{if(this.iFade!="None")return;this.setNone()}this.slideel.children().first().css({opacity:1,left:0,top:0}).nextAll().css("opacity",0)},getSlipeInterval:function(e){},getLayerContentSize:function(){var e=this.getdetail(),t={};if(!e.layer_ids||e.layer_ids.length>0){var n=_.map(e.layer_ids,function(e){return interaction_view.ilayerlist.get(e).toJSON()});return t.width=_.max(_.pluck(n,"layer_width")),t.height=_.max(_.pluck(n,"layer_height")),t}return null},getStartPoint:function(e){return this.delay+(this.delay+.500002)*this.delay},getEndPoint:function(e){return(this.delay+.500002)*e+1e-5},getCurrentIndex:function(e){var t=this.timeline.duration(),n=t/this.slidelength;return parseInt(e/n,10)},testControl:function(e){var t=this,n=$(e).closest(".iView");if(n.hasClass("hasaction"))return!1;if(n){var r=n.attr("data-type");if(r=="Slide"||r=="CycleImage")if(n.attr("data-iSlipable"))return!1;return!0}return!0},resetOtherStatus:function(){this.resetlayer();var e=this,t=this.getdetail();if(!t.layer_ids||t.layer_ids.length==0)return;this.slideel.children().first().css({opacity:1,left:0,top:0}),this.autoplay=t.iAutoplay,e.currentIndex=0,e.currentSlideIndex=null,this.changeSlideNumber(),this.$el.children(".Element").removeClass("is_exceededX"),this.$el.children(".Element").removeClass("is_exceededY"),this.timeline&&(this.timeline.pause(1e-5),this.autoplay&&(!this.$el.children(".Element").is(":hidden")||interaction_view.ismobile)?this.timeline.play(0):this.setSlideDisplay(0))},getSlideLength:function(){var e=this.getdetail();return e.layer_ids?e.layer_ids.length:0}})});define("interaction_view/model/binding",["interaction_view/model/base"],function(){interaction_view.model.Binding=interaction_view.model.Base.extend({defaults:{iType:"Binding",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Binding({model:this})},setsyncmodel:function(){}}),interaction_view.view.Binding=interaction_view.view.Base.extend({events:{},renderDynamicElement:function(){},render:function(e){},preload:function(){},afterpreload:function(){this.model.pageid=this.model.get("pageid"),this.model.parentpageid=this.model.get("parentpageid");if(this.model.get("pagetype")=="LayerRef"){var e=this.model.get("parentpageid"),t=this.model.get("layerid"),n=interaction_view.getParentpage(e);this.model.parentpage=n,this.model.page=n.iOverlaylist.get(this.model.pageid).layer[t]}else this.model.page=interaction_view.getParentpage(this.model.pageid);var r=this,i=this.getdetail();this.bindings=i.iBindings;if(this.bindings.length>1){var s=this.getControlBinding();_.each(this.bindings,function(e){interaction_view.events.bindingEvents.push({id:e.id,page_id:e.page_id,direction:e.direction,func:function(e){r.executeBinding(r,e)}})})}this.preloaded=!0},getControlBinding:function(){return _.find(this.bindings,function(e){return e.isControl})?_.find(this.bindings,function(e){return e.isControl}):(this.bindings[0].isControl=!0,this.bindings[0])},getOperateBindings:function(){return _.reject(this.bindings,function(e){return e.isControl})},getBindingElement:function(e,t){var n;return interaction_view.getParentpage(e)?n=interaction_view.getParentpage(e):n=this.model.page,n.iOverlaylist.get(t)},getDirection:function(e,t){var n=this.getControlBinding();return t.id==n.id?e.direction?1:-1:e.id==n.id?t.direction?1:-1:t.direction==e.direction?1:-1},resetBindingStatus:function(){var e=this,t;_.each(this.bindings,function(n){var r=interaction_view.ipagelist.getElement(e.model.page,n.page_id,n.id);if(r)if(n.isControl)if(n.property=="offset"){var i=r.iview.getCurrentPositionRate();interaction_view.events.onBingChangeTo({type:0,page_id:r.get("pageid"),id:r.id,delta:-1,deltarate:i.left,cdirection:0}),interaction_view.events.onBingChangeTo({type:0,page_id:r.get("pageid"),id:r.id,delta:-1,deltarate:i.top,cdirection:1})}else r.iview.singletime?t=r.iview.singletime:t=1e-5,interaction_view.events.onBingChangeTo({type:1,page_id:r.get("pageid"),id:r.id,delta:t/r.iview.timeline.duration(),reset:!0});else n.property=="offset"&&(r.bindingfixed=!0)})},executeBinding:function(e,t){_.each(this.bindings,function(n){if(n.id==t.id)return;var r=e.getDirection(n,t),i=e.getBindingElement(n.page_id,n.id);if(i){var s=$.extend(!0,{},t);s.direction=r,s.delta=r*s.delta,s.deltarate=r==1?s.deltarate:e.getRevertRate(i,s.deltarate),s.revert=r==1?!1:!0,i.iview.onExecuteBinding(s)}})},getRevertRate:function(e,t){if(e.get("iType")=="LayerRef")return 1-t;var n=e.iview.slidelength,r=1-t;return r},resetStatus:function(){}})});define("interaction_view/model/SubContainer",["interaction_view/model/base","interaction_view/view/subcontainer"],function(){interaction_view.model.SubContainer=interaction_view.model.Base.extend({defaults:{iType:"SubContainer",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.setSubOverlays(),this.patchGridSize(),this.setiview()},createPath:function(){var e=interaction_view.createPath({path:this.get("path"),isSubOverlay:this.get("isSubOverlay"),page_id:this.get("pageid"),model:this});return e},setiview:function(){this.iview=new interaction_view.view.SubContainer({model:this})},setsyncmodel:function(){},GridPatch:!0,patchGridSize:function(){if(!this.GridPatch)return;var e=this.get("iCommon"),t=this.get("iDetail"),n=this.get("suboverlays");e[iPageDirection].iWidth=(t.iCols+1)*t.iColspace+n[0].iCommon[iPageDirection].iWidth*t.iCols,e[iPageDirection].iHeight=(t.iRows+1)*t.iRowspace+n[0].iCommon[iPageDirection].iHeight*t.iRows,this.set("iCommon",e)},getSubOverlays:function(){var e=this.get("iCommon"),t=this.get("iDetail"),n=[],r=this.get("suboverlays"),s=r[0],o=t.iRows,u=t.iCols;for(i=0;i<o;i++)for(j=0;j<u;j++)overlay=$.extend(!0,{},s),overlay.id=overlay.id+i+j,overlay.iCommon[iPageDirection].iStartx=t.iColspace*(j+1)+j*overlay.iCommon[iPageDirection].iWidth,overlay.iCommon[iPageDirection].iStarty=t.iRowspace*(i+1)+i*overlay.iCommon[iPageDirection].iHeight,n.push(overlay);return n},createImageSubOverlay:function(e){var t=e.iFullview,n={iType:"Image",iDetail:{iMask:!1,iFullview:e.iFullview,title:e.iImg[0].title,ratiofixxed:!1,iHidden:!1,iImg:e.iImg,iAdapt:!1,iDisplay:e.iDisplay||0},iCommon:{portait:{iWidth:e.iWidth,iHeight:e.iHeight,iStartx:e.iStartx,iStarty:e.iStarty},landscape:{iWidth:e.iWidth,iHeight:e.iHeight,iStartx:e.iStartx,iStarty:e.iStarty}},id:"Img"+_g.uuid(),iHidden:e.iHidden||!1,GalleryIndex:e.index};return n},GridReverse:function(){var e=this.get("iDetail");return e.iSlidetype?!1:!0},getOverlayPositionX:function(e,t,n,r){return this.GridReverse()?t*(n+1)+n*e.iCommon[iPageDirection].iWidth:t*(r+1)+r*e.iCommon[iPageDirection].iWidth},getOverlayPositionY:function(e,t,n,r){return this.GridReverse()?t*(r+1)+r*e.iCommon[iPageDirection].iHeight:t*(n+1)+n*e.iCommon[iPageDirection].iHeight}}),interaction_view.view.SubContainer=interaction_view.view.Base.extend({events:{},render:function(){this.renderBackGroud()},subPreLoadCheck:function(e){},preload:function(){var e=this.model.get("iDetail");this.sendToPreload({file:null,subcontainer:!0,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")})},afterSubOverlayPreload:function(){console.log("preloadok"),this.preloadmodel&&(this.model.iOverlaylist.each(function(e){e.iview.preloaded||e.iview.afterpreload()}),this.model.iActionlist.each(function(e){e.iview.render()}),this.preloadmodel.set("loaded",!0),this.preloadmodel.page.ipreloadlist.preloadcheck(null,!0,this.model)),interaction_view.ismobile&&_g.ui.isOverflowed(this.$el.children(".Element")).y&&this.$el.children(".Element").addClass("iMouseWheel disableMouseWheelY disableDragY"),this.otherAfterSubOverlayPreload&&this.otherAfterSubOverlayPreload()},allowScroll:!0,resetOtherStatus:function(){if(!this.allowScroll)return!1}})});define("interaction_view/model/gallery",["interaction_view/model/SubContainer"],function(){interaction_view.model.Gallery=interaction_view.model.SubContainer.extend({defaults:{iType:"Gallery",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSlideNumber:!0,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setiview:function(){this.iview=new interaction_view.view.Gallery({model:this})},getSubOverlays:function(){var e=this.get("iDetail"),t=this.get("iCommon"),n=[],r=this.get("suboverlays"),s=r[0],o=e.iRows,u=e.iCols;e.iMode||(e.iSlidetype?o=100:u=100);if(this.GridReverse()){var a=o;o=u,u=a}var f=0,l=0;if(e.iImg&&e.iImg.length){for(i=0;;i++){if(f>=e.iImg.length)break;i==o&&(i=0,l+=1);for(j=0;j<u;j++){if(f>=e.iImg.length)break;overlay=$.extend(!0,{},s),overlay.id=overlay.id+i+j+f,overlay.parent_index=l,overlay.suboverlays[0].iDetail.iText=interaction_view.formatLabel({text:_g.string.getUrlNameWithOutExt(e.iImg[f].title),font_size:overlay.suboverlays[0].iDetail.font_size,text_color:overlay.suboverlays[0].iDetail.text_color,iPosition:overlay.suboverlays[0].iDetail.iPosition}),e.show_title!=undefined&&!e.show_title&&overlay.suboverlays.shift();var c=this.createImageSubOverlay({iImg:[e.iImg[f]],iFullview:e.iFullscreen,iWidth:s.iCommon[iPageDirection].iWidth,iHeight:s.iCommon[iPageDirection].iHeight,iStartx:0,iStarty:0,iDisplay:Number(e.iDisplay),index:e.iSlipable?f:null});overlay.suboverlays.unshift(c),overlay.iCommon[iPageDirection].iStartx=this.getOverlayPositionX(overlay,e.iColspace,i,j),overlay.iCommon[iPageDirection].iStarty=this.getOverlayPositionY(overlay,e.iRowspace,i,j),overlay.iCommon[iPageDirection].iStartx>t[iPageDirection].iWidth&&(e.overflow_x=!0),overlay.iCommon[iPageDirection].iStarty>t[iPageDirection].iHeight&&(e.overflow_y=!0),n.push(overlay),f+=1}e.overflow_length=i+1}e.overflow_x&&(e.overflow_x=s.iCommon[iPageDirection].iWidth*e.overflow_length+e.iColspace*(e.overflow_length+1)),e.overflow_y&&(e.overflow_y=s.iCommon[iPageDirection].iHeight*e.overflow_length+e.iRowspace*(e.overflow_length+1)),l+=1}return e.slidelength=l,this.set("iDetail",e),n},patchGridSize:function(){if(!this.GridPatch)return;var e=this.get("iCommon"),t=this.get("iDetail"),n=this.get("suboverlays");if(t.iMode||!t.iMode&&t.iSlidetype)e[iPageDirection].iWidth=(t.iCols+1)*t.iColspace+n[0].iCommon[iPageDirection].iWidth*t.iCols;if(t.iMode||!t.iMode&&!t.iSlidetype)e[iPageDirection].iHeight=(t.iRows+1)*t.iRowspace+n[0].iCommon[iPageDirection].iHeight*t.iRows;this.set("iCommon",e)}}),interaction_view.view.Gallery=interaction_view.view.SubContainer.extend({otherAfterSubOverlayPreload:function(){var e=this.getSlideLength(),t=this.getdetail(),n=t.iCols*t.iRows;t.iMode||(n=t.iImg?t.iImg.length:0);if(e){var r=this.$el.children(".Element").children().detach(),s=0;for(i=0;i<e;i++){this.$el.children(".Element").append('<div class="gallery-content" data-index="'+i+'"></div>');for(j=0;j<n;j++){var o=this.$el.children(".Element").children().eq(i);o.append(r[s]),s+=1}}this.setSlidePosition()}},getSlideLength:function(){var e=this.getdetail();return e.slidelength||0},setSlidePosition:function(){var e=this.getdetail(),t=this.getcommon();e.iMode?(this.$el.children(".Element").addClass("hasSlide"),this.$el.children(".Element").css({overflow:"hidden"}),this.$el.children(".Element").children().each(function(){var e=$(this).index();$(this).css({position:"absolute",width:"100%",height:"100%"})}),this.playAnimation()):e.iSlidetype?(this.$el.children(".Element").css({overflow:"hidden"}),this.$el.children(".Element").children().each(function(){var e=$(this).index();$(this).css({position:"absolute",left:0,top:e*t.iHeight,width:"100%",height:"100%"})}),this.galleryFlow().y&&(this.$el.children(".Element").addClass("iMouseWheel disableMouseWheelY disableDragY"),this.scrollview=new IScroll(this.$el.children(".Element")[0],{mouseWheel:!0,probeType:3,scrollX:!1,scrollY:!0,click:!0,wrapperWidth:t.iWidth,wrapperHeight:t.iHeight,scrollerWidth:t.iWidth,scrollerHeight:e.overflow_y}))):(this.$el.children(".Element").css({overflow:"hidden"}),this.$el.children(".Element").children().each(function(){var e=$(this).index();$(this).css({position:"absolute",left:e*t.iWidth,top:0,width:"100%",height:"100%"})}),this.galleryFlow().x&&(this.$el.children(".Element").addClass("iMouseWheel disableMouseWheelX disableDragX"),this.scrollview=new IScroll(this.$el.children(".Element")[0],{mouseWheel:!0,probeType:3,scrollX:!0,scrollY:!1,click:!0,wrapperWidth:t.iWidth,wrapperHeight:t.iHeight,scrollerWidth:e.overflow_x,scrollerHeight:t.iHeight})))},playAnimation:function(){var e=this,t=0,n=this.getdetail(),r=n.iSlidetype;this.delay=Number(n.iInterval)||2,this.autoplay=n.iAutoplay,this.iFade="Slip";var i=0;this.timeline=new TimelineMax({paused:!0,repeat:i,onComplete:this.setRewind}),this.slideel=e.$el.children(".Element").first(),this.slidelength=this.getSlideLength(),this.repeat=i,this.iRewind=n.iRewind,this.slipable=!0,this.setTimeline(),this.autoplay?this.$el.children(".Element").is(":hidden")||this.timeline.play(0):this.setSlideDisplay(0),this.onChangeSlideTo(0),this.slipable&&(this.control(),this.autoplay||this.$el.attr("data-iSlipable",!0))},setTimeline:function(){if(this.iFade=="Fade"||0)this.setFade();else if(this.iFade=="Slip")this.setSlip();else{if(this.iFade!="None")return;this.setNone()}this.slideel.children().first().css({opacity:1,left:0,top:0}).nextAll().css("opacity",0)},testControl:function(){return!0},preview_left:function(e){e>0&&this.model.iOverlaylist.at(e-1).iOverlaylist.at(0).iview.$el.children(".Element").trigger("click")},preview_right:function(e){e<this.model.iOverlaylist.length-1&&this.model.iOverlaylist.at(e+1).iOverlaylist.at(0).iview.$el.children(".Element").trigger("click")},galleryFlow:function(){var e={x:!1,y:!1},t=this.getcommon(),n=this.getdetail();return n.overflow_x&&(e.x=!0),n.overflow_y&&(e.y=!0),e},resetOtherStatus:function(){var e=this;if(!this.allowScroll)return!1;this.$el.children(".Element").removeClass("is_exceededX"),this.$el.children(".Element").removeClass("is_exceededY"),typeof wx_permissions!="undefined"&&wx_permissions.previewImage&&e.$el.find(".iImage.Element").click(function(t){var n=e.$el.find(".iImage.Element").index($(this));e.fullviewIndex(n)})}})});define("interaction_view/model/Grid",["interaction_view/model/gallery"],function(){interaction_view.model.Grid=interaction_view.model.Gallery.extend({defaults:{iType:"Grid",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},getSubOverlays:function(){var e=this.get("iDetail"),t=this.get("iCommon"),n=[],r=this.get("suboverlays"),s=r[0],o=e.iRows,u=e.iCols,a=0,f=0;for(i=0;i<o;i++)for(j=0;j<u;j++)overlay=$.extend(!0,{},s),overlay.id=overlay.id+i+j+a,overlay.parent_index=f,overlay.suboverlays=_.map(overlay.suboverlays,function(t){if(t.iType=="TextLabel"||t.iType=="BookButton")t.iDetail.iText=interaction_view.formatLabel({text:t.iDetail.iText,font_size:t.iDetail.font_size,text_color:t.iDetail.text_color,iPosition:t.iDetail.iPosition,radius:t.iDetail.corner_radius,border_color:t.iDetail.border_color,bg_color:t.iDetail.bg_color,border_size:t.iDetail.border_size});return t.iType=="Image"&&(t.iDetail.iDisplay=e.iDisplay),t}),overlay.suboverlays=_.reject(overlay.suboverlays,function(t){if(!e.show_title&&t.iDetail.iValue=="title")return!0;if(!e.show_description&&t.iDetail.iValue=="description")return!0}),overlay.iCommon[iPageDirection].iStartx=this.getOverlayPositionX(overlay,e.iColspace,i,j),overlay.iCommon[iPageDirection].iStarty=this.getOverlayPositionY(overlay,e.iRowspace,i,j),overlay.iCommon[iPageDirection].iStartx>t[iPageDirection].iWidth&&(e.overflow_x=!0),overlay.iCommon[iPageDirection].iStarty>t[iPageDirection].iHeight&&(e.overflow_y=!0),n.push(overlay),a+=1;return e.slidelength=f,this.set("iDetail",e),n},setiview:function(){this.iview=new interaction_view.view.Grid({model:this})}}),interaction_view.view.Grid=interaction_view.view.Gallery.extend({allowScroll:!1})});define("interaction_view/model/Cell",["interaction_view/model/SubContainer"],function(){interaction_view.model.Cell=interaction_view.model.SubContainer.extend({defaults:{iType:"Cell",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null,isStatic:!0},setiview:function(){this.iview=new interaction_view.view.Cell({model:this})},GridPatch:!1,getSubOverlays:function(){var e=this.get("iDetail"),t=[],n=this.get("suboverlays");return n}}),interaction_view.view.Cell=interaction_view.view.SubContainer.extend({allowScroll:!1})});define("interaction_view/model/TextLabel",["interaction_view/model/base"],function(){interaction_view.model.TextLabel=interaction_view.model.Base.extend({defaults:{iType:"TextLabel",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.TextLabel({model:this})},setsyncmodel:function(){}}),interaction_view.view.TextLabel=interaction_view.view.Base.extend({events:{},render:function(e){var t=this.model.get("iDetail")}})});define("interaction_view/model/TabBar",["interaction_view/model/SubContainer"],function(){interaction_view.model.TabBar=interaction_view.model.SubContainer.extend({defaults:{iType:"TabBar",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setiview:function(){this.iview=new interaction_view.view.TabBar({model:this})},GridPatch:!1,getSubOverlays:function(){var e=this.get("iDetail"),t=[],n=this.get("suboverlays");return n=_.map(n,function(e){return e.isTabBarButton=!0,e}),n}}),interaction_view.view.TabBar=interaction_view.view.SubContainer.extend({allowScroll:!1})});define("interaction_view/model/SearchInput",["interaction_view/model/base"],function(){interaction_view.model.SearchInput=interaction_view.model.Base.extend({defaults:{iType:"SearchInput",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.SearchInput({model:this})},setsyncmodel:function(){}}),interaction_view.view.SearchInput=interaction_view.view.Base.extend({events:{},render:function(e){}})});define("text!interaction_view/template/Tree_content.js",[],function(){return'<div class="treeview category-bookshelf inited">\n                <ul>\n                  <li>\n                    <div class="wraparea" style="border-bottom: 1px solid <%=iDetail.line_color%>;"><h4><a href="#" style="color:<%=iDetail.text_color%>;">所有</a></h4></div>\n                  </li>\n                  <li>\n                    <div class="wraparea" style="border-bottom: 1px solid <%=iDetail.line_color%>;"><h4><a href="#" style="color:<%=iDetail.text_color%>;">未分类</a></h4></div>\n                  </li>\n                  <li class="hasmenu unfold">\n                    <div class="wraparea" style="border-bottom: 1px solid <%=iDetail.line_color%>;"><h4><a href="#" style="color:<%=iDetail.text_color%>;">分类 1</a></h4><div class="hitarea"></div></div>\n                    <ul>\n                      <li class="active">\n                        <div class="wraparea" style="border-bottom: 1px solid <%=iDetail.line_color%>;background:<%=iDetail.selected_color%>;"><h4><a href="#" style="color:<%=iDetail.text_color%>;">分类 1.1</a></h4></div>\n                      </li>\n                      <li>\n                        <div class="wraparea" style="border-bottom: 1px solid <%=iDetail.line_color%>;"><h4><a href="#" style="">分类 1.2</a></h4></div>\n                      </li>\n                      <li>\n                        <div class="wraparea" style="border-bottom: 1px solid <%=iDetail.line_color%>;"><h4><a href="#" style="color:<%=iDetail.text_color%>;">分类 1.3</a></h4></div>\n                      </li>\n                    </ul>\n                  </li>\n                  <li class="hasmenu unfold">\n                    <div class="wraparea" style="border-bottom: 1px solid <%=iDetail.line_color%>;"><h4><a href="#" style="color:<%=iDetail.text_color%>;">分类 2</a></h4><div class="hitarea"></div></div>\n                    <ul>\n                      <li>\n                        <div class="wraparea" style="border-bottom: 1px solid <%=iDetail.line_color%>;"><h4><a href="#" style="color:<%=iDetail.text_color%>;">分类 2.1</a></h4></div>\n                      </li>\n                      <li>\n                        <div class="wraparea" style="border-bottom: 1px solid <%=iDetail.line_color%>;"><h4><a href="#" style="color:<%=iDetail.text_color%>;">分类 2.2</a></h4></div>\n                      </li>\n                    </ul>\n                  </li>\n                </ul>\n              </div>'});define("interaction_view/model/Tree",["interaction_view/model/base","text!interaction_view/template/Tree_content.js"],function(){var e=require("text!interaction_view/template/Tree_content.js");interaction_view.model.Tree=interaction_view.model.Base.extend({defaults:{iType:"Tree",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Tree({model:this})},setsyncmodel:function(){}}),interaction_view.view.Tree=interaction_view.view.Base.extend({events:{},render:function(t){var n=this.getdetail();if(!n.is_expandable)this.$el.children(".Element").html(_.template(e,this.model.toJSON()));else{var r='<img src="'+n.iImg+'" width="41px" height="38px"><img>';this.$el.children(".Element").html(r)}}})});define("interaction_view/model/PageIndex",["interaction_view/model/SubContainer"],function(){interaction_view.model.PageIndex=interaction_view.model.SubContainer.extend({defaults:{iType:"PageIndex",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setiview:function(){this.iview=new interaction_view.view.PageIndex({model:this})},getSubOverlays:function(){var e=this.get("iDetail"),t=this.get("iCommon"),n=[],r=this.get("suboverlays"),s=r[0],o=e.iRows,u=e.iCols,a=0;this.indexpages=interaction_view.foredit?iPagelist.getIndexPages():interaction_view.ipagelist.getIndexPages();if(this.indexpages.length){for(i=0;;i++){if(a>=this.indexpages.length)break;for(j=0;j<u;j++){if(a>=this.indexpages.length)break;overlay=$.extend(!0,{},s),overlay.id=overlay.id+i+j,overlay.suboverlays[1].iDetail.iText=interaction_view.formatLabel({text:this.indexpages[a].get("title"),font_size:overlay.suboverlays[1].iDetail.font_size,text_color:overlay.suboverlays[1].iDetail.text_color,iPosition:overlay.suboverlays[0].iDetail.iPosition});var f=this.indexpages[a].get("nav");overlay.suboverlays[0].iDetail.iImg=f&&f.thumbnail?[f]:[],overlay.suboverlays[0].iDetail.iDisplay=1,this.get("iDetail").show_thumb||overlay.suboverlays.shift(),this.get("iDetail").show_title||overlay.suboverlays.shift(),overlay.iCommon[iPageDirection].iStartx=e.iColspace*(j+1)+j*overlay.iCommon[iPageDirection].iWidth,overlay.iCommon[iPageDirection].iStarty=e.iRowspace*(i+1)+i*overlay.iCommon[iPageDirection].iHeight,n.push(overlay),a+=1}}e.overflow_y=(this.indexpages.length+1)*e.iRowspace+overlay.iCommon[iPageDirection].iHeight*this.indexpages.length,e.overflow_y=e.overflow_y>t[iPageDirection].iHeight?e.overflow_y:null,this.set("iDetail",e,{silent:!0})}return n},patchGridSize:function(){if(!this.GridPatch)return;var e=this.get("iCommon"),t=this.get("iDetail");t.iRows=this.indexpages.length;var n=this.get("suboverlays");e[iPageDirection].iWidth=(t.iCols+1)*t.iColspace+n[0].iCommon[iPageDirection].iWidth*t.iCols;var r=(t.iRows+1)*t.iRowspace+n[0].iCommon[iPageDirection].iHeight*t.iRows;this.set("iCommon",e),this.set("iDetail",t)}}),interaction_view.view.PageIndex=interaction_view.view.SubContainer.extend({otherAfterSubOverlayPreload:function(){var e=this,t=this.model.indexpages;this.$el.children(".Element").find("[data-type=Cell]").each(function(){var e=t[$(this).index()].id;$(this).children(".Element").css({cursor:"pointer"});if(interaction_view.foredit)return;$(this).children(".Element").on("click",function(){presentation.gotopage(e,9)})});var n=this.getdetail(),r=this.getcommon();n.overflow_y&&(this.$el.children(".Element").addClass("iMouseWheel disableMouseWheelY disableDragY"),this.$el.children(".Element").wrapInner('<div class="iContent"></div>'),this.scrollview=new IScroll(this.$el.children(".Element")[0],{mouseWheel:!0,probeType:3,scrollX:!1,scrollY:!0,click:!0,wrapperWidth:r.iWidth,wrapperHeight:r.iHeight,scrollerWidth:r.iWidth,scrollerHeight:n.overflow_y}))}})});define("text!interaction_view/template/offline_info.js",[],function(){return'<div class="offline-shadow" style="background: rgba(218,218,218,0.7);left:0;top:0;width:100%;height:100%;position:absolute;display: block;">\n <div class="offline-text" style="line-height:<%=iCommon[iPageDirection].iHeight%>px;text-align: center;">\n   <i class="icon-warning-sign icon-4x" style="display: inline-block;">\n    <br>\n    <span style="background: #444444;color: #FFFFFF;padding: 8px;font-size: 14px;">请在联网的状态下使用</span>\n   </i>\n </div>\n</div>\n '});define("interaction_view/model/webcontent",["interaction_view/model/base","text!interaction_view/template/offline_info.js"],function(){var e=require("text!interaction_view/template/offline_info.js");interaction_view.model.WebContent=interaction_view.model.Base.extend({defaults:{iType:"WebContent",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.WebContent({model:this})},setsyncmodel:function(){}}),interaction_view.view.WebContent=interaction_view.view.Base.extend({events:{},render:function(){this.model.renderWebContent=!0},renderWebContent:function(e){var t=this,n=this.detail;if(!this.result){var r=this.result||interaction_view.getWebContentSrc(n);this.result=r}if(!this.result)return;if(!this.result.src&&!this.result.content)return;this.iframeStyle?(this.$el.children(".Element").html("<iframe></iframe>"),this.iframeStyle=this.$el.children(".Element").children("iframe").attr("style",this.iframeStyle)):this.iframeStyle=this.$el.children(".Element").children("iframe").attr("style"),r=this.result,r&&r.src?this.$el.children(".Element").children("iframe")[0].src=r.src:r&&r.content&&(this.hasContent=r.content,this.$el.children(".Element").children("iframe")[0].contentWindow.document.write(r.content)),n.iOnline&&(interaction_view.isOnline||(interaction_view.isOnline==null?_g.device.online("http://www.epub360.com/staticfs/diazo/img/favicon.png",function(){interaction_view.isOnline=!0},function(){interaction_view.isOnline=!1,t.renderOfflineInfo()}):t.renderOfflineInfo()))},renderOfflineInfo:function(){this.$el.children(".Element").append(_.template(e,this.model.toJSON()))},clearWebContent:function(){this.$el.children(".Element").children("iframe").remove()}})});define("interaction_view/model/formview",["interaction_view/model/webcontent"],function(){interaction_view.model.FormView=interaction_view.model.WebContent.extend({defaults:{iType:"FormView",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.FormView({model:this})},setsyncmodel:function(){}}),interaction_view.view.FormView=interaction_view.view.Base.extend({resetOtherStatus:function(){},onSizeAdaptChange:function(){this.$el.children(".Element").children("iframe").css({width:this.originWidth,height:this.originHeight})},otherOnShow:function(){}})});define("interaction_view/model/shape",["interaction_view/model/base"],function(){interaction_view.model.Shape=interaction_view.model.Base.extend({defaults:{iType:"Shape",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:100,iHeight:100},landscape:{iStartx:400,iStarty:200,iWidth:100,iHeight:100}},iDetail:{title:"",type:"circle",bg_opacity:0,bg_color:"#FFFFFF",rotate:90,iSvg:'<svg width="100%" height="100%" stroke="black" stroke-width="1" stroke-opacity="1" fill="red" fill-opacity="0.1" version="1.1" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50"/></svg>',iImg:[{origin:"http://qn.media.epub360.com/materials/origin/f62b8741244895a7ec91abe865b041e7_origin.png",picture:"http://qn.media.epub360.com/materials/origin/f62b8741244895a7ec91abe865b041e7_origin.png",thumb_height:40,preview:'<img src="http://qn.media.epub360.com/materials/origin/f62b8741244895a7ec91abe865b041e7_origin.png"/>',uid:131779,thumb_width:320,title:"RichText_20140709160314864337",thumb_preview:'<img src="http://qn.media.epub360.com/materials/origin/f62b8741244895a7ec91abe865b041e7_origin.png"/>',type:"Image",created:"2014-07-09 16:03:14",thumbnail:"http://qn.media.epub360.com/materials/origin/f62b8741244895a7ec91abe865b041e7_origin.png",height:40,width:40,id:"Resources_4561404892960557",origin_height:40,origin_width:40,size:"2.0 KB",resourceattr:"iImg",dimension:0,elementid:"140489293611260",description:""}],iStaticImage:!1},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Shape({model:this})},setsyncmodel:function(){}}),interaction_view.view.Shape=interaction_view.view.Base.extend({events:{},render:function(e){var t=this;this.rotateShape(),this.isRotated=!0,t.getdetail().type=="line"&&this.isRotated&&$.zoom&&$(window).resize(function(){if(interaction_view.currentPage!=t.model.page.id)return;t.$el.find("svg").height(t.$el.find("svg").attr("height"));var e=t.$el.find("svg").height();$.zoom<.65&&$.zoom>=.44&&e<30?t.$el.find("svg").height(30):$.zoom<.44&&$.zoom>=.33&&e<40?t.$el.find("svg").height(40):$.zoom<.33&&$.zoom>=.26&&e<50?t.$el.find("svg").height(50):$.zoom<.26&&$.zoom>=.22&&e<60?t.$el.find("svg").height(60):$.zoom<.22&&$.zoom>=.19&&e<70?t.$el.find("svg").height(70):$.zoom<.19&&$.zoom>=.17&&e<80?t.$el.find("svg").height(80):$.zoom<.17&&e<100&&t.$el.find("svg").height(100)})},resetOtherStatus:function(){this.isRotated||this.rotateShape(),this.isRotated=!1},otherOnShow:function(){this.resetOtherStatus()},rotateShape:function(){TweenMax.set(this.$el.find(".iShape.Element"),{rotation:parseInt(this.getdetail().rotate)})}})});define("interaction_view/model/BookButton",["interaction_view/model/TextLabel"],function(){interaction_view.model.BookButton=interaction_view.model.TextLabel.extend({defaults:{iType:"BookButton",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0},setiview:function(){this.iview=new interaction_view.view.BookButton({model:this})}}),interaction_view.view.BookButton=interaction_view.view.TextLabel.extend({allowScroll:!1})});define("interaction_view/model/dragdrop",["interaction_view/model/base"],function(){interaction_view.model.DragDrop=interaction_view.model.Base.extend({defaults:{iType:"DragDrop",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.DragDrop({model:this})},setsyncmodel:function(){}}),interaction_view.view.DragDrop=interaction_view.view.Base.extend({events:{},render:function(e){this.model._reset=!0},preload:function(){this.preloaded=!1,this.checkImglist=[];var e=this.getdetail(),t=[null,null];if(e.iconNormal&&e.iconNormal[0]){this.checkImglist.push(e.iconNormal[0].picture);var n=this.sendToPreload({file:e.iconNormal[0].picture,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")});t[0]=n.id}if(e.iconActive&&e.iconActive[0]){this.checkImglist.push(e.iconActive[0].picture);var n=this.sendToPreload({file:e.iconActive[0].picture,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")});t[1]=n.id}this.model.set("preload_id",t)},checkImgload:function(e){return this.checkImglist=_.reject(this.checkImglist,function(t){return t==e}),this.checkImglist.length==0?!0:!1},afterpreload:function(e){if(e&&this.preloaded)return;e&&!this.preloaded&&(this.preloaded=this.checkImgload(e)),this.preloaded&&(this.setZindex(),this.setElementDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style"))},setOtherDisplay:function(){this.active=!1,this.Status=0},changeStatus:function(e){var t=this.getdetail(),n=this;typeof e!="undefined"&&(n.active=e),n.active?(n.$el.find("img.iconActive").hide(),n.$el.find("img.iconNormal").show(),n.active=!1):(n.$el.find("img.iconActive").show(),n.$el.find("img.iconNormal").hide(),n.active=!0)},resetOtherStatus:function(){var e=this;e.resetButtonStatus(),e.DragDropGroups=[],$.each(e.model.page.iOverlaylist.where({iType:"DragDropGroup"}),function(t,n){_.include(n.iview.getdetail().element_ids,e.model.id)&&e.DragDropGroups.push(n)})},resetButtonStatus:function(){this.$el.find("img.iconActive").hide(),this.$el.find("img.iconNormal").show(),this.active=!1}})});define("interaction_view/model/dragdropgroup",["interaction_view/model/base"],function(){interaction_view.model.DragDropGroup=interaction_view.model.Base.extend({defaults:{iType:"DragDropGroup",iVisibility:!0,iCommon:null,iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iOptions:{createfocus:!0},iParentModel:null,iDraggable:!1,iResizable:!1,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.DragDropGroup({model:this})},setsyncmodel:function(){}}),interaction_view.view.DragDropGroup=interaction_view.view.Base.extend({events:{},renderDynamicElement:function(){},render:function(e){this.model._reset=!0},preload:function(){},afterpreload:function(){this.model.pageid=this.model.get("pageid"),this.model.parentpageid=this.model.get("parentpageid");if(this.model.get("pagetype")=="LayerRef"){var e=this.model.get("parentpageid"),t=this.model.get("layerid"),n=interaction_view.getParentpage(e);this.model.parentpage=n,this.model.page=n.iOverlaylist.get(this.model.pageid).layer[t]}else this.model.page=interaction_view.getParentpage(this.model.pageid);this.preloaded=!0}})});define("interaction_view/model/variable",["interaction_view/model/base"],function(){interaction_view.model.Variable=interaction_view.model.Base.extend({defaults:{},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Variable({model:this})},setsyncmodel:function(){}}),interaction_view.view.Variable=interaction_view.view.Base.extend({events:{},resetOtherStatus:function(){this.showRandom(),this.updateText(this.origin,addtourl=0)},updateText:function(e,t){var n=this.getdetail();e&&(n.initial=e),this.isKindNum()&&(n.initial=(Number(n.initial)||0).toFixed(Number(n.precision)||0)),this.$el.find(".Element").html(n.initial),t&&this.addToUrl()},render:function(e){var t=this.getdetail();this.iHorizontal=["left","center","right"],t.iEditable&&(t.initial=this.getFromUrl()),this.updateText("",addtourl=0),this.$el.find(".Element").css("font-size",t.font_size).css("color",t.font_color).css("text-align",this.iHorizontal[t.iPosition]),this.origin=t.initial,this.model._reset=!0},setVariable:function(e,t){var n=this,r=this.getdetail(),i=interaction_view.getVarsOp(interaction_view.currentPage,null,interaction_view.environment.Votes.get());if(!(!this.isKindText()||e!=1&&e!=2&&e!=3))return;if(this.isKindRandom()&&e!=3||!this.isKindRandom()&&e==3)return;if(this.isKindNum()&&Number(t).toString()=="NaN"&&!i.beginWithAT(t))return;e=Number(e),this.isKindNum()&&(r.initial=Number(r.initial));switch(e){case 0:r.initial=i.var2val(t,n.isKindText());break;case 1:r.initial+=i.var2val(t);break;case 2:r.initial-=i.var2val(t);break;case 3:r.initial=_.random(r.range[0],r.range[1])}n.updateText("",addtourl=1),n.triggerVarChange()},triggerVarChange:function(){var e=this.getdetail();e.immediate==1&&interaction_view.events.onVariableChanged(this)},isKindNum:function(){var e=this.getdetail();return e.iKind==0},isKindText:function(){var e=this.getdetail();return e.iKind==1},isKindRandom:function(){var e=this.getdetail();return e.iKind==2},showRandom:function(){this.isKindRandom()&&(this.origin=this.setRandom())},setRandom:function(){var e=this.getdetail();return e.initial=_.random(e.range[0],e.range[1]),e.initial},getFromUrl:function(e){var t=_g.getUrlParameterByName(this.model.id,e);return!t&&t!=0&&(t=_g.getHashParameterByName(this.model.id)),!t&&t!=0&&(t=this.getdetail().initial),t},addToUrl:function(e){var t=this.getdetail();if(!t.iEditable)return!1;typeof message_link=="undefined"&&(message_link=document.location.href,interaction_view.weixin.share()),typeof e=="undefined"&&(e=t.initial);var n=0,r=this.model.id+"="+encodeURI(e),i=_g.getUrlParameterByName(this.model.id,message_link);if(!i){var s="?";message_link.indexOf("?")>=0&&(s="&"),message_link+=s+r,interaction_view.weixin.share()}else encodeURI(i)!=encodeURI(e)?(message_link=_g.replaceUrlParameterByName(this.model.id,r,message_link),interaction_view.weixin.share()):n=1;if(!interaction_view.forpreview){var o=_g.getHashParameterByName(this.model.id);o?encodeURI(o)!=encodeURI(e)?window.history.replaceState({},"",_g.replaceHashParameterByName(this.model.id,r)):n=1:window.history&&(document.location.hash?window.history.replaceState({},"",document.location.hash+="&"+r):window.history.replaceState({},"","#"+r))}return n?!1:!0}})});define("interaction_view/model/timer",["interaction_view/model/base"],function(){interaction_view.model.Timer=interaction_view.model.Base.extend({defaults:{},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Timer({model:this})},setsyncmodel:function(){}}),interaction_view.view.Timer=interaction_view.view.Base.extend({events:{},render:function(e){var t=this.getdetail();this.iHorizontal=["left","center","right"],this.$el.find(".Element").html(t.formatTime).css("font-size",t.font_size).css("color",t.font_color).css("text-align",this.iHorizontal[t.iPosition]),this.model._reset=!0},resetOtherStatus:function(){this.clearTimer(),this.Interval=!1,this.Status=-1,this.Suspend=!1,this.frame=10},startTimer:function(){function n(){e.updateTimer(),e.Actions_16.length&&interaction_view.events.onTimerCountTo(e),e.currentTime!=t.initial&&e.Actions_18.length&&interaction_view.events.onTimerInterval(e)}function r(){if(!e.Interval)return;if(e.currentTime<=0){e.stopTimer();return}n(),e.currentTime-=.01,setTimeout(r,e.frame)}function i(){if(!e.Interval)return;n(),e.currentTime+=.01,setTimeout(i,e.frame)}if(this.Status==1||this.Status==3)return;if(this.Status==-1){this.Suspend=!0;return}var e=this,t=this.getdetail();this.Interval=!0,t.iKind==1?r():i(),interaction_view.events.onTimerStart(this),this.Status=1},stopTimerSimple:function(){return this.Status==2||this.Status==3||this.Status==-1?!1:(this.clearTimer(),this.Status=2,!0)},stopTimer:function(){this.stopTimerSimple()&&(interaction_view.events.onTimerStop(this),this.Status=3)},resetTimer:function(){var e=this,t=this.getdetail();this.clearTimer(),this.currentTime=t.initial=Number(Number(t.initial).toFixed(2)),this.Status=0,this.updateTimer();if(!this.gotTimerActions){function n(t,n){return t.overlay_id!=e.model.id||t.type!=n?!1:e.model.page.isLayer?t.layer_id==e.model.page.iOverlaylist.layerid:t.page_id==e.model.page.id}this.Actions_16=_.filter(interaction_view.events.timerEvents,function(e){return n(e,16)}),this.Actions_18=_.filter(interaction_view.events.timerEvents,function(e){return n(e,18)}),this.Actions_17=_.filter(interaction_view.events.timerEvents,function(e){return n(e,17)}),this.Actions_19=_.filter(interaction_view.events.timerEvents,function(e){return n(e,19)}),this.gotTimerActions=!0}(t.iAutoStart||this.Suspend)&&this.startTimer(),this.Suspend=!1},updateTimer:function(){var e=this.getdetail();e.formatTime=this.getFormatTime(this.currentTime,e.format),this.$el.find(".Element").html(e.formatTime)},clearTimer:function(){this.Interval=!1},getFormatTime:function(e,t){var n,r,i,s;e=Number(Number(e).toFixed(2)),e<=0?n=r=i=s=0:(n=Math.floor(e/3600),r=Math.floor((e-n*3600)/60),i=Math.floor(e-n*3600-r*60),s=Math.round((e-Math.floor(e))*100));switch(Number(t)){case 0:return(r<10?"0"+r:r)+":"+(i<10?"0"+i:i);case 1:return(r<10?"0"+r:r)+":"+(i<10?"0"+i:i)+":"+(s<10?"0"+s:s);case 2:return(n<10?"0"+n:n)+":"+(r<10?"0"+r:r)+":"+(i<10?"0"+i:i);case 3:return(n<10?"0"+n:n)+":"+(r<10?"0"+r:r)+":"+(i<10?"0"+i:i)+":"+(s<10?"0"+s:s)}}})});(function(){var e={load:function(e,t){return _g.ajax.get(e,t)},get:function(e,t){var n={url:null,dataType:"JSON",staticUrl:null,callback:null,parseData:null,debug:!1,name:null,retry:!1,retrydelay:0};typeof e=="string"?(n.url=e,n.callback=t,e=n):e=e?$.extend(!0,{},n,e):$.extend(!0,{},n),_g.debug&&_g.debug.enabled&&(e.name||(e.name=e.url),_g.debug.data[e.name]={});var r=typeof _gDebug!="undefined"&&_gDebug||e.debug,i=r?_g.debug&&_g.debug.query_user_data(e.name)?_g.debug.query_user_data(e.name):e.staticUrl||e.url:e.url;if(!i)return!1;var s=$.ajax({url:i,type:"GET",data:"",dataType:e.dataType,beforeSend:e.beforeSend,success:function(t){_g.debug&&_g.debug.enabled&&(_g.debug.data[e.name].data=$.extend(!0,{},t)),r&&e.parseData&&(t=e.parseData(t)),e.callback&&e.callback(t)},error:function(){_g.error.serverError(),e.onError&&e.onError(0)},timeout:1e5});return s},post:function(e,t,n){var r={url:null,data:null,dataType:"JSON",staticUrl:null,callback:null,debug:!1,name:null,retry:!1,retrydelay:0};typeof e=="string"?(r.url=e,r.callback=n,r.data=t,e=r):e=e?$.extend(!0,{},r,e):$.extend(!0,{},r),_g.debug&&_g.debug.enabled&&(e.name||(e.name=e.url),_g.debug.data[e.name]={});var i=typeof _gDebug!="undefined"&&_gDebug||e.debug,s=i?_g.debug&&_g.debug.query_user_data(e.name)?_g.debug.query_user_data(e.name):e.staticUrl||e.url:e.url;if(!s)return!1;var o=$.ajax({url:s,type:i?"GET":"POST",data:e.data,dataType:e.dataType,traditional:e.traditional,beforeSend:e.beforeSend,success:function(t){_g.debug&&_g.debug.enabled&&(_g.debug.data[e.name].data=$.extend(!0,{},t)),e.callback&&e.callback(t)},error:function(){_g.error.serverError(e.name),e.onError&&e.onError(0)},timeout:1e5});return o},dataGenerate:function(e){var t={dataSource:null,map:null,key:null,count:0};e=e?$.extend(!0,{},t,e):$.extend(!0,{},t);if(!e.dataSource||!e.map)return e.dataSource;var n=e.key?e.dataSource[e.key]:e.dataSource;if(!n[0])return e.dataSource;for(i=0;i<e.count;i++){var r={},s=n[0];_.each(s,function(t,n){var i;if(!e.map[n])r[n]=s[n];else{switch(e.map[n]){case"uuid":i=_g.uuid();break;case"randompick":i=_g.array.randomPick(s[n]);break;case"string":i=_g.string.randomGenerate(10);break;case"number":i=_g.number.randomInt();break;case"boolean":i=_g.boolean.randomPick();break;default:i=s[n]}r[n]=i}}),n.push(r)}return n.shift(),e.key?e.dataSource[e.key]=n:e.dataSource=n,e.dataSource},testSpeed:function(e){function u(){var e=(i-r)/1e3,t=s*8,n=(t/e).toFixed(2),o=(n/1024).toFixed(2),u=(o/1024).toFixed(2)}var t={file:null,fileSize:0,callback:null};e=e?$.extend(!0,{},t,e):$.extend(!0,{},t);if(!e.file)return!1;var n=e.file+"?n="+Math.random(),r,i,s=e.fileSize,o=new Image;o.onload=function(){i=(new Date).getTime(),u()},r=(new Date).getTime(),o.src=n}};typeof require=="undefined"?(window._g||(window._g={}),window._g.ajax=e,e=undefined):define("_g/ajax",["jquery","_g/base","_g/error"],function(){return window._g.ajax=e,e=undefined,window._g.ajax})})(window);define("interaction_view/model/vote",["_g/ajax","interaction_view/model/base"],function(){interaction_view.model.Vote=interaction_view.model.Base.extend({defaults:{iType:"Vote",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){var t=this.get("iDetail");this.setSubOverlays(),this.iview=new interaction_view.view.Vote({model:this})},setsyncmodel:function(){}}),interaction_view.view.Vote=interaction_view.view.Base.extend({events:{},getInitialValue:function(){return parseInt(this.model.get("iDetail").initial)||0},render:function(e){var t=this;this.voteUrl||(this.voteUrl=encodeURI(context_url+this.model.iPageId+"/vote/"+t.model.id+"/")),this.waitForVoted=!0,this.$el.find("img").hide(),_g.ajax.get({dataType:"JSON",url:t.voteUrl,callback:function(e){t.waitForVoted=!1;var n=t.getInitialValue();e.num_votes?(t.model.get("suboverlays")[0].iDetail.iValue=e.num_votes+n,t.model.set("value",e.num_votes+n),t.model.set("voted",e.vote_value),t.model.set("position",e.position+n),t.resetOtherStatus()):t.changeStatus(),this.waitForVoted2&&this.triggerVoted()}}),interaction_view.environment.Votes.add(this.model),this.model._reset=!0},preload:function(){this.preloaded=!1,this.checkImglist=[];var e=this.getdetail(),t=[null,null];if(e.iconNormal&&e.iconNormal[0]){this.checkImglist.push(e.iconNormal[0].picture);var n=this.sendToPreload({file:e.iconNormal[0].picture,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")});t[0]=n.id}if(e.iconActive&&e.iconActive[0]){this.checkImglist.push(e.iconActive[0].picture);var n=this.sendToPreload({file:e.iconActive[0].picture,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")});t[1]=n.id}this.sendToPreload({file:null,subcontainer:!0,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")}),this.model.set("preload_id",t)},checkImgload:function(e){return this.checkImglist=_.reject(this.checkImglist,function(t){return t==e}),this.checkImglist.length==0?!0:!1},afterpreload:function(e){if(e&&this.preloaded)return;e&&!this.preloaded&&(this.preloaded=this.checkImgload(e)),this.preloaded&&(this.setZindex(),this.setElementDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style"))},setOtherDisplay:function(){this.$el.css("cursor","pointer")},bindClick:function(){var e=this;e.vote||(e.vote=function(){e.model.get("suboverlays")[0].iDetail.iValue+=1,e.changeStatus(),_g.ajax.post({dataType:"JSON",url:e.voteUrl,data:{value:1},callback:function(t){var n=e.getInitialValue();t.num_votes&&(e.model.get("suboverlays")[0].iDetail.iValue=t.num_votes+n,interaction_view.environment.Votes.update(e.model),e.model.set("value",t.num_votes+n),e.model.set("voted",1),e.model.set("position",t.position+n),e.changeStatus())}})}),this.isVoted()?this.$el.off("click",e.vote):this.$el.one("click",e.vote)},changeStatus:function(){this.waitForVoted||(this.isVoted()?(this.$el.find("img.iconActive").show(),this.$el.find("img.iconNormal").hide(),this.active=!0):(this.$el.find("img.iconActive").hide(),this.$el.find("img.iconNormal").show(),this.active=!1)),this.setTitle()},resetOtherStatus:function(){this.changeStatus(),this.reseted||this.bindClick(),this.reseted=!0},triggerVoted:function(){this.noVoted()?this.waitForVoted2=!0:this.isVoted()&&interaction_view.events.onVoted(this)},setTitle:function(){var e=this.getdetail(),t=this.model.get("suboverlays"),n=interaction_view.formatLabel({text:t[0].iDetail.iValue,font_size:t[0].iDetail.font_size,text_color:t[0].iDetail.text_color,iPosition:t[0].iDetail.iPosition});this.$el.find(".iTextLabel.Element").html(n)},afterSubOverlayPreload:function(){this.preloadmodel&&(this.model.iOverlaylist.each(function(e){e.iview.preloaded||e.iview.afterpreload()}),this.model.iActionlist.each(function(e){e.iview.render()}),this.setTitle(),this.preloadmodel.set("loaded",!0),this.preloadmodel.page.ipreloadlist.preloadcheck(null,!0,this.model))},isVoted:function(){return this.model.get("voted")},noVoted:function(){return typeof this.model.get("voted")=="undefined"}})});define("text!interaction_view/template/prompt.js",[],function(){return'<div class="<%=class_name%>" style="display:none;">\n	<div class="modalArea" style="position: fixed;top: 50%;left: 50%;z-index: 10003;background: white;box-shadow: 0 0 60px rgba(0, 0, 0, .25); width: 480px;height: 235px; margin-left: -240px;margin-top: -120px;text-align: center;">\n		<div class="alert" style="text-align:left; margin-bottom: 0px;">输入文字 :</div>\n		<div style="padding: 10px 10px 10px;">\n			<textarea style="resize: none; width: 96%;height: 120px;border: 0px;" autofocus="autofocus"></textarea>\n			<div style="margin: 10px;">\n				<button type="button" style="margin-right: 40px;border-radius: 18px 18px;padding: 7px 28px;" class="btn btn-default cancel">取消</button>\n				<button type="button" style="border-radius: 18px 18px;padding: 7px 28px;" class="btn btn-danger ok">确认</button>\n			</div>\n		</div>\n	</div>\n	<div class="modal-backdrop fade in" style="z-index: 10002;"></div>\n</div>'});define("interaction_view/model/paragraph",["interaction_view/model/base","text!interaction_view/template/prompt.js"],function(){var e=require("text!interaction_view/template/prompt.js");interaction_view.model.Paragraph=interaction_view.model.Base.extend({defaults:{iType:"Paragraph",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Paragraph({model:this})},setsyncmodel:function(){}}),interaction_view.view.Paragraph=interaction_view.view.Base.extend({events:{},render:function(e){this.scrollEl=this.$el.children(".Element"),this.textel=this.$el.find(".iText"),this.originContent=this.model.attributes.iDetail.iText,typeof this.userContent=="undefined"&&(this.userContent=this.originContent),typeof message_link=="undefined"&&(message_link=location.href,interaction_view.weixin.share());var t=this.model.attributes.iDetail.iEditable?message_link:data_link,n=_g.getUrlParameterByName(this.model.id,t);if(n)this.updateText(n,addtourl=0);else{var r=_g.getHashParameterByName(this.model.id);r&&this.updateText(r,addtourl=0)}this.renderEdit(),this.model.attributes.iDetail.iEditable&&this.$el.find(".iParagraph").addClass("editable"),this.renderlink&&this.renderlink(),this.model._reset=!0},resetOtherStatus:function(){var e=this;if(_g.ui.isOverflowed(this.$el.children(".Element")).y){if(!this.$el.children(".Element").hasClass("disableDragY")){var t=this.$el.children(".Element").height();this.$el.children(".Element").wrapInner('<div class="iContent"></div>');var n=_g.ui.isOverflowed(this.$el.children(".Element")).y-t;this.scrollView=new IScroll(this.$el.children(".Element")[0],{mouseWheel:!0,click:!0,probeType:3}),this.scrollView.on("scroll",function(){console.log(this.y),n&&n>0&&(this.y>0?this.y>30&&e.scrollEl.addClass("is_exceededY"):Math.abs(this.y)-n>30&&e.scrollEl.addClass("is_exceededY"))}),this.scrollEl=this.$el.children(".Element"),this.$el.children(".Element").addClass("disableDragY iMouseWheel disableMouseWheelY")}this.$el.children(".Element").removeClass("is_exceededX"),this.$el.children(".Element").removeClass("is_exceededY")}},otherOnShow:function(){this.resetOtherStatus()},renderEdit:function(){var t=this,n=this.getdetail();if(n.iStaticImage||!n.iEditable)return;var r="ParagraphInput",i=_.template(e,{class_name:r});t.activeEdit=function(e){if(!interaction_view.environment.Paragraph.state()&&!e)return;var n=$("."+r);n.length||(n=$(i).appendTo("body")),n.show().attr("paragraph-id",t.model.id);var s=n.find(".modalArea");interaction_view.ismobile&&s.width($(document).width()),_g.ui.center({Item:s}),n.find("button.cancel").one("click",function(){n.remove()}),n.find("button.ok").one("click",function(){if(n.attr("paragraph-id")!=t.model.id)return;n.remove(),t.updateText(n.find("textarea").val().replace(/\n/g,"<br>"),addtourl=1)}),n.find("textarea").val(t.userContent.replace(/<br>/g,"\n"));var o=function(){n.find("textarea").focus().click(function(){$(this).focus()})};setTimeout(o,300)},t.$el.on("click",function(){t.activeEdit()})},updateText:function(e,t){this.userContent=e,this.textel.html(_g.util.htmlspecialchars(e));var n=!1;t&&(this.addToUrl(e),n=!0),this.resetOtherStatus(),n&&interaction_view.events.onParagraphChanged(this)},addToUrl:function(e){var t=this.model.id+"="+encodeURI(e),n=this.model.attributes.iDetail.iEditable?message_link:data_link,r=_g.getUrlParameterByName(this.model.id,n),i=0;if(!r){var s="?";n.indexOf("?")>=0&&(s="&"),n+=s+t}else encodeURI(r)!=encodeURI(e)?n=_g.replaceUrlParameterByName(this.model.id,t,n):i=1;i||(this.model.attributes.iDetail.iEditable?(message_link=n,interaction_view.weixin.share()):data_link=n);if(!interaction_view.forpreview&&!interaction_view.weixin.shareable()&&this.model.attributes.iDetail.iEditable){var o=_g.getHashParameterByName(this.model.id);o?encodeURI(o)!=encodeURI(e)?window.history.replaceState({},"",_g.replaceHashParameterByName(this.model.id,t)):i=1:window.history&&(document.location.hash?window.history.replaceState({},"",document.location.hash+="&"+t):window.history.replaceState({},"","#"+t))}return i?!1:!0}})});define("interaction_view/model/input",["interaction_view/model/base"],function(){interaction_view.model.Input=interaction_view.model.Base.extend({defaults:{iType:"Input",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Input({model:this})},setsyncmodel:function(){}}),interaction_view.view.Input=interaction_view.view.Base.extend({events:{},render:function(e){var t=this;this.$el.find("input").on("input",function(){console.log($(this).val()),interaction_view.events.onFormEvent(t.model,$(this).val())});var n=interaction_view.events.onFormButtonRender(this.model);n.value&&this.$el.find("input").val(n.value),this.setFormFieldType(n.field)},resetOtherStatus:function(){var e=interaction_view.events.onFormButtonRender(this.model);e.value&&this.$el.find("input").val(e.value)},setFormFieldType:function(e){if(!e||!interaction_view.ismobile)return;var t="text";console.log(e);var n=e.i.field_type;n=="number"&&(t="number"),n=="email"&&(t="email"),n=="url"&&(t="url"),t!="text"&&this.$el.find("input")[0].setAttribute("type",t)}})});define("interaction_view/model/textarea",["interaction_view/model/base"],function(){interaction_view.model.Textarea=interaction_view.model.Base.extend({defaults:{iType:"Textarea",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Textarea({model:this})},setsyncmodel:function(){}}),interaction_view.view.Textarea=interaction_view.view.Base.extend({events:{},render:function(e){var t=this;this.$el.find("textarea").on("input",function(){console.log($(this).val()),interaction_view.events.onFormEvent(t.model,$(this).val())});var n=interaction_view.events.onFormButtonRender(this.model);n.value&&this.$el.find("textarea").html(n),this.model._reset=!0},resetOtherStatus:function(){var e=interaction_view.events.onFormButtonRender(this.model);e.value&&this.$el.find("textarea").html(e)}})});define("interaction_view/model/selectbutton",["interaction_view/model/button"],function(){interaction_view.model.SelectButton=interaction_view.model.Button.extend({defaults:{iType:"SelectButton",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0},setview:function(e){var t=this.get("iDetail");t.isSwitch&&(this.isSwitch=!0),this.iview=new interaction_view.view.SelectButton({model:this})}}),interaction_view.view.SelectButton=interaction_view.view.Button.extend({events:{},render:function(e){var t=interaction_view.events.onFormButtonRender(this.model);t.value&&this.setActiveStatus()},afterpreload:function(e){if(e&&this.preloaded)return;e&&!this.preloaded&&(this.preloaded=this.checkImgload(e)),this.preloaded&&(this.setZindex(),this.setElementDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style"))},setOtherDisplay:function(){this.active=!1,this.buttonon=!1;var e=this;this.$el.css("cursor","pointer");var t=this.getdetail();if(t.isSwitch)this.$el.on("click",function(t){e.changeStatus()});else{if(interaction_view.ismobile)var n="touchstart",r="touchend";else var n="mousedown",r="mouseup";this.$el.on(n,function(t){e.buttonon=!0,e.changeStatus()}),this.$el.on(r,function(t){e.buttonon&&(e.buttonon=!1,e.changeStatus())})}},changeStatus:function(){var e=this.getdetail(),t=this;if(!t.active)t.$el.find("img.iconActive").show(),t.$el.find("img.iconNormal").hide(),t.active=!0,e.isSwitch&&interaction_view.events.onFormEvent(t.model,t.active);else{if(t.groupcontrol&&e.isSwitch)return;if(interaction_view.application.isBindingButton(t.model))return;if(t.model.get("isTabBarSelectButton"))return;t.$el.find("img.iconActive").hide(),t.$el.find("img.iconNormal").show(),t.active=!1,interaction_view.events.onFormEvent(t.model,t.active)}},resetOtherStatus:function(){this.resetButtonStatus()},resetButtonStatus:function(){this.$el.find("img.iconActive").hide(),this.$el.find("img.iconNormal").show(),this.active=!1;var e=interaction_view.events.onFormButtonRender(this.model);e.value&&this.setActiveStatus()}})});define("interaction_view/model/submitbutton",["interaction_view/model/button"],function(){interaction_view.model.SubmitButton=interaction_view.model.Button.extend({defaults:{iType:"SubmitButton",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0},setview:function(e){var t=this.get("iDetail");t.isSwitch&&(this.isSwitch=!0),this.iview=new interaction_view.view.SubmitButton({model:this})}}),interaction_view.view.SubmitButton=interaction_view.view.Button.extend({events:{},render:function(e){},afterpreload:function(e){if(e&&this.preloaded)return;e&&!this.preloaded&&(this.preloaded=this.checkImgload(e)),this.preloaded&&(this.setZindex(),this.setElementDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style"))},setOtherDisplay:function(){this.active=!1,this.buttonon=!1;var e=this;this.$el.css("cursor","pointer");var t=this.getdetail();if(t.isSwitch)this.$el.on("click",function(t){e.changeStatus(),interaction_view.events.onFormEvent(e.model)});else{if(interaction_view.ismobile)var n="touchstart",r="touchend";else var n="mousedown",r="mouseup";this.$el.on(n,function(t){e.buttonon=!0,e.changeStatus()}),this.$el.on(r,function(t){e.buttonon&&(e.buttonon=!1,e.changeStatus(),window.setTimeout(function(){interaction_view.events.onFormEvent(e.model)},500))})}},changeStatus:function(){var e=this.getdetail(),t=this;if(!t.active)t.$el.find("img.iconActive").show(),t.$el.find("img.iconNormal").hide(),t.active=!0;else{if(t.groupcontrol&&e.isSwitch)return;if(t.model.get("isTabBarSubmitButton"))return;t.$el.find("img.iconActive").hide(),t.$el.find("img.iconNormal").show(),t.active=!1}},resetOtherStatus:function(){this.resetSubmitButtonStatus()},resetSubmitButtonStatus:function(){this.$el.find("img.iconActive").hide(),this.$el.find("img.iconNormal").show(),this.active=!1}})});define("interaction_view/model/selectbox",["interaction_view/model/base"],function(){interaction_view.model.SelectBox=interaction_view.model.Base.extend({defaults:{iType:"SelectBox",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.SelectBox({model:this})},setsyncmodel:function(){}}),interaction_view.view.SelectBox=interaction_view.view.Base.extend({events:{},render:function(e){var t=this;this.$el.find("input").on("change",function(){var e=$(this).is(":checked");interaction_view.events.onFormEvent(t.model,e);if($(this).closest(".layer-mask").length){var n=this;setTimeout(function(){e?$(n).attr("checked","checked"):$(n).removeAttr("checked")},100)}});var n=interaction_view.events.onFormButtonRender(this.model);n.value&&this.$el.find("input").attr("checked","checked"),this.isRadio&&this.$el.find("input")[0].setAttribute("type","radio")},resetOtherStatus:function(){this.resetButtonStatus()},resetButtonStatus:function(){interaction_view.application.isBindingButton(this.model)&&(this.isRadio=!0,this.$el.find("input")[0].setAttribute("type","radio"));var e=interaction_view.events.onFormButtonRender(this.model);e.value?this.$el.find("input").attr("checked","checked"):this.$el.find("input").removeAttr("checked")}})});define("interaction_view/model/imageblock",["interaction_view/model/base"],function(){interaction_view.model.ImageBlock=interaction_view.model.Base.extend({setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.ImageBlock({model:this})},setsyncmodel:function(){}}),interaction_view.view.ImageBlock=interaction_view.view.Base.extend({render:function(){this.renderEdit()},getArgs:function(){var e=this,t=this.getdetail();if(t.iEditable){var n=e.getFromUrl().split(",");if(n.length<5)return;t.iImg[0].picture=n[0]||t.iImg[0].picture,e.args=n,e.model._rotate=n[4],e.model._scale=n[3],e.model._x=n[1],e.model._y=n[2]}},preload:function(){this.getArgs()},setOtherDisplay:function(){var e=this.getdetail(),t=this.$el.children(".Element").children("img");if(this.args){var n=this.args[4],r=this.args[3],i=this.args[1],s=this.args[2],o="rotate("+n+"deg) scale("+r+") skew(0deg) translate("+i+"px ,"+s+"px)";t.css({"-webkit-transform":o,width:"100%",height:"auto"}),t.parent().css({overflow:"hidden"});return}e.iDisplay&&e.iImg&&e.iImg.length>0&&_g.ui.fitImage({fit:Number(e.iDisplay),width:e.iImg[0].width,height:e.iImg[0].height,items:t})},getFromUrl:function(){var e=_g.getUrlParameterByName(this.model.id,message_link);return e||(e=_g.getHashParameterByName(this.model.id)),decodeURI(e||"")},removeFromUrl:function(){var e=_g.getUrlParameterByName(this.model.id,message_link);e&&(message_link=_g.replaceUrlParameterByName(this.model.id,"",message_link),message_link=message_link.replace("&&","&").replace("?&","?"),interaction_view.weixin.share());var t=_g.getHashParameterByName(this.model.id);if(t){var n=_g.replaceHashParameterByName(this.model.id,"");window.history.replaceState({},"",n.replace("#&","#").replace("&&","&"))}return!e&&!t?!1:!0},addToUrl:function(e,t,n,r,i){var s=this,o=this.getdetail(),u=(e==o.iImg[0].origin?"":e)+","+t+","+n+","+r+","+i,a=this.model.id+"="+encodeURI(u),f=_g.getUrlParameterByName(this.model.id,message_link),l=0;if(!f){var c="?";message_link.indexOf("?")>=0&&(c="&"),message_link+=c+a,interaction_view.weixin.share()}else encodeURI(f)!=encodeURI(a)?(message_link=_g.replaceUrlParameterByName(this.model.id,a,message_link),interaction_view.weixin.share()):l=1;if(!interaction_view.forpreview){var h=_g.getHashParameterByName(this.model.id);h?encodeURI(h)!=encodeURI(a)?window.history.replaceState({},"",_g.replaceHashParameterByName(this.model.id,a)):l=1:window.history&&(document.location.hash?window.history.replaceState({},"",document.location.hash+="&"+a):window.history.replaceState({},"","#"+a))}return l?!1:!0},renderEdit:function(){var e=this,t=this.getdetail();if(!t.iEditable)return;e.activeEdit=function(t){if(!interaction_view.environment.Paragraph.state()&&!t)return;typeof wx_permissions!="undefined"&&wx_permissions.chooseImage&&(interaction_view.localIds?setTimeout(function(){e.setweixinimage(interaction_view.localIds[0])},100):interaction_view.weixin.chooseimage(function(t){t&&(interaction_view.localIds=t,e.setweixinimage(t[0]))}))},e.$el.children(".Element").on("click",function(){e.activeEdit(!0)})},setweixinimage:function(e){var t=this,n=e;this.$el.find("img").attr("src",n);var r=this.getcommon(),i=r.iWidth,s=r.iHeight,o=this.model;interaction_view.imageEditor(this.model,i,s,n,function(e,r,i,s){var u=t.$el.children(".Element").children("img");o._x=e,o._y=r,o._scale=i,o._rotate=s;if(t.model.localId&&t.model.localId==n){t.addToUrl(t.model.pic,e,r,i,s);return}_g.device.ios()&&u.attr("src",n),interaction_view.imageUploader(n,function(o){_g.device.android()&&u.attr("src",o),t.model.localId=n,t.model.pic=o;var a=t.getdetail();a.iImg[0].picture=o,t.addToUrl(o,e,r,i,s)})},t.setweixinimage)}})});define("interaction_view/model/weixincamera",["interaction_view/model/button"],function(){interaction_view.model.WeixinCamera=interaction_view.model.Button.extend({defaults:{iType:"WeixinCamera",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null},setview:function(e){var t=this.get("iDetail");t.isSwitch&&(this.isSwitch=!0),this.iview=new interaction_view.view.WeixinCamera({model:this})}}),interaction_view.view.WeixinCamera=interaction_view.view.Button.extend({events:{},render:function(e){},afterpreload:function(e){if(e&&this.preloaded)return;e&&!this.preloaded&&(this.preloaded=this.checkImgload(e)),this.preloaded&&(this.setZindex(),this.setElementDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style"))},setOtherDisplay:function(){this.active=!1,this.buttonon=!1;var e=this;this.$el.css("cursor","pointer");var t=this.getdetail();if(interaction_view.ismobile)var n="touchstart",r="touchend";else var n="mousedown",r="mouseup";this.$el.on(n,function(t){e.buttonon=!0,e.changeStatus()}),this.$el.on(r,function(t){e.buttonon&&(e.buttonon=!1,e.changeStatus(),_g.device.isWeixin()?window.setTimeout(function(){interaction_view.weixin.chooseimage(function(t){t?(interaction_view.localIds=t,interaction_view.events.onWeixinEvent(e,71)):interaction_view.events.onWeixinEvent(e,72)})},500):interaction_view.errorAlert("请在微信中操作"))})},changeStatus:function(){var e=this.getdetail(),t=this;t.active?(t.$el.find("img.iconActive").hide(),t.$el.find("img.iconNormal").show(),t.active=!1):(t.$el.find("img.iconActive").show(),t.$el.find("img.iconNormal").hide(),t.active=!0)},resetOtherStatus:function(){this.resetWeixinCameraStatus()},resetWeixinCameraStatus:function(){this.$el.find("img.iconActive").hide(),this.$el.find("img.iconNormal").show(),this.active=!1}})});define("interaction_view/model/weixinvoice",["interaction_view/model/button"],function(){interaction_view.model.WeixinVoice=interaction_view.model.Button.extend({defaults:{iType:"WeixinVoice",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null},setview:function(e){var t=this.get("iDetail");t.isSwitch&&(this.isSwitch=!0),this.iview=new interaction_view.view.WeixinVoice({model:this})}}),interaction_view.view.WeixinVoice=interaction_view.view.Button.extend({events:{},render:function(e){},afterpreload:function(e){if(e&&this.preloaded)return;e&&!this.preloaded&&(this.preloaded=this.checkImgload(e)),this.preloaded&&(this.setZindex(),this.setElementDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style"))},setOtherDisplay:function(){this.active=!1,this.buttonon=!1;var e=this;this.$el.css("cursor","pointer");var t=this.getdetail();if(interaction_view.ismobile)var n="touchstart",r="touchend";else var n="mousedown",r="mouseup";this.$el.on(n,function(t){e.buttonon=!0,e.changeStatus()}),this.$el.on(r,function(t){e.buttonon&&(e.buttonon=!1,e.changeStatus(),_g.device.isWeixin()?window.setTimeout(function(){interaction_view.voiceEditor(function(t){t?(interaction_view.voicelocalId=t,interaction_view.events.onWeixinEvent(e,71)):interaction_view.events.onWeixinEvent(e,72)})},500):interaction_view.errorAlert("请在微信中操作"))})},changeStatus:function(){var e=this.getdetail(),t=this;t.active?(t.$el.find("img.iconActive").hide(),t.$el.find("img.iconNormal").show(),t.active=!1):(t.$el.find("img.iconActive").show(),t.$el.find("img.iconNormal").hide(),t.active=!0)},resetOtherStatus:function(){this.resetWeixinVoiceStatus()},resetWeixinVoiceStatus:function(){this.$el.find("img.iconActive").hide(),this.$el.find("img.iconNormal").show(),this.active=!1}})});define("text!interaction/template/infoList_content.js",[],function(){return'<% var position = ["left", "center", "right"]; _.each(infolist, function(v,i){ %>\n<table style="margin: 0;<%=(page&&i==0)?"":"border-top: 1px solid;"%> <%=(infolist.length==i+1)?"border-bottom: 1px solid;":""%>border-color:<%=iDetail.stroke_color%>">\n	<tr>\n		<td style="width: 50px; vertical-align: top;<%=iDetail.iPortrait?"":"display:none"%>">\n			<div style="background-image: url(<%=v.portrait||"/staticfs/diazo/img/avatar.png"%>);width: 30px;height: 30px;margin: 10px;background-size: cover;	background-position: 50% 50%;border-radius: 40px;"></div>\n		</td>\n		<td style="vertical-align: top;padding: 5px;">\n			<p style="margin: 0;font-size: 13px;font-weight: bold;<%=iDetail.iNickname?"":"display:none;"%> color:<%=iDetail.nickname_color%>; min-height:21px;"><%=_g.util.htmlspecialchars(v.nickname||"")%></p>\n			<p style="color:<%=iDetail.font_color%>;font-size:<%=iDetail.font_size%>px;text-align:<%=position[iDetail.iPosition]%>;"><%=_g.util.htmlspecialchars(v[iDetail.iField])%></p>\n		</td>\n	</tr>\n</table>\n<%})%>'});define("interaction_view/model/infoList",["interaction_view/model/base","text!interaction/template/infoList_content.js","text!interaction_view/template/prompt.js"],function(){var e=require("text!interaction/template/infoList_content.js"),t=require("text!interaction_view/template/prompt.js");interaction_view.model.InfoList=interaction_view.model.Base.extend({setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.InfoList({model:this})},setsyncmodel:function(){}}),interaction_view.view.InfoList=interaction_view.view.Base.extend({render:function(){this.totalInfoPage=0,this.currentPage=1,this.pullUpInfo=["上拉加载更多","释放更新"],this.model._reset=!0},resetOtherStatus:function(){this.getInfo()},renderUrl:function(e){var t=this.getdetail(),n=t.iAppUrl+"infolist.json";return n+="?iField="+t.iField,this.currentPage>1&&!e?n+="&size="+t.size*this.currentPage:n+="&size="+t.size,n+="&sort_by="+t.sort_by,n+="&sort_order="+(t.sord_order?1:-1),t.sort_by==1&&(n+="&unique="+t.unique),e&&(n+="&page="+e),n},getInfo:function(t){var n=this,r=this.getdetail(),i,s=!1;t?(this.currentPage<this.totalInfoPage?this.currentPage++:s=!0,i=n.renderUrl(this.currentPage)):i=n.renderUrl(),s||_g.ajax.get({dataType:"JSON",url:i,callback:function(i){if(i.code==200){n.totalInfoPage=Math.ceil(i.data.sum/r.size);var s=_.template(e,{infolist:i.data.results,iDetail:r,page:t}),o={x:0,y:0};t?(o=n.scrollview.iScroll.getComputedPosition(),n.$el.find(".info-content .lists").append(s)):n.$el.find(".info-content .lists").html(s),n.renderScroll(o),n.updatePullUpInfo()}else n.$el.find(".info-content .lists").html("空")}})},postInfo:function(){var e=this,n=this.getdetail(),r="InfoListInput",i=_.template(t,{class_name:r}),s=$("."+r);s.length||(s=$(i).appendTo("body")),s.show().attr("infolist-id",e.model.id);var o=s.find(".modalArea");interaction_view.ismobile&&o.width($(document).width()),_g.ui.center({Item:o}),s.find("textarea").val("");var u=function(){s.find("textarea").focus().click(function(){$(this).focus()})};setTimeout(u,300),s.find("button.cancel").one("click",function(){s.remove()}),s.find("button.ok").one("click",function(){if(s.attr("infolist-id")!=e.model.id)return;s.remove();var t={};t[n.iField]=s.find("textarea").val(),_g.ajax.post({dataType:"JSON",url:n.iAppUrl+"?format=json",data:t,callback:function(t){t.code==200&&e.getInfo()}})})},updatePullUpInfo:function(){this.currentPage>=this.totalInfoPage?this.pullUpInfo=["没有更多了","没有更多了"]:this.pullUpInfo=["上拉加载更多","释放更新"],this.$el.find(".info-content .pullUp").html(this.pullUpInfo[0]).text(this.pullUpInfo[0])},getLayerContentSize:function(){var e={width:0,height:0},t;return e.width=this.$el.find(".info-content .lists").width(),e.height=this.$el.find(".info-content .lists").height(),t=this.$el.find(".Element").height(),e.height<=t&&(e.height=t),e.height+=10,e},renderScroll:function(e){this.scrollview&&this.scrollview.iScroll.destroy();var t=this,n=this.getMoveRange(),r=this.$el.find(".Element"),i=0;this.scrollview=new _g.scrollview({containment:r,contentel:this.$el.find(".info-content"),mask_width:r.width(),mask_height:r.height(),content_width:this.getLayerContentSize().width,content_height:this.getLayerContentSize().height,content_x:0,content_y:e.y,scrollY:n.y>0?!0:!1,onScrolling:function(e){if(n.y>0){e.deltaY>0&&t.$el.find(".info-content .pullUp").hide(),e.deltaY<-5-n.y&&t.$el.find(".info-content .pullUp").show();if(-e.deltaY>n.y+30)i=1,t.$el.find(".info-content .pullUp").html(t.pullUpInfo[1]).text(t.pullUpInfo[1]);else{if(!(e.deltaY>30)){t.$el.find(".info-content .pullUp").html(t.pullUpInfo[0]).text(t.pullUpInfo[0]),t.$el.find(".info-content .pullDown").html("下拉刷新").text("下拉刷新");return}i=2,t.$el.find(".info-content .pullDown").html("释放更新").text("释放更新")}r.addClass("is_exceededY")}},onScrollend:function(){i>0&&t.getInfo(i==1),r.removeClass("is_exceededY"),t.$el.find(".info-content").find(".pullUp").hide()}}),this.$el.addClass("hascontrols")}})});;define('highcharts',function(){});;define('/Users/blues/projects/epub360/1-src/epub360-built/html/common/js/highcharts/charts.js',function(){});;define("text!interaction/template/chartList_content.js",[],function(){return'<div style="color:<%=iDetail.font_color%>;font-size:<%=iDetail.font_size%>px;">\n   <p style="font-weight:bold;margin:2px;"><%=iDetail.label%></p>\n   <p style="text-align:right;margin:2px;">参与人数：<span><%=infolist.sum%></span></p>\n   <% var position = ["left", "center", "right"]; _.each(infolist.items, function(v,i){ %>\n	<table style="margin: 0;border-top: 1px solid;<%=(infolist.length==i+1)?"border-bottom: 1px solid;":""%>border-color:<%=iDetail.stroke_color%>">\n		<tr>\n			<td style="width:20px;text-align:left;padding: 2px;"><%=i+1%>.</td>\n			<td style="text-align:<%=position[iDetail.iPosition]%>;font-size:<%=iDetail.font_size%>px;"><%=v.value%></td>\n		</tr>\n		<tr>\n			<td colspan="2">\n				<div style="width:100%;height:13px;background-color:#D9D9D9">\n					<div style="width: <%=(v.count/infolist.sum*100).toFixed(2)%>%;background-color:<%=Colors[i%10]%>;height:100%"></div>\n				</div>\n			</td>\n		</tr>\n		<tr><td colspan="2" style="text-align:right;padding: 2px;"><%=v.count%>人 <%=(v.count/infolist.sum*100).toFixed(2)%>%</td></tr>\n	</table>\n   <%})%>\n</div>'});define("interaction_view/model/chartList",["interaction_view/model/base","highcharts","text!interaction/template/chartList_content.js"],function(){var e=require("text!interaction/template/chartList_content.js");interaction_view.model.ChartList=interaction_view.model.Base.extend({setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.ChartList({model:this})},setsyncmodel:function(){}}),interaction_view.view.ChartList=interaction_view.view.Base.extend({render:function(){this.Colors=["#50d92b","#5dbc5e","#9fb5ef","#a5cbd6","#d743b3","#e2fea9","#fd7a99","#fce096","#e6f63b","#e7ab6d"],this.model._reset=!0},resetOtherStatus:function(){this.getInfo()},renderUrl:function(e){var t=this.getdetail(),n=t.iAppUrl+"chartlist.json";return n+="?iField="+t.iField,n},getInfo:function(e){var t=this,n=this.getdetail();_g.ajax.get({dataType:"JSON",url:t.renderUrl(),callback:function(e){if(e.code==200&&e.data.results.length>0){var r={sum:e.data.sum,items:e.data.results.length?e.data.results[0].items:[]};(n.sort_by=1)&&r.items.sort(function(e,t){return n.sord_order?parseInt(e.count)>parseInt(t.count):parseInt(e.count)<parseInt(t.count)}),t.renderChart(r),t.renderScroll()}else t.$el.find(".info-content .lists").html("空")}})},renderChart:function(t){var n=this,r,i=this.getdetail();if(i.iKind==0)r=_.template(e,{infolist:t,iDetail:i,Colors:n.Colors}),n.$el.find(".info-content .lists").html(r);else{var s=[],o=n.getcommon().iWidth,u=n.getcommon().iHeight;_.each(t.items,function(e,t){s.push([e.value,Number(e.count)])}),n.$el.find(".info-content .lists").highcharts({chart:{backgroundColor:null,plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:i.label},credits:{enabled:!1},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0}},legend:{itemStyle:{"font-size":i.font_size+"px",color:i.font_color}},series:[{type:"pie",name:"占比",data:s}]}),n.$el.find(".info-content .lists .highcharts-button").hide(),n.$el.find(".info-content .lists .highcharts-title").css("font-size",i.font_size)}},getLayerContentSize:function(){var e={width:0,height:0},t;return e.width=this.$el.find(".info-content .lists").width(),e.height=this.$el.find(".info-content .lists").height(),t=this.$el.find(".Element").height(),e.height<=t&&(e.height=t),e.height*=1.03,e},renderScroll:function(){this.scrollview&&this.scrollview.iScroll.destroy();var e=this,t=this.getMoveRange(),n=this.$el.find(".Element"),r=0;this.scrollview=new _g.scrollview({containment:n,contentel:this.$el.find(".info-content"),mask_width:n.width(),mask_height:n.height(),content_width:this.getLayerContentSize().width,content_height:this.getLayerContentSize().height,content_x:0,content_y:0,scrollY:t.y>0?!0:!1,onScrolling:function(i){if(t.y>0){if(!(i.deltaY>30)){e.$el.find(".info-content .pullDown").html("下拉刷新").text("下拉刷新");return}r=1,e.$el.find(".info-content .pullDown").html("释放更新").text("释放更新"),n.addClass("is_exceededY")}},onScrollend:function(){r>0&&e.getInfo(),n.removeClass("is_exceededY")}}),this.$el.addClass("hascontrols")}})});define("interaction_view/model/componentref",["interaction_view/model/layerref"],function(){interaction_view.model.ComponentRef=interaction_view.model.LayerRef.extend({defaults:{iType:"ComponentRef",iDraggable:!0,iResizable:!0,iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,callback:null},setiview:function(){var e=this.get("iCommon");this.offset=this.getOffset(e),e.landscape.iStartx=0,e.landscape.iStarty=0,e.landscape.iWidth=interaction_view.size.x,e.landscape.iHeight=interaction_view.size.y,this.iview=new interaction_view.view.ComponentRef({model:this})},setsyncmodel:function(){},filterlayers:function(){var e=this,t=this.get("iDetail"),n=t.layer_ids;this.components={},t.layer_ids&&t.layer_ids.length>0&&(n=_.filter(n,function(t){var n=interaction_view.iComponentlist.get(t);return n&&(e.components[t]=n),n})),t.layer_ids=n,this.set("iDetail",t)},getOffset:function(e){var t={x:0,y:0},n=this.get("iDetail");if(n.layer_ids&&n.layer_ids.length){var r=n.layer_ids[0],i=this.getComponentSize(r);t={x:e.landscape.iStartx-i.left,y:e.landscape.iStarty-i.top}}return t},getComponentSize:function(e,t){t||(t={w:200,h:200,left:null,top:null,bottom:null,right:null});var n=this.components[e];if(n){var r=n.overlays;_.each(r,function(e){t.left==null?(t.left=e.iCommon[iPageDirection].iStartx,t.top=e.iCommon[iPageDirection].iStarty,t.right=e.iCommon[iPageDirection].iStartx+e.iCommon[iPageDirection].iWidth,t.bottom=e.iCommon[iPageDirection].iStarty+e.iCommon[iPageDirection].iHeight):(t.left=t.left<e.iCommon[iPageDirection].iStartx?t.left:e.iCommon[iPageDirection].iStartx,t.top=t.top<e.iCommon[iPageDirection].iStarty?t.top:e.iCommon[iPageDirection].iStarty,t.right=t.right>e.iCommon[iPageDirection].iStartx+e.iCommon[iPageDirection].iWidth?t.right:e.iCommon[iPageDirection].iStartx+e.iCommon[iPageDirection].iWidth,t.bottom=t.bottom>e.iCommon[iPageDirection].iStarty+e.iCommon[iPageDirection].iHeight?t.bottom:e.iCommon[iPageDirection].iStarty+e.iCommon[iPageDirection].iHeight)})}return t.left!=null&&t.top!=null&&(t.w=t.right-t.left,t.h=t.bottom-t.top),t}}),interaction_view.view.ComponentRef=interaction_view.view.LayerRef.extend({events:{},render:function(e){this.$el.css({width:"100%",height:"100%"}),this.renderMask(),this.model._reset=!0},renderMask:function(){},preload:function(){var e=this.model.get("iDetail");e.layer_ids&&e.layer_ids.length>0&&this.sendToPreload({file:null})},loadLayer:function(e){var t=this.getdetail();this.layerCheckList=_.clone(t.layer_ids),this.firstlayer=t.layer_ids?t.layer_ids[0]:null,this.preloadmodel=e;var n=require("interaction_view/view/layer");n=_g.mvc.createView(n),this.layerview=new n({model:this.model}),this.layerview.afterload()},afterlayerload:function(e){console.log(e);if(this.preloadmodel){this.layerCheckList=_.reject(this.layerCheckList,function(t){return t==e}),this.model.layer[e].iOverlaylist.each(function(e){e.iview.preloaded||e.iview.afterpreload()}),this.model.layer[e].iActionlist.each(function(e){e.iview.render()});var t=this.model.toJSON().iDetail.iHidden||!1;this.layerCheckList.length==0&&(this.$el.addClass("hide").css("opacity",""),this.slideel=this.$el.find(".layer-content").first(),this.slideel.children(".layer-item").first().show(),this.slidestyle=this.slideel.attr("style"),this.playAnimation(),this.firstlayer&&this.model.get("iType")=="ComponentRef"&&(this.model.layer[this.firstlayer].isLayer=!0),this.preloadmodel.set("loaded",!0),this.preloadmodel.page.ipreloadlist.preloadcheck(null,!0,this.model))}},playLayer:function(){this.firstlayer&&interaction_view.play(this.model.layer[this.firstlayer])},playAnimation:function(){var e=this,t=this.getdetail();this.$el.find(".layer-content").children().css("opacity",1)},onExecuteBindingForComponentRef:function(e){var t=this,n=this.getMoveRange();if(e.type==1)return;e.cdirection||n.x>0&&this.scrollview&&this.scrollview.iScroll.scrollTo(-e.deltarate*n.x,this.getCurrentPosition().top),e.cdirection&&n.y>0&&this.scrollview&&this.scrollview.iScroll.scrollTo(this.getCurrentPosition().left,-e.deltarate*n.y)},getCurrentPosition:function(){if(this.$el.find(".layer-content").length>0){var e={left:0,top:0};return this.scrollview&&(e={left:this.scrollview.iScroll.x,top:this.scrollview.iScroll.y}),e}return{left:0,top:0}},getCurrentPositionRate:function(){var e=0,t=0,n=this.getMoveRange(),r=this.getCurrentPosition();return n.x&&(e=-r.left/n.x),n.y&&(t=-r.top/n.y),{left:e,top:t}},getLayerContentSize:function(){var e=this.getdetail(),t={};return!e.layer_ids||e.layer_ids.length>0?(t.width=interaction_view.size.x,t.height=interaction_view.size.y,t):null},stoplayer:function(){var e=this,t=this.getdetail();t.layer_ids&&t.layer_ids.length>0&&_.each(t.layer_ids,function(t){e.model.layer[t].iAnimationlist.timeline&&e.model.layer[t].iAnimationlist.timeline.pause(0),e.model.layer[t].iOverlaylist.resetViewStatus(),interaction_view.bezierPatch&&interaction_view.bezierPatch(e.model.layer[t])})},resetlayer:function(){var e=this,t=this.getdetail();t.layer_ids&&t.layer_ids.length>0&&(_.each(t.layer_ids,function(t){e.model.layer[t].iAnimationlist.resetAnimationStatus(),e.model.layer[t].iOverlaylist.resetViewStatus()}),!this.model.bindingfixed&&this.slideel&&this.slideel.attr("style",this.slidestyle),e.currentIndex=0)},resetOtherStatus:function(){this.resetlayer()},onShow:function(e){var t=this.getdetail(),n=this;t.layer_ids&&t.layer_ids.length>0&&_.each(t.layer_ids,function(r){e&&t.layer_ids.indexOf(r)==e?n.model.layer[r].iOverlaylist.each(function(e){e.iview.onShow()}):n.model.layer[r].iOverlaylist.each(function(e){e.iview.onShow()})})},onBeforeHide:function(e){var t=this.getdetail(),n=this;t.layer_ids&&t.layer_ids.length>0&&_.each(t.layer_ids,function(r){(!e||t.layer_ids.indexOf(r)!=e)&&n.model.layer[r].iOverlaylist.each(function(e){e.iview.onBeforeHide(),_.include(["RichText","Region"],e.get("iType"))&&e.iview.resetOtherStatus()})})},onHide:function(e){var t=this.getdetail(),n=this;t.layer_ids&&t.layer_ids.length>0&&_.each(t.layer_ids,function(r){(!e||t.layer_ids.indexOf(r)!=e)&&n.model.layer[r].iOverlaylist.each(function(e){e.iview.onHide()})})},onSizeAdaptChange:function(){}})});define("interaction_view/model/textbutton",["interaction_view/model/paragraph"],function(){interaction_view.model.TextButton=interaction_view.model.Paragraph.extend({defaults:{iType:"TextButton",iSync:!1},setview:function(){this.iview=new interaction_view.view.TextButton({model:this})}}),interaction_view.view.TextButton=interaction_view.view.Paragraph.extend({renderlink:function(){var e=this;if(interaction_view.forpreview)return!1;var t=this.model.get("iDetail");this.$el.children(".Element").on("click",function(){if(!t.linktype&&t.page_id){if(interaction_view.ipagelist.get(t.page_id))return presentation.gotopage(t.page_id,0),!1}else if(t.linktype==1&&t.url)return document.location.href=t.url,!1})}})});define("interaction_view/model/collision",["interaction_view/model/base"],function(){interaction_view.model.Collision=interaction_view.model.Base.extend({defaults:{},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Collision({model:this})},setsyncmodel:function(){}}),interaction_view.view.Collision=interaction_view.view.Base.extend({resetOtherStatus:function(){},render:function(e){this.peers=this.getPeers(),this.bindHitDetect(),this.hitState={},this.cachePos={}},getPeers:function(){var e=this.getdetail(),t=[];return _.each(e.target_ids,function(n,r){_.each(e.source_ids,function(e,r){e!=n&&t.push([e,n])})}),t},bindHitDetect:function(){var e=this;_.each(e.peers,function(t,n){_.each(t,function(n,r){var i=interaction_view.getParentpage(e.model.page.id),s=i.iAnimationlist.where({overlay_id:n});_.each(s,function(r,i){var s={type:"animation",page_id:e.model.page.id,overlay_id:n,animation_id:r.id,layer_id:e.model.get("layer_id")};s.func=function(){e.hitDetect(t[0],t[1],n)},interaction_view.events.animationUpdateEvents.push(s)});var o=i.get("overlays").filter(function(e){return e.id==n});if(o.length&&o[0].iDetail.draggable){var u={page_id:e.model.page.id,overlay_id:n,layer_id:e.model.get("layer_id")};u.func=function(){e.hitDetect(t[0],t[1],n)},interaction_view.events.draggingEvents.push(u)}})})},setHitState:function(e,t,n){this.hitState[e+t]=n,this.hitState[t+e]=n},getHitState:function(e,t){return this.hitState[e+t]},hitDetect:function(e,t,n){this.cachePos[n]=[!1,{}];if(this.isHit(e,t)){var r=this.getdetail(),i=!0;r.trigger=="once"&&this.getHitState(e,t)&&(i=!1),i&&(r.hide_source&&this.getModel(e).iview.$el.addClass("hide"),interaction_view.events.onCollision(this)),this.setHitState(e,t,!0)}else this.setHitState(e,t,!1)},isHit:function(e,t){var n=this,r=this.getdetail(),i=n.getModel(e),s=n.getModel(t);return i&&s?(i=i.iview.$el,s=s.iview.$el,i.css("opacity")==0||s.css("opacity")==0||i.css("display")=="none"||s.css("display")=="none"?!1:r.source_offset_type=="center"?r.target_offset_type=="center"?n.isHitCC(i,s):n.isHitCR(i,s):r.target_offset_type=="center"?n.isHitRC(i,s):n.isHitRR(i,s)):!1},getModel:function(e){return interaction_view.getParentpage(interaction_view.currentPage).iOverlaylist.where({id:e})[0]},isHitCC:function(e,t){var n=this,r=this.getdetail(),i=n.getCoord(e,"circle",r.source_offset),s=n.getCoord(t,"circle",r.target_offset);return n.isCircleHitCircle(i,s)},isHitCR:function(e,t){var n=this,r=this.getdetail(),i=n.getCoord(e,"circle",r.source_offset),s=n.getCoord(t,"rect",r.target_offset);return n.isCircleHitRect(i,s)},isHitRC:function(e,t){var n=this,r=this.getdetail(),i=n.getCoord(e,"rect",r.source_offset),s=n.getCoord(t,"circle",r.target_offset);return n.isCircleHitRect(s,i)},isHitRR:function(e,t){var n=this,r=this.getdetail(),i=n.getCoord(e,"rect",r.source_offset),s=n.getCoord(t,"rect",r.target_offset);return n.isRectHitRect(i,s)},getCoord:function(e,t,n){var r=this,i=this.getdetail();if(r.cachePos[e[0].id]&&r.cachePos[e[0].id][0])return r.cachePos[e[0].id][1];var s=r.getOffsetXY(e);e.hasClass("static")&&(s={x:s.x+e.children().width()/2,y:s.y+e.children().height()/2});var o;switch(t){case"circle":o={o:s,r:n};break;case"rect":var u=e.children().width(),a=e.children().height(),f=r.getDomRotation(e),l={x:s.x-u/2,y:s.y-a/2},c={x:l.x+u,y:l.y},h={x:l.x+u,y:l.y+a},p={x:l.x,y:l.y+a};l=r.getRotatedCoord(s,{x:l.x-n,y:l.y-n},f),c=r.getRotatedCoord(s,{x:c.x+n,y:c.y-n},f),h=r.getRotatedCoord(s,{x:h.x+n,y:h.y+n},f),p=r.getRotatedCoord(s,{x:p.x-n,y:p.y+n},f);var d=[l,c,h,p];o={o:s,vertex:d,w:u,h:a}}return r.cachePos[e[0].id]=[!0,o],o},getOffsetXY:function(e){var t=e.offset();return{x:t.left,y:t.top}},getDomRotation:function(e){function n(e,t){e=parseFloat(e),t=parseFloat(t);var n=(Math.asin(e)*180/Math.PI+360)%360;if(e>=0&&t>=0)return n;if(e>=0&&t<=0)return 180-n;if(e<=0&&t>=0)return n;if(e<=0&&t<=0)return 540-n}function r(){var t;return e.children().css("transform").split("(")[1]?(t=e.children().css("transform").split("(")[1].split(","),n(t[1],t[0])):0}var t;if(e.css("transform").split("(")[1]){var i=e.css("transform").split("(")[1].split(",");t=n(i[1],i[0]),t||(t=r())}else t=r();return t},getRotatedCoord:function(e,t,n){var r=t;n=n/180*Math.PI;var i=(r.x-e.x)*Math.cos(n)-(r.y-e.y)*Math.sin(n)+e.x,s=(r.x-e.x)*Math.sin(n)+(r.y-e.y)*Math.cos(n)+e.y;return{x:i,y:s}},distPP:function(e,t){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},distPL:function(e,t,n){var r=n.y-t.y,i=t.x-n.x,s=n.x*t.y-t.x*n.y;return Math.abs(r*e.x+i*e.y+s)/Math.sqrt(r*r+i*i)},isCircleHitCircle:function(e,t){var n=this.distPP(e.o,t.o);return n<=e.r+t.r},isCircleHitRect:function(e,t){var n=t.w/2,r=t.h/2,i={x:(t.vertex[0].x+t.vertex[1].x)/2,y:(t.vertex[0].y+t.vertex[1].y)/2},s={x:(t.vertex[2].x+t.vertex[1].x)/2,y:(t.vertex[2].y+t.vertex[1].y)/2},o=this.distPL(e.o,t.o,i),u=this.distPL(e.o,t.o,s);return o>n+e.r?!1:u>r+e.r?!1:o<=n?!0:u<=r?!0:(o-n)*(o-n)+(u-r)*(u-r)<=e.r*e.r},isRectHitRect:function(e,t){var n=this,r=!0,i=[{x:e.vertex[0].x-e.vertex[3].x,y:e.vertex[0].y-e.vertex[3].y},{x:e.vertex[0].x-e.vertex[1].x,y:e.vertex[0].y-e.vertex[1].y},{x:t.vertex[0].x-t.vertex[3].x,y:t.vertex[0].y-t.vertex[3].y},{x:t.vertex[0].x-t.vertex[1].x,y:t.vertex[0].y-t.vertex[1].y}];return $.each(i,function(n,i){var s=[],o,u,a,f;_.each(e.vertex,function(e,t){var n=e.x*i.x+e.y*i.y;s.push(n)}),o=_.min(s),u=_.max(s),s=[],_.each(t.vertex,function(e,t){var n=e.x*i.x+e.y*i.y;s.push(n)}),a=_.min(s),f=_.max(s);if(!(a<=u&&o<=f))return r=!1,!1}),r}})});define("interaction_view/model/usersvg",["interaction_view/model/base"],function(){interaction_view.model.UserSVG=interaction_view.model.Base.extend({defaults:{},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.UserSVG({model:this})},setsyncmodel:function(){}}),interaction_view.view.UserSVG=interaction_view.view.Base.extend({resetOtherStatus:function(){}})});define("interaction_view/model/main",["interaction_view/model/action","interaction_view/model/animation_view","interaction_view/model/audio","interaction_view/model/chapter","interaction_view/model/cycleimage","interaction_view/model/image","interaction_view/model/page","interaction_view/model/doc","interaction_view/model/preload","interaction_view/model/richtext","interaction_view/model/slide","interaction_view/model/video","interaction_view/model/button","interaction_view/model/map","interaction_view/model/pay","interaction_view/model/link","interaction_view/model/layerref","interaction_view/model/layerslide","interaction_view/model/binding","interaction_view/model/Grid","interaction_view/model/Cell","interaction_view/model/TextLabel","interaction_view/model/TabBar","interaction_view/model/SearchInput","interaction_view/model/Tree","interaction_view/model/gallery","interaction_view/model/PageIndex","interaction_view/model/webcontent","interaction_view/model/formview","interaction_view/model/shape","interaction_view/model/BookButton","interaction_view/model/dragdrop","interaction_view/model/dragdropgroup","interaction_view/model/variable","interaction_view/model/timer","interaction_view/model/vote","interaction_view/model/paragraph","interaction_view/model/input","interaction_view/model/textarea","interaction_view/model/selectbutton","interaction_view/model/submitbutton","interaction_view/model/selectbox","interaction_view/model/imageblock","interaction_view/model/weixincamera","interaction_view/model/weixinvoice","interaction_view/model/infoList","interaction_view/model/chartList","interaction_view/model/component","interaction_view/model/componentref","interaction_view/model/textbutton","interaction_view/model/collision","interaction_view/model/usersvg"],function(){});define("text!interaction_view/template/alertbox.js",[],function(){return'<div class="alert-box"><div class="alert-msg"><%=text%></div><div class="alert-title"><a class="alert-confirm" href="#">确定</a></div></div>'});define("interaction_view/ui/main",["jquery","backbone","text!interaction_view/template/message.js","text!interaction_view/template/alertbox.js"],function(){var e=require("text!interaction_view/template/message.js"),t=require("text!interaction_view/template/alertbox.js");return window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelnimationFrame,{message:function(t,n,r){$("body").find(".msg").length==0&&$("body").append('<div class="msg"></div>'),r||(r=3e3),$(".msg").html(_.template(e,{type:t,msg:n})),$(".msg").fadeIn(),setTimeout(function(){$(".msg").fadeOut("slow"),$(".msg").remove()},r)},getRequest:function(e){var t=location.search,n={};if(t.indexOf("?")!=-1){var r=t.substr(1);strs=r.split("&");for(var i=0;i<strs.length;i++)n[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1])}return e?n[e]:n},deviceType:function(){return navigator.userAgent.match(/iPad/i)=="iPad"?"iPad":navigator.userAgent.match(/iPhone/i)=="iPhone"?"iPhone":navigator.userAgent.match(/Android/i)=="Android"?"Android":navigator.userAgent.match(/BlackBerry/i)=="BlackBerry"?"BlackBerry":"null"},getModelById:function(e,t){var n=null;return e.icollection.each(function(e){e.id==t&&(n=e);var r=interaction_view.getModelById(e,t);r&&(n=r)}),n},model2collection:function(e,t){e.has(t)&&e.icollection.add(e.get(t))},model2tree:function(e,t,n){e.has(t)&&(e.icollection.add(e.get(t)),e.icollection.each(function(e){e.has(n)&&interaction_view.model2tree(e,n,n)}))},getPageIds:function(){var e=[];return $(".reveal").find("section").each(function(){e.push($(this).attr("id"))}),e},createPath:function(e){var t=[];return e.isSubOverlay?t=$.extend(!0,[],e.path):t.push({type:"page",id:e.page_id}),t.push({type:e.model.get("iType"),id:e.model.id}),e.layer_id&&t.push({type:"layer",id:e.layer_id}),t},hashPath:function(e){return _.pluck(e,"id").join("")},getContainerDivByPath:function(e){var t=$(".interaction-view");if(!e)return $(".interaction-view");for(i=0;i<e.length;i++)if(e[i].type=="page"){if(interaction_view.ipagelist.getPage(e[i].id))t=$('.Presentation[id="'+e[i].id+'"]').find(".interaction-view").first();else if(interaction_view.imasterlist.get(e[i].id)||interaction_view.ibackgroundlist.get(e[i].id))t=$('.Presentation[id="'+interaction_view.currentPage+'"]').find(".interaction-view").first()}else e[i].type=="layer"?t=t.find('div.layer-item[data-id="'+e[i].id+'"]').first():t=t.find('div.iView[id="'+e[i].id+'"]').first().children(".Element");return t},getContainerModelByPath:function(e){var t=null;for(i=0;i<e.length;i++){e[i].type=="page"?t=interaction_view.getParentpage(e[i].id):e[i].type=="layer"?t=t.layer[e[i].id]:t=t.iOverlaylist.get(e[i].id);if(!t)return null}return t},formatLabel:function(e){var t,n="",r="",i="";e.iPosition||(t="left"),e.iPosition==1&&(t="center"),e.iPosition==2&&(t="right"),e.radius!=undefined&&(n="border-top-left-radius:"+e.radius+"px; border-top-right-radius:"+e.radius+"px; border-bottom-right-radius:"+e.radius+"px; border-bottom-left-radius:"+e.radius+"px;"),e.border_color!=undefined&&e.border_size&&(r="border:"+e.border_size+"px solid "+e.border_color+";"),e.bg_color!=undefined&&(i="background-color:"+e.bg_color+";");if(!e.el)return'<p style="text-align:'+t+";font-size:"+e.font_size+"px;color:"+e.text_color+";"+n+r+i+'">'+e.text+"</p>";$(e.el).css({"font-size":e.font_size,color:e.text_color,"text-align":t}),n&&$(e.el).css("border-radius",e.radius+"px")},getWebContentSrc:function(e){var t=null;switch(e.contentType){case 0:if(e.iUrl){var n=e.iUrl.indexOf("http://")!=-1?e.iUrl:e.iUrl.indexOf("/")==0?e.iUrl:"http://"+e.iUrl;return{src:n,content:null}}return null;case 1:if(e.iFile&&e.iFile[0]&&e.iFile[0].file){if(typeof cbt_data=="undefined"||interaction_view.forpreview)var n=e.iFile[0].file.replace(".zip","/");else var n=e.iFile[0].file.replace(".zip","/index.html");return{src:n,content:null}}return null;case 2:return e.iSource?{src:null,content:e.iSource}:null}},getAnimationPage:function(e,t){return interaction_view.getParentpage(e)?interaction_view.getParentpage(e):t},filterAnimations:function(e,t,n,r){var i=_.filter(e,function(e){var t=e.toJSON();return t.iTiming&&t.iTiming.waitaction&&!interaction_view.SinglePreview&&!r?!1:t.iKind==0&&t.iGroup_id&&!n?!1:!0});return i},generateTimeline:function(e){var t=interaction_view.getVarsOp(e.iPage_id,[0,2]),n={paused:e.paused,onStart:e.onStart,onComplete:e.onComplete,onStartParams:e.onStartParams,onCompleteParams:e.onComplateParams};e.repeat&&(n.repeat=e.repeat);var r=new TimelineMax(n);r.addLabel("Start");var i=0;if(e.ids){e.ids=_.filter(e.ids,function(t){page=interaction_view.getAnimationPage(t.page_id,e.page);var n=page.iAnimationlist.get(t.id);if(!n)return!1;var t=n.toJSON();return t.iKind==0&&!page.iOverlaylist.get(t.overlay_id)?!1:!0}),e.animations=[];for(var s=0;s<e.ids.length;s++)page=interaction_view.getAnimationPage(e.ids[s].page_id,e.page),e.animations.push(page.iAnimationlist.get(e.ids[s].id))}if(e.animations.length==0)return!1;var o=interaction_view.filterAnimations(e.animations,e.page,e.group,e.foraction);return o=_.filter(o,function(e){return e._animation}),_.each(o,function(n,s){if(!n)return;n._animation.refresh();var u=n.toJSON(),a=$.extend(!0,{},n._animation.param);if(u.iTiming){var f=t.var2val(u.iTiming.delay),l=t.var2val(u.iTiming.repeat),c=t.var2val(u.iTiming.duration);i+=f,c=c;var h=s;if(_.include([0,3,4,5,6,7],u.iTiming.start)){r.addLabel(n.id+"_start",i);switch(u.iTiming.start){case 0:r.call(e.page.iAnimationlist.AddClickTween,[r,e.iPage_id,n,i],this,i-f);break;case 3:case 4:case 5:case 6:r.call(e.page.iAnimationlist.AddPageSwipeTween,[r,e.iPage_id,u.iTiming.start,n,i],this,i-f);break;case 7:r.call(e.page.iAnimationlist.AddPageShakeTween,[r,e.iPage_id,u.iTiming.start,n,i],this,i-f)}}else if(u.iTiming.start==2)if(h!=0){var p=r.getLabelTime(o[h-1].id+"_start");r.addLabel(n.id+"_start",p+f),i=r.getLabelTime(n.id+"_start")}else r.addLabel(n.id+"_start",i);else r.addLabel(n.id+"_start",i)}if(u.iKind==1&&u.children){var d=[];_.each(u.children,function(t){d.push({id:t,page_id:e.page.id})});var v=interaction_view.generateTimeline({page:e.page,ids:d,iPage_id:e.iPage_id,group:!0,paused:!1,repeat:a.repeat,onStart:a.onStart,onComplete:a.onComplete,onStartParams:a.onStartParams,onCompleteParams:a.onCompleteParams,foraction:!0});if(v){r.add(v,i);var m=v;c=v.duration()}else c=0}else{if(!_g.browserSupport({msie:9})&&!_.include([101,201,100,103,200,203,402,500,501,502,503],n.get("iType"))){var g=$(n._animation.obj),y;if(n._animation.toparam)y=n._animation.toparam.css;else if(n._animation.param)if(n._animation.param.css)y=n._animation.param.css;else if(n._animation.param.bezier){var b=n._animation.param.bezier.values;y=b[b.length-1]}return y&&y.x&&g.css("margin-left",y.x+"px"),y&&y.y&&g.css("margin-top",y.y+"px"),g.removeClass("hide").show(),g.parents(".iView:first").removeClass("hide").show(),!0}var w=n._animation.obj,E,S={onUpdate:interaction_view.events.onAnimationUpdate,onUpdateParams:[{animation_id:n.id,overlay_id:n.get("overlay_id"),page_id:n.get("page_id"),layer_id:n.get("layer_id")}]};n._animation.toparam?n._animation.toparam=$.extend({},n._animation.toparam,S):n._animation.param=$.extend({},n._animation.param,S);if(_.include([301,302],n.get("iType"))&&!a)return!1;if(_.include([501,502,503],n.get("iType"))){var x=e.page.iAnimationlist.getMediaTime(n);n.get("iType")==502||n.get("iType")==503?c=0:c=x,r.call(e.page.iAnimationlist.AddMediaTween,[n],this,i)}else if(_.include([102,103],n.get("iType")))r.add(TweenMax.fromTo(w,c,n._animation.fromparam,n._animation.toparam),i);else if(n.get("iType")==104)r.add(TweenMax.fromTo(w,.01,{opacity:0},n._animation.fromparam),i),r.add(TweenMax.fromTo(w,c-.01,n._animation.fromparam,n._animation.toparam),i+.01);else if(n.get("iType")==101)_g.browserSupport({msie:9})?r.add(TweenMax.fromTo(w,c,n._animation.fromparam,n._animation.toparam),i):r.add(TweenMax.fromTo(w,c,{"margin-left":n._animation.fromparam.css.x,"margin-top":n._animation.fromparam.css.y},{"margin-left":n._animation.toparam.css.x,"margin-top":n._animation.toparam.css.y,immediateRender:!1}),i);else if(n.get("iType")==201&&!_g.browserSupport({msie:9}))r.add(TweenMax.to(w,c,{"margin-left":n._animation.param.css.x,"margin-top":n._animation.param.css.y}),i);else if(n.get("iType")==701){r.add(TweenMax.fromTo(w,1e-4,{drawSVG:"0%"},{drawSVG:!0,onStart:n._animation.toparam.onStart}),i),i+=1e-4;var T=$.extend(!0,{},n._animation.toparam);T.onStart=null,r.add(TweenMax.fromTo(w,c-1e-4,n._animation.fromparam,T),i)}else r.add(TweenMax.to(w,c,n._animation.param),i);var m=r.getChildren()[r.getChildren().length-1]}l&&l>0?c*=l:(l==-1,l==-2&&r.call(e.page.iAnimationlist.AddRepeatClickTween,[r,e.iPage_id,m,n],this,i)),i+=c,r.addLabel(n.id+"_end",i)}),r},preloadImg:function(e){var t=new Image;t.onload=function(){},t.src=e},drawImg:function(e,t,n,r){console.log(n);try{r.clearRect(0,0,e.canvas_width,e.canvas_height),r.drawImage(e.model.iImgs[n],0,0,e.canvas_width,e.canvas_height),this.onload=null}catch(i){console.log(i)}},getOverlays:function(e,t){if(interaction_view.imasterlist.length==0)var n=iMasterlist.at(0).overlaylist.models;else var n=interaction_view.imasterlist.at(0).iOverlaylist.models;return interaction_view.currentPage==t&&(n=_.union(n,interaction_view.getAnimationPage(interaction_view.currentPage).iOverlaylist.models)),_.filter(n,function(t){return t.attributes.iType==e})},getVarsOp:function(e,t,n){if(typeof t=="undefined"||!t||!t.length)t=[0,1,2];_.each(t,function(e,n){t[n]=String(e)});var r=_.filter(interaction_view.getOverlays("Variable",e),function(e){return _.include(t,String(e.attributes.iDetail.iKind))});r=_.union(r,interaction_view.getOverlays("Paragraph",e)),n&&(r=_.union(r,n));var i="@",s=/@/g,o=/\@[^\@]+\@/g,u=function(e){if(!f(e))return e;var t;e=e.replace(s,""),ids=e.split("_"),ext=ids.length>1?ids[1]:"",ids.length>1&&["position","voted"].indexOf(ext)>-1?e=ids[0]:ext="",t=_.filter(r,function(t){return t.id==e});if(t.length){var n=t[0],i=t[0].attributes.iDetail;if(n.get("iType")=="Vote"){var o=parseInt(i.initial);return ext==""?o=n.get("value")||parseInt(i.initial):ext=="position"?o=n.get("position")||0:ext=="voted"&&(o=n.get("voted")||0),o}return typeof i.initial!="undefined"?String(i.initial):typeof i.iText!="undefined"?String(t[0].iview.userContent||i.iText):String(t[0].get("suboverlays")[0].iDetail.iValue)}return"0"},a=function(e){var t=String(e),n=t.match(o);return _.each(n,function(e){t=t.replace(e,u(e))}),t},f=function(e){return e&&e[0]==i};return{vars:r,var2val:function(e,t){return!r||!r.length?e:t?a(e):Number(u(e))||0},beginWithAT:f}},getParentpage:function(e){return interaction_view.ipagelist.getPage(e)||interaction_view.imasterlist.get(e)||interaction_view.ibackgroundlist.get(e)},getPageType:function(e){return interaction_view.imasterlist.length&&e.model.page.id==interaction_view.imasterlist.at(0).id?"master":interaction_view.ibackgroundlist.length&&e.model.page.id==interaction_view.ibackgroundlist.at(0).id?"background":"page"},getPageType2:function(e){return e.isMasterOverlay?"master":e.isBackgroundOverlay?"background":"page"},imageEditor:function(e,t,n,r,i,s){$(".reveal").addClass("noevents");var o,u;o=$.zoom?t*$.zoom:t,u=$.zoom?n*$.zoom:n;var a=e.iview.$el.children(".Element").offset(),f=$.zoom?a.left*$.zoom:a.left,l=$.zoom?a.top*$.zoom:a.top,c=_.isNaN(Number(e._rotate))?0:Number(e._rotate),h=_.isNaN(Number(e._scale))?1:Number(e._scale),p=_.isNaN(Number(e._x))?0:Number(e._x),d=_.isNaN(Number(e._y))?0:Number(e._y),v="rotate("+c+"deg) scale("+h+") skew(0deg) translate("+p+"px ,"+d+"px)";e.iview.$el.find("img").css({"-webkit-transform":v,width:"100%",height:"auto"}),interaction_view.imageEditorClear(),interaction_view.containment.append('<div class="editor_mask" style="opacity:0;"></div>'),interaction_view.containment.append('<div class="imageeditorcontainer"><div class="imageeditor" style="position:absolute;left:'+f+"px;top:"+l+"px;width:"+o+"px;height:"+u+'px;z-index:999999999;"><img src="'+r+'" style="width:100%;opacity:0;"></div></div>'),typeof epub360!="undefined"&&epub360.settings&&["USER_FREE","USER_BASIC"].indexOf(epub360.settings.billing_type)>=0&&interaction_view.containment.append('<div style=" padding-bottom: 3px;display: inline-block;z-index: 999999999;position: absolute; bottom: 10px;  text-align: center; width: 100%;"><a href="http://www.epub360.com/?utm_source=epub360&amp;utm_medium=player&amp;utm_content=%E5%85%8D%E8%B4%B9%E6%8A%80%E6%9C%AF%E6%94%AF%E6%8C%81&amp;utm_campaign=loading" target="_blank" style="color: #c9c9c9;font-size: 14px;padding: 8px 14px;background: #a1a1a1;border-radius: 15px; -moz-border-radius: 15px;" class="advertise">Epub360.com 技术支持</a></div>'),interaction_view.containment.append('<div class="imageeditorbuttons"><button class="weixinbutton chooseimage"></button><button class="weixinbutton imageconfirm"></button></div>'),interaction_view.bindImageEditor($(".imageeditor").children("img"),c,h,p,d,e),$(".imageconfirm").on("click",function(){var e=$(".imageeditor").children("img").data();return i&&i(e.x||0,e.y||0,e.scale||1,e.rotate||0),interaction_view.imageEditorClear(),$(".reveal").removeClass("noevents"),!1}),$(".chooseimage").on("click",function(){return interaction_view.weixin.chooseimage(function(e){e&&(interaction_view.localIds=e,s(e[0]))}),!1}),setTimeout(function(){$(".imageeditorcontainer").on("click",function(e){if($(e.target).is(e.currentTarget)){var t=$(".imageeditor").children("img").data();i&&i(t.x||0,t.y||0,t.scale||1,t.rotate||0),interaction_view.imageEditorClear(),$(".reveal").removeClass("noevents")}})},500)},imageEditorClear:function(){$(".editor_mask").remove(),$(".imageeditorcontainer").remove(),$(".voiceeditor").remove(),$(".imageeditor-confirm").remove(),$(".weixinbutton").remove(),$(".advertise").remove(),$(".imageeditorbuttons").remove()},bindImageEditor:function(e,t,n,r,i,s){var o=!1,u=0,a=1;e.data({rotate:t,scale:n,x:r,y:i}),e.hammer().on("drag",function(e){if(o)return;var u=r+e.gesture.deltaX,a=i+e.gesture.deltaY,f="rotate("+t+"deg) scale("+n+") skew(0deg) translate("+u+"px, "+a+"px)";s.iview.$el.find("img").css({transform:f,"-webkit-transform":f}),$(".imageeditorbuttons").hide(),e.gesture.preventDefault()}),e.hammer().on("rotate",function(f){o=!0,a=f.gesture.scale;var l=n+(a-1);u=f.gesture.rotation;var c=t+u;e.data({scale:l,rotate:c,x:r,y:i});var h="rotate("+c+"deg) scale("+l+") skew(0deg) translate("+r+"px ,"+i+"px)";s.iview.$el.find("img").css({transform:h,"-webkit-transform":h}),$(".imageeditorbuttons").hide(),f.gesture.preventDefault()}),e.hammer().on("pinch",function(f){o=!0,a=f.gesture.scale;var l=n+(a-1);u=f.gesture.rotation;var c=t+u;e.data({scale:l,rotate:c,x:r,y:i}),$(".imageeditorbuttons").hide();var h="rotate("+c+"deg) scale("+l+") skew(0deg) translate("+r+"px ,"+i+"px)";s.iview.$el.find("img").css({transform:h,"-webkit-transform":h}),f.gesture.preventDefault()}),e.hammer().on("dragend",function(s){var f=s.gesture.deltaX,l=s.gesture.deltaY;o?(t+=u,n+=a-1,e.data({rotate:t,scale:n,x:r,y:i})):(r+=f,i+=l,e.data({rotate:t,scale:n,x:r,y:i})),u=0,a=1,o=!1,$(".imageeditorbuttons").show()})},imageUploader:function(e,t){wx.uploadImage({localId:e,success:function(e){var n=context_url+"uploadimage";_g.ajax.post({url:n,data:{serverid:e.serverId},callback:function(e){e.code==200?t&&t(e.data.results[0]):interaction_view.errorAlert(e.msg)}})},fail:function(e){interaction_view.errorAlert("图片上传错误")}})},voiceEditor:function(e){$(".reveal").addClass("noevents"),interaction_view.weixin.voiceauth(),interaction_view.imageEditorClear(),interaction_view.containment.append('<div class="editor_mask" style="opacity:0;"></div>'),typeof epub360!="undefined"&&epub360.settings&&["USER_FREE","USER_BASIC"].indexOf(epub360.settings.billing_type)>=0&&interaction_view.containment.append('<div style=" padding-bottom: 3px;display: inline-block;z-index: 999999999;position: absolute; bottom: 10px;  text-align: center; width: 100%;"><a href="http://www.epub360.com/?utm_source=epub360&amp;utm_medium=player&amp;utm_content=%E5%85%8D%E8%B4%B9%E6%8A%80%E6%9C%AF%E6%94%AF%E6%8C%81&amp;utm_campaign=loading" target="_blank" style="color: #c9c9c9;font-size: 14px;padding: 8px 14px;background: #a1a1a1;border-radius: 15px; -moz-border-radius: 15px;" class="advertise">Epub360.com 技术支持</a></div>'),interaction_view.containment.append('<div class="voiceeditor absolutecenter weixin-record">    <div class="voiceeditor-control">         <button class="voicebutton" id="playVoice" style="opacity:0;"></button>         <button class="voicebutton" id="startRecord"></button>         <div class="voicetext">按住录音</div>         <button class="weixincancel"></button>         <button class="weixinconfirm"></button>    </div></div>'),interaction_view.bindVoiceEditor(),$(".weixinconfirm").on("click",function(){return interaction_view.imageEditorClear(),$(".reveal").removeClass("noevents"),e&&e(interaction_view.voicelocalId),!1}),$(".weixincancel").on("click",function(){return wx.stopRecord({success:function(e){},fail:function(e){}}),interaction_view.imageEditorClear(),$(".reveal").removeClass("noevents"),!1})},bindVoiceEditor:function(e){var t=!1,n=function(){if(!interaction_view.voicelocalId){interaction_view.errorAlert("你还没有录音呢！");return}wx.playVoice({localId:interaction_view.voicelocalId}),window.setTimeout(function(){$("#playVoice").attr("id","stopVoice")},500)};$(".weixin-record").on("touchstart","#startRecord",function(e){return t=!0,wx.startRecord({success:function(){t?$("div.voicetext").html("正在录音...."):wx.stopRecord({})},cancel:function(){interaction_view.errorAlert("开启微信功能失败")}}),window.setTimeout(function(){$("#startRecord").attr("id","stopRecord")},100),!1}),$(".weixin-record").on("touchend","#stopRecord",function(e){return wx.stopRecord({success:function(e){interaction_view.voicelocalId=e.localId,$("#playVoice").css("opacity",1),n()},fail:function(e){interaction_view.errorAlert("微信录音失败")}}),window.setTimeout(function(){$("#stopRecord").attr("id","startRecord")},100),t=!1,$("div.voicetext").html("按住录音"),!1}),$(".weixin-record").on("touchcancel","#stopRecord",function(e){return wx.stopRecord({success:function(e){interaction_view.voicelocalId=e.localId,$("#playVoice").css("opacity",1),n()},fail:function(e){interaction_view.errorAlert("微信录音失败")}}),window.setTimeout(function(){$("#stopRecord").attr("id","startRecord")},100),t=!1,!1}),$(".weixin-record").on("click","#playVoice",function(e){return n(),!1}),$(".weixin-record").on("click","#stopVoice",function(e){if(!interaction_view.voicelocalId){interaction_view.errorAlert("你还没有录音呢！");return}return wx.stopVoice({localId:interaction_view.voicelocalId}),window.setTimeout(function(){$("#stopVoice").attr("id","playVoice")},500),!1}),wx.onVoicePlayEnd({complete:function(e){$("#stopVoice").attr("id","playVoice")}}),wx.onVoiceRecordEnd({complete:function(e){interaction_view.voicelocalId=e.localId,$("#playVoice").css("opacity",1),n(),$("#stopRecord").attr("id","startRecord")}})},voiceUploader:function(e,t){wx.uploadVoice({localId:e,isShowProgressTips:1,success:function(e){var n=e.serverId,r=context_url+"uploadvoice";_g.ajax.post({url:r,data:{serverid:e.serverId},callback:function(e){e.code==200?t&&t(e.data.results[0]):interaction_view.errorAlert(e.msg)}})}})},errorAlert:function(e){if(!interaction_view.containment.children(".alert_mask").length){interaction_view.containment.append('<div class="alert_mask"></div>');var n=_.template(t,{text:e});interaction_view.containment.append(n),interaction_view.containment.find(".alert-confirm").on("click",function(){return interaction_view.containment.find(".alert_mask").remove(),interaction_view.containment.find(".alert-box").remove(),!1})}},playbgsound:function(){if(!interaction_view.bgsound)return;var e=interaction_view.bgsound;if(e.hasPlayed)return;var t=e.iview.getdetail();e.media=audio,e.iview.$el.find(".status-play").addClass("status-pause").removeClass("status-play"),e.media.paused||(e.hasPlayed=!0),$("audio#bgsound").on("loadstart",function(e){}).on("error",function(e){}).on("timeupdate",function(t){if(e.iview.slider){var n=e.media.currentTime,r=e.media.duration,i=_g.number.decimal(n/r,2)*100;e.iview.onSliderChange(i)}}),$("audio#bgsound").on("ended",function(n){if(!t.iRepeat){e.iview.slider&&e.iview.sliderstop();if(e.media.seekable.length==0)return;try{e.media.currentTime=0,interaction_view.media.pause(e)}catch(r){}e.onAnimationStart&&(interaction_view.events.onAnimationEnd(e.onAnimationStart),e.onAnimationStart=null)}else _g.device.android()&&e.media.play()})},createLoop:function(e){var t=e.delay*1e3,n=17,r=0,i={};i.paused=!0,i._int=null;var s=0;return i.duration=function(){return e.duration},i.play=function(){i.paused=!1;var o=function(){if(!i)return;i._int=requestAnimationFrame(o),r*n>=t?(console.log("play"),e.callback&&e.callback(),r=1,s=s+e.delay<=e.duration?s+e.delay:0):r+=1};o()},i.pause=function(){i._int&&window.cancelAnimationFrame(i._int)},i.kill=function(){i._int&&(window.cancelAnimationFrame(i._int),i.paused=!0),i=null},i.time=function(){return s},i}}});!function(e){var t=function(t,n){this.$element=e(t),this.options=n,this.init()};t.prototype={init:function(){_.bindAll(this)},_animate_loading:function(){if(!this.loading.is(":visible")){clearInterval(this.loadingTimer);return}e("div",this.loading).css("top",this.loadingFrame*-40+"px"),this.loadingFrame=(this.loadingFrame+1)%12},load:function(t){this.$element.children("#jswait-loading").remove(),this.$element.children("#jswait-overlay").remove(),this.loadingTimer=this.loadingFrame=1,this.options=t,this.$element.append(this.loading=e('<div id="jswait-loading"><div></div></div>'),this.overlay=e('<div id="jswait-overlay" class="mask hide"></div>')),this.options.modal&&this.overlay.removeClass("hide"),this.options.simple?(this.loading.css({background:"#000000","line-height":40,"text-align":"center"}),this.loading.html('<img src="/staticfs/common/js/jswait/jswait.gif">'),this.loading.show()):(clearInterval(this.loadingTimer),this.loading.show(),this.loadingTimer=setInterval(this._animate_loading,66)),this.waited=!0},close:function(){this.waited&&(this.loading.remove(),this.overlay.remove(),this.$element.children("#jswait-loading").remove(),this.$element.children("#jswait-overlay").remove(),this.loadingFrame=1,clearInterval(this.loadingTimer),this.waited=!1)}},e.fn.jswait=function(n){return this.each(function(){var r=e(this),i=r.data("jswait"),s=e.extend({},e.fn.jswait.defaults,typeof n=="object"&&n),o=typeof n=="string"?n:null;i||r.data("jswait",i=new t(this,s)),o?i[o]():i.load(s)})},e.fn.jswait.defaults={modal:!1},e.fn.jswait.Constructor=t}(window.jQuery),define("jswait",function(){}),define("/Users/blues/projects/epub360/1-src/epub360-built/html/common/js/jswait/jswait.js",function(){});(function(e,t){"use strict";var n="undefined"!=typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,r=function(){for(var e,n,r=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"]],i=0,s=r.length,o={};s>i;i++)if(e=r[i],e&&e[1]in t){for(i=0,n=e.length;n>i;i++)o[r[0][i]]=e[i];return o}return!1}(),i={request:function(e){var i=r.requestFullscreen;e=e||t.documentElement,/5\.1[\.\d]* Safari/.test(navigator.userAgent)?e[i]():e[i](n&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){t[r.exitFullscreen]()},toggle:function(e){this.isFullscreen?this.exit():this.request(e)},onchange:function(){},onerror:function(){},raw:r};return r?(Object.defineProperties(i,{isFullscreen:{get:function(){return!!t[r.fullscreenElement]}},element:{enumerable:!0,get:function(){return t[r.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!t[r.fullscreenEnabled]}}}),t.addEventListener(r.fullscreenchange,function(e){i.onchange.call(i,e)}),t.addEventListener(r.fullscreenerror,function(e){i.onerror.call(i,e)}),e.screenfull=i,void 0):e.screenfull=!1})(window,document),define("screenfull",function(){}),define("/Users/blues/projects/epub360/1-src/epub360-built/html/common/js/screenfull/screenfull.js",function(){});define("text!interaction_view/template/pagenumber.js",[],function(){return'<%if(presentation.getPageNumber().horizontal_count>1){ %>\n<nav class="iView master nav-horizen pagenumber" style="position:absolute;left:<%=pageno_horizontal.x%>px;top:<%=pageno_horizontal.y%>px;<%=pageno_horizontal.show?"":"display:none;"%>">\n    <%for(i=0;i<presentation.getPageNumber().horizontal_count;i++){%><li class="<%=Reveal.getIndices().h==i?"active":""%>"><a href="#" data-index="<%=i%>"></a></li><% } %>\n</nav>\n<% } %>\n<%if(presentation.getPageNumber().vertical_count>1){ %>\n<nav class="iView master nav-vertical pagenumber" style="position:absolute;left:<%=pageno_vertical.x%>px;top:<%=pageno_vertical.y%>px;<%=pageno_vertical.show?"":"display:none;"%>">\n    <%for(i=0;i<presentation.getPageNumber().vertical_count;i++){%><li class="<%=Reveal.getIndices().v==i?"active":""%>"><a href="#" data-index="<%=i%>"></a></li><% } %>\n</nav>\n<% } %>'});define("interaction_view/ui/presentation",["jswait","screenfull","_g/ui","text!interaction_view/template/pagenumber.js"],function(){var e=require("text!interaction_view/template/pagenumber.js"),t={init:function(){},masterPageReset:function(){interaction_view.imasterlist.length&&interaction_view.imasterlist.at(0).iOverlaylist.each(function(e){_.include(["Grid","PageIndex","Gallery"],e.get("iType"))&&e.iview.resetOtherStatus()})},preloadpageAudio:function(e){interaction_view.ismobile&&interaction_view.imasterlist.at(0).iOverlaylist.each(function(e){e.get("iType")=="Audio"&&e.media&&(e.hasPlayed||e.autoplay&&(interaction_view.media.play(e),e.hasPlayed=!0))})},play:function(e){var n=null;typeof e=="string"?n=interaction_view.getParentpage(e):n=e;if(interaction_view.mode=="Page"&&!n.isLayer&&interaction_view.ipagelist.getPage(n.id)){t.setBackgroundDisplay(n);var r=n.get("share_page_id")||"first";if(r=="current"||interaction_view.share_page_id!=r)interaction_view.share_page_id=r,interaction_view.weixin.share()}n.playFinished==1&&(n.iOverlaylist.resetViewStatus(),n.iOverlaylist.resetBindings(),n.iAnimationlist.resetAnimationStatus(),n.playFinished=!1),n.iOverlaylist.each(function(e){n.playFinished||e._reset&&e.iview.resetStatus(),e.media&&(e.autoplay?interaction_view.ismobile&&e.get("isBgsound")?typeof bgsound_id=="undefined"&&(interaction_view.media.play(e),e.media.paused||(e.hasPlayed=!0)):(interaction_view.media.play(e),e.media.paused||(e.hasPlayed=!0)):e.get("iType")=="Video"&&(e.get("iDetail").iHidden||(e.notallowed=!0,e.iview.$el.removeClass("hide"),e.iview.$el.css("opacity",1),e.hided=!1))),e.renderWebContent&&e.iview.renderWebContent()}),n.played=!1,interaction_view.events.clearWaitClick(),interaction_view.events.clearAnimationWaitSwipe(),n.iAnimationlist.setParams(),n.iAnimationlist.setPlay(),n.playFinished=!0,interaction_view.mode=="Page"&&!interaction_view.masterplayed&&!n.isLayer&&(interaction_view.masterplayed=!0,interaction_view.imasterlist.length&&interaction_view.play(interaction_view.imasterlist.at(0))),interaction_view.mode=="Page"&&!interaction_view.backgroundplayed&&!n.isLayer&&(interaction_view.backgroundplayed=!0,interaction_view.ibackgroundlist.length&&interaction_view.play(interaction_view.ibackgroundlist.at(0))),n.isLayer?interaction_view.events.onPageStart(n.iOverlaylist.pageid,n.iOverlaylist.layerid):interaction_view.events.onPageStart(n.id),interaction_view.events.onControllerEvent(n.id),interaction_view.mode=="Page"&&!n.isLayer&&interaction_view.ipagelist.getPage(n.id)&&t.setMasterDisplay(n),n.iAnimationlist.timeline&&n.iAnimationlist.timeline.play(0,!1),n.iOverlaylist.each(function(e){switch(e.get("iType")){case"LayerRef":case"LayerSlide":case"ComponentRef":e.iview.playLayer();break;case"Timer":e.iview.resetTimer();break;case"Vote":e.iview.triggerVoted();break;case"Variable":e.iview.triggerVarChange()}e._autoplay&&e.iview._autoplay()})},pause:function(e){var t;typeof e=="string"?t=interaction_view.ipagelist.getPage(e):t=e,t.playFinished&&t.iAnimationlist.timeline&&t.iAnimationlist.timeline.pause()},continuePlay:function(e){var t;typeof e=="string"?t=interaction_view.ipagelist.getPage(e):t=e,t.playFinished&&t.iAnimationlist.timeline&&t.iAnimationlist.timeline.play()},stop:function(e){var t;typeof e=="string"?t=interaction_view.ipagelist.getPage(e):t=e,t.playFinished&&(t.iAnimationlist.timeline&&(t.iAnimationlist.timeline.pause(0),t.iOverlaylist.resetViewStatus(),typeof e=="string"&&$(".interaction-view").css("cursor","auto"),interaction_view.bezierPatch(e)),t.iActionlist.each(function(e){e.iview.timeline&&e.iview.timeline.pause(1e-5)}),t.iOverlaylist.each(function(e){e.media&&(e.iview.resetOtherStatus(),e.iview.iType=="Video"&&e.iview.$el.addClass("hide")),(e.iview.iType=="LayerRef"||e.iview.iType=="LayerSlide"||e.iview.iType=="ComponentRef")&&e.iview.stoplayer(),(e.iview.iType=="LayerRef"||e.iview.iType=="Image")&&e.iview.renderMask(),(e.iview.iType=="Slide"||e.iview.iType=="LayerSlide"||e.iview.iType=="CycleImage")&&e.iview.timeline&&e.iview.timeline.pause(1e-5),e.iview.iType=="Timer"&&e.iview.stopTimerSimple(),e.renderWebContent&&e.iview.clearWebContent()}))},getPageNumber:function(){var e=Reveal.getVerticalLength(),t=Reveal.getHorizontalLength();return{vertical_count:e,horizontal_count:t}},setMasterDisplay:function(e){t.setPageNumber(e),interaction_view.show_master=e.get("show_master")?!0:!1;var n=$('.Presentation[id="'+e.id+'"]').find(".interaction-view");interaction_view.touchview&&(n=$(".reveal")),interaction_view.show_master||interaction_view.mode=="Master"?n.children(".iView.master").removeClass("masterhide"):n.children(".iView.master").addClass("masterhide"),t.masterPageReset(e)},setBackgroundDisplay:function(e){interaction_view.show_background=e.get("show_background")?!0:!1;var t=$('.Presentation[id="'+e.id+'"]').find(".interaction-view");interaction_view.touchview&&(t=$(".reveal")),interaction_view.show_background||interaction_view.mode=="Background"?t.children(".iView.background").removeClass("backgroundhide"):t.children(".iView.background").addClass("backgroundhide")},setPageNumber:function(n){var r=$('.Presentation[id="'+n.id+'"]').find(".interaction-view");interaction_view.touchview&&(r=$(".reveal")),(interaction_view.mode=="Master"||interaction_view.mode=="Page")&&interaction_view.imasterlist.length&&(r.children(".iView.master.pagenumber").remove(),r.append(_.template(e,interaction_view.imasterlist.at(0).toJSON())),t.setPageNumberPosition())},setPageNumberPosition:function(){$("nav.pagenumber").each(function(){$(this).css({left:$(this).position().left-$(this).outerWidth(!1)/2,top:$(this).position().top-$(this).outerHeight(!1)/2})})},bezierPatch:function(e){var t;typeof e=="string"?t=interaction_view.ipagelist.getPage(e):t=e,t.iAnimationlist.each(function(e){_.include([301,302],e.get("iType"))&&e.toJSON().iDetail.autoRotate&&TweenMax.set(e._animation.obj,{rotation:"0_cw"})})},startLoad:function(){t.pagesForLoad=[],interaction_view.imasterlist&&interaction_view.imasterlist.length&&t.pagesForLoad.push(interaction_view.imasterlist.at(0).id),interaction_view.ibackgroundlist&&interaction_view.ibackgroundlist.length&&t.pagesForLoad.push(interaction_view.ibackgroundlist.at(0).id),_.each(interaction_view.ipagelist.getPages(),function(e){t.pagesForLoad.push(e.id)}),t.pagelength=t.pagesForLoad.length;var e;if(!interaction_view.forpreview||interaction.doc.mode!="Layer"&&interaction.doc.mode!="Background")if(interaction_view.imasterlist&&interaction_view.imasterlist.length||interaction_view.ibackgroundlist&&interaction_view.ibackgroundlist.length){interaction_view.imasterlist&&interaction_view.imasterlist.length&&(e=interaction_view.imasterlist.at(0));if(interaction_view.ibackgroundlist&&interaction_view.ibackgroundlist.length){var n=interaction_view.ibackgroundlist.at(0);n.iview.prepareLoad(),n.iview.startLoad(),n.isStartLoad=!0}}else e=interaction_view.ipagelist.at(0);else interaction_view.imasterlist&&interaction_view.imasterlist.length?e=interaction_view.imasterlist.at(0):e=interaction_view.ipagelist.at(0);e.iview.prepareLoad(),e.iview.startLoad(),e.isStartLoad=!0},pagesForLoad:[],pageLoadEvent:function(e){},pageLoad:function(e){var n=interaction_view.ipagelist.getPage(e);!n.isStartLoad&&!n.get("loaded")?(n.iview.prepareLoad(),n.iview.startLoad(),n.isStartLoad=!0):interaction_view.ismobile&&t.pagePreloadCenter(e)},bookStatus:0,foredit:function(){},forpreview:function(){interaction_view.mode="Page",interaction_view.events.clearAll(),$("body").children("preloader").remove(),$("body").append('<div id="preloader"></div>'),interaction_view.forpreview||$("body").prepend('<div class="loading progress progress-striped active"><div class="bar" style="width: 0%;"></div></div>'),interaction_view.containment.children("#jswait-loading").length||interaction_view.containment.jswait(),interaction_view.finishPagePreload=function(e,n){t.pagesForLoad=_.reject(t.pagesForLoad,function(t){return t==e}),n||(n=interaction_view.ipagelist.getPage(e)||interaction_view.imasterlist.get(e)||interaction_view.ibackgroundlist.get(e)),interaction_view.donext(n),n.set("loaded",!0,{silent:!0});if(t.pagesForLoad.length==0||t.pagelength-t.pagesForLoad.length>=1)if(interaction_view.imasterlist.length==0||interaction_view.imasterlist.at(0).get("loaded"))if(interaction_view.ibackgroundlist.length==0||interaction_view.ibackgroundlist.at(0).get("loaded"))interaction_view.preloadended||(interaction_view.preloadended=!0);if(interaction_view.playstatus=="wait"&&interaction_view.preloadended){var r=interaction_view.ipagelist.getPage(interaction_view.currentPage);r.get("loaded")&&(interaction_view.playstatus="play",interaction_view.containment.jswait("close"),interaction_view.containment.children(".prejsloading").length?loading_progress_percent<60?(loading_progress_percent=71,window.loading_progress_timer1=setInterval(function(){compute_loadding_progress(),set_loading_progress()},100)):(loading_progress_percent=100,set_loading_progress(),workEnd("-------- 3. presentation : start clear loading 1 --------"),interaction_view.containment.children(".prejsloading").fadeOut(1500,function(){interaction_view.containment.children(".prejsloading").remove(),interaction_view.play(interaction_view.currentPage),workEnd("-------- 3. presentation : start clear loading 1 --------"),window.loadAnalytics&&loadAnalytics()})):(interaction_view.containment.children("#jswait-loading").remove(),interaction_view.play(interaction_view.currentPage)))}else if(interaction_view.preloadended&&interaction_view.transitionPagePreLoad&&e==interaction_view.transitionPagePreLoad.page_id){var i=interaction_view.transitionPagePreLoad.transition;interaction_view.transitionPagePreLoad=null,t.gotopage(e,i)}t.pagesForLoad.length==0?$(".loading").remove():interaction_view.ismobile||interaction_view.ipagelist.getPage(t.pagesForLoad[0])&&t.pageLoad(t.pagesForLoad[0]);if(interaction_view.ismobile)if(t.isFirstPageLoading){e==t.isFirstPageLoading&&(t.firstpageloaded=!0);if(t.firstpageloaded&&interaction_view.imasterlist.at(0).get("loaded")&&interaction_view.ibackgroundlist.at(0).get("loaded")){var s=t.isFirstPageLoading;t.isFirstPageLoading=null,t.preloadFourDirections(),t.pagePreloadCenter(s)}}else t.pagePreloadCenter(e)},interaction_view.setPreloadStatus=function(){var e=0,t=0;_.each(interaction_view.ipagelist.getPages(),function(n){t+=n.ipreloadlist.length,n.ipreloadlist.length>0&&(e+=n.ipreloadlist.where({loaded:!0}).length)}),interaction_view.imasterlist.length&&(t+=interaction_view.imasterlist.at(0).ipreloadlist.length,interaction_view.imasterlist.at(0).ipreloadlist.length>0&&(e+=interaction_view.imasterlist.at(0).ipreloadlist.where({loaded:!0}).length)),interaction_view.ibackgroundlist.length&&(t+=interaction_view.ibackgroundlist.at(0).ipreloadlist.length,interaction_view.ibackgroundlist.at(0).ipreloadlist.length>0&&(e+=interaction_view.ibackgroundlist.at(0).ipreloadlist.where({loaded:!0}).length)),$(".loading").children("div").css("width",String(e/t*100)+"%")},interaction_view.donext=function(e){e.iview.afterpreload()},interaction_view.play=t.play,interaction_view.stopPlay=t.stop,interaction_view.pausePlay=t.pause,interaction_view.continuePlay=t.continuePlay,interaction_view.moveMaster=function(e,t){if(!interaction_view.touchview){var n=$('.Presentation[id="'+e+'"]').find(".interaction-view").children(".iView.master").detach();$('.Presentation[id="'+t+'"]').find(".interaction-view").append(n)}},interaction_view.bezierPatch=t.bezierPatch,interaction_view.slideChange=function(e){if(!Reveal)return;typeof e=="number"&&Reveal.slide(e);if(typeof e=="string"){var t=interaction_view.getModelById(interaction_view.iChapter,e);Reveal.slide(t.get("index"))}},interaction_view.firstPlay=!0},screencontrol:function(){window.isFullscreen=!1,window.screenLock=!1,window.screenAutoAdapt=function(){if(window.screenLock)return;if(screenfull.isFullscreen){isFullscreen=!0;var e=window.screen.width/window.screen.height>=interaction_view.size.x/interaction_view.size.y?window.screen.height/interaction_view.size.y:window.screen.width/interaction_view.size.x;_g.ui.scale(".reveal",e)}else isFullscreen=!1,_g.ui.scale(".reveal",1)},!interaction_view.ismobile&&(screenfull.onchange=screenAutoAdapt)},gotopage:function(e,n){interaction_view.transitionPagePreLoad=null;var r=null,i,s,o,u;if(e==interaction_view.currentPage)return;switch(n){case 0:o=0,s="y",i="up",u=1;break;case 1:o=0,s="x",i="right",u=-1;break;case 2:o=0,s="y",i="down",u=-1;break;case 3:o=0,s="x",i="left",u=1;break;case 4:o=1,s="y",i="up",u=1;break;case 5:o=1,s="x",i="right",u=-1;break;case 6:o=1,s="y",i="down",u=-1;break;case 7:o=1,s="x",i="left",u=1;break;case 8:o=2,s="x",i="left",u=1;break;case 10:o=3,s="y",i="up",u=1;break;case 11:o=3,s="x",i="right",u=-1;break;case 12:o=3,s="y",i="down",u=-1;break;case 13:o=3,s="x",i="left",u=1;break;case 14:o=4,s="y",i="up",u=1;break;case 15:o=4,s="x",i="right",u=-1;break;case 16:o=4,s="y",i="down",u=-1;break;case 17:o=4,s="x",i="left",u=1;break;case 18:o=5,s="y",i="up",u=1;break;case 19:o=5,s="x",i="right",u=-1;break;case 20:o=5,s="y",i="down",u=-1;break;case 21:o=5,s="x",i="left",u=1}if(interaction_view.ipagelist.getPage(e)){var a=interaction_view.ipagelist.getPage(e);interaction_view.doc.toJSON().play_mode==0?indexh=interaction_view.ipagelist.indexOf(a):(a.icollection.length&&(a=a.icollection.at(0)),indexh=a.collection.parent.collection.indexOf(a.collection.parent),r=a.collection.indexOf(a));if(n==9){Reveal.slide(indexh,r);return}if(!a.get("loaded")){interaction_view.transitionPagePreLoad={page_id:e,transition:n},t.pageLoad(e);return}Reveal.setSingleSlideItem(indexh,r,i),Reveal.originh=Reveal.indexh,Reveal.originv=Reveal.indexv,Reveal.indexh=indexh,r!=null&&(Reveal.indexv=r),Reveal.transition.autostart(o,s,u)}},preloadFourDirections:function(){t.touchPreloadPageList=[];var e=Reveal.getSlideDirections();e.left?t.touchPreloadPageList.push(Reveal.getLeft()):interaction_view.control.getGroupLeft(Reveal.getCurrentSlideId())&&t.touchPreloadPageList.push(interaction_view.control.getGroupLeftId(Reveal.getCurrentSlideId())),e.right?t.touchPreloadPageList.push(Reveal.getRight()):interaction_view.control.getGroupRight(Reveal.getCurrentSlideId())&&t.touchPreloadPageList.push(interaction_view.control.getGroupRightId(Reveal.getCurrentSlideId())),Reveal.slideType==3&&(e.up&&t.touchPreloadPageList.push(Reveal.getUp()),e.down&&t.touchPreloadPageList.push(Reveal.getDown())),t.touchPreloadPageList.length&&t.pagePreloadCenter()},clearPreloadPages:function(){t.touchClearPageList=[];var e=Reveal.getAllSlideIds();_.each(e,function(e){e!=Reveal.getLeft()&&e!=Reveal.getRight()&&e!=Reveal.getUp()&&e!=Reveal.getDown()&&e!=Reveal.getCurrentSlideId()&&e!=interaction_view.control.getGroupRightId(Reveal.getCurrentSlideId())&&e!=interaction_view.control.getGroupLeftId(Reveal.getCurrentSlideId())&&t.touchClearPageList.push(e)}),t.touchClearPageList.length&&t.pageClearCenter()},pagePreloadCenter:function(e){e&&(t.touchPreloadPageList=_.reject(t.touchPreloadPageList,function(t){return t==e}));if(t.touchPreloadPageList.length){var n=t.touchPreloadPageList[0];t.pageLoad(n)}},pageClearCenter:function(e){e&&(t.touchClearPageList=_.reject(t.touchClearPageList,function(t){return t==e}));if(t.touchClearPageList.length){var n=interaction_view.ipagelist.getPage(t.touchClearPageList[0]);n.iview.clearPageLoad()}},touchPreloadPageList:[],touchClearPageList:[]};window.presentation=t});define("interaction_view/ui/control",[],function(){var e={bindArrowControls:function(){Reveal.setNavigateFuncs({navigateLeft:e.slideLeft,navigateRight:e.slideRight})},slideUp:function(){Reveal.up()},slideDown:function(){Reveal.down()},slideLeft:function(){var t=Reveal.getCurrentSlide().id,n=e.getLeft(t);n&&e.slideTo(n.id)},slideRight:function(){var t=Reveal.getCurrentSlide().id,n=e.getRight(t);n&&e.slideTo(n.id)},getGroupLeft:function(e){if(Reveal.slideType!=3)return null;var t=interaction_view.ipagelist.getPage(e);if(!t)return null;var n=t.get("group"),r=t.collection.parent,i=interaction_view.ipagelist.at(interaction_view.ipagelist.indexOf(r)-1);if(i){var s=i.icollection.at(0);return s}return null},getGroupRight:function(e){if(Reveal.slideType!=3)return null;var t=interaction_view.ipagelist.getPage(e);if(!t)return null;var n=t.get("group"),r=t.collection.parent,i=interaction_view.ipagelist.at(interaction_view.ipagelist.indexOf(r)+1);if(i){var s=i.icollection.at(0);return s}return null},getGroupLeftId:function(e){var t=interaction_view.control.getGroupLeft(e);return t?t.id:null},getGroupRightId:function(e){var t=interaction_view.control.getGroupRight(e);return t?t.id:null},getRight:function(e){var t=interaction_view.ipagelist.getPage(e),n=t.get("group"),r=t.collection.parent,i=interaction_view.ipagelist.at(interaction_view.ipagelist.indexOf(r)+1);if(i){var s=i.icollection.at(0),o=s.get("group");return n!=o?!1:s}return!1},getLeft:function(e){var t=interaction_view.ipagelist.getPage(e),n=t.get("group"),r=t.collection.parent,i=interaction_view.ipagelist.at(interaction_view.ipagelist.indexOf(r)-1);if(i){var s=i.icollection.at(0),o=s.get("group");return n!=o?!1:s}return!1},getCurrent:function(){},slideTo:function(e){var t=interaction_view.ipagelist.getPage(e);indexh=t.collection.parent.collection.indexOf(t.collection.parent),indexv=t.collection.indexOf(t),Reveal.slide(indexh,indexv)}};return e});(function(){var e=1,t={init:function(){_g.orientation.orientationSupport&&window.addEventListener("deviceorientation",_g.orientation.onDeviceOrientation),_g.orientation.deltaX=0,_g.orientation.deltaY=0},orientationSupport:function(){return!!window.DeviceOrientationEvent},onDeviceOrientation:function(){var t,n,r,i;if(event.beta!==null&&event.gamma!==null){this.orientationStatus=1;var s=(event.beta-30||0)/e,o=(event.gamma-30||0)/e,u=window.innerHeight>window.innerWidth;u?(t=o+30,n=s,r=180,i=90):(t=-(s+30),n=o,r=90,i=180),_.each(_g.orientation.orientationEvents,function(e){var s=t,o=n;e.scrollX||(s=0),e.scrollY||(o=0),e.func&&e.func(-s*e.speed,-o*e.speed,r,i)})}},orientationEvents:[]};typeof require=="undefined"?(window._g||(window._g={}),window._g.orientation=t):define("_g/orientation",["_g/base"],function(){return window._g.orientation=t,window._g.orientation})})(window);(function(e,t){typeof define=="function"&&define.amd?define("shake",[],function(){return t(e,e.document)}):typeof module!="undefined"&&module.exports?module.exports=t(e,e.document):e.Shake=t(e,e.document)})(typeof window!="undefined"?window:this,function(e,t){"use strict";function n(n){this.hasDeviceMotion="ondevicemotion"in e,this.options={threshold:15,timeout:1e3};if(typeof n=="object")for(var r in n)n.hasOwnProperty(r)&&(this.options[r]=n[r]);this.lastTime=new Date,this.lastX=null,this.lastY=null,this.lastZ=null;if(typeof t.CustomEvent=="function")this.event=new t.CustomEvent("shake",{bubbles:!0,cancelable:!0});else{if(typeof t.createEvent!="function")return!1;this.event=t.createEvent("Event"),this.event.initEvent("shake",!0,!0)}}return n.prototype.reset=function(){this.lastTime=new Date,this.lastX=null,this.lastY=null,this.lastZ=null},n.prototype.start=function(){this.reset(),this.hasDeviceMotion&&e.addEventListener("devicemotion",this,!1)},n.prototype.stop=function(){this.hasDeviceMotion&&e.removeEventListener("devicemotion",this,!1),this.reset()},n.prototype.devicemotion=function(t){var n=t.accelerationIncludingGravity,r,i,s=0,o=0,u=0;if(this.lastX===null&&this.lastY===null&&this.lastZ===null){this.lastX=n.x,this.lastY=n.y,this.lastZ=n.z;return}s=Math.abs(this.lastX-n.x),o=Math.abs(this.lastY-n.y),u=Math.abs(this.lastZ-n.z);if(s>this.options.threshold&&o>this.options.threshold||s>this.options.threshold&&u>this.options.threshold||o>this.options.threshold&&u>this.options.threshold)r=new Date,i=r.getTime()-this.lastTime.getTime(),i>this.options.timeout&&(e.dispatchEvent(this.event),this.lastTime=new Date);this.lastX=n.x,this.lastY=n.y,this.lastZ=n.z},n.prototype.handleEvent=function(e){if(typeof this[e.type]=="function")return this[e.type](e)},n});define("interaction_view/ui/event",["_g/ui","_g/event","_g/orientation","shake"],function(){window.Shake=require("shake");var events={pageStartEvents:[],pageClickEvents:[],pageDblClickEvents:[],pageWXShareSuccessEvents:[],pageSwipeEvents:[],elementChangeToEvents:[],slideClickEvents:[],slideDblClickEvents:[],animationStartEvents:[],animationEndEvents:[],animationUpdateEvents:[],bindingEvents:[],mediaEvents:[],controllerEvents:[],dragStartEvents:[],dragEndEvents:[],draggingEvents:[],dragDropEvents:[],dragDropGroupEvents:[],timerEvents:[],variableEvents:[],voteEvents:[],paragraphEvents:[],pageShakeEvents:[],formEvents:[],eraserEvents:[],formSubmitEvents:[],WeixinCameraEvents:[],collisionEvents:[],init:function(){target=$(".slides"),target.on("click",function(e){events.testControl(e)&&events.onClickEvent()}),target.on("dblclick",function(e){events.testDblControl(e)&&(events.onDblClickEvent(),e.preventDefault()),_g.ui.clearSelection()}),interaction_view.touchview&&target.hammer().on("doubletap",function(e){events.testDblControl(e)&&(events.onDblClickEvent(),e.preventDefault()),_g.ui.clearSelection()}),interaction_view.ismobile||events.initWheelEvent(),interaction_view.ismobile&&_g.orientation.init(),_g.getUrlParameterByName("-build")!="1"&&_g.event.document.disable_contextmenu(),events.initShakeEvent()},initWXEvent:function(){function e(e){WeixinJSBridge.invoke("sendAppMessage",{appid:appid,img_url:imgUrl,img_width:"640",img_height:"640",link:message_link,desc:descContent,title:shareTitle},function(t){e&&e(t)})}function t(e){WeixinJSBridge.invoke("shareTimeline",{img_url:imgUrl,img_width:"640",img_height:"640",link:message_link,desc:descContent,title:shareTitle},function(t){e&&e(t)})}function n(e){WeixinJSBridge.invoke("shareWeibo",{content:descContent,url:message_link},function(t){e&&e(t)})}function r(){function r(){var e=_.filter(interaction_view.events.pageWXShareSuccessEvents,function(e){return e.page_id==interaction_view.currentPage});_.each(e,function(e){e.func()})}WeixinJSBridge.on("menu:share:appmessage",function(t){e(function(e){switch(e.err_msg){case"send_app_msg:cancel":break;case"send_app_msg:fail":break;case"send_app_msg:confirm":case"send_app_msg:ok":r(),_gaq.push(["_trackSocial","Wechat","appmessage",ga_opt_target,ga_opt_pagePath])}})}),WeixinJSBridge.on("menu:share:timeline",function(e){t(function(e){switch(e.err_msg){case"share_timeline:cancel":break;case"share_timeline:fail":break;case"share_timeline:confirm":case"share_timeline:ok":r(),_gaq.push(["_trackSocial","Wechat","timeline",ga_opt_target,ga_opt_pagePath])}})}),WeixinJSBridge.on("menu:share:weibo",function(e){n(function(e){switch(e.err_msg){case"share_weibo:cancel":break;case"share_weibo:fail":break;case"share_weibo:confirm":case"share_weibo:ok":r(),_gaq.push(["_trackSocial","Wechat","weibo",ga_opt_target,ga_opt_pagePath])}})}),typeof interaction_view!="undefined"&&(interaction_view.iswechat=1)}typeof WeixinJSBridge=="undefined"?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",r,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",r),document.attachEvent("onWeixinJSBridgeReady",r)):r()},wheelEvents:[],initWheelEvent:function(){_g.mousewheel.init()},initShakeEvent:function(){if(!_g.device.mobile())return;var e=new Shake({threshold:_g_device.iphone()?11:25});e.start(),window.addEventListener("shake",function(){interaction_view.events.onPageShakeEvent()},!1)},testControl:function(e){var t=$(e.target).closest(".iView");if($(e.target).closest(".iView").hasClass("hasaction"))return!1;if(t){var n=t.attr("data-type");if(n=="Slide"||n=="CycleImage")if(t.attr("data-iSlipable"))return!1}return $(e.target).closest(".iLayerRef").length>0&&$(e.target).closest(".iLayerRef").parent(".iView").hasClass("hascontrols")?!1:!0},testDblControl:function(e){var t=$(e.target).closest(".iView");return $(e.target).closest(".iView").hasClass("hasDblClick")?!1:!0},onPageStart:function(e,t){interaction_view.ipagelist.getPage(e)&&epub360.settings.pems.has_analytics_src&&interaction_view.analytics.set(e);var n=_.filter(interaction_view.events.pageStartEvents,function(n){return n.page_id==e&&(t?n.layer_id==t:!0)});n.length>0&&_.each(n,function(e){e.func()})},onPageSwipeEvent:function(e,t,n){var r=_.filter(interaction_view.events.pageSwipeEvents,function(r){return r.page_id==t&&(n?r.layer_id==n:!0)&&e==r.swipeType});return r.length>0?(_.each(r,function(e){e.func()}),events.clearAnimationWaitSwipe(),!0):!1},onPageShakeEvent:function(){var e=_.filter(interaction_view.events.pageShakeEvents,function(e){return e.page_id==interaction_view.currentPage||e.page_id==interaction_view.imasterlist.at(0).id});return e.length>0?(_.each(e,function(e){e.func()}),events.clearAnimationWaitShake(),!0):!1},onChangeTo:function(e,t,n){var r=_.filter(interaction_view.events.elementChangeToEvents,function(r){return r.page_id==e&&r.overlay_id==t&&r.index==n});r.length>0&&_.each(r,function(e){e.func()})},onClickEvent:function(){if(interaction_view.events.pageClickEvents.length>0){var e=_.filter(interaction_view.events.pageClickEvents,function(e){return e.type=="waitaction"});if(e.length>0)_.each(e,function(e){e.func()});else{var t=_.filter(interaction_view.events.pageClickEvents,function(e){return e.page_id==interaction_view.currentPage&&e.type=="page"});if(t.length>0)_.each(t,function(e){e.func()});else{var n=_.filter(interaction_view.events.pageClickEvents,function(e){return e.type=="master"});if(n.length>0)interaction_view.show_master&&_.each(n,function(e){e.func()});else{var r=_.filter(interaction_view.events.pageClickEvents,function(e){return e.type=="background"});interaction_view.show_background&&_.each(r,function(e){e.func()})}}}events.clearWaitClick()}},onDblClickEvent:function(){if(interaction_view.events.pageDblClickEvents.length>0){var e=_.filter(interaction_view.events.pageDblClickEvents,function(e){return e.page_id==interaction_view.currentPage&&e.type=="page"});if(e.length>0)_.each(e,function(e){e.func()});else{var t=_.filter(interaction_view.events.pageDblClickEvents,function(e){return e.type=="master"});if(t.length>0)interaction_view.show_master&&_.each(t,function(e){e.func()});else{var n=_.filter(interaction_view.events.pageDblClickEvents,function(e){return e.type=="background"});interaction_view.show_background&&_.each(n,function(e){e.func()})}}}},onSlideClickEvent:function(e,t,n,r,i){},onSlideDblClickEvent:function(e,t,n,r,i){},onControllerEvent:function(e){},onBingChangeTo:function(e){var t=_.filter(interaction_view.events.bindingEvents,function(t){return t.id==e.id&&t.page_id==e.page_id});_.each(t,function(t){e.direction=t.direction,t.func(e)})},onAnimationStart:function(e){var t=_.filter(interaction_view.events.animationStartEvents,function(t){return e.layer_id?e.overlay_id?t.overlay_id==e.overlay_id&&t.animation_id==e.animation_id&&t.layer_id==e.layer_id:t.animation_id==e.animation_id&&t.layer_id==e.layer_id:e.overlay_id?t.overlay_id==e.overlay_id&&t.animation_id==e.animation_id&&t.page_id==e.page_id:t.animation_id==e.animation_id&&t.page_id==e.page_id});_.each(t,function(e){e.func()})},onAnimationEnd:function(e){var t=_.filter(interaction_view.events.animationEndEvents,function(t){return e.layer_id?e.overlay_id?t.overlay_id==e.overlay_id&&t.animation_id==e.animation_id&&t.layer_id==e.layer_id:t.animation_id==e.animation_id&&t.layer_id==e.layer_id:e.overlay_id?t.overlay_id==e.overlay_id&&t.animation_id==e.animation_id&&t.page_id==e.page_id:t.animation_id==e.animation_id&&t.page_id==e.page_id});_.each(t,function(e){e.func()})},onAnimationUpdate:function(e){var t=_.filter(interaction_view.events.animationUpdateEvents,function(t){return e.layer_id?e.overlay_id?t.overlay_id==e.overlay_id&&t.animation_id==e.animation_id&&t.layer_id==e.layer_id:t.animation_id==e.animation_id&&t.layer_id==e.layer_id:e.overlay_id?t.overlay_id==e.overlay_id&&t.animation_id==e.animation_id&&t.page_id==e.page_id:t.animation_id==e.animation_id&&t.page_id==e.page_id});_.each(t,function(e){e.func()})},onDragStart:function(e){var t=_.filter(interaction_view.events.dragStartEvents,function(t){return e.layer_id?t.overlay_id==e.overlay_id&&t.layer_id==e.layer_id:t.overlay_id==e.overlay_id&&t.page_id==e.page_id});_.each(t,function(e){e.func()})},onDragEnd:function(e){var t=_.filter(interaction_view.events.dragEndEvents,function(t){return e.layer_id?t.overlay_id==e.overlay_id&&t.layer_id==e.layer_id:t.overlay_id==e.overlay_id&&t.page_id==e.page_id});_.each(t,function(e){e.func()})},onDragging:function(e){var t=_.filter(interaction_view.events.draggingEvents,function(t){return e.layer_id?t.overlay_id==e.overlay_id&&t.layer_id==e.layer_id:t.overlay_id==e.overlay_id&&t.page_id==e.page_id});_.each(t,function(e){e.func()})},onDragDrop:function(e,t,n){function i(t,n){return t.overlay_id!=e.id||t.drop_type!=n?!1:e.page.isLayer?t.layer_id==e.page.iOverlaylist.layerid:t.page_id==e.page.id}var r;if(n==0){r=_.filter(interaction_view.events.dragDropEvents,function(e){return i(e,8)}),_.each(r,function(e){e.func()});return}e.iview.Status=2,_.include(e.iview.getdetail().element_ids,t.id)?(e.iview.Status=1,r=_.filter(interaction_view.events.dragDropEvents,function(e){return i(e,9)})):r=_.filter(interaction_view.events.dragDropEvents,function(e){return i(e,10)}),_.each(r,function(e){e.func()})},onDragDropGroup:function(e){function t(e,t,n){return e.overlay_id!=n.id||e.drop_type!=t?!1:n.page.isLayer?e.layer_id==n.page.iOverlaylist.layerid:e.page_id==n.page.id}$.each(e.iview.DragDropGroups,function(e,n){var r=n.iview.getdetail().element_ids,i=0,s=!0;$.each(r,function(e,t){var r=n.page.iOverlaylist.where({id:t})[0];if(r&&r.iview){r=r.iview;if(r.Status==0)return s=!1,!1;r.Status==1&&i++}});if(!s)return;var o;i==r.length?o=_.filter(interaction_view.events.dragDropGroupEvents,function(e){return t(e,11,n)}):o=_.filter(interaction_view.events.dragDropGroupEvents,function(e){return t(e,12,n)}),_.each(o,function(e){e.func()})})},onTimerStart:function(e){_.each(e.Actions_19,function(e){e.func()})},onTimerStop:function(e){_.each(e.Actions_17,function(e){e.func()})},onTimerInterval:function(e){_.each(e.Actions_18,function(t){var n=Number(t.condition);n>0&&Number(e.currentTime.toFixed(2))*100%(Number(n.toFixed(2))*100)==0&&t.func()})},onTimerCountTo:function(e){_.each(e.Actions_16,function(t){Math.abs(Number(e.currentTime.toFixed(2))*100-Number(Number(t.condition).toFixed(2))*100)<5&&t.func()})},onVariableChanged:function(view){var detail=view.getdetail(),initial=detail.iKind=="0"&&Number(detail.initial)||detail.initial,actions=_.filter(interaction_view.events.variableEvents,function(e){return interaction_view.events.filterType(view,e,22)}),VarOPobj=interaction_view.getVarsOp(interaction_view.currentPage,null,interaction_view.environment.Votes.get());_.each(actions,function(v){var cond;cond=v.condition.replace(/%@/g,"initial"),cond=VarOPobj.var2val(cond,!0),eval(cond)&&v.func()})},onVoted:function(e){var t=_.filter(interaction_view.events.voteEvents,function(t){return interaction_view.events.filterType(e,t,23)});_.each(t,function(e){e.func()})},onParagraphChanged:function(e){var t=_.filter(interaction_view.events.paragraphEvents,function(t){return interaction_view.events.filterType(e,t,54)});_.each(t,function(e){e.func()})},onFormEvent:function(e,t){var n=e.createPath(),r=_.filter(interaction_view.events.formEvents,function(e){return interaction_view.hashPath(n)==interaction_view.hashPath(e.overlay.path)+e.overlay.id});_.each(r,function(e){e.func(t)})},onFormSubmitEvent:function(e,t){var n=_.filter(interaction_view.events.formSubmitEvents,function(e){return e.id==t});_.each(n,function(e){e.func(status)})},onFormButtonRender:function(e){var t=e.createPath(),n=null,r=null,i=_.filter(interaction_view.events.formEvents,function(e){return interaction_view.hashPath(t)==interaction_view.hashPath(e.overlay.path)+e.overlay.id});return _.each(i,function(t){r=t,n=interaction_view.application.getValue(t.id,t.cid,t.key),t.bindSwitch&&interaction_view.application.sendOverlayToButtonGroup(e)}),{field:r,value:n}},onEraserEvent:function(e){var t=_.filter(interaction_view.events.eraserEvents,function(t){return interaction_view.events.filterType(e,t,41)});_.each(t,function(e){e.func()})},onWeixinEvent:function(e,t){var n=_.filter(interaction_view.events.WeixinCameraEvents,function(n){return interaction_view.events.filterType(e,n,t)});_.each(n,function(e){e.func()})},onCollision:function(e){var t=_.filter(interaction_view.events.collisionEvents,function(t){return interaction_view.events.filterType(e,t,73)});_.each(t,function(e){e.func()})},clearWaitClick:function(){interaction_view.events.pageClickEvents=_.reject(interaction_view.events.pageClickEvents,function(e){return e.type=="waitaction"})},clearAnimationWaitSwipe:function(){interaction_view.events.pageSwipeEvents=_.reject(interaction_view.events.pageSwipeEvents,function(e){return e.type=="waitaction"})},clearAnimationWaitShake:function(){interaction_view.events.pageShakeEvents=_.reject(interaction_view.events.pageShakeEvents,function(e){return e.type=="waitaction"})},clearAll:function(){interaction_view.events.pageClickEvents=[],interaction_view.events.pageDblClickEvents=[],interaction_view.events.pageStartEvents=[],interaction_view.events.pageWXShareSuccessEvents=[],interaction_view.events.bindingEvents=[],interaction_view.events.elementChangeToEvents=[],interaction_view.events.animationStartEvents=[],interaction_view.events.animationEndEvents=[],interaction_view.events.animationUpdateEvents=[],interaction_view.events.slideClickEvents=[],interaction_view.events.slideDblClickEvents=[],interaction_view.events.controllerEvents=[],interaction_view.events.dragDropEvents=[],interaction_view.events.dragDropGroupEvents=[],interaction_view.events.timerEvents=[],interaction_view.events.variableEvents=[],interaction_view.events.voteEvents=[],interaction_view.events.paragraphEvents=[],interaction_view.events.pageSwipeEvents=[],interaction_view.events.pageShakeEvents=[],interaction_view.events.formEvents=[],interaction_view.events.formSubmitEvents=[],interaction_view.events.eraserEvents=[],interaction_view.events.WeixinCameraEvents=[],interaction_view.events.collisionEvents=[],interaction_view.events.dragStartEvents=[],interaction_view.events.draggingEvents=[],interaction_view.events.dragEndEvents=[],typeof Reveal!="undefined"&&(Reveal.wheelLock=!1,Reveal.dragLock=!1,Reveal.wheelEventLock=!1)},filterType:function(e,t,n){return t.overlay_id!=e.model.id||t.type!=n?!1:e.model.page.isLayer?t.layer_id==e.model.page.iOverlaylist.layerid:t.page_id==e.model.page.id}};return events});define("interaction_view/ui/environment",["underscore"],function(){var e={Votes:{collection:{},add:function(t){e.Votes.collection[t.id]||e.Votes.update(t)},update:function(t){e.Votes.collection[t.id]=t},get:function(){return _.toArray(e.Votes.collection)}},Paragraph:{editable:!1,stateChanged:function(e){_.each(interaction_view.getOverlays("Slide",interaction_view.currentPage),function(t){t.iview.setControl(e)})},enable:function(){e.Paragraph.editable=!0,$("body").addClass("ParagraghEditable"),e.Paragraph.stateChanged(!0)},disable:function(){e.Paragraph.editable=!1,$("body").removeClass("ParagraghEditable"),e.Paragraph.stateChanged(!1)},state:function(){return e.Paragraph.editable}}};return e});define("interaction_view/ui/mobilemedia",[],function(){var e={statusclear:function(e){e.loaded=!1,e.played=!1,e.reseted=!1,e.completed=!1},play:function(t){t.get("iType")=="Video"&&e.video.play(t),t.get("iType")=="Audio"&&e.audio.play(t)},pause:function(e){if(!e.media||e.media.paused)return!1;try{e.media.pause()}catch(t){}e.iview.slider&&e.iview.sliderstop()},seek:function(t,n,r){r&&(n=e.getTimeByPercent(t,r));try{t.media.currentTime=n}catch(i){}},changeSrc:function(e,t){try{e.media.src=t}catch(n){}},video:{render:function(e,t,n){},init:function(e,t,n){function a(n){t.loaded=n,e.set("loaded",!0),e.page.ipreloadlist.preloadcheck(e.toJSON().file,n,t)}var r=n;if(_g.string.getUrlExt(r)==".m3u8"||_g.string.getUrlExt(r)==".M3U8")return;var i=t.iview.getdetail(),s=t.iview.getcommon(),o=$('<video style="position:absolute; display:none;" src="'+r+'" width="100%" height="100%"></video>'),u=$('<img style="position:absolute;" src="'+i.iFile[0].picture+'" width="100%" height="100%"/>');t.iview.$el.removeClass("hide").children(".Element").append(o).append(u),i.iControl&&o.attr("controls",""),i.iRepeat&&o.attr("loop",""),t.media=o[0],t.autoplay=i.iAutoplay||!1,o.on("loadstart",function(e){a(!0)}).on("error",function(e){a(!1)}).on("canplay",function(e){u.fadeOut(function(){o.fadeIn()})}),t.onAnimationStart&&o.on("ended",function(e){interaction_view.events.onAnimationEnd(t.onAnimationStart),t.onAnimationStart=null})},play:function(e){if(!e.loaded||!e.media||!e.media.paused)return e.iview.slider&&e.media&&e.iview.sliderplay(),!1;e.reseted=!1,e.get("iType")=="Video"&&(e.iview.$el.removeClass("hide"),e.hided=!1),e.get("iType")=="Audio"?e.media.play():setTimeout(e.media.play(),100),e.iview.slider&&e.iview.sliderplay()},reset:function(e){if(!e.media||e.reseted)return!1;try{e.media.currentTime=0,e.media.pause()}catch(t){}e.reseted=!0},getDuration:function(e){return e.duration}},audio:{init:function(t,n,r){var i=t.toJSON().file,s="Audio_"+t.id+n.id;n.src=i,n.audioid=s;if(_g.string.getUrlExt(i)==".m3u8"||_g.string.getUrlExt(i)==".M3U8")return;var o=n.iview.getdetail(),u=n.iview.getcommon();if(_g.device.isWeixin()&&r&&typeof bgsound_id!="undefined"&&typeof bgsound_src!="undefined"&&bgsound_id==n.id){n.media=audio,interaction_view.bgsound=n,n.isBgsound=!0;if(!audio){audioelement=n,n.loaded=!0,t.set("loaded",!0),t.page.ipreloadlist.preloadcheck(t.toJSON().file,!0,n);return}a=$("audio#bgsound"),n.media.play(),n.media.paused||(n.hasPlayed=!0)}else{var a=$('<audio id="'+s+'" style="position:absolute;"> <source src="'+i+'" /> </audio>');n.iview.$el.removeClass("hide").children(".Element").append(a),!_g.device.android()&&o.iRepeat&&a.attr("loop",""),n.media=a[0],n.autoplay=o.iAutoplay||!1,o.iAutoplay&&r&&(interaction_view.bgsound||(n.isBgsound=!0,interaction_view.bgsound=n))}n.loaded=!0,t.set("loaded",!0),t.page.ipreloadlist.preloadcheck(t.toJSON().file,!0,n),a.on("loadstart",function(e){}).on("error",function(e){}).on("timeupdate",function(e){if(n.iview.slider){var t=n.media.currentTime,r=n.media.duration,i=_g.number.decimal(t/r,2)*100;n.iview.onSliderChange(i)}}),a.on("ended",function(t){if(!o.iRepeat){n.iview.slider&&n.iview.sliderstop();if(n.media.seekable.length==0)return;try{n.media.currentTime=0,e.pause(n)}catch(r){}n.onAnimationStart&&(interaction_view.events.onAnimationEnd(n.onAnimationStart),n.onAnimationStart=null)}else _g.device.android()&&n.media.play()})},getDuration:function(e){return e.duration},play:function(t){e.video.play(t)},reset:function(t){if(t.isBgsound)return;e.video.reset(t)}},getTimeByPercent:function(e,t){if(!e.media)return null;var n=e.media.duration;return t/100*n}};return e});(function(e){var t={init:function(n){return this.each(function(){var r=e(this),i=r.data("eraser");if(!i){var s=r.width(),o=r.height(),u=r.offset(),a=e("<canvas/>"),f=a.get(0),l=n.imageWidth,c=n.imageHeight,h=n&&n.size?n.size:40,p=n&&n.completeRatio?n.completeRatio:.7,d=n&&n.completeFunction?n.completeFunction:null,v=n&&n.completeRatioFunction?n.completeRatioFunction:null,m=[],g=Math.floor(s/h),y=g*Math.floor(o/h),b=y,w=f.getContext("2d");r.after(a),f.id=this.id,f.className=this.className,f.width=s,f.height=o;if(!this.src)return;var E=new Image;E.onload=function(){l&&c?w.drawImage(E,0,0,l,c):w.drawImage(E,0,0),r.remove(),w.globalCompositeOperation="destination-out",w.strokeStyle="rgba(255,0,0,255)",w.lineWidth=h,w.lineCap="round",a.bind("mousedown.eraser",t.mouseDown),a.bind("touchstart.eraser",t.touchStart),a.bind("touchmove.eraser",t.touchMove),a.bind("touchend.eraser",t.touchEnd);while(b--)m.push(1);e.zoom||(e.zoom=1),i={posX:u.left,posY:u.top,touchDown:!1,touchID:-999,touchX:0,touchY:0,ptouchX:0,ptouchY:0,canvas:a,ctx:w,w:s,h:o,source:E,size:h,parts:m,colParts:g,numParts:y,ratio:0,complete:!1,completeRatio:p,completeFunction:d,completeRatioFunction:v,imageWidth:l,imageHeight:c},a.data("eraser",i),r.data("eraser",i),e(window).resize(function(){e.zoom||(e.zoom=1);var t=a.offset();i.posX=t.left,i.posY=t.top,a.data("eraser",i)})},E.src=this.src}})},touchStart:function(n){var r=e(this),i=r.data("eraser"),s=r.offset();i.posX=s.left,i.posY=s.top;if(!i.touchDown){var o=n.originalEvent.changedTouches[0],u=o.pageX/e.zoom-i.posX,a=o.pageY/e.zoom-i.posY;t.evaluatePoint(i,u,a),i.touchDown=!0,i.touchID=o.identifier,i.touchX=u,i.touchY=a,n.preventDefault()}},touchMove:function(n){var r=e(this),i=r.data("eraser"),s=r.offset();i.posX=s.left,i.posY=s.top;if(i.touchDown){var o=n.originalEvent.changedTouches,u=o.length;while(u--)if(o[u].identifier==i.touchID){var a=o[u].pageX/e.zoom-i.posX,f=o[u].pageY/e.zoom-i.posY;t.evaluatePoint(i,a,f),i.ctx.beginPath(),i.ctx.moveTo(i.touchX,i.touchY),i.touchX=a,i.touchY=f,i.ctx.lineTo(i.touchX,i.touchY),i.ctx.stroke(),n.preventDefault();break}}},touchEnd:function(t){var n=e(this),r=n.data("eraser"),i=n.offset();r.posX=i.left,r.posY=i.top;if(r.touchDown){var s=t.originalEvent.changedTouches,o=s.length;while(o--)if(s[o].identifier==r.touchID){r.touchDown=!1,t.preventDefault();break}}},evaluatePoint:function(e,t,n){var r=Math.floor(t/e.size)+Math.floor(n/e.size)*e.colParts;r>=0&&r<e.numParts&&(e.ratio+=e.parts[r],e.parts[r]=0,e.complete||e.ratio/e.numParts>=e.completeRatio&&(e.complete=!0,e.completeRatioFunction!=null&&e.completeRatioFunction()))},mouseDown:function(n){var r=e(this),i=r.data("eraser"),s=r.offset();i.posX=s.left,i.posY=s.top;var o=n.pageX/e.zoom-i.posX,u=n.pageY/e.zoom-i.posY;console.log("mouse page "+n.pageX+" "+n.pageY),console.log("offset "+i.posX+" "+i.posY),t.evaluatePoint(i,o,u),i.touchDown=!0,i.touchX=o,i.touchY=u,i.ctx.beginPath(),i.ctx.moveTo(i.touchX-1,i.touchY),i.ctx.lineTo(i.touchX,i.touchY),i.ctx.stroke(),r.bind("mousemove.eraser",t.mouseMove),e(document).bind("mouseup.eraser",i,t.mouseUp),n.preventDefault()},mouseMove:function(n){var r=e(this),i=r.data("eraser"),s=r.offset();i.posX=s.left,i.posY=s.top;var o=n.pageX/e.zoom-i.posX,u=n.pageY/e.zoom-i.posY;t.evaluatePoint(i,o,u),i.ctx.beginPath(),i.ctx.moveTo(i.touchX,i.touchY),i.touchX=o,i.touchY=u,i.ctx.lineTo(i.touchX,i.touchY),i.ctx.stroke(),n.preventDefault()},mouseUp:function(t){var n=t.data,r=n.canvas;n.touchDown=!1,r.unbind("mousemove.eraser"),e(document).unbind("mouseup.eraser"),t.preventDefault()},clear:function(){var t=e(this),n=t.data("eraser");if(n){var r=0;h=0;var i=function(){n.ctx.clearRect(0,0,n.w,n.h);var e=n.numParts;while(e--)n.parts[e]=0;n.ratio=n.numParts,n.complete=!0,n.completeFunction!=null&&n.completeFunction()};i()}},size:function(t){var n=e(this),r=n.data("eraser");r&&t&&(r.size=t,r.ctx.lineWidth=t)},reset:function(){var t=e(this),n=t.data("eraser");if(n){n.ctx.globalCompositeOperation="source-over",n.imageWidth&&n.imageHeight?n.ctx.drawImage(n.source,0,0,n.imageWidth,n.imageHeight):n.ctx.drawImage(n.source,0,0),n.ctx.globalCompositeOperation="destination-out";var r=n.numParts;while(r--)n.parts[r]=1;n.ratio=0,n.complete=!1}}};e.fn.eraser=function(n){if(t[n])return t[n].apply(this,Array.prototype.slice.call(arguments,1));if(typeof n=="object"||!n)return t.init.apply(this,arguments);e.error("Method "+n+" does not yet exist on jQuery.eraser")}})(jQuery),define("jquery.eraser",function(){}),define("/Users/blues/projects/epub360/1-src/epub360-built/html/common/js/eraser/jquery.eraser.js",function(){});define("interaction_view/ui/eraser",["jquery.eraser"],function(){var e={set:function(e,t,n,r){$(e).eraser({size:40,imageWidth:t,imageHeight:n,completeRatio:.5,completeRatioFunction:function(){$(e).eraser("clear"),interaction_view.events.onEraserEvent(r)},completeFunction:function(){r.$el.addClass("invisible noevents")}})},reset:function(e){$(e).eraser("reset")}};return e});define("interaction_view/ui/adapt",[],function(){var e={elements:[],size:{x:0,y:0},adjustSize:function(){},adjustPosition:function(){},adjustElement:function(e){var t=e.view.getcommon(),n=Reveal._getScreenScale();e.view.x=t.iStartx+t.iWidth/2,e.view.y=t.iStarty+t.iHeight/2,e.view.staticX=t.iStartx,e.view.staticY=t.iStarty;if(!e.adapt||e.adapt==5){var r=t.iStartx+t.iWidth/2,i=t.iStarty+t.iHeight/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=r+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.staticX=e.view.x-t.iWidth/2):e.view.x=r,Reveal.slideScreenHeight>Reveal.slideHeight?(e.view.y=i+(Reveal.slideScreenHeight-Reveal.slideHeight)/2,e.view.staticY=e.view.y-t.iHeight/2):e.view.y=i}else{console.log(e.adapt);switch(e.adapt){case 1:e.view.sizeLeft=!0,e.view.sizeTop=!0;break;case 2:var r=t.iStartx+t.iWidth/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=r+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.staticX=e.view.x-t.iWidth/2):e.view.x=r;break;case 3:e.view.sizeTop=!0,e.view.sizeRight=!0;var r=t.iStartx+t.iWidth/2,s=interaction_view.size.x-r;e.view.x=Reveal.slideScreenWidth-s,e.view.staticX=e.view.x-t.iWidth/2;break;case 4:e.view.sizeLeft=!0;var i=t.iStarty+t.iHeight/2;Reveal.slideScreenHeight>Reveal.slideHeight?e.view.y=i+(Reveal.slideScreenHeight-Reveal.slideHeight)/2:e.view.y=i,e.view.staticY=e.view.y-t.iHeight/2;break;case 5:break;case 6:e.view.sizeRight=!0;var r=t.iStartx+t.iWidth/2,s=interaction_view.size.x-r;e.view.x=Reveal.slideScreenWidth-s;var i=t.iStarty+t.iHeight/2;Reveal.slideScreenHeight>Reveal.slideHeight?e.view.y=i+(Reveal.slideScreenHeight-Reveal.slideHeight)/2:e.view.y=i,e.view.staticX=e.view.x-t.iWidth/2,e.view.staticY=e.view.y-t.iHeight/2;break;case 7:e.view.sizeLeft=!0,e.view.sizeBottom=!0;var i=t.iStarty+t.iHeight/2,o=interaction_view.size.y-i;e.view.y=Reveal.slideScreenHeight-o,e.view.staticY=e.view.y-t.iHeight/2;break;case 8:e.view.sizeBottom=!0;var r=t.iStartx+t.iWidth/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=r+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.x=e.view.x):e.view.x=r;var i=t.iStarty+t.iHeight/2,o=interaction_view.size.y-i;e.view.y=Reveal.slideScreenHeight-o,e.view.staticX=e.view.x-t.iWidth/2,e.view.staticY=e.view.y-t.iHeight/2;break;case 9:e.view.sizeBottom=!0,e.view.sizeRight=!0;var r=t.iStartx+t.iWidth/2,s=interaction_view.size.x-r;e.view.x=Reveal.slideScreenWidth-s;var i=t.iStarty+t.iHeight/2,o=interaction_view.size.y-i;e.view.y=Reveal.slideScreenHeight-o,e.view.staticX=e.view.x-t.iWidth/2,e.view.staticY=e.view.y-t.iHeight/2;break;case 10:e.view.sizeLeft=!0,e.view.sizeRight=!0;var u=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,a=u-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth);e.view.width=a;var i=t.iStarty+t.iHeight/2;Reveal.slideScreenHeight>Reveal.slideHeight?e.view.y=i+(Reveal.slideScreenHeight-Reveal.slideHeight)/2:e.view.y=i,e.view.x=e.view.staticX+e.view.width/2,e.view.staticY=e.view.y-e.view.originHeight/2;break;case 11:e.view.sizeTop=!0,e.view.sizeBottom=!0;var r=t.iStartx+t.iWidth/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=r+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.staticX=e.view.x-e.view.originWidth/2):e.view.x=r;var f=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,l=f-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight);e.view.height=l,e.view.y=e.view.staticY+e.view.height/2;break;case 12:e.view.sizeLeft=!0,e.view.sizeRight=!0,e.view.sizeTop=!0,e.view.sizeBottom=!0;var u=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,a=u-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth);e.view.width=a;var f=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,l=f-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight);e.view.height=l,e.view.staticX=t.iStartx,e.view.staticY=t.iStarty,e.view.x=t.iStartx+e.view.width/2,e.view.y=t.iStarty+e.view.height/2;break;case 13:e.view.sizeLeft=!0,e.view.sizeRight=!0,e.view.sizeTop=!0;var u=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,a=u-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth);e.view.width=a,e.view.x=e.view.staticX+e.view.width/2;var i=t.iStarty+t.iHeight/2;if(Reveal.slideScreenHeight>Reveal.slideHeight)var c=Reveal.slideScreenHeight-Reveal.slideHeight;else var c=0;e.view.staticY=e.view.y-t.iHeight/2;var f=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,l=f-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight)-c;e.view.height=l;break;case 14:e.view.sizeLeft=!0,e.view.sizeRight=!0,e.view.sizeBottom=!0;var u=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,a=u-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth);e.view.width=a,e.view.x=e.view.staticX+e.view.width/2;var i=t.iStarty+t.iHeight/2;Reveal.slideScreenHeight>Reveal.slideHeight?e.view.y=i+(Reveal.slideScreenHeight-Reveal.slideHeight)/2:e.view.y=i,e.view.staticY=e.view.y-t.iHeight/2;var f=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,l=f-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight);e.view.height=l;break;case 15:e.view.sizeLeft=!0,e.view.sizeTop=!0,e.view.sizeBottom=!0;if(Reveal.slideScreenWidth>Reveal.slideWidth)var c=Reveal.slideScreenWidth-Reveal.slideWidth;else var c=0;var u=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,a=u-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth)-c;e.view.width=a;var f=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,l=f-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight);e.view.height=l,e.view.x=e.view.staticX+e.view.width/2,e.view.y=e.view.staticY+e.view.height/2;break;case 16:e.view.sizeRight=!0,e.view.sizeTop=!0,e.view.sizeBottom=!0;var r=t.iStartx+t.iWidth/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=r+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.staticX=e.view.x-t.iWidth/2):e.view.x=r;var u=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,a=u-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth);e.view.width=a;var f=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,l=f-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight);e.view.height=l,e.view.y=e.view.staticY+e.view.height/2;break;case 17:e.view.sizeTop=!0;var r=t.iStartx+t.iWidth/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=r+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.staticX=e.view.x-t.iWidth/2):e.view.x=r;if(Reveal.slideScreenHeight>Reveal.slideHeight)var c=Reveal.slideScreenHeight-Reveal.slideHeight;else var c=0;e.view.staticY=e.view.y-t.iHeight/2;var f=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,l=f-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight)-c;e.view.height=l,e.view.width=t.iWdith;break;case 18:e.view.sizeRight=!0;var i=t.iStarty+t.iHeight/2;Reveal.slideScreenHeight>Reveal.slideHeight?e.view.y=i+(Reveal.slideScreenHeight-Reveal.slideHeight)/2:e.view.y=i,e.view.staticY=e.view.y-t.iHeight/2;var r=t.iStartx+t.iWidth/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=r+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.staticX=e.view.x-t.iWidth/2):e.view.x=r;var u=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,a=u-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth);e.view.width=a;break;case 19:e.view.sizeBottom=!0;var r=t.iStartx+t.iWidth/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=r+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.staticX=e.view.x-t.iWidth/2):e.view.x=r;var i=t.iStarty+t.iHeight/2;Reveal.slideScreenHeight>Reveal.slideHeight?e.view.y=i+(Reveal.slideScreenHeight-Reveal.slideHeight)/2:e.view.y=i,e.view.staticY=e.view.y-t.iHeight/2;var f=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,l=f-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight);e.view.height=l;break;case 20:e.view.sizeLeft=!0;var i=t.iStarty+t.iHeight/2;Reveal.slideScreenHeight>Reveal.slideHeight?e.view.y=i+(Reveal.slideScreenHeight-Reveal.slideHeight)/2:e.view.y=i,e.view.staticY=e.view.y-t.iHeight/2;if(Reveal.slideScreenWidth>Reveal.slideWidth)var c=Reveal.slideScreenWidth-Reveal.slideWidth;else var c=0;var u=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,a=u-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth)-c;e.view.width=a}e.view.width&&($.zoom&&$.zoom!=1?e.view.width=e.view.width/$.zoom:e.view.width=e.view.width),e.view.height&&($.zoom&&$.zoom!=1?e.view.height=e.view.height/$.zoom:e.view.height=e.view.height);if(_g.device.ios()){if(e.view.model.isMasterOverlay||e.view.model.isBackgroundOverlay)var h=$(Reveal.options.containment).offset();else var h=e.view.$el.closest(".interaction-area").offset();if(h){e.view.x=e.view.x-h.left,e.view.y=e.view.y-h.top,e.view.staticX=e.view.staticX-h.left,e.view.staticY=e.view.staticY-h.top;if(e.view.model.get("iType")=="LayerRef"||e.view.model.get("iType")=="ComponentRef")e.view.width&&(e.view.width=e.view.width+Math.abs(h.left)),e.view.height&&(e.view.height=e.view.height+Math.abs(h.top))}}}},change:function(){_.each(interaction_view.adapt.elements,function(e){interaction_view.adapt.excute(e)})},excute:function(e){interaction_view.adapt.adjustElement(e);var t=!1;e.view.model.get("isStatic")?(e.view.width&&(t=!0,e.view.originWidth=e.view.width,e.view.$el.width(e.view.width),e.view.$el.children(".Element").width(e.view.width)),e.view.height&&(t=!0,e.view.originHeight=e.view.height,e.view.$el.height(e.view.height),e.view.$el.children(".Element").height(e.view.height)),e.view.$el.css({left:e.view.staticX,top:e.view.staticY})):(TweenMax.set(e.view.$el[0],{x:e.view.x,y:e.view.y}),e.view.width&&(t=!0,e.view.originWidth=e.view.width,e.view.$el.children(".Element").width(e.view.width)),e.view.height&&(t=!0,e.view.originHeight=e.view.height,e.view.$el.children(".Element").height(e.view.height))),t&&e.view.onSizeAdaptChange&&e.view.onSizeAdaptChange()}};return e});define("text!interaction_view/template/analytics.js",[],function(){return'<iframe src="<%=data.src%>" style="border:none;width:0;height:0;" class="analytics_frame"></iframe>'});define("interaction_view/ui/analytics",["text!interaction_view/template/analytics.js"],function(){var e=require("text!interaction_view/template/analytics.js"),t={set:function(t){var n="./analytics/"+t+".html";$("body").find(".analytics_frame").length?$("body").find(".analytics_frame").attr("src",n):$("body").append(_.template(e,{data:{src:n}}))}};return t});define("interaction_view/ui/weixin",[],function(){var e={chooseimage:function(e){typeof wx_permissions!="undefined"&&wx_permissions.chooseImage?wx.chooseImage({success:function(t){t.localIds&&t.localIds.length?e&&e(t.localIds):e&&e(null)}}):interaction_view.weixin.error()},voiceauth:function(){if(typeof wx_permissions!="undefined"&&wx_permissions.startRecord){if(interaction_view.weixinvoiceauth)return;wx.startRecord({success:function(){wx.stopRecord({})},cancel:function(){interaction_view.errorAlert("开启微信功能失败")}}),interaction_view.weixinvoiceauth=!0}},shareable:function(){return typeof wx_permissions!="undefined"&&wx_permissions.onMenuShareTimeline?!0:!1},share:function(){if(typeof wx_permissions!="undefined"&&wx_permissions.onMenuShareTimeline){var e=message_link,t="";interaction_view.share_page_id=="current"?(e=_g.replaceUrlParameterByName("disableHistoryStart","disableHistoryStart=0",e),e+="#page/"+interaction_view.currentPage):interaction_view.share_page_id!="first"&&(e=_g.replaceUrlParameterByName("disableHistoryStart","disableHistoryStart=0",e),e+="#page/"+interaction_view.share_page_id);var n=shareTitle==bookTitle?descContent:shareTitle;wx.onMenuShareAppMessage({title:bookTitle,desc:n,link:e,imgUrl:imgUrl,trigger:function(e){_gaq.push(["_trackEvent","weixin","share","appmessage","click"])},success:function(e){_gaq.push(["_trackSocial","Wechat","appmessage",ga_opt_target,ga_opt_pagePath]),_paq.push(["trackEvent","weixin","share","appmessage"])},cancel:function(e){_gaq.push(["_trackEvent","weixin","share","appmessage","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","appmessage",JSON.stringify(e)])}}),wx.onMenuShareTimeline({title:shareTitle,link:e,imgUrl:imgUrl,trigger:function(e){_gaq.push(["_trackEvent","weixin","share","timeline","click"])},success:function(e){_gaq.push(["_trackSocial","Wechat","timeline",ga_opt_target,ga_opt_pagePath]),_paq.push(["trackEvent","weixin","share","timeline"])},cancel:function(e){_gaq.push(["_trackEvent","weixin","share","timeline","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","timeline",JSON.stringify(e)])}}),wx.onMenuShareQQ({title:bookTitle,desc:n,link:e,imgUrl:imgUrl,trigger:function(e){_gaq.push(["_trackEvent","weixin","share","QQ","click"])},complete:function(e){_gaq.push(["_trackEvent","weixin","share","QQ","complete"])},success:function(e){_gaq.push(["_trackSocial","Wechat","QQ",ga_opt_target,ga_opt_pagePath]),_paq.push(["trackEvent","weixin","share","QQ"])},cancel:function(e){_gaq.push(["_trackEvent","weixin","share","QQ","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","QQ",JSON.stringify(e)])}}),wx.onMenuShareWeibo({title:shareTitle,desc:descContent,link:message_link,imgUrl:imgUrl,trigger:function(e){_paq.push(["trackEvent","weixin","share","Weibo","click"])},complete:function(e){_paq.push(["trackEvent","weixin","share","Weibo","complete"])},success:function(e){_gaq.push(["_trackSocial","Wechat","Weibo",ga_opt_target,ga_opt_pagePath]),_paq.push(["trackEvent","weixin","share","Weibo"])},cancel:function(e){_gaq.push(["_trackEvent","weixin","share","Weibo","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","Weibo",JSON.stringify(e)])}})}},error:function(e){interaction_view.errorAlert("开启微信功能失败")}};return e});(function(){var e={support:function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}(),bind:function(){}};typeof require=="undefined"?(window._g||(window._g={}),window._g.touch=e):define("_g/touch",["_g/base","jquery.hammer"],function(){return window._g.touch=e,window._g.touch})})(window);(function(){var e={support:function(){},init:function(){$(document).on("keydown",function(e){console.log("keydown"+e)}),$(document).on("keyup",function(e){console.log("keyup"+e)}),$(document).on("keypress",function(e){console.log("keypress"+e)})}};typeof require=="undefined"?(window._g||(window._g={}),window._g.keyboard=e):define("_g/keyboard",["_g/base","_g/event"],function(){return window._g.keyboard=e,window._g.keyboard})})(window);(function(){var e={0:{x:{activeItem:{x:function(e,t){return-e*(1-t)*100+"%"}},currentItem:{x:function(e,t){return e*t*100+"%"}}},y:{activeItem:{y:function(e,t){return-e*(1-t)*100+"%"}},currentItem:{y:function(e,t){return e*t*100+"%"}}},perspective:!1,currentEasing:"snap",activeEasing:"snap"},1:{x:{activeItem:{x:function(e,t){return-e*(1-t)*100+"%"}},currentItem:{x:0}},y:{activeItem:{y:function(e,t){return-e*(1-t)*100+"%"}},currentItem:{y:0}},activeTop:!0,perspective:!1,currentEasing:"snap",activeEasing:"snap"},2:{x:{activeItem:{},currentItem:{opacity:function(e,t){return 1-t}}},y:{activeItem:{},currentItem:{opacity:function(e,t){return 1-t}}},currentTop:!0,perspective:!1,currentEasing:"snap",activeEasing:"snap"},3:{perspective:!0,currentEasing:"out",activeEasing:"in",currentTop:!0,percentcontrol:[.5,1],.5:{x:{activeItem:{rotateY:function(e,t){return-e*90+"deg"},opacity:.2},currentItem:{rotateY:function(e,t){return e*90*t*2+"deg"},opacity:function(e,t){return.2+.8*(1-t*2)}}},y:{activeItem:{rotateX:function(e,t){return e*90+"deg"},opacity:.2},currentItem:{rotateX:function(e,t){return-e*90*t*2+"deg"},opacity:function(e,t){return.2+.8*(1-t*2)}}}},1:{x:{activeItem:{rotateY:function(e,t){return-e*90*(1-(t-.5)*2)+"deg"},opacity:function(e,t){return.2+.8*(t-.5)*2}},currentItem:{rotateY:function(e,t){return e*90+"deg"},opacity:.2}},y:{activeItem:{rotateX:function(e,t){return e*90*(1-(t-.5)*2)+"deg"},opacity:function(e,t){return.2+.8*(t-.5)*2}},currentItem:{rotateX:function(e,t){return-e*90+"deg"},opacity:.2}}}},4:{x:{css:{currentItem:{transformOrigin:function(e,t){return e<0?"100% 50%":"0% 50%"}},activeItem:{transformOrigin:function(e,t){return e>0?"100% 50%":"0% 50%"}}},activeItem:{x:function(e,t){return-e*(1-t)*100+"%"},opacity:function(e,t){return t},rotateY:function(e,t){return-e*(1-t)*90+"deg"}},currentItem:{x:function(e,t){return e*t*100+"%"},rotateY:function(e,t){return e*t*90+"deg"},opacity:function(e,t){return 1-t}}},y:{css:{currentItem:{transformOrigin:function(e,t){return e<0?"50% 100%":"50% 0%"}},activeItem:{transformOrigin:function(e,t){return e>0?"50% 100%":"50% 0%"}}},activeItem:{y:function(e,t){return-e*(1-t)*100+"%"},opacity:function(e,t){return t},rotateX:function(e,t){return e*(1-t)*90+"deg"}},currentItem:{y:function(e,t){return e*t*100+"%"},rotateX:function(e,t){return-e*t*90+"deg"},opacity:function(e,t){return 1-t}}},currentTop:!0,perspective:!0,currentEasing:"easeOutCubic",activeEasing:"easeOutCubic"},5:{x:{css:{currentItem:{transformOrigin:function(e,t){return e>0?"100% 50%":"0% 50%"}}},activeItem:{x:function(e,t){return-e*(1-t)*100+"%"}},currentItem:{x:0,scale:function(e,t){return.5+.5*(1-t)}}},y:{css:{currentItem:{transformOrigin:function(e,t){return e>0?"50% 100%":"50% 0%"}}},activeItem:{y:function(e,t){return-e*(1-t)*100+"%"}},currentItem:{y:0,scale:function(e,t){return.5+.5*(1-t)}}},activeTop:!0,perspective:!1,currentEasing:"epubOut",activeEasing:"epubOut"}};typeof require=="undefined"?(window._g||(window._g={}),window._g.transitionargs=e):define("_g/transitionargs",["_g/base"],function(){return window._g.transitionargs=e,window._g.transitionargs})})(window);(function(){function f(e,t){var n=1200;return"x"===e?"perspective("+n+"px) rotateY("+t+"rad)":"perspective("+n+"px) rotateX("+ -t+"rad)"}var e=document.createElement("div"),t=function(t,n){return null==n&&(n=e),void 0!==n.style[t]?t:void 0},n=t("webkitTransform"),r=t("webkitTransitionProperty"),s=t("webkitTransitionDuration"),o=t("webkitTransitionTimingFunction"),u=t("webkitTransition"),a=function(e){var t,n,r,i;for(t="",n=r=0,i=e.length;i>=0?i>r:r>i;n=i>=0?++r:--r)t+=e[n]===e[n].toUpperCase()?"-"+e[n].toLowerCase():e[n];return t=t.replace(/^webkit\-/,"-webkit-"),t=t.replace(/^moz\-/,"-moz-"),t=t.replace(/^ms\-/,"-ms-")},l=function(e){this.init(e)};l.prototype={isDraged:!1,init:function(e){var t={containment:null,containmentClass:"c-transition-containment",perspectiveClass:"c-perspective",itemClass:"c-transition-item",currentClass:"c-transition-current",leftClass:"c-transition-left",rightClass:"c-transition-right",upClass:"c-transition-up",downClass:"c-transition-down",activeClass:"c-transition-active",topClass:"c-transition-top",repeat:!1,direction:0,type:1,duration:1e3,onStart:null,onEnd:function(){},onCancel:function(){},control:!0,autoplay:!1,width:null,height:null,disableControlled:!1,autoplayDirection:-1,autoplayAxis:null},n=this;this.opts=e?$.extend(!0,{},t,e):t;if(!this.opts.containment)return!1;$(this.opts.containment).addClass(this.opts.containmentClass),_.bindAll(this);if(this.opts.type==7){var r="flipboardStyle";if(!document.getElementById(r)){var i=document.createElement("style");i.setAttribute("id",r),i.innerHTML='[data-flap]{-webkit-backface-visibility:hidden;backface-visibility:hidden}[data-flap].backface-visible{-webkit-backface-visibility:visible;backface-visibility:visible}[data-flap="left"],[data-flap="right"]{z-index:1}[data-flap="front"],[data-flap="back"]{z-index:2}.flap-shadow{position:absolute;top:0;width:50%;height:100%;background:#000;z-index:99999}.flap-shadowY{position:absolute;left:0;width:100%;height:50%;background:#000;z-index:99999}.flap-shadow.left,.flap-shadow.back{left:0}.flap-shadow.right,.flap-shadow.front{right:0}.flap-shadowY.up,.flap-shadowY.bottom{top:0}.flap-shadowY.down,.flap-shadowY.top{bottom:0}.flap-shadow.flap-gradient{background:linear-gradient(to right,rgba(0,0,0,0.5) 0,rgba(0,0,0,0) 100%)}.flap-shadow.back.flap-gradient{background:linear-gradient(to left,rgba(0,0,0,0.5) 0,rgba(0,0,0,0) 100%)}.flap-shadowY.flap-gradient{background:linear-gradient(to top,rgba(0,0,0,0.5) 0,rgba(0,0,0,0) 100%);background:-webkit-linear-gradient(to top,rgba(0,0,0,0.5) 0,rgba(0,0,0,0) 100%)}.flap-shadowY.top.flap-gradient{background:linear-gradient(to bottom,rgba(0,0,0,0.5) 0,rgba(0,0,0,0) 100%);background:-webkit-linear-gradient(to bottom,rgba(0,0,0,0.5) 0,rgba(0,0,0,0) 100%)}',(document.getElementsByTagName("head")[0]||document.body).appendChild(i)}var s=$(this.opts.containment);this.container=s[0],this.$container=s;var o=this.opts.width||this.$container.width(),u=this.opts.height||this.$container.height();this.width=o%2?o+1:o,this.height=u%2?u+1:u,this.hack=this.width>o||this.height>u,s.attr("data-hack",this.hack);var a=s.offset(),f=this.opts.boundary||0;interaction_view.ismobile?(this.boundaryStart=f+a.left,this.boundaryEnd=o-f-a.left,this.boundaryStartY=f+a.top,this.boundaryEndY=u-f-a.top):(this.boundaryStart=f,this.boundaryEnd=o-f,this.boundaryStartY=f,this.boundaryEndY=u-f),this.PI=Math.PI,this.dur=this.opts.duration||"1000",this.rad=this.opts.rad||.5,this.isTransiting=!1,this.shadowOpacity=this.opts.shadowOpacity||.1;var l=this;$(window).resize(function(){l.resize()}),$(this.opts.containment).on("touchend",function(e){setTimeout(function(){l.key&&!l.isTransiting&&(console.log("transition is touchended"),l.clearNode(!0))},50)})}return this.opts.control&&(this.control(),this.opts.disableControlled&&this.disableControl()),this.opts.autostart?(this.timerDisabled=!1,this.timerstart({})):this.timerDisabled=!0,this},resize:function(){var e=this.opts.width||this.$container.width(),t=this.opts.height||this.$container.height();this.width=e%2?e+1:e,this.height=t%2?t+1:t,this.hack=this.width>e||this.height>t,this.$container.attr("data-hack",this.hack);var n=this.$container.offset(),r=this.opts.boundary||20;this.boundaryStart=r+n.left,this.boundaryEnd=e-r-n.left,this.boundaryStartY=r+n.top,this.boundaryEndY=t-r-n.top},disableControlled:!1,disableControl:function(){this.disableControlled=!0},enableControl:function(){this.disableControlled=!1},control:function(){var e=this;_g.dragcontrol.bind({el:this.opts.containment,dragstart:function(t){if(e.disableControlled)return;e.start(t)},dragleft:function(t){if(e.disableControlled)return;e.dragX(t)},dragright:function(t){if(e.disableControlled)return;e.dragX(t)},dragup:function(t){if(e.disableControlled)return;e.dragY(t)},dragdown:function(t){if(e.disableControled)return;e.dragY(t)},dragend:function(t){if(e.disableControlled)return;e.dragEnd(t)},canDragX:function(){return!e.opts.autoplayAxis||e.opts.autoplayAxis=="x"?!0:!1},canDragY:function(){return!e.opts.autoplayAxis||e.opts.autoplayAxis=="y"?!0:!1}})},stashitemClass:function(){$(this.opts.containment).find("."+this.opts.itemClass).css({transform:"","-moz-transform":"","-webkit-transform":"","-o-transform":"","-ms-transform":"",opacity:""}),this.stashClass={current:$(this.opts.containment).find("."+this.opts.currentClass).attr("style"),left:$(this.opts.containment).find("."+this.opts.leftClass).attr("style"),right:$(this.opts.containment).find("."+this.opts.rightClass).attr("style"),up:$(this.opts.containment).find("."+this.opts.upClass).attr("style"),down:$(this.opts.containment).find("."+this.opts.downClass).attr("style")},this.stashed=!0},recoveritemClass:function(){if(this.stashed)try{this.currentItem.attr("style",this.stashClass.current||""),this.activeItem.hasClass(this.opts.leftClass)?this.activeItem.attr("style",this.stashClass.left||""):this.activeItem.hasClass(this.opts.rightClass)?this.activeItem.attr("style",this.stashClass.right||""):this.activeItem.hasClass(this.opts.upClass)?this.activeItem.attr("style",this.stashClass.up||""):this.activeItem.hasClass(this.opts.downClass)&&this.activeItem.attr("style",this.stashClass.down||"")}catch(e){console.log(e)}$(this.opts.containment).find("."+this.opts.itemClass).css({transform:"","-moz-transform":"","-webkit-transform":"","-o-transform":"","-ms-transform":"",opacity:""}),this.stashed=!1},start:function(e,t){if(this.isTransiting)return;this.key=new Date*1,t==undefined&&(t=this.opts.type),this.args=_g.transitionargs[t]||{},this.args.perspective?$(this.opts.containment).addClass(this.opts.perspectiveClass):$(this.opts.containment).removeClass(this.opts.perspectiveClass),this.currentItem=$(this.opts.containment).find(">."+this.opts.currentClass),this.currentItem.addClass(this.opts.topClass),this.stashitemClass()},startInit:function(e,t,n){this.dur=this.opts.duration,this.lastsubpi=0,this.startObj={x:0,y:0},this.end={x:0,y:0};var r=this.getPos(e,n);this.startObj.x=this.end.x=r.x,this.startObj.y=this.end.y=r.y,this.touchStartDirection=!1,this.realslide=!1},clearNode:function(e){var t=this;$(t.fromNodeCloneNode).remove(),$(t.toNodeCloneNode).remove(),$(t.fromNodeFlapShadow).remove(),$(t.toNodeFlapShadow).remove(),$(t.fromNodeCloneNodeFlapShadow).remove(),$(t.toNodeCloneNodeFlapShadow).remove(),e&&(t.currentItem&&t.currentItem.length&&(t.currentItem[0].style.removeProperty("visibility"),t.currentItem[0].style.removeProperty("clip"),t.currentItem[0].style.removeProperty("opacity")),t.activeItem&&t.activeItem.length&&(t.activeItem[0].style.removeProperty("visibility"),t.activeItem[0].style.removeProperty("clip"),t.activeItem[0].style.removeProperty("opacity")),t.isTransiting=!1,t.key=null)},initNode:function(e){this.fromNode=this.currentItem[0],this.toNode=this.activeItem[0],this.fromNodeCloneNode=this.fromNode.cloneNode(!0),this.toNodeCloneNode=this.toNode.cloneNode(!0),this.r=this.boundaryEnd-this.startObj.x,this.l=this.startObj.x-this.boundaryStart,this.u=this.startObj.y-this.boundaryStartY,this.d=this.boundaryEndY-this.startObj.y,$(this.toNode).css({visibility:"visible"}),$(this.fromNode).css({visibility:"visible"}),$(this.fromNodeCloneNode).css({visibility:"visible"}),$(this.toNodeCloneNode).css({visibility:"visible"})},dragX:function(e,t,n){if(this.isTransiting)return;if(!this.key)return;e.gesture.deltaX<=0?(this.plus=-1,this.activeItem=$(this.opts.containment).find(">."+this.opts.rightClass)):(this.plus=1,this.activeItem=$(this.opts.containment).find(">."+this.opts.leftClass));if(!this.activeItem.length)return;var r=e.gesture.deltaX;this.direction="x",t==undefined&&(t=this.opts.type);if(t!=7)this.dragHandle(r,t);else{if(this.isOverstepBoundary("x",e,n))return;this.touchStartDirection!=e.type&&(console.log("------------------------------",this.isOverstepBoundary("x",e)),this.startInit(e,t,n),this.startObj.x<this.width/2?this.flipSide="l2r":this.flipSide="r2l",this.touchStartDirection=e.type,this.clearNode(),this.initNode(e),e.type=="dragleft"?this.leftFlap():this.rightFlap());var i=this.getPos(e,n);this.end.x=i.x,this.end.y=i.y,this.dragHandle(this.end.x-this.startObj.x,t)}},dragY:function(e,t,n){if(this.isTransiting)return;if(!this.key)return;e.gesture.deltaY<=0?(this.plus=-1,this.activeItem=$(this.opts.containment).find("."+this.opts.downClass)):(this.plus=1,this.activeItem=$(this.opts.containment).find("."+this.opts.upClass));if(!this.activeItem.length)return;var r=e.gesture.deltaY;this.direction="y",t==undefined&&(t=this.opts.type);if(t!=7)this.dragHandle(r,t);else{if(this.isOverstepBoundary("y",e,n))return;this.touchStartDirection!=e.type&&(this.startInit(e,t,n),this.direction="y",this.touchStartDirection=e.type,this.startObj.y<this.height/2?this.flipSide="u2d":this.flipSide="d2u",this.clearNode(),this.initNode(e),this.r=this.d,this.l=this.u,e.type=="dragup"?this.upFlap():this.downFlap());var i=this.getPos(e,n);this.end.x=i.x,this.end.y=i.y,this.dragHandle(this.end.y-this.startObj.y,t)}},getIsPassMiddlePosition:function(){var e=this.end.x,t=this.end.y,n=this.startObj.x,r=this.startObj.y,i=this.l,s=this.r,o=this.rad,u,a=0,f;return this.flipSide=="l2r"?this.touchStartDirection=="dragleft"?e<n-i*o?(u=this.endRotate,a=1,f=(i-(n-e))/i):(u=0,a=0,f=(n-e)/i):this.touchStartDirection=="dragright"&&(e>n+s*o?(u=this.endRotate,a=1,f=(s-(e-n))/s):(u=0,a=0,f=(e-n)/s)):this.flipSide=="r2l"?this.touchStartDirection=="dragleft"?e<n-i*o?(u=this.endRotate,a=1,f=(i-(n-e))/i):(u=0,a=0,f=(n-e)/i):this.touchStartDirection=="dragright"&&(e>n+s*o?(u=this.endRotate,a=1,f=(s-(e-n))/s):(u=0,a=0,f=(e-n)/s)):this.flipSide=="u2d"?this.touchStartDirection=="dragup"?t<r-i*o?(u=this.endRotate,a=1,f=(i-(r-t))/i):(u=0,a=0,f=(r-t)/i):this.touchStartDirection=="dragdown"&&(t>r+s*o?(u=this.endRotate,a=1,f=(s-(t-r))/s):(u=0,a=0,f=(t-r)/s)):this.flipSide=="d2u"&&(this.touchStartDirection=="dragup"?t<r-i*o?(u=this.endRotate,a=1,f=(i-(r-t))/i):(u=0,a=0,f=(r-t)/i):this.touchStartDirection=="dragdown"&&(t>r+s*o?(u=this.endRotate,a=1,f=(s-(t-r))/s):(u=0,a=0,f=(t-r)/s))),{subpi:u,isPassMiddlePosition:a,dur:f}},dragHandle:function(e,t){isDraged=!0,this.opts.onStopPlay&&this.opts.onStopPlay(),$(this.opts.containment).find("."+this.opts.itemClass).removeClass(this.opts.activeClass),this.activeItem.addClass(this.opts.activeClass),this.currentItem=$(this.opts.containment).find("."+this.opts.currentClass),t==undefined&&(t=this.opts.type);if(t!=7){var r=Math.abs(e)/$(this.opts.containment).width();if(!_g.browserSupport({msie:9}))this.currentItem.css(this.direction=="x"?"margin-left":"margin-top",this.plus*r*100+"%"),this.activeItem.css(this.direction=="x"?"margin-left":"margin-top",-this.plus*(1-r)*100+"%");else if(this.args.percentcontrol){for(i=0;i<this.args.percentcontrol.length;i++)if(r<=this.args.percentcontrol[i]){if(this.args[this.args.percentcontrol[i]][this.direction].css){var s=this.args[this.args.percentcontrol[i]][this.direction].css;s.currentItem&&this.currentItem.css(this.getArgs(s.currentItem,this.plus,r)),s.activeItem&&this.activeItem.css(this.getArgs(s.activeItem,this.plus,r))}this.activeItem.css(this.getArgs(this.args[this.args.percentcontrol[i]][this.direction].activeItem,this.plus,r)),this.currentItem.css(this.getArgs(this.args[this.args.percentcontrol[i]][this.direction].currentItem,this.plus,r));break}}else{if(this.args[this.direction].css){var s=this.args[this.direction].css;s.currentItem&&this.currentItem.css(this.getArgs(s.currentItem,this.plus,r)),s.activeItem&&this.activeItem.css(this.getArgs(s.activeItem,this.plus,r))}this.activeItem.css(this.getArgs(this.args[this.direction].activeItem,this.plus,r)),this.currentItem.css(this.getArgs(this.args[this.direction].currentItem,this.plus,r))}this.args.currentTop?this.currentItem.addClass(this.opts.topClass):this.currentItem.removeClass(this.opts.topClass),this.args.activeTop&&this.activeItem.addClass(this.opts.topClass),this.opts.onTransition&&this.opts.onTransition(event,r)}else{var e=Math.round(Math.abs(e)),o=e,u=this.startObj.x,a=this.end.x,l=this.startObj.y,c=this.end.y;if(this.direction=="x"){a<this.boundaryStart&&(a=this.boundaryStart,o=u-this.boundaryStart),a>this.boundaryEnd&&(a=this.boundaryEnd,o=this.boundaryEnd-u);var h=1*(this.width/2)}else{c<this.boundaryStartY&&(c=this.boundaryStartY,o=l-this.boundaryStartY),c>this.boundaryEndY&&(c=this.boundaryEndY,o=this.boundaryEndY-l);var h=1*(this.height/2)}var p="",d="";this.flipSide=="l2r"?this.touchStartDirection=="dragleft"?(a>=u&&(a=u,o=0),d=-this.PI*(o/this.l)):this.touchStartDirection=="dragright"&&(a<=u&&(a=u,o=0),d=this.PI*(o/this.r)):this.flipSide=="r2l"?this.touchStartDirection=="dragleft"?(a>=u&&(a=u,o=0),d=-this.PI*(o/this.l)):this.touchStartDirection=="dragright"&&(a<=u&&(a=u,o=0),d=this.PI*(o/this.r)):this.flipSide=="u2d"?this.touchStartDirection=="dragup"?(c>=l&&(c=l,o=0),d=-this.PI*(o/this.l)):this.touchStartDirection=="dragdown"&&(c<=l&&(c=l,o=0),d=this.PI*(o/this.r)):this.flipSide=="d2u"&&(this.touchStartDirection=="dragup"?(c>=l&&(c=l,o=0),d=-this.PI*(o/this.l)):this.touchStartDirection=="dragdown"&&(c<=l&&(c=l,o=0),d=this.PI*(o/this.r)));if(this.lastsubpi==d)return;this.lastsubpi=d,console.log("[this.lastsubpi:",this.lastsubpi,"]"),this.fromNodeCloneNode.style[n]=f(this.direction,d),this.toNodeCloneNode.style[n]=f(this.direction,this.PI+d),this.toNodeFlapShadow.style.opacity=Math.abs(d)>this.PI/2?0:.7-2*Math.abs(d)/this.PI*.7,this.fromNodeFlapShadow.style.opacity=Math.abs(d)>this.PI/2?.7-2*(this.PI-Math.abs(d))/this.PI*.7:0,this.fromNodeCloneNodeFlapShadow.style.opacity=Math.abs(d)>this.PI/2?this.shadowOpacity:2*Math.abs(d)/this.PI*this.shadowOpacity,this.toNodeCloneNodeFlapShadow.style.opacity=Math.abs(d)>this.PI/2?2*(this.PI-Math.abs(d))/this.PI*this.shadowOpacity:this.shadowOpacity,this.args.currentTop?this.currentItem.addClass(this.opts.topClass):this.currentItem.removeClass(this.opts.topClass),this.args.activeTop&&this.activeItem.addClass(this.opts.topClass),this.opts.onTransition&&this.opts.onTransition(event,r)}},dragEnd:function(e,t,r){if(this.isTransiting)return;t==undefined&&(t=this.opts.type);if(t!=7){if(!this.currentItem.length||!this.activeItem.length)return;var o=this;this.isTransiting=!0;var a=this.direction=="x"?e.gesture.deltaX:e.gesture.deltaY,l=Math.abs(a)/$(this.opts.containment).width();if(!_g.browserSupport({msie:9}))this.activeItem.css(this.direction=="x"?"margin-left":"margin-top","0%"),this.currentItem.css(this.direction=="x"?"margin-left":"margin-top",-this.plus*100+"%");else if(this.args.percentcontrol){this.percent=l;for(i=0;i<this.args.percentcontrol.length;i++)if(l<=this.args.percentcontrol[i]){this.transitPercent(i);break}}else{var c=1100,h=this.getArgs(this.args[this.direction].currentItem,this.plus,1);h.duration=c,h.easing=this.args.currentEasing;var p=this.getArgs(this.args[this.direction].activeItem,this.plus,1);p.duration=c,p.easing=this.args.activeEasing,p.complete=function(){o.isTransiting=!1,_g.device.android()?setTimeout(function(){o.onTransitionEnd()},100):o.onTransitionEnd()},this.currentItem.transit(h),this.activeItem.transit(p)}}else{var d=this,v=1;d.isTransiting=!0;var m=d.getIsPassMiddlePosition(),g=m.isPassMiddlePosition;d.dur=d.dur*m.dur;if(!this.currentItem.length||!this.activeItem.length||!d.fromNodeCloneNode||!this.key||!this.touchStartDirection){g=0,v==3,b();return}var y=m.subpi;if(!r){if(d.l<=0||d.r<=0||d.lastsubpi==y){$(d.fromNodeCloneNode).remove(),d.fromNode.style.clip="rect(0px "+d.width+"px "+d.height+"px 0px)",g&&$(d.fromNode).css({visibility:"hidden"}),g||$(d.toNode).css({visibility:"hidden"}),$(d.toNodeCloneNode).remove(),d.toNode.style.clip="rect(0px "+d.width+"px "+d.height+"px 0px)",$(d.fromNodeFlapShadow).remove(),$(d.toNodeFlapShadow).remove(),v=3,b();return}}else{d.dur=500;var y=d.direction=="x"?e.gesture.deltaX<0?-3.141592653589793:3.141592653589793:e.gesture.deltaY<0?-3.141592653589793:3.141592653589793}$(d.fromNodeCloneNode).on("webkitTransitionEnd",function(){$(d.fromNodeCloneNode).off("webkitTransitionEnd"),$(d.fromNodeCloneNode).remove(),d.fromNode.style.clip="rect(0px "+(d.width+1)+"px "+d.height+"px 0px)",g&&$(d.fromNode).css({visibility:"hidden"}),$(d.fromNodeFlapShadow).remove(),v++,b(),setTimeout(function(){v<3&&(v++,b())},d.dur/2)}),$(d.toNodeCloneNode).on("webkitTransitionEnd",function(){$(d.toNodeCloneNode).off("webkitTransitionEnd"),g||$(d.toNode).css({visibility:"hidden"}),$(d.toNodeCloneNode).remove(),$(d.toNodeFlapShadow).remove(),d.toNode.style.clip="rect(0px "+d.width+"px "+d.height+"px 0px)",v++,b()}),g||r?(d.toNodeFlapShadow.style[u]="opacity "+d.dur/2+"ms ease-in",d.fromNodeFlapShadow.style[u]="opacity "+d.dur/2+"ms ease-in",d.fromNodeFlapShadow.style.opacity=.7,d.toNodeFlapShadow.style.opacity=0,d.fromNodeCloneNodeFlapShadow.style.opacity=0,d.toNodeCloneNodeFlapShadow.style.opacity=0,d.fromNodeCloneNode.style[n]=f(d.direction,y),d.fromNodeCloneNode.style[s]=d.dur+"ms",d.toNodeCloneNode.style[n]=f(d.direction,d.PI+y),d.toNodeCloneNode.style[s]=d.dur*1.5+"ms"):(d.toNodeFlapShadow.style[u]="opacity "+d.dur/2+"ms ease-in",d.fromNodeFlapShadow.style[u]="opacity "+d.dur/2+"ms ease-in",d.toNodeFlapShadow.style.opacity=.7,d.fromNodeFlapShadow.style.opacity=0,d.fromNodeCloneNodeFlapShadow.style.opacity=0,d.toNodeCloneNodeFlapShadow.style.opacity=0,d.fromNodeCloneNode.style[n]=f(d.direction,y),d.fromNodeCloneNode.style[s]=d.dur*1.5+"ms",d.toNodeCloneNode.style[n]=f(d.direction,d.PI+y),d.toNodeCloneNode.style[s]=d.dur+"ms"),console.log("[isPassMiddlePosition:",g,"]"),console.log("[touchStartDirection:",this.touchStartDirection,"]"),console.log("[that.fromNodeCloneNode:",d.fromNodeCloneNode,"]"),console.log("[that.toNodeCloneNode:",d.toNodeCloneNode,"]"),console.log("[that.direction:",d.direction,"]"),console.log("[subpi:",y,"]"),console.log("[lastsubpi:",d.lastsubpi,"]"),console.log("[that.dur:",d.dur,"]");function b(){v==3&&(d.lastsubpi=y,d.realslide=!1,$(d.toNodeCloneNode).remove(),$(d.toNodeFlapShadow).remove(),$(d.fromNodeCloneNode).remove(),$(d.fromNodeFlapShadow).remove(),d.touchStartDirection=!1,d.isTransiting=!1,d.key=null,d.currentItem[0].style.removeProperty("visibility"),d.currentItem[0].style.removeProperty("clip"),d.currentItem[0].style.removeProperty("opacity"),d.activeItem[0].style.removeProperty("visibility"),d.activeItem[0].style.removeProperty("clip"),d.activeItem[0].style.removeProperty("opacity"),g?d.opts.onEnd&&d.opts.onEnd(g):d.opts.onCancel&&d.opts.onCancel(g))}}},onTransitionEnd:function(){var e=this;this.recoveritemClass(),this.currentItem.removeClass(this.opts.currentClass),this.activeItem.addClass(this.opts.currentClass).removeClass(this.opts.activeClass).removeClass(this.opts.upClass).removeClass(this.opts.rightClass).removeClass(this.opts.leftClass).removeClass(this.opts.downClass),$(this.opts.containment).find("."+this.opts.itemClass).removeClass(this.opts.topClass);var t=this.currentItem.index(),n=this.activeItem.index();$(this.opts.containment).removeClass(this.opts.perspectiveClass),e.opts.onEnd&&e.opts.onEnd(t,n),this.timerStart()},transitPercent:function(e){var t=this;if(e<this.args.percentcontrol.length){var t=this,n=this.opts.duration*(this.args.percentcontrol[e]-this.percent),r=this.getArgs(this.args[this.args.percentcontrol[e]][this.direction].currentItem,this.plus,this.args.percentcontrol[e]);r.duration=n,r.easing=this.args.currentEasing;var i=this.getArgs(this.args[this.args.percentcontrol[e]][this.direction].activeItem,this.plus,this.args.percentcontrol[e]);i.duration=n,i.easing=this.args.activeEasing,i.complete=function(){t.transitPercent(e+1)},this.percent=this.args.percentcontrol[e],this.currentItem.transit(r),this.activeItem.transit(i)}else t.isTransiting=!1,this.onTransitionEnd()},getArgs:function(e,t,n){var r={};for(var i in e)typeof e[i]=="function"?r[i]=e[i](t,n):r[i]=e[i];return r},autostart:function(e,t,n){if(this.isTransiting)return;this.args=_g.transitionargs[e]||{},this.currentItem=$(this.opts.containment).find("."+this.opts.currentClass),this.stashitemClass(),this.key=new Date*1,t=="x"&&(n<0?this.activeItem=$(this.opts.containment).find("."+this.opts.rightClass):this.activeItem=$(this.opts.containment).find("."+this.opts.leftClass)),t=="y"&&(n<0?this.activeItem=$(this.opts.containment).find("."+this.opts.downClass):this.activeItem=$(this.opts.containment).find("."+this.opts.upClass));if(!this.activeItem.length)return;if(e!=7){this.args.currentTop&&this.currentItem.addClass(this.opts.topClass),this.plus=n,this.direction=t,this.args.perspective?$(this.opts.containment).addClass(this.opts.perspectiveClass):$(this.opts.containment).removeClass(this.opts.perspectiveClass);var r={gesture:{}};t=="x"?r.gesture.deltaX=0:r.gesture.deltaY=0,this.dragHandle(0,e),this.dragEnd(r,e)}else{if(t=="x"){if(n<0)var r={gesture:{deltaX:-0.01},type:"dragleft"};else var r={gesture:{deltaX:.01},type:"dragright"};this.dragX(r,e,!0)}if(t=="y"){if(n<0)var r={gesture:{deltaY:-0.01},type:"dragup"};else var r={gesture:{deltaY:.01},type:"dragbottom"};this.dragY(r,e,!0)}this.dragEnd(r,e,!0)}},enableTimer:function(){this.timerDisabled=!1},disableTimer:function(){this.timerDisabled=!0},setCurrent:function(e,t){var n,r=this;$(this.opts.containment).children("."+this.opts.itemClass).removeClass(this.opts.topClass).removeClass(this.opts.activeClass).removeClass(this.opts.upClass).removeClass(this.opts.rightClass).removeClass(this.opts.leftClass).removeClass(this.opts.downClass);var i=$(this.opts.containment).children().length;if(e>=i){if(!this.opts.repeat){this.timerStop();return}this.current=0,e=0}else if(e<0){if(!this.opts.repeat){this.timerStop();return}this.current=i-1,e=i-1}$(this.opts.containment).children().each(function(){$(this).index()==e?(n=$(this),$(this).addClass(r.opts.currentClass)):$(this).removeClass(r.opts.currentClass)});if(t&&n){if(t=="x")var s=this.opts.leftClass,o=this.opts.rightClass;else var s=this.opts.upClass,o=this.opts.downClass;n.prev().length?n.prev().addClass(s):this.opts.repeat&&$(this.opts.containment).children().last().addClass(s),n.next().length?n.next().addClass(o):this.opts.repeat&&$(this.opts.containment).children().first().addClass(o)}},timerStart:function(e){if(this.timerDisabled)return;var t=this;if(e)e.type||(e.type=t.opts.type),e.axis||(e.axis="x"),e.diretion||(e.direction=-1),e.startAt||(e.startAt=0),this.setCurrent(e.startAt,e.axis),this.current=e.startAt,this.TimerArgs=e;else{if(!this.TimerArgs)return;e=this.TimerArgs,this.TimerDirection=this.TimerDirection||t.opts.autoplayDirection,this.current=this.tempCurrent!=null?this.tempCurrent:this.TimerDirection==-1?this.current+1:this.current-1,this.tempCurrent=null,this.TimerDirection=null,this.setCurrent(this.current,e.axis)}this.Timer&&window.clearTimeout(this.Timer),this.Timer=window.setTimeout(function(){t.autostart(e.type,e.axis,e.direction)},this.opts.interval)},timerStop:function(e){this.Timer&&(window.clearTimeout(this.Timer),this.Timer=null),this.TimerArgs=null,this.disableTimer()},isOverstepBoundary:function(e,t,n){if(n)return!1;var r=this.getPos(t,n),i=r.x,s=r.y;console.log(i,"[",this.boundaryStart,this.boundaryEnd,"]"),console.log("this.key[",this.key,"]"),console.log("direction[",e,"]");if(e=="x"){if(i<=this.boundaryStart||i>=this.boundaryEnd)return!0}else if(e=="y")if(s<=this.boundaryStartY||s>=this.boundaryEndY)return!0;return!1},getPos:function(e,t){var n=e.gesture.touches?e.gesture.touches[0]:{};return interaction_view.ismobile?t?{x:interaction_view.size.x,y:interaction_view.size.y}:{x:n.pageX,y:n.pageY}:t?{x:this.$container.offset().left+interaction_view.size.x,y:this.$container.offset().top+interaction_view.size.y}:{x:n.pageX-this.$container.offset().left,y:n.pageY-this.$container.offset().top}},addCloneAttr:function(){$(this.fromNodeFlapShadow).attr("data-clone","fromNodeFlapShadow"),$(this.toNodeFlapShadow).attr("data-clone","toNodeFlapShadow"),$(this.fromNodeCloneNodeFlapShadow).attr("data-clone","fromNodeCloneNodeFlapShadow"),$(this.toNodeCloneNodeFlapShadow).attr("data-clone","toNodeCloneNodeFlapShadow"),$(this.fromNodeCloneNode).attr("data-clone","fromNodeCloneNode"),$(this.toNodeCloneNode).attr("data-clone","toNodeCloneNode")},leftFlap:function(){this.endRotate=-this.PI,this.middlePosition=this.startObj.x-this.l/2,this.fromNodeFlapShadow=$('<div class="flap-shadow flat left" style="opacity: 0;"></div>')[0],this.toNodeFlapShadow=$('<div class="flap-shadow flat right" style="opacity: 0.7;"></div>')[0],this.fromNodeCloneNodeFlapShadow=$('<div class="flap-shadow flap-gradient front" style="opacity: 0;width:'+this.width/2+"px;height:"+this.height+'px;"></div>')[0],this.toNodeCloneNodeFlapShadow=$('<div class="flap-shadow flap-gradient back" style="opacity: '+this.shadowOpacity+";width:"+this.width/2+"px;height:"+this.height+'px;"></div>')[0],this.container.appendChild(this.fromNodeCloneNode),this.container.appendChild(this.toNodeCloneNode),this.fromNode.appendChild(this.fromNodeFlapShadow),this.toNode.appendChild(this.toNodeFlapShadow),this.fromNodeCloneNode.appendChild(this.fromNodeCloneNodeFlapShadow),this.toNodeCloneNode.appendChild(this.toNodeCloneNodeFlapShadow),this.addCloneAttr(),this.hack?(this.fromNode.style.clip="rect(0px "+(this.width/2+1)+"px "+this.height+"px 0px)",this.toNode.style.clip="rect(0px "+this.width+"px "+this.height+"px "+(this.width/2-1)+"px)",this.fromNodeCloneNode.style.clip="rect(0px "+this.width+"px "+this.height+"px "+(this.width/2-1)+"px)",this.fromNodeCloneNode.style.webkitTransform="perspective(1200px) rotateY(0rad)",this.toNodeCloneNode.style.clip="rect(0px "+(this.width/2+1)+"px "+this.height+"px 0px)",this.toNodeCloneNode.style.webkitTransform="perspective(1200px) rotateY("+this.PI+"rad)"):(this.fromNode.style.clip="rect(0px "+this.width/2+"px "+this.height+"px 0px)",this.toNode.style.clip="rect(0px "+this.width+"px "+this.height+"px "+this.width/2+"px)",this.fromNodeCloneNode.style.clip="rect(0px "+this.width+"px "+this.height+"px "+this.width/2+"px)",this.fromNodeCloneNode.style.webkitTransform="perspective(1200px) rotateY(0rad)",this.toNodeCloneNode.style.clip="rect(0px "+this.width/2+"px "+this.height+"px 0px)",this.toNodeCloneNode.style.webkitTransform="perspective(1200px) rotateY("+this.PI+"rad)")},rightFlap:function(){this.endRotate=this.PI,this.middlePosition=this.startObj.x+this.r/2,this.hack?(this.toNode.style.clip="rect(0px "+(this.width/2+1)+"px "+this.height+"px 0px)",this.fromNode.style.clip="rect(0px "+this.width+"px "+this.height+"px "+this.width/2+"px)",this.toNodeCloneNode.style.clip="rect(0px "+this.width+"px "+this.height+"px "+(this.width/2-1)+"px)",this.toNodeCloneNode.style.webkitTransform="perspective(1200px) rotateY(3.141592653589793rad)",this.fromNodeCloneNode.style.clip="rect(0px "+(this.width/2+1)+"px "+this.height+"px 0px)"):(this.toNode.style.clip="rect(0px "+this.width/2+"px "+this.height+"px 0px)",this.fromNode.style.clip="rect(0px "+this.width+"px "+this.height+"px "+this.width/2+"px)",this.toNodeCloneNode.style.clip="rect(0px "+this.width+"px "+this.height+"px "+this.width/2+"px)",this.toNodeCloneNode.style.webkitTransform="perspective(1200px) rotateY(3.141592653589793rad)",this.fromNodeCloneNode.style.clip="rect(0px "+this.width/2+"px "+this.height+"px 0px)"),this.fromNodeCloneNode.style.webkitTransform="perspective(1200px) rotateY(0rad)",this.container.appendChild(this.toNodeCloneNode),this.container.appendChild(this.fromNodeCloneNode),this.fromNodeFlapShadow=$('<div class="flap-shadow flat right" style="opacity: 0;">A</div>')[0],this.toNodeFlapShadow=$('<div class="flap-shadow flat left" style="opacity: 0.7;">B</div>')[0],this.fromNodeCloneNodeFlapShadow=$('<div class="flap-shadow flap-gradient back" style="opacity: 0;width:'+this.width/2+"px;height:"+this.height+'px;">C</div>')[0],this.toNodeCloneNodeFlapShadow=$('<div class="flap-shadow flap-gradient front" style="opacity: '+this.shadowOpacity+";width:"+this.width/2+"px;height:"+this.height+'px;">D</div>')[0],this.fromNode.appendChild(this.fromNodeFlapShadow),this.toNode.appendChild(this.toNodeFlapShadow),this.fromNodeCloneNode.appendChild(this.fromNodeCloneNodeFlapShadow),this.toNodeCloneNode.appendChild(this.toNodeCloneNodeFlapShadow),this.addCloneAttr()},upFlap:function(){this.endRotate=-this.PI,this.middlePosition=this.startObj.y-this.l/2,this.fromNodeFlapShadow=$('<div class="flap-shadowY flat up" style="opacity: 0;"></div>')[0],this.toNodeFlapShadow=$('<div class="flap-shadowY flat down" style="opacity: 0.7;"></div>')[0],this.fromNodeCloneNodeFlapShadow=$('<div class="flap-shadowY flap-gradient top" style="opacity: 0;width:'+this.width+"px;height:"+this.height/2+'px;"></div>')[0],this.toNodeCloneNodeFlapShadow=$('<div class="flap-shadowY flap-gradient bottom" style="opacity: '+this.shadowOpacity+";width:"+this.width+"px;height:"+this.height/2+'px;"></div>')[0],this.fromNodeCloneNode=this.fromNode.cloneNode(!0),this.toNodeCloneNode=this.toNode.cloneNode(!0),this.container.appendChild(this.fromNodeCloneNode),this.container.appendChild(this.toNodeCloneNode),this.fromNode.appendChild(this.fromNodeFlapShadow),this.toNode.appendChild(this.toNodeFlapShadow),this.fromNodeCloneNode.appendChild(this.fromNodeCloneNodeFlapShadow),this.toNodeCloneNode.appendChild(this.toNodeCloneNodeFlapShadow),this.hack?(this.fromNode.style.clip="rect(0px "+this.width+"px "+(this.height/2+1)+"px 0px)",this.toNode.style.clip="rect("+(this.height/2-1)+"px "+this.width+"px "+this.height+"px "+"0px)",this.fromNodeCloneNode.style.clip="rect("+(this.height/2-1)+"px "+this.width+"px "+this.height+"px "+"0px)",this.fromNodeCloneNode.style.webkitTransform="perspective(1200px) rotateX(0rad)",this.toNodeCloneNode.style.clip="rect(0px "+this.width+"px "+(this.height/2+1)+"px 0px)",this.toNodeCloneNode.style.webkitTransform="perspective(1200px) rotateX("+this.PI+"rad)"):(this.fromNode.style.clip="rect(0px "+this.width+"px "+this.height/2+"px 0px)",this.toNode.style.clip="rect("+this.height/2+"px "+this.width+"px "+this.height+"px "+"0px)",this.fromNodeCloneNode.style.clip="rect("+this.height/2+"px "+this.width+"px "+this.height+"px "+"0px)",this.fromNodeCloneNode.style.webkitTransform="perspective(1200px) rotateX(0rad)",this.toNodeCloneNode.style.clip="rect(0px "+this.width+"px "+this.height/2+"px 0px)",this.toNodeCloneNode.style.webkitTransform="perspective(1200px) rotateX("+this.PI+"rad)"),this.addCloneAttr()},downFlap:function(){this.endRotate=this.PI,this.middlePosition=this.startObj.y+this.r/2,this.hack?(this.toNode.style.clip="rect(0px "+this.width+"px "+(this.height/2+1)+"px 0px)",this.fromNode.style.clip="rect("+this.height/2+"px "+this.width+"px "+this.height+"px "+"0px)",this.toNodeCloneNode.style.clip="rect("+(this.height/2-1)+"px "+this.width+"px "+this.height+"px "+"0px)",this.toNodeCloneNode.style.webkitTransform="perspective(1200px) rotateX(3.141592653589793rad)",this.fromNodeCloneNode.style.clip="rect(0px "+this.width+"px "+(this.height/2+1)+"px 0px)"):(this.toNode.style.clip="rect(0px "+this.width+"px "+this.height/2+"px 0px)",this.fromNode.style.clip="rect("+this.height/2+"px "+this.width+"px "+this.height+"px "+"0px)",this.toNodeCloneNode.style.clip="rect("+this.height/2+"px "+this.width+"px "+this.height+"px "+"0px)",this.toNodeCloneNode.style.webkitTransform="perspective(1200px) rotateX(3.141592653589793rad)",this.fromNodeCloneNode.style.clip="rect(0px "+this.width+"px "+this.height/2+"px 0px)"),this.fromNodeCloneNode.style.webkitTransform="perspective(1200px) rotateX(0rad)",this.container.appendChild(this.toNodeCloneNode),this.container.appendChild(this.fromNodeCloneNode),this.fromNodeFlapShadow=$('<div class="flap-shadowY flat down" style="opacity: 0;"></div>')[0],this.toNodeFlapShadow=$('<div class="flap-shadowY flat up" style="opacity: 0.7;"></div>')[0],this.fromNodeCloneNodeFlapShadow=$('<div class="flap-shadowY flap-gradient bottom" style="opacity: 0;width:'+this.width+"px;height:"+this.height/2+'px;"></div>')[0],this.toNodeCloneNodeFlapShadow=$('<div class="flap-shadowY flap-gradient top" style="opacity: '+this.shadowOpacity+";width:"+this.width+"px;height:"+this.height/2+'px;"></div>')[0],this.fromNode.appendChild(this.fromNodeFlapShadow),this.toNode.appendChild(this.toNodeFlapShadow),this.fromNodeCloneNode.appendChild(this.fromNodeCloneNodeFlapShadow),this.toNodeCloneNode.appendChild(this.toNodeCloneNodeFlapShadow),this.addCloneAttr()}},typeof require=="undefined"?(window._g||(window._g={}),window._g.transition=l):define("_g/transition2",["_g/base","jquery.transit","_g/transitionargs"],function(){return window._g.transition=l,window._g.transition})})(window);(function(){var e=function(e){this.init(e)};e.prototype={init:function(e){var t={body:"window",containment:".touchslide",slidesclass:".slides",groupclass:".group",itemclass:".Presentation",width:1024,height:768,overview:!0,controls:!0,progress:!0,slideNumber:!1,history:!1,disableHistoryStart:!1,keyboard:!0,overview:!0,center:!0,touch:!0,loop:!1,rtl:!1,fragments:!0,embedded:!1,autoSlide:0,autoSlideStoppable:!0,mouseWheel:!1,hideAddressBar:!0,previewLinks:!1,transition:0,transitionSpeed:"default",onReady:null,onSlideChange:null,canDragX:null,canDragY:null,adapt:!1,screen_mode:1,show_excontent:!1};this.options=e?$.extend(!0,{},t,e):t,_g.browserSupport({msie:9})||(this.options.canDragX=this.options.canDragY=function(e){return!1}),_.bindAll(this),this._initVaribles(),this._initControls(),this._initScreenSet(),this._initSlideItems(),this.transition=new _g.transition({type:this.options.transition,containment:this.slideContent,control:!1,onEnd:this._complete,onStopPlay:this._onStopPlay,onCancel:this._cancel,duration:700,shadowOpacity:.3,rad:.1}),this._initSlideStyle();if(this.options.onReady){var n=this.slideType==3?this.indexes[0][0]:this.indexes[0];this.options.onReady(this,n)}return this.options.controls&&(this._bindControllers(),this.setControllers()),this.options.progress&&this.setProgressBar(),this.options.keyboard&&this._bindKeyboard(),this.options.mouseWheel&&this._bindMouseWheel(),this.options.history&&this._bindRoute(),this},_bindRoute:function(){var e=this,t=Backbone.Router.extend({routes:{"page/:query":"page"}});this.Router=new t,this.Router.on("route:page",function(t,n){var r=e.getSlidePositionById(t);r&&e.slide(r.h,r.v)});var n=!1;e.options.disableHistoryStart&&(n=!0);if(!_g.device.mobile()||!e.options.disableHistoryStart)Backbone.history.start({silent:n}),this.Router.navigate("page/"+this.getCurrentSlideId())},_initVaribles:function(){this.indexv=0,this.indexh=0,this.currentSlideDirection=null,this.dragstart=!1,this.dragging=!1,this.sliding=!1},_initControls:function(){var e=this,t=0,n=0,r=0,i=0;this.hammertime=$(this.options.containment).hammer().on("dragstart",function(t){if(interaction_view.stopDragging)return;if(e.sliding)return t.gesture.preventDefault(),!1;if(e.options.canDrag&&!e.options.canDrag(t))return;e.dragstart=!0,e._doStartEvent(t)}),$(this.options.containment).hammer().on("drag",function(){if(e.sliding)return event.gesture.preventDefault(),!1}),$(this.options.containment).hammer().on("dragleft",function(t){console.log("------dragleft");if(e.sliding)return t.gesture.preventDefault(),!1;if(interaction_view.stopDragging)return;e.currentSlideDirection==null&&(e.currentSlideDirection=1);if(e.dragLock||interaction_view.events.onPageSwipeEvent(38,interaction_view.currentPage))return e.dragLock=!0,t.gesture.preventDefault(),!1;if(e.options.canDragX&&!e.options.canDragX(t))return;if(!e._testSlideDragEventAccess(t)){t.gesture.preventDefault();return}return e.dragstart=!0,$.zoom&&$.zoom!=1&&(t.gesture.deltaX=t.gesture.deltaX/$.zoom),r=t.gesture.deltaX,e.options.smooth||e._doDragingEvent(t),t.gesture.preventDefault(),!1}),$(this.options.containment).hammer().on("dragright",function(t){console.log("------dragright");if(e.sliding)return t.gesture.preventDefault(),!1;if(interaction_view.stopDragging)return;e.currentSlideDirection==null&&(e.currentSlideDirection=1);if(e.dragLock||interaction_view.events.onPageSwipeEvent(39,interaction_view.currentPage))return e.dragLock=!0,t.gesture.preventDefault(),!1;if(e.options.canDragX&&!e.options.canDragX(t))return;return e._testSlideDragEventAccess(t)?(e.dragstart=!0,$.zoom&&$.zoom!=1&&(t.gesture.deltaX=t.gesture.deltaX/$.zoom),r=t.gesture.deltaX,e.options.smooth||e._doDragingEvent(t),t.gesture.preventDefault(),!1):(t.gesture.preventDefault(),!1)}),$(this.options.containment).hammer().on("dragup",function(t){if(e.sliding)return t.gesture.preventDefault(),!1;console.log("------dragup");if(interaction_view.stopDragging)return;console.log("dragup"),e.currentSlideDirection==null&&(e.currentSlideDirection=2);if(e.dragLock||interaction_view.events.onPageSwipeEvent(36,interaction_view.currentPage))return e.dragLock=!0,t.gesture.preventDefault(),!1;if(e.options.canDragY&&!e.options.canDragY(t))return;return e._testSlideDragEventAccess(t)?(e.dragstart=!0,$.zoom&&$.zoom!=1&&(t.gesture.deltaY=t.gesture.deltaY/$.zoom),i=t.gesture.deltaY,e.options.smooth||e._doDragingEvent(t),t.gesture.preventDefault(),!1):(t.gesture.preventDefault(),!1)}),$(this.options.containment).hammer().on("dragdown",function(t){if(e.sliding)return t.gesture.preventDefault(),!1;console.log("------dragdown");if(interaction_view.stopDragging)return;console.log("dragdown"),e.currentSlideDirection==null&&(e.currentSlideDirection=2);if(e.dragLock||interaction_view.events.onPageSwipeEvent(37,interaction_view.currentPage))return e.dragLock=!0,t.gesture.preventDefault(),!1;if(e.options.canDragY&&!e.options.canDragY(t))return;return e._testSlideDragEventAccess(t)?(e.dragstart=!0,$.zoom&&$.zoom!=1&&(t.gesture.deltaY=t.gesture.deltaY/$.zoom),i=t.gesture.deltaY,e.options.smooth||e._doDragingEvent(t),t.gesture.preventDefault(),!1):(t.gesture.preventDefault(),!1)}),$(this.options.containment).hammer().on("dragend",function(t){if(interaction_view.stopDragging)return;console.log("slide is dragended"),e.dragstart||(e.currentSlideDirection=null),e.dragLock=!1;if(e.options.canDrag&&!e.options.canDrag(t))return;if(!e._testSlideDragEventAccess(t))return;if(e.currentSlideDirection==1&&r||e.currentSlideDirection==2&&i)if(e.options.smooth){var n=e.getSlideDirections(),s=e.currentSlideDirection==1?"x":"y";e.originh=e.indexh,e.originv=e.indexv;var o=!0;if(e.currentSlideDirection==1){var u=r/Math.abs(r);u<0&&!n.right?o=!1:u>0&&!n.left?o=!1:(e._onStopPlay(),e.indexh=u<0?e.indexh+1:e.indexh-1,e.indexv=0)}else{var u=i/Math.abs(i);u<0&&!n.down?o=!1:u>0&&!n.up?o=!1:(e._onStopPlay(),e.indexv=u<0?e.indexv+1:e.indexv-1)}o&&e.transition.autostart(e.options.transition,s,u)}else $.zoom&&$.zoom!=1&&(e.currentSlideDirection==2&&i&&(t.gesture.deltaY=t.gesture.deltaY/$.zoom),e.currentSlideDirection==1&&r&&(t.gesture.deltaX=t.gesture.deltaX/$.zoom)),e._doDragEndEvent(t);return e.dragstart=!1,e.currentSlideDirection=null,r=0,i=0,t.gesture.preventDefault(),!1}),$(this.options.containment).on("touchend",function(e){console.log("slide is touchended")})},_initSlideItems:function(){var e=0,t=0,n=this,r=[];this.slideItems=[],this.slideContent.children(".slideTempContainer").length==0&&this.slideContent.append('<div class="slideTempContainer" style="position:absolute;left:-99999px;top:-99999px;"></div>'),this.slideContent.hasClass("c-transition-containment")||this.slideContent.addClass("c-transition-containment"),this.slideTempContainer=this.slideContent.children(".slideTempContainer");if(this.slideContent.children(this.options.groupclass).length>0){this.slideType=3,this.slideContent.children(this.options.groupclass).each(function(){r[t]=[],n.slideItems[t]=[],$(this).children(n.options.itemclass).each(function(){r[t][e]=$(this).attr("id")||1,n.slideItems[t][e]=this,e+=1}),t+=1,e=0});var i=this.slideContent.children(this.options.groupclass).detach();this.slideTempContainer.append(i)}else{this.slideType=1,this.slideContent.children(this.options.itemclass).each(function(){r[t]=$(this).attr("id")||1,n.slideItems[t]=this,t+=1});var i=this.slideContent.children(this.options.itemclass).detach();this.slideTempContainer.append(i)}this.indexes=r,this.options.show_overview&&this._drawOverview()},_initSlideStyle:function(){var e=this,t=0,n=0;this.slideContent.find(this.options.itemclass).each(function(){$(this).css({width:"100%",height:"100%"}),$(this).children(".interaction-area").css({width:"100%",height:"100%"}),$(this).addClass("c-transition-item")}),this.setSlideItems(),e.setAdaptSlideItems()},_initScreenSet:function(){this.slideScreenWidth=this.options.width,this.slideScreenHeight=this.options.height,this.slideWidth=this.options.width,this.slideHeight=this.options.height,this.slideContainment=$(this.options.containment),this.slideContent=$(this.options.containment).find(this.options.slidesclass).first(),this.slideContainment.children(".slides-wrap").length==0&&this.slideContent.wrap('<div class="slides-wrap" style="position:absolute;width:100%;height:100%;left:0;top:0;z-index:1000;"></div>'),this.slideWrap=this.slideContainment.children(".slides-wrap"),this.slideContainment.css({width:this.slideScreenWidth,height:this.slideScreenHeight}),this.slideContent.css({width:this.slideScreenWidth,height:this.slideScreenHeight}),this.slideGroup=this.slideContent.children(),this.options.adapt&&(this.adapt=!0),this.setAdaptScreen()},sendSlide2Content:function(e){var t=$(e).detach();this.slideContent.append(t)},sendSlide2Temp:function(e){var t=$(e).detach();this.slideTempContainer.append(t)},setSingleSlideItem:function(e,t,n){this.slideContent.find(this.options.itemclass).removeClass("c-transition-"+n),this.slideItem=this.getSlideItem(e,t),$(this.slideItem).addClass("c-transition-"+n),$(this.slideItem).parent().is(this.slideContent)||this.sendSlide2Content(this.slideItem)},setSlideItems:function(){var e=this;this.currentItem=this.getCurrentSlide(),this.leftItem=null,this.rightItem=null,this.upItem=null,this.downItem=null;var t=[];t.push(this.getCurrentSlideId()),$(this.currentItem).parent().is(this.slideContent)||this.sendSlide2Content(this.currentItem);var n=this.getSlideDirections();n.left&&(t.push(this.getLeft()),this.leftItem=this.getSlideItemById(this.getLeft()),$(this.leftItem).parent().is(this.slideContent)||this.sendSlide2Content(this.leftItem)),n.right&&(t.push(this.getRight()),this.rightItem=this.getSlideItemById(this.getRight()),$(this.rightItem).parent().is(this.slideContent)||this.sendSlide2Content(this.rightItem)),this.slideType==3&&(n.up&&(t.push(this.getUp()),this.upItem=this.getSlideItemById(this.getUp()),$(this.upItem).parent().is(this.slideContent)||this.sendSlide2Content(this.upItem)),n.down&&(t.push(this.getDown()),this.downItem=this.getSlideItemById(this.getDown()),$(this.downItem).parent().is(this.slideContent)||this.sendSlide2Content(this.downItem))),this.slideContent.children(this.options.itemclass).each(function(){var n=$(this).attr("id");_.include(t,n)||e.sendSlide2Temp(this)}),this.slideContent.find(".c-transition-item").each(function(){this.id!=e.currentItem.id&&$(this).removeClass("c-transition-current"),$(this).removeClass("c-transition-left").removeClass("c-transition-right").removeClass("c-transition-up").removeClass("c-transition-down")}),$(this.currentItem).addClass("c-transition-current"),this.rightItem&&$(this.rightItem).addClass("c-transition-right"),this.leftItem&&$(this.leftItem).addClass("c-transition-left"),this.upItem&&$(this.upItem).addClass("c-transition-up"),this.downItem&&$(this.downItem).addClass("c-transition-down")},setAdaptScreen:function(){if(this.options.adapt){var e=this._getScreenSize(),t=this._getScreenScale();this.options.screen_mode==0?(this.slideScreenWidth=e.x,this.slideScreenHeight=e.y):this.options.screen_mode==1?(t.x&&(e.x=parseInt(e.x/t.x,10)),t.y&&(e.y=parseInt(e.y/t.y,10)),t.x&&(this.slideScreenWidth=e.x>this.options.width?e.x:this.options.width,this.slideScreenHeight=this.options.height),t.y&&(this.slideScreenHeight=e.y>this.options.height?e.y:this.options.height,this.slideScreenWidth=this.options.width)):(t.y&&(e.x=parseInt(e.x/t.y,10)),t.x&&(e.y=parseInt(e.y/t.x,10)),t.y&&(this.slideScreenWidth=e.x<this.options.width?e.x:this.options.width,this.slideScreenHeight=this.options.height),t.x&&(this.slideScreenHeight=e.y<this.options.height?e.y:this.options.height,this.slideScreenWidth=this.options.width)),this.slideContainment.css({width:this.slideScreenWidth+2,height:this.slideScreenHeight}),this.slideContent.css({width:this.slideScreenWidth+2,height:this.slideScreenHeight}),this.slideContent.find(".Presentation").css({overflow:"hidden"}),this.options.show_excontent&&this.slideContent.find(".interaction-view").css({overflow:"visible"}),this.slideWrap.css({overflow:"hidden"}),this.slideContainment.css({overflow:"visible"})}else if(this.options.screen_mode==2){var e=this._getScreenSize(),t=this._getScreenScale();t.y&&(e.x=parseInt(e.x/t.y,10)),t.x&&(e.y=parseInt(e.y/t.x,10)),t.y&&(this.slideScreenWidth=e.x<this.options.width?e.x:this.options.width,this.slideScreenHeight=this.options.height),t.x&&(this.slideScreenHeight=e.y<this.options.height?e.y:this.options.height,this.slideScreenWidth=this.options.width),this.slideContainment.css({width:this.slideScreenWidth,height:this.slideScreenHeight}),this.slideContent.css({width:this.slideScreenWidth,height:this.slideScreenHeight}),this.slideContent.find(".Presentation").css({overflow:"hidden"}),this.slideWrap.css({overflow:"hidden"}),this.slideContainment.css({overflow:"visible"})}},setAdaptSlideItems:function(){var e=this._getScreenScale(),t=(this.slideScreenWidth-this.slideWidth)/2,n=(this.slideScreenHeight-this.slideHeight)/2;this.slideContent.find(".interaction-area").css({"margin-left":t}),this.slideContent.find(".interaction-area").css({"margin-top":n})},_getScreenSize:function(){var e,t;if(this.options.body=="window"){var n=window,r=document,i=r.documentElement,s=r.getElementsByTagName("body")[0];e=n.innerWidth||i.clientWidth||s.clientWidth,t=n.innerHeight||i.clientHeight||s.clientHeight}else e=parseInt($(this.options.body).css("width"),10),t=parseInt($(this.options.body).css("height"),10);return{x:e,y:t}},_getScreenScale:function(){var e=this._getScreenSize(),t=e.x,n=e.y,r=this.options.width,i=this.options.height,s=null,o=null;return r>=i?s=t/n>=r/i?n/i:t/r:s=n/t>i/r?t/r:n/i,$.zoom&&(s=$.zoom),t/n>=r/i?{x:s,y:null}:{x:null,y:s}},_bindControllers:function(){var e=this;$(".action-control").children("button").on("click",function(){$(this).hasClass("enabled")&&($(this).hasClass("navigate-right")&&e.next(),$(this).hasClass("navigate-left")&&e.prev(),$(this).hasClass("navigate-up")&&e.up(),$(this).hasClass("navigate-down")&&e.down())})},_bindKeyboard:function(){var e=this;$(document).on("keydown",function(t){var n=!1,r=e.getSlideDirections();t.keyCode==37&&r.left&&(e.options.onKeyboard&&e.options.onKeyboard(),e.prev(),n=!0),t.keyCode==38&&r.up&&(e.options.onKeyboard&&e.options.onKeyboard(),e.up(),n=!0),t.keyCode==39&&r.right&&(e.options.onKeyboard&&e.options.onKeyboard(),e.next(),n=!0),t.keyCode==40&&r.down&&(e.options.onKeyboard&&e.options.onKeyboard(),e.down(),n=!0),t.keyCode==27&&e.options.overview&&e.options.show_controlbar&&(e.show_overview?e.toggleOverview(!1):e.toggleOverview(!0)),n&&t.preventDefault()})},_bindMouseWheel:function(){var e=this,t=0,n=0;e.wheelLock=!1,e.wheelEventLock=!1,$(this.options.containment).addClass("iMouseWheel enableMouseWheel"),$(this.options.containment).on("wheelstart",function(t,n){console.log("wstart");if(!$(t.target).is(this))return;if(e.sliding)return;if(e.wheelLock)return;e.wheelstart=!0}),$(this.options.containment).on("wheelleft",function(n,r){if(!$(n.target).is(this))return;var i=_g.mousewheel.getMouseWheel(r),s=i.x,o=Math.max(-1,Math.min(1,s||0));e.currentSlideDirection==null&&(e.currentSlideDirection=1);var u=parseInt(e.slideScreenWidth/25,10);t+=o/Math.abs(o)*u,n.gesture={deltaX:-1};if(t<-100&&(e.wheelEventLock||interaction_view.events.onPageSwipeEvent(38,interaction_view.currentPage))){e.wheelEventLock=!0,t=0;return}if(!e._testSlideDragEventAccess(n))return;e.wheelstart=!0,_g.mousewheel.currentTarget=$(e.options.containment);if(t<-100&&!e.wheelLock){var a=e.getSlideDirections();if(!a.right)return;e.options.onWheel&&e.options.onWheel(),e.wheelLock=!0,e.originh=e.indexh,e.originv=e.indexv,e.indexh=e.indexh+1,e.indexv=0,e.transition.autostart(e.options.transition,"x",n.gesture.deltaX)}}),$(this.options.containment).on("wheelright",function(n,r){if(!$(n.target).is(this))return;var i=_g.mousewheel.getMouseWheel(r),s=i.x,o=Math.max(-1,Math.min(1,s||0));e.currentSlideDirection==null&&(e.currentSlideDirection=1);var u=parseInt(e.slideScreenWidth/25,10);t+=o/Math.abs(o)*u,n.gesture={deltaX:1};if(t>100&&(e.wheelEventLock||interaction_view.events.onPageSwipeEvent(39,interaction_view.currentPage))){e.wheelEventLock=!0,t=0;return}if(!e._testSlideDragEventAccess(n))return;e.wheelstart=!0,_g.mousewheel.currentTarget=$(e.options.containment);if(t>100&&!e.wheelLock){var a=e.getSlideDirections();if(!a.left)return;e.options.onWheel&&e.options.onWheel(),e.wheelLock=!0,e.originh=e.indexh,e.originv=e.indexv,e.indexh=e.indexh-1,e.indexv=0,e.transition.autostart(e.options.transition,"x",n.gesture.deltaX)}}),$(this.options.containment).on("wheelup",function(t,r){console.log(t.currentTarget);if(!$(t.target).is(this))return;var i=_g.mousewheel.getMouseWheel(r),s=i.y,o=Math.max(-1,Math.min(1,s));e.currentSlideDirection==null&&(e.currentSlideDirection=2);var u=parseInt(e.slideScreenHeight/25,10);n+=o/Math.abs(o)*u,t.gesture={deltaY:-1};if(n<-50&&(e.wheelEventLock||interaction_view.events.onPageSwipeEvent(36,interaction_view.currentPage))){e.wheelEventLock=!0,n=0;return}if(!e._testSlideDragEventAccess(t))return;e.dragstart=!0,_g.mousewheel.currentTarget=$(e.options.containment);if(n<-50&&!e.wheelLock){var a=e.getSlideDirections();if(!a.down)return;e.options.onWheel&&e.options.onWheel(),e.wheelLock=!0,e.originh=e.indexh,e.originv=e.indexv,e.indexv+=1,e.transition.autostart(e.options.transition,"y",t.gesture.deltaY)}}),$(this.options.containment).on("wheeldown",function(t,r){if(!$(t.target).is(this))return;var i=_g.mousewheel.getMouseWheel(r),s=i.y,o=Math.max(-1,Math.min(1,r.wheelDeltaY));e.currentSlideDirection==null&&(e.currentSlideDirection=2);var u=parseInt(e.slideScreenHeight/25,10);n+=o/Math.abs(o)*u,t.gesture={deltaY:1};if(n>50&&(e.wheelEventLock||interaction_view.events.onPageSwipeEvent(38,interaction_view.currentPage))){e.wheelEventLock=!0,n=0;return}if(!e._testSlideDragEventAccess(t))return;e.wheelstart=!0,_g.mousewheel.currentTarget=$(e.options.containment);if(n>50&&!e.wheelLock){var a=e.getSlideDirections();if(!a.up)return;e.options.onWheel&&e.options.onWheel(),e.wheelLock=!0,e.originh=e.indexh,e.originv=e.indexv,e.indexv-=1,e.transition.autostart(e.options.transition,"y",t.gesture.deltaY)}}),$(this.options.containment).on("wheelend",function(r,i){console.log("wend");if(!$(r.target).is(this))return;e.wheelstart||(e.currentSlideDirection=null),e.wheelEventLock=!1,e.wheelstart=!1,e.wheelLock=!1,e.currentSlideDirection=null,t=0,n=0})},_bindOverviewEvents:function(){var e=this;this.touchoverviewelement.hammer().on("tap",function(t){console.log(t.target);if($(t.target).is(".touchslide_overview_item")){var n=$(t.target).attr("data-indexh"),r=$(t.target).attr("data-indexv");n&&r&&e.slide(Number(n),Number(r))}return e.toggleOverview(!1),!1})},_drawOverview:function(){var e=this,t=this._getScreenSize(),n=this.slideScreenWidth/this.slideScreenHeight,r=parseInt(t.x/4<250?t.x/4:250,10),s=parseInt(r/n,10);this.overview_width=r,this.overview_height=s,$("body").append('<div class="touchslide_overview disableMouseWheel iMouseWheel" style="width:100%;height:100%;position:absolute;left:0;z-index:10000;overflow:auto;top:0;display:none;"></div>'),this.touchoverviewelement=$("body").children(".touchslide_overview"),this.touchoverviewelement.append('<div class="touchslide_overview_container"></div>'),this.touchoverviewcontainerel=this.touchoverviewelement.children(".touchslide_overview_container"),this.touchoverviewcontainerel.append('<div class="touchslide_overview_wrap disableMouseWheel iMouseWheel"></div>'),this.touchoverviewel=this.touchoverviewcontainerel.children(".touchslide_overview_wrap"),this.touchoverviewel.css("top",0),this.touchoverviewcontainerel.css({width:r+"px",height:s+"px","margin-left":"-"+r/2+"px","margin-top":"-"+s/2+"px"});if(this.slideType==3){for(i=0;i<this.indexes.length;i++){var o=i*r+i*10;e.touchoverviewel.append('<div class="touchslide_overview_group" data-index="'+i+'" style="position:absolute;left:'+o+'px;top:0;"></div>');for(j=0;j<this.indexes[i].length;j++){var u=j*s+j*10,a=this.options.getOverview?this.options.getOverview(this.indexes[i][j]):null;$(e.touchoverviewel.children()[i]).append('<div class="touchslide_overview_item" data-indexh="'+i+'" data-indexv="'+j+'" style="position:absolute;top:'+u+"px;left:0;width:"+r+"px;height:"+s+'px;"></div>'),$(e.touchoverviewel.children()[i]).children('[data-indexv="'+j+'"]').css({"background-color":"#FFF",outline:"1px solid #ccc"}),a&&$(e.touchoverviewel.children()[i]).children('[data-indexv="'+j+'"]').css({"background-image":"url("+a+")","background-size":"contain","background-position":"center center","background-repeat":"no-repeat"})}}$($(e.touchoverviewel.children()[0]).children()[0]).css("outline","2px solid red")}else{for(i=0;i<this.indexes.length;i++){var o=i*r+i*10,a=this.options.getOverview?this.options.getOverview(this.indexes[i]):null;e.touchoverviewel.append('<div class="touchslide_overview_item" data-indexh="'+i+'" data-indexv="0" style="position:absolute;left:'+o+"px;bottom:0;width:"+r+"px;height:"+s+'px;top:0;"></div>'),$(e.touchoverviewel.children()[i]).css({"background-color":"#FFF",outline:"1px solid #ccc"}),a&&$(e.touchoverviewel.children()[i]).css({"background-image":"url("+a+")","background-size":"contain","background-position":"center center","background-repeat":"no-repeat"})}$(e.touchoverviewel.children()[0]).css("outline","2px solid red")}this._bindOverviewEvents()},toggleOverview:function(e){if(!this.options.show_overview)return;if(e){$(".reveal").css("opacity",.1);var t=this.indexh*this.overview_width+10*this.indexh;this.touchoverviewelement.show(),this.touchoverviewelement.scrollLeft(t),this.touchoverviewelement.scrollTop(0),this.show_overview=!0}else $(".reveal").css("opacity",""),this.touchoverviewelement.hide(),this.show_overview=!1},getSlideDirections:function(){var e={left:!1,right:!1,up:!1,down:!1};return this.slideType==1?(this.indexh>0&&(e.left=!0),this.indexh<this.indexes.length-1&&(e.right=!0)):(this.indexh>0&&(this.options.checkSlidePermission?this.options.checkSlidePermission(this,this.slideType,"left",this.indexh,this.indexv)&&(e.left=!0):e.left=!0),this.indexh<this.indexes.length-1&&(this.options.checkSlidePermission?this.options.checkSlidePermission(this,this.slideType,"right",this.indexh,this.indexv)&&(e.right=!0):e.right=!0),this.indexv>0&&(e.up=!0),this.indexv<this.indexes[this.indexh].length-1&&(e.down=!0)),e},_testSlideDragEventAccess:function(e){var t=!0;if(this.dragstart||this.wheelstart){this.currentSlideDirection==1&&(e.type=="dragup"||e.type=="dragdown"||e.type=="wheelup"||e.type=="wheeldown")&&(t=!1),this.currentSlideDirection==2&&(e.type=="dragleft"||e.type=="dragright"||e.type=="wheelleft"||e.type=="wheelright")&&(t=!1),this.slideType==1&&(e.type=="dragup"||e.type=="dragdown"||e.type=="wheelup"||e.type=="wheeldown")&&(t=!1),this.slideType==2&&(e.type=="dragleft"||e.type=="dragright"||e.type=="wheelleft"||e.type=="wheelright")&&(t=!1);if(e.type=="dragend"||e.type=="wheelend")this.currentSlideDirection||(t=!1)}else t=!1;return t},_doStartEvent:function(e){this.transition.start(e)},_doDragingEvent:function(e){var t=this._getDragDistance(e),n=this.getSlideDirections(),r=this.transition.opts.type;if(e.type=="dragleft"||e.type=="dragright"||e.type=="wheelleft"||e.type=="wheelright"){var i=e.gesture.deltaX;if(e.type.indexOf("right")!=-1&&!n.left){this.dragstart=!1;return}if(e.type.indexOf("left")!=-1&&!n.right){this.dragstart=!1;return}interaction_view.transitionPagePreLoad=null,i<t.min&&(e.gesture.deltaX=t.min),i>t.max&&(e.gesture.deltaX=t.max),this.transition.dragX(e)}if(e.type=="dragup"||e.type=="dragdown"||e.type=="wheelup"||e.type=="wheeldown"){if(e.type.indexOf("down")!=-1&&!n.up){this.dragstart=!1;return}if(e.type.indexOf("up")!=-1&&!n.down){this.dragstart=!1;return}interaction_view.transitionPagePreLoad=null;var s=e.gesture.deltaY;s<t.min&&(e.gesture.deltaY=t.min),s>t.max&&(e.gesture.deltaY=t.max),this.transition.dragY(e)}},_doDragEndEvent:function(e,t){var n=this.transition.opts.type,r=this,i=this._getDragDistance({type:this.currentSlideDirection==1?"dragleft":"dragup"}),s=[0,0],o=!1,u=this.getSlideDirections();if(!e||!e.gesture)return;if(this.currentSlideDirection==1){var a=e.gesture.deltaX;a<i.min&&(e.gesture.deltaX=i.min),a>i.max&&(e.gesture.deltaX=i.max),a!=0&&(this.originh=this.indexh,this.originv=this.indexv,a<0&&u.right&&(o=!0,this.indexh+=1),a>0&&u.left&&(o=!0,this.indexh-=1),this.indexv=0);if(o){var f=this.getCurrentSlideId();this.options.onSlideChangeStart&&this.options.onSlideChangeStart(f);if(a>0&&u.left||a<0&&u.right)this.sliding=!0,this.transition.dragEnd(e)}}if(this.currentSlideDirection==2){var l=e.gesture.deltaY;l<i.min&&(e.gesture.deltaY=i.min),l>i.max&&(e.gesture.deltaY=i.max),l!=0&&(this.originh=this.indexh,this.originv=this.indexv,l<0&&u.down&&(o=!0,s=[0,i.min],this.indexv+=1),l>0&&u.up&&(o=!0,s=[0,i.max],this.indexv-=1));if(o){var f=this.getCurrentSlideId();this.options.onSlideChangeStart&&this.options.onSlideChangeStart(f);if(l>0&&u.up||l<0&&u.down)this.sliding=!0,this.transition.dragEnd(e)}}o||this.transition.recoveritemClass()},_complete:function(e){var t=this;this.slideContent.find(".c-transition-item").removeClass("c-transition-left").removeClass("c-transition-right").removeClass("c-transition-up").removeClass("c-transition-down").removeClass("c-transition-active"),console.log(t.indexh,t.originh);var n=t.slideType==3?t.indexes[t.indexh][t.indexv]:t.indexes[t.indexh],r=t.slideType==3?t.indexes[t.originh][t.originv]:t.indexes[t.originh];t.preStoped=!1,t.sliding=!1,t.onSlideChange(n,r)},_cancel:function(){var e=this;this.indexh=this.originh,this.indexv=this.originv,e.transition.opts.type==7&&this.slideContent.find(".c-transition-item").removeClass("c-transition-active"),this.slideContent.find(".c-transition-item").removeClass("c-transition-left").removeClass("c-transition-right").removeClass("c-transition-up").removeClass("c-transition-down"),this.setSlideItems(),e.sliding=!1;var t=e.slideType==3?e.indexes[e.indexh][e.indexv]:e.indexes[e.indexh];this.options.onContinuePlay&&this.options.onContinuePlay(t)},_getDragDistance:function(e){var t={min:0,max:0},n=this.getSlideDirections();if(e.type=="dragleft"||e.type=="dragright"||e.type=="wheelleft"||e.type=="wheelright")n.right&&(t.min=-this.slideScreenWidth),n.left&&(t.max=this.slideScreenWidth);if(e.type=="dragup"||e.type=="dragdown"||e.type=="wheelup"||e.type=="wheeldown")n.down&&(t.min=-this.slideScreenHeight),n.up&&(t.max=this.slideScreenHeight);return t},_getCurrentPosition:function(){var e=-this.indexh*this.slideScreenWidth,t=-this.indexv*this.slideScreenHeight;return{x:e,y:t}},isOverview:function(){return!1},getSlideItem:function(e,t){return this.slideType==3?this.slideItems[e][t]:this.slideItems[e]},getSlideItemById:function(e){var t=this.getSlidePositionById(e);return t?this.slideType==3?this.slideItems[t.h][t.v]:this.slideItems[t.h]:null},getCurrentSlide:function(){return this.slideType==3?this.slideItems[this.indexh][this.indexv]:this.slideItems[this.indexh]},getCurrentSlideId:function(){return this.slideType==3?this.indexes[this.indexh][this.indexv]:this.indexes[this.indexh]},getIndices:function(){return{h:this.indexh,v:this.indexv}},getAllSlideIds:function(){var e=[];if(this.slideType==3){for(i=0;i<this.indexes.length;i++)for(j=0;j<this.indexes[i].length;j++)e.push(this.indexes[i][j]);return e}return this.indexes},getFirst:function(){var e=this.getAllSlideIds();return e?e[0]:null},getLast:function(){var e=this.getAllSlideIds();return e?e[e.length-1]:null},getRight:function(){return this.getSlideDirections().right?this.slideType==3?this.indexes[this.indexh+1][0]:this.indexes[this.indexh+1]:null},getLeft:function(){return this.getSlideDirections().left?this.slideType==3?this.indexes[this.indexh-1][0]:this.indexes[this.indexh-1]:null},getUp:function(){return this.getSlideDirections().up?this.slideType==3?this.indexes[this.indexh][this.indexv-1]:null:null},getDown:function(){return this.getSlideDirections().down?this.slideType==3?this.indexes[this.indexh][this.indexv+1]:null:null},getPrev:function(){return this.getSlideDirections().up?this.getUp():typeof this.indexes[this.indexh-1]=="object"&&this.indexes[this.indexh-1][0]?_.last(this.indexes[this.indexh-1]):this.indexes[this.indexh-1]},getNext:function(){var e;return this.getSlideDirections().down?e=this.getDown():e=this.getRight(),!e&&Reveal.indexes.length>this.indexh+1&&(e=this.indexes[this.indexh+1][0]),e},getSlidePositionById:function(e){var t=null;if(this.slideType==3){for(i=0;i<this.indexes.length;i++)for(j=0;j<this.indexes[i].length;j++)if(this.indexes[i][j]==e)return{h:i,v:j};return t}return this.indexes.indexOf(e)!=-1?{h:this.indexes.indexOf(e),v:null}:null},getVerticalLength:function(){return this.slideType==3?this.indexes[this.indexh].length:1},getHorizontalLength:function(){return this.indexes.length},slide:function(e,t){if(e==undefined)return;if(e==this.indexh&&t==this.indexv)return;var n=this.getCurrentSlideId();this.indexh=e,this.indexv=t?t:0;var r=e*this.slideScreenWidth,i=t?t*this.slideScreenHeight:0,s=this.getCurrentSlideId();this.onSlideChange(s,n)},setControllers:function(){var e=this.getSlideDirections();$(".action-control").children("button").removeClass("enabled"),e.right&&$(".action-control").children(".navigate-right").addClass("enabled"),e.left&&$(".action-control").children(".navigate-left").addClass("enabled"),e.up&&$(".action-control").children(".navigate-up").addClass("enabled"),e.down&&$(".action-control").children(".navigate-down").addClass("enabled")},setProgressBar:function(){var e=parseInt((this.indexh+1)/this.indexes.length*100,10);$(".controlbar").children(".progress").children("span").css({width:e+"%"})},onSlideChange:function(e,t){var n=this;this.setSlideItems(),this.previousSlide=t,this.currentSlide=e,this.options.history&&this.Router.navigate("page/"+e),n.options.onSlideChange&&n.options.onSlideChange(n.currentSlide,n.previousSlide),n.options.controls&&n.setControllers(),n.options.progress&&n.setProgressBar(),n.changeOverview(n.indexh,n.indexv)},_onStopPlay:function(){if(!this.preStoped){var e=this,t=e.slideType==3?e.indexes[e.indexh][e.indexv]:e.indexes[e.indexh];this.options.onStopPlay&&this.options.onStopPlay(t),this.preStoped=!0}},prev:function(){if(this.indexh==0||this.indexes.length<2)return;this.slide(this.indexh-1)},next:function(){if(this.indexh==this.indexes.length-1||this.indexes.length<2)return;this.slide(this.indexh+1)},up:function(){if(this.slideType!=3)return;this.indexes[this.indexh][this.indexv-1]&&this.slide(this.indexh,this.indexv-1)},down:function(){if(this.slideType!=3)return;this.indexes[this.indexh][this.indexv+1]&&this.slide(this.indexh,this.indexv+1)},changeOverview:function(e,t){if(!this.options.show_overview)return;var n=t?t*this.overview_height+10*t:0;$(this.touchoverviewel).find(".touchslide_overview_item").css("outline","1px solid #ccc"),this.slideType==3?($($(this.touchoverviewel.children()[this.indexh]).children()[this.indexv]).css("outline","2px solid red"),this.touchoverviewel.children().css("top",0),this.touchoverviewel.children().eq(e).css({top:-n})):$(this.touchoverviewel.children()[this.indexh]).css("outline","2px solid red")}},typeof require=="undefined"?(window._g||(window._g={}),window._g.touchslide=e):define("_g/touchslide2",["_g/base","_g/touch","jquery.hammer","underscore","jquery.transit","backbone","_g/keyboard","_g/transition2"],function(){return window._g.touchslide=e,window._g.touchslide})})(window);(function(){var e,t,n,r,i,s,o,u,a,f,l={};n=window.document.documentElement,f=window.navigator.userAgent.toLowerCase(),l.ios=function(){return l.iphone()||l.ipod()||l.ipad()},l.iphone=function(){return r("iphone")},l.ipod=function(){return r("ipod")},l.ipad=function(){return r("ipad")},l.android=function(){return r("android")},l.androidPhone=function(){return l.android()&&r("mobile")},l.androidTablet=function(){return l.android()&&!r("mobile")},l.blackberry=function(){return r("blackberry")||r("bb10")||r("rim")},l.blackberryPhone=function(){return l.blackberry()&&!r("tablet")},l.blackberryTablet=function(){return l.blackberry()&&r("tablet")},l.windows=function(){return r("windows")},l.mac=function(){return r("mac")},l.linux=function(){return r("linux")},l.windowsPhone=function(){return l.windows()&&r("phone")},l.windowsTablet=function(){return l.windows()&&r("touch")},l.fxos=function(){return(r("(mobile;")||r("(tablet;"))&&r("; rv:")},l.fxosPhone=function(){return l.fxos()&&r("mobile")},l.fxosTablet=function(){return l.fxos()&&r("tablet")},l.meego=function(){return r("meego")},l.mobile=function(){return l.androidPhone()||l.iphone()||l.ipod()||l.windowsPhone()||l.blackberryPhone()||l.fxosPhone()||l.meego()},l.tablet=function(){return l.ipad()||l.androidTablet()||l.blackberryTablet()||l.windowsTablet()||l.fxosTablet()},l.msie=function(){return $.browser.msie||!!navigator.userAgent.match(/Trident\/7\./)},l.portrait=function(){return Math.abs(window.orientation)!==90},l.landscape=function(){return Math.abs(window.orientation)===90},l.noConflict=function(){return this},l.svg=function(){return document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape","1.1")},l.online=function(e,t,n){var r=new Image;r.onload=function(){console.log("online"),t&&t.constructor==Function&&t()},r.onerror=function(){console.log("offline"),n&&n.constructor==Function&&n()},r.src=e+"?t="+_g.uuid()},l.screenSize=function(){var e=window,t=document,n=t.documentElement,r=t.getElementsByTagName("body")[0],i=e.innerWidth||n.clientWidth||r.clientWidth,s=e.innerHeight||n.clientHeight||r.clientHeight;return{x:i,y:s}},l.isWeixin=function(){var e=navigator.userAgent.toLowerCase();return/micromessenger/.test(e)?!0:!1},r=function(e){return f.indexOf(e)!==-1},s=function(e){var t;return t=new RegExp(e,"i"),n.className.match(t)},t=function(e){if(!s(e))return n.className+=" "+e},u=function(e){if(s(e))return n.className=n.className.replace(e,"")};var c=function(){l.ios()?l.ipad()?t("ios ipad tablet"):l.iphone()?t("ios iphone mobile"):l.ipod()&&t("ios ipod mobile"):l.android()?l.androidTablet()?t("android tablet"):t("android mobile"):l.blackberry()?l.blackberryTablet()?t("blackberry tablet"):t("blackberry mobile"):l.windows()?l.windowsTablet()?t("windows tablet"):l.windowsPhone()?t("windows mobile"):t("desktop"):l.fxos()?l.fxosTablet()?t("fxos tablet"):t("fxos mobile"):l.meego()?t("meego mobile"):t("desktop")};i=function(){return l.landscape()?(u("portrait"),t("landscape")):(u("landscape"),t("portrait"))},a="onorientationchange"in window,o=a?"orientationchange":"resize",window.addEventListener?window.addEventListener(o,i,!1):window.attachEvent?window.attachEvent(o,i):window[o]=i,i(),l.initDom=c,window._g_device=l,typeof require=="undefined"?(window._g||(window._g={}),window._g.device=_g_device):define("_g/device",["_g/base"],function(){return window._g.device=_g_device,window._g.device})})(window);(function(e){e.fn.addBack=e.fn.addBack||e.fn.andSelf,e.fn.extend({actual:function(t,n){if(!this[t])throw'$.actual => The jQuery method "'+t+'" you called does not exist';var r={absolute:!1,clone:!1,includeMargin:!1},i=e.extend(r,n),s=this.eq(0),o,u;if(i.clone===!0)o=function(){var e="position: absolute !important; top: -1000 !important; ";s=s.clone().attr("style",e).appendTo("body")},u=function(){s.remove()};else{var a=[],f="",l;o=function(){l=s.parents().addBack().filter(":hidden"),f+="visibility: hidden !important; display: block !important; ",i.absolute===!0&&(f+="position: absolute !important; "),l.each(function(){var t=e(this),n=t.attr("style");a.push(n),t.attr("style",n?n+";"+f:f)})},u=function(){l.each(function(t){var n=e(this),r=a[t];r===undefined?n.removeAttr("style"):n.attr("style",r)})}}o();var c=/(outer)/.test(t)?s[t](i.includeMargin):s[t]();return u(),c}})})(jQuery),define("jquery.actual",function(){}),define("/Users/blues/projects/epub360/1-src/epub360-built/html/common/js/jquery/jquery.actual.js",function(){});define("text!interaction_view/template/controlbar.js",[],function(){return'<div class=\'presentation-area\'>\n    <div class="controlbar">\n            <div class="logo"><% if (typeof cbt_data=="undefined"){ %><% if(typeof has_logo != \'undefined\' &&  has_logo){ %><a href="http://www.epub360.com" target="_blank"><img alt="logo" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFIAAAAaCAYAAAAkJwuaAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABhFJREFUeNrsmVlwlEUQx7+sSTwikSAqiAciJCJQQVFBA4WAZwyXoiioUUAi+CBe4IMFXg8ioIKlgoIHhhKltDzAg0IpopJQbjQYTVKh1NKICUSUwygJC7Gb+k3ZTu2GXcyDD9tV/5qd6S/zfdPT3fPvSUo4HA48WSqYLNggKBasFPwRJCWqDBgw4GAbiqKrFuwUDBW8IKgXPJA0WdsSzZALBFmCHMFCwbGCRwRvJ82VmCHPFpwrqBXMEJwj+FkwWrA8abL4DTlfUC74UjBOUCE4X/Cn4CYMmpQ4DPkEB4164irBLYIGwXj0zyXN1rYhjxF0F6wTXCwoYPwlQaZgtaBG0FWQmzRddEPqYfKT4AfBbsGDgjWCSeifpH2FdnAC79D08Ficz6Ycpu5/YcgboDfHM9ZBMEcwAW90xlD5irZ3Au/QlDBLMK+NZ9T7PxE0CpbwDfbwUz67XfAWB6GTIwT3C+pMTo8lRwumC+YKrouiV6d5XHAz81qZiO5GQSfBCJyjqLy8PPPgLgshV8/LJ3R1wTMFhXhkAWG8X/ANXtFPsAfvjUfWCi5lUyZF0Q8RlHhjYQ64boIfoyysj6DKzG2lMAq70MVvEvQ0Yx8LLuH3OozjROceSCGyzPtu5dgdTf8XQV7IDH7ABB/Rz8djN2NElVbB1wkY0Ybk5hj622kX4W27BOcxNhIjKhUbJHiT8f6CdIzYRE5/CN3MKO+4GyNWkcZ2YLjObNYIouFhwRaioD/rVyO2oCvDXvvplwpOVg8PMahyFO0WysSnbSVEaH4mWCy4wOiW8IG30R+G4T80O+hCNNfzCpXTad8gdTjvzGahKp/jUcX0tVjowe8KWMbr9HVhGd47utLqt88WrKDfzxycK0lp8807XArbgO4++uvpz6I/MBUvU/nNhFXYW6jt52luwEM20fZm4e6j+2C4gN1UmQoCPGuc8fIAZhDAV1WOE+zldyptlnnWD3eX4zPw1iaja/Lmce/qTuoIjEO5CDrRbMhew2zsmly/S6p5WT5/0IG4X8P4nbQN5J5rBGcyrgfSNvS7PENsbYOr6hz3svtFLLzCeK5bUITfEUPFqmAYvb35Q2aRB2KkkTTaF0lR64ggq0unbRbs83Rp3oa4/l92kdcKXhM8j5s7ca6/DFeeY0IoMC87VI5cgHe/S3+GSexDCNsywm07edjl7ysJ3dlEQT0ee7jyKZSuzoT9fxLrkTvwOnXnL6Lsogv9PbS9PA88lDTgSeqFo7w8tsh79juSfycXOoayTGZDtrYTBWxu78pGeVFfwRkez3JhcqR3KEUSJMoZXl45ALdTOQvjTsNAF3Lr1IC+hG/S8D9NMKYdDZne3oZsMZyr0FxO+DvW2k5RECEtaJ69WvA+p2op+h7m3dXU/XPpD4pyMiciY2EbPYmSdgntNG/sCsHLGCwU/HM7HjEpIDCnZqpncP+EjKUPMed0mEA1d54pJqWke1HQbObM8MZazHeFYhwy7tlRXMZs5IrQ6ixTSEnEI5sN3bA0Yov3Ee5Dx3intAt9dzCc6n1YxKMup3jz1XsG7mzmjZiy1dKWfeRQ+3yLSTXNMQ48f0N2Gl2ml4Ja4zhI/+WRpVQG00jiY9GVmhpV5R68J9vkLVd/699MEZxENRJAL5xe6+1b2aQCQ6QDDjbllAvxkKHG81dT446EslyGrtZ4Ul9O/Bz6NRyAWjFdZAh4EUwhm3tVlUpzWE7AqKNNERC3IbXW7saEWWZ8N7VmDTXpcO/vyvDMbRBXrWROMPq9UJow45UY2ebjwRixI/PlGP1TgrtM5TTVoy5XwR50Y58xul/hqCV4up72dwie5VJkmHl2OWdBwEZM9O4HLocSasX1LRs2HmpYDd+9HspYm8rpl0vO6ALNWWoYv3P990CdKf8COF8uNalyy9+5bnOpoRH9ZOpaDadX2SQXXn3x2F6Q5LVm/iKKgzw2ZpXROQMVMs9ik3IexSMr6Q/nHTncJ6w38+itzjvU+Bv5HbDWYv5j4A69FV5f9RUpUf4d64vbySmQ8qTYS4g2/h3rS0dTlyYlDh4ZS74nXBqT5ootfwswAIGagOhx/Kc1AAAAAElFTkSuQmCC"></a><% } %><% } %></div>\n            <div class="progress"><span></span></div>\n            <% if(controlbar_settings.arrow){%>\n              <% if(play_mode==0){ %>\n                <div class="btn-group action-control" style="margin-left: -40px;">\n                   <button class="btn navigate-left" href="#" rel="tooltip" data-original-title="LEFT"><i class="icon-chevron-left icon-2x"></i></button>\n                   <button class="btn navigate-right" href="#" rel="tooltip" data-original-title="RIGHT"><i class="icon-chevron-right icon-2x"></i></button>                  \n              <% } else {%>\n                <div class="btn-group action-control" style="margin-left: -90px;">\n                    <button class="btn navigate-left" href="#" rel="tooltip" data-original-title="LEFT"><i class="icon-chevron-left icon-2x"></i></button>\n                    <button class="btn navigate-right" href="#" rel="tooltip" data-original-title="RIGHT"><i class="icon-chevron-right icon-2x"></i></button>\n                    <button class="btn navigate-up" href="#" rel="tooltip" data-original-title="UP"><i class="icon-chevron-up icon-2x"></i></button>\n                    <button class="btn navigate-down" href="#" rel="tooltip" data-original-title="DOWN"><i class="icon-chevron-down icon-2x"></i></button>\n               <% } %>\n            </div>\n            <% } %>\n\n            <div class="btn-group more-actions">\n              <button class="btn" data-toggle="dropdown"><i class="icon-ellipsis-horizontal icon-2x"></i></button>\n              <div class="btn-group dropdown-menu">\n                <% if(controlbar_settings.screen_mode){%>\n                <button class="btn actualsize" href="#" rel="tooltip" data-original-title="原始尺寸"><i class="im-actualsize im-more"></i></button>\n                <% } %>\n                <button class="btn adaptive active" href="#" rel="tooltip" data-original-title="自适应窗口"><i class="im-adaptive im-more"></i></button>\n                <% if(controlbar_settings.fullscreen){%>\n                 <button class="btn fullscreen" href="#" rel="tooltip" data-original-title="全屏"><i class="im-fullscreen im-more"></i></button>\n                <% } %>\n                <% if(controlbar_settings.overview){ %>\n                <button class="btn overview" href="#" rel="tooltip" data-original-title="全局预览"><i class="im-overview im-more"></i></button>\n                <% } %>\n              </div>\n              <% if(controlbar_settings.share){%>\n              <button class="btn action-share" data-target="#share" rel="tooltip" data-original-title="分享"><i class="icon-share-alt icon-large"></i></button>\n              <% } %>\n            </div>\n    </div>\n</div>'});define("interaction_view/ui/screenset",["text!interaction_view/template/controlbar.js","_g/device"],function(){var e=require("text!interaction_view/template/controlbar.js"),t={init:function(){window.screenLock=!1,window.screenScale=null,window.bar_height=0,window.useTranform=!1,window.get_window_size=function(){var e,t;if(!interaction_view.forpreview){var n=window,r=document,i=r.documentElement,s=r.getElementsByTagName("body")[0];e=n.innerWidth||i.clientWidth||s.clientWidth,t=n.innerHeight||i.clientHeight||s.clientHeight}else e=parseInt($(".interaction-preview").css("width"),10),t=parseInt($(".interaction-preview").css("height"),10);return{x:e,y:t}},window.recover_screen=function(){window.useTransform?(document.querySelectorAll(".reveal")[0].style.transform="scale(1)",document.querySelectorAll(".reveal")[0].style.WebkitTransform="scale(1)",document.querySelectorAll(".reveal")[0].style.MozTransform="scale(1)",document.querySelectorAll(".reveal")[0].style["-o-transform"]="scale(1)"):(document.querySelectorAll(".reveal")[0].style.zoom=1,document.querySelectorAll(".reveal")[0].style.MozTransform="scale(1)"),$.zoom=1},window.adjust_screen=function(){if(window.screenLock){interaction_view.screenset.patchForFixedSize();return}var e=1,t=get_window_size();if(interaction_view.ismobile&&interaction_view.currentScreenSize&&interaction_view.currentScreenSize.x==t.x){interaction_view.screenset.patchForIframe();return}var n=t.x,r=t.y,i=interaction_view?interaction_view.size.x:parseInt($(".slides")[0].style.width,10),s=interaction_view?interaction_view.size.y:parseInt($(".slides")[0].style.height,10);$("body").height($("html").height()-0),i>=s?interaction_view.screen_mode==2?e=window.screenScale?window.screenScale:n/r>=i/s?n/i:r/s:e=window.screenScale?window.screenScale:n/r>=i/s?r/s:n/i:interaction_view.screen_mode==2?e=window.screenScale?window.screenScale:r/n>=s/i?r/s:n/i:e=window.screenScale?window.screenScale:r/n>=s/i?n/i:r/s,window.useTranform?(document.querySelectorAll(".reveal")[0].style.transform="scale("+e+")",document.querySelectorAll(".reveal")[0].style.WebkitTransform="scale("+e+")",document.querySelectorAll(".reveal")[0].style.MozTransform="scale("+e+")",document.querySelectorAll(".reveal")[0].style["-o-transform"]="scale("+e+")"):(document.querySelectorAll(".reveal")[0].style.zoom=e,document.querySelectorAll(".reveal")[0].style.MozTransform="scale("+e+")"),$.zoom=e,interaction_view.currentScreenSize=t,_g.device.msie()&&interaction_view.screenset.adjustPatchforIE(e),interaction_view.screenset.patchForIframe(),typeof Reveal!="undefined"&&Reveal.adapt?(Reveal.setAdaptScreen(),Reveal._initSlideStyle(),interaction_view.adapt.change()):(Reveal.setAdaptScreen(),Reveal._initSlideStyle()),interaction_view.touchview&&interaction_view.screenset.adjustRevealPosition(e)},interaction_view.forpreview||(window.onresize=function(e){console.log("window resize"),adjust_screen()},window.onload=adjust_screen);if(interaction_view.ismobile){var e="onorientationchange"in window,t=e?"orientationchange":"resize";window.addEventListener?window.addEventListener(t,interaction_view.screenset.patchForMobileOrientation,!1):window.attachEvent?window.attachEvent(t,interaction_view.screenset.patchForMobileOrientation):window[t]=interaction_view.screenset.patchForMobileOrientation,interaction_view.screenset.patchForMobileOrientation()}window.screenSizeLock=function(){recover_screen(),window.screenLock=!0,interaction_view.screenset.patchForFixedSize(),interaction_view.screenset.patchForScreenMode2()},window.screenSizeRelease=function(){window.screenLock=!1,adjust_screen()}},patchForScreenMode2:function(){interaction_view.screen_mode==2&&(Reveal.setAdaptScreen(),Reveal._initSlideStyle())},patchForFixedSize:function(){if(typeof Reveal!="undefined"&&Reveal.adapt)Reveal.setAdaptScreen(),Reveal._initSlideStyle(),interaction_view.adapt.change();else{var e=typeof Reveal!="undefined"?Reveal.slideWidth:interaction_view.size.x,t=typeof Reveal!="undefined"?Reveal.slideHeight:interaction_view.size.y,n=get_window_size();if(window.useTransform){var r=(n.y-t)/2;$(".reveal").css({"margin-top":r});var i=(n.x-e)/2;$(".reveal").css({"margin-left":i})}else{var r=(n.y-t)/2;$(".reveal").css({"margin-top":r});var i=(n.x-e)/2;$(".reveal").css({"margin-left":i})}}},bindControlbarAutoHideEvent:function(){interaction_view.controlbarStatus=1,interaction_view.ismobile||$("body").on("mouseover",function(){$(".loading").length>0&&$(".loading").show(),interaction_view.controlbarStatus==0&&interaction_view.screenset.controlbarel&&interaction_view.screenset.controlbarel.show(500),interaction_view.controlbarStatus=1,t.startControlbarHide()})},changeProgressBar:function(){var e=Reveal.getIndices();interaction_view.screenset.controlbarel&&(interaction_view.screenset.controlbarel.find(".progress").children("span")[0].style.width=(e.h+1)/interaction_view.ipagelist.models.length*100+"%")},startControlbarHide:function(){typeof interaction_view.controlbarTimeOut=="number"&&(window.clearTimeout(interaction_view.controlbarTimeOut),delete interaction_view.controlbarTimeOut),interaction_view.controlbarTimeOut=window.setTimeout(function(){interaction_view.screenset.controlbarel&&interaction_view.screenset.controlbarel.hide(),$(".loading").length>0&&$(".loading").hide(500),interaction_view.controlbarStatus=0},3e3)},render:function(){var e=interaction_view.doc.toJSON();interaction_view.screenset.values=t.values=t.queryparse(e),interaction_view.ismobile||interaction_view.forpreview||t.rendercontrolbar(),t.initScreen(),t.bindControlbarAutoHideEvent(),interaction_view.ismobile&&interaction_view.screenset.startControlbarHide()},initScreen:function(){workEnd("-------- 6. screenset  1 add style 1 --------"),t.values.bg_opacity?interaction_view.containment.css("background",t.values.bg_color):interaction_view.containment.css("background-color","transparent"),workEnd("-------- 6. screenset  1 add style 1 --------"),t.values.screen_mode==0&&(window.screenLock=!0,interaction_view.screenset.controlbarel&&(interaction_view.screenset.controlbarel.find("button.actualsize").addClass("active"),interaction_view.screenset.controlbarel.find("button.adaptive").removeClass("active")),recover_screen())},queryparse:function(e){return e.bg_color=_g.getUrlParameterByName("bg_color")?"#"+_g.getUrlParameterByName("bg_color"):e.bg_color,e.bg_opacity=_g.getUrlParameterByName("bg_opacity")?Number(_g.getUrlParameterByName("bg_opacity")):e.bg_opacity,e.screen_mode=_g.getUrlParameterByName("screen_mode")?Number(_g.getUrlParameterByName("screen_mode")):e.screen_mode,e.show_controlbar=_g.getUrlParameterByName("controlbar")?_g.string.string2boolean(_g.getUrlParameterByName("controlbar")):e.show_controlbar,e.controlbar_settings=_g.getUrlParameterByName("controlbar_settings")?JSON.parse(_g.getUrlParameterByName("controlbar_settings")):e.controlbar_settings,e},rendercontrolbar:function(){if(!t.values.show_controlbar)return;interaction_view.containment.append(_.template(e,t.values)),interaction_view.screenset.controlbarel=$("div.presentation-area"),interaction_view.screenset.controlbarel.find("[rel=tooltip]").tooltip()},adjustPatchforIE:function(e){var t=get_window_size();if(t.x/t.y<interaction_view.size.x/interaction_view.size.y){var n=(t.y-interaction_view.size.y*e)/2;$(".reveal").css({"margin-top":n})}else{var r=(t.x-interaction_view.size.x*e)/2;$(".reveal").css({"margin-left":r})}},adjustRevealPosition:function(e){var t=get_window_size(),n=typeof Reveal!="undefined"?Reveal.slideScreenWidth:interaction_view.size.x,r=typeof Reveal!="undefined"?Reveal.slideScreenHeight:interaction_view.size.y;if(t.x/t.y<interaction_view.size.x/interaction_view.size.y){if(window.useTransform)var i=(t.y-r)/2,s=(t.x-n)/2;else{var i;$.browser.mozilla?i=(t.y-r*e)/2:i=(t.y/e-r)/2;var s=0}$(".reveal").css({"margin-top":i}),$(".reveal").css({"margin-left":s})}else{if(window.useTransform)var s=(t.x-n)/2,i=(t.y-r)/2;else{var s;$.browser.mozilla?s=(t.x-n*e)/2:s=(t.x/e-n)/2;var i=0}$(".reveal").css({"margin-left":s}),$(".reveal").css({"margin-top":i})}},patchForIframe:function(){if(!$.zoom||$.zoom==1)return},patchForWeiXin:function(){navigator.userAgent.toLowerCase().match(/MicroMessenger/i)=="micromessenger"&&$(".reveal").css("transform","scale(1.005,1.005)")},adaptScreen:function(){},patchForMobileOrientation:function(){var e=interaction_view.doc.toJSON().vertical,t=interaction_view.doc.toJSON().horizontal,n=!1;if(!e&&!t)return!1;t?e||_g.device.portrait()&&(n=!0,$("body").children(".book_mask").length||$("body").append('<div class="book_mask"><img src="/staticfs/diazo/img/screendirectionlock.png"><div>请调整到适合屏幕阅读的方向</div></div>')):_g.device.landscape()&&(n=!0,$("body").children(".book_mask").length||$("body").append('<div class="book_mask"><img src="/staticfs/diazo/img/screendirectionlock.png"><div>请调整到适合屏幕阅读的方向</div></div>')),n||$("body").children(".book_mask").remove(),console.log(_g.device.portrait())}};return t});define("interaction_view/ui/touchinit",[],function(){var e={init:function(){interaction_view.iImgs={},interaction_view.share_page_id="first",interaction_view.wait=function(){$("#jswait-loading").hide(),$("body").append('<div class="mejs-overlay-button player-control-button" style="cursor:pointer;margin-top: -35px;position: absolute;top: 50%;left: 50%;width: 100px;height: 100px;margin: -50px 0 0 -50px;z-index: 1000001;background: url(http://qn.static.epub360.com/common/js/mediaelementjs/bigplay.svg);"></div>'),$(".player-control-button").on("click",function(){$("#jswait-loading").show(),$("div#epub360player-cover").remove(),$(".player-control-button").remove(),loading_progress_timer=setInterval(function(){compute_loadding_progress(),set_loading_progress()},200),interaction_view.start()})},interaction_view.start=function(){workEnd("-------- 1. touchinit 3 interaction_view.start start --------");var e=!1;if(_g.getUrlParameterByName("disableHistoryStart")==1||_g.getUrlParameterByName("disableHistoryStart")==null)e=!0;workEnd("-------- 1. touchinit 3 add style 1 --------"),interaction_view.ismobile&&$("body").addClass("ios"),workEnd("-------- 1. touchinit 3 add style 1 --------");var t=interaction_view.doc.get("play_mode");interaction_view.play_mode=t,interaction_view.screen_mode=interaction_view.doc.get("screen_mode"),interaction_view.events.init(),interaction_view.screenset.init(),interaction_view.screenset.render();var n=interaction_view.doc.toJSON();workEnd("-------- 1. touchinit 3 interaction_view.start 1 --------"),new _g.touchslide({body:interaction_view.forpreview?".interaction-preview":"window",width:interaction_view.size.x,height:interaction_view.size.y,containment:".reveal",keyboard:!interaction_view.ismobile,controls:!interaction_view.ismobile,mouseWheel:!interaction_view.ismobile&&n.desktop_mousewheel,progress:!interaction_view.ismobile,adapt:n.adapt,history:interaction_view.forpreview?!1:!0,disableHistoryStart:e,show_excontent:n.show_excontent,screen_mode:n.screen_mode,transition:n.switch_mode,overview:interaction_view.forpreview?!1:n.controlbar_settings.overview,show_overview:interaction_view.ismobile?!1:interaction_view.forpreview?!1:!0,show_controlbar:n.show_controlbar,smooth:n.smooth,onReady:function(e,t){workEnd("-------- 1. touchinit 3 interaction_view.start  _g.touchslide.onReady  start ------------"),interaction_view.screenset.patchForWeiXin(),window.Reveal=e,interaction_view.forpreview||adjust_screen(),interaction_view.playstatus="wait",interaction_view.currentPage=t;var n=require("interaction_view/view/master");interaction_view.imasterlist.length&&interaction_view.imasterlist.at(0).addView("iview",n),workEnd("-------- 1. touchinit 3 interaction_view.start  masterview ------------");var r=require("interaction_view/view/background");interaction_view.ibackgroundlist.length&&interaction_view.ibackgroundlist.at(0).addView("iview",r),presentation.startLoad(),interaction_view.ismobile&&(presentation.isFirstPageLoading=interaction_view.currentPage,presentation.pageLoad(interaction_view.currentPage))},onSlideChangeStart:function(e){interaction_view.ismobile&&!interaction_view.isWeixin&&presentation.preloadpageAudio(e)},onStopPlay:function(e){interaction_view.pausePlay(e)},onContinuePlay:function(e){interaction_view.continuePlay(e)},onSlideChange:function(e,t){var n=e;interaction_view.currentPage=e,pre_id=t,interaction_view.ismobile||interaction_view.moveMaster(pre_id,n),interaction_view.stopPlay(pre_id);var r=interaction_view.ipagelist.getPage(interaction_view.currentPage);r.get("loaded")&&interaction_view.imasterlist.at(0).get("loaded")&&interaction_view.ibackgroundlist.at(0).get("loaded")?(interaction_view.playstatus="play",interaction_view.containment.jswait("close"),interaction_view.containment.find("#jswait-loading").remove(),interaction_view.android?window.setTimeout(function(){interaction_view.play(n)},100):interaction_view.play(n)):(!interaction_view.containment.has("#jswait-loading").length>0&&interaction_view.containment.jswait(),interaction_view.playstatus="wait",r.isStartLoad||interaction_view.ipagelist.getPage(r.id)&&presentation.pageLoad(r.id)),interaction_view.ismobile&&(_g.device.android()?window.setTimeout(function(){workEnd("preload"),presentation.preloadFourDirections(),presentation.clearPreloadPages()},0):(presentation.preloadFourDirections(),presentation.clearPreloadPages()))},onKeyboard:function(){interaction_view.transitionPagePreLoad=null},onWheel:function(){interaction_view.transitionPagePreLoad=null},canDrag:function(e){return $(e.target).closest(".disableDragX").length!=0&&$(e.target).closest(".disableDragY").length!=0?!1:!0},canDragX:function(e){return $(e.target).closest(".disableDragX").length!=0?$(e.target).closest(".disableDragX").hasClass("is_exceededX")?!0:!1:!0},canDragY:function(e){return $(e.target).closest(".disableDragY").length!=0?$(e.target).closest(".disableDragY").hasClass("is_exceededY")?!0:!1:!0},checkSlidePermission:function(e,t,n,r,i){if(n=="left"){var s=e.getCurrentSlideId();return interaction_view.control.getLeft(s)?!0:!1}if(n=="right"){var s=e.getCurrentSlideId();return interaction_view.control.getRight(s)?!0:!1}return!0},getOverview:function(e){return interaction_view.ipagelist.getPage(e)?interaction_view.ipagelist.getPage(e).toJSON().nav?interaction_view.ipagelist.getPage(e).toJSON().nav.thumbnail:null:null}}),interaction_view.ismobile||(interaction_view.presentate=new $.presentate(!0))},interaction_view.init=function(){interaction_view.forpreview?interaction_view.containment=$(".interaction-preview"):interaction_view.containment=$("body"),presentation.forpreview(),presentation.screencontrol(),window.iPageDirection="landscape";var e=require("interaction_view/model/doc");interaction_view.doc=new e({id:"doc"});if(typeof cbt_data!="undefined"||typeof epub360_book_data!="undefined"){interaction_view.forpreview||(interaction_view.isPack=!0);var t;workEnd("-------- 1. touchinit 1 page list start --------"),typeof epub360_book_data!="undefined"?(t=interaction_view.doc.parse(epub360_book_data),workEnd("-------- 1.1 touchinit 1 page parse --------")):t=interaction_view.doc.parse(cbt_data),interaction_view.doc.set(t),workEnd("-------- 1. touchinit 2 page list ready --------"),_g.getUrlParameterByName("autoplay")=="false"?interaction_view.wait():interaction_view.start(),workEnd("-------- 1. touchinit 3 interaction_view.start end --------")}else interaction_view.doc.fetch({success:function(e,t){_g.getUrlParameterByName("autoplay")=="false"?interaction_view.wait():interaction_view.start()}})}}};return e});define("interaction_view/ui/application",["text!interaction_view/template/alertbox.js"],function(){var e=require("text!interaction_view/template/alertbox.js"),t={buttons:[],buttonGroups:[],initForm:function(e){interaction_view.application.buttons=[],interaction_view.application.buttonGroups=[],_.each(e.data,function(t){if(t.binding)if(_.include(["radio","checkboxes","dropdown"],t.field_type)){var n=[];_.each(t.binding,function(r,s){interaction_view.events.formEvents.push({overlay:r,func:function(n){interaction_view.application.setValue(e.id,t.cid,s,n),t.field_type!="checkboxes"&&interaction_view.application.execBindingButton(r)},i:t,cid:t.cid,key:s,id:e.id,bindSwitch:t.field_type!="checkboxes"}),n.push(r)}),t.field_type!="checkboxes"&&n.length>1&&interaction_view.application.buttonGroups.push({overlays:n})}else interaction_view.events.formEvents.push({overlay:t.binding,func:function(n){if(n&&t.field_type=="number"){n=Number(n);var r=interaction_view.application.validateNumber(n,t.field_options.min,t.field_options.max);r&&interaction_view.application.errorAlert(r)}interaction_view.application.setValue(e.id,t.cid,null,n)},i:t,cid:t.cid,id:e.id})})},getValue:function(e,t,n){var r=_.find(interaction_view.applications,function(t){return t.id==e}),i=_.find(r.data,function(e){return e.cid==t});return _.include(["radio","dropdown"],i.field_type)?n?n==i.value?1:0:i.value:_.include(["checkboxes"],i.field_type)?n&&i.value&&i.value.length?_.include(i.value,n):!1:i.value},setValue:function(e,t,n,r){var i=_.find(interaction_view.applications,function(t){return t.id==e});if(t=="submit")return interaction_view.application.submitForm(e),!1;i.data=_.map(i.data,function(e){return e.cid==t&&(_.include(["radio","dropdown"],e.field_type)?e.value=n:_.include(["checkboxes"],e.field_type)?(e.value||(e.value=[]),r?e.value=_.union(e.value,[n]):e.value=_.without(e.value,n)):e.value=r),e})},sendOverlayToButtonGroup:function(e){var t=e.createPath(),n=interaction_view.hashPath(t);_.include(_.pluck(interaction_view.application.buttons,"hash"),n)?interaction_view.application.buttons=_.map(interaction_view.application.buttons,function(t){return t.hash==n&&(t.overlay=e),t}):interaction_view.application.buttons.push({hash:n,overlay:e})},getHashs:function(e){var t=[];return _.each(e,function(e){t.push(interaction_view.hashPath(e.path)+e.id)}),t},execBindingButton:function(e){var t=interaction_view.hashPath(e.path)+e.id,n=[],r=_.find(interaction_view.application.buttonGroups,function(e){_.include(interaction_view.application.getHashs(e.overlays),t)&&_.each(e.overlays,function(e){interaction_view.hashPath(e.path)+e.id!=t&&n.push(e)})});n.length&&_.each(n,function(e){var t=interaction_view.hashPath(e.path)+e.id,n=_.find(interaction_view.application.buttons,function(e){return e.hash==t});n&&n.overlay.iview.resetButtonStatus()})},isBindingButton:function(e){var t=!1;return _.each(interaction_view.application.buttonGroups,function(n){_.include(interaction_view.application.getHashs(n.overlays),interaction_view.hashPath(e.createPath()))&&(t=!0)}),t},errorMsg:function(e,t,n,r){var i=_.find(interaction_view.applications,function(t){return t.id==e}),s=_.find(i.data,function(e){return e.cid==t});return n?s.label+(r||"中填写的数值不正确"):_.include(["radio","dropdown","checkboxes"],s.field_type)?"请选择"+s.label:s.label+(r||"不能为空")},errorAlert:function(t){if(!interaction_view.containment.children(".alert_mask").length){interaction_view.containment.append('<div class="alert_mask"></div>');var n=_.template(e,{text:t});interaction_view.containment.append(n),interaction_view.containment.find(".alert-confirm").on("click",function(){interaction_view.containment.find(".alert_mask").remove(),interaction_view.containment.find(".alert-box").remove()})}},submitForm:function(e){var t=_.find(interaction_view.applications,function(t){return t.id==e});if(!t)return!1;var n={},r=!0,i;_.each(t.data,function(t){n[t.cid]=t.value;if(t.field_type=="number"){var s=!1;if(n[t.cid]||_.isNumber(n[t.cid]))s=!0;t.field_options.integer_only&&_.isNumber(n[t.cid])&&(n[t.cid]=Math.round(n[t.cid]));if(!_.isNumber(n[t.cid])||_.isNaN(n[t.cid])){if(t.required||s)i||(i=interaction_view.application.errorMsg(e,t.cid,s?!0:!1)),r=!1}else{var o=interaction_view.application.validateNumber(n[t.cid],t.field_options.min,t.field_options.max);o&&(i=interaction_view.application.errorMsg(e,t.cid,!0,o),r=!1)}}else t.required&&!n[t.cid]&&(i||(i=interaction_view.application.errorMsg(e,t.cid)),r=!1)});if(!r){i&&interaction_view.application.errorAlert(i);return}var s="/form/"+t.app_id+"/?format=json";_g.ajax.post({traditional:!0,url:s,data:n,callback:function(n){var r=null;if(n.code==200)interaction_view.events.onFormSubmitEvent(70,t.id);else{var i=n.msg;if(_.keys(i).length){var s=_.keys(i)[0];r=interaction_view.application.errorMsg(e,s),interaction_view.application.errorAlert(r)}}}})},setFormData:function(e,t,n,r){var i=_.find(interaction_view.applications,function(t){return t.id==e});if(!i)return!1;n==3&&(r=null);var s={};_.each(i.data,function(e){if(e.cid==t){if(n==1||n==2){r=Number(r),e.value=Number(e.value);if(_.isNaN(r)||!_.isNumber(r))return!1;if(_.isNaN(e.value)||!_.isNumber(e.value))e.value=0}n==1?e.value+=r:n==2?e.value-=r:e.field_type=="number"?e.value=Number(r):e.value=r}})},validateNumber:function(e,t,n){if(_.isNaN(e)||!_.isNumber(e))return"请输入数字";var r=!1,i="取值范围:";t!=undefined&&(i=i+"大于"+t,e<=t&&(r=!0)),n!=undefined&&(i=i+"小于"+n,e>=n&&(r=!0));if(r)return i}};return t});define("interaction_view/ui/timeline",["interaction_view/model/base"],function(){interaction_view.timeline={render:function(e){if(!epub360.isV2&&!epub360.variable.isV2)return;e.timelines=[],e.iOverlaylist.each(function(t){var n=t.get("iAnis");if(n.length&&!t.iAnimationlist){t.iAnimationlist=new interaction_view.collection.Animation,t.iAnimationlist.pageid=e.id;var r=[];for(var t=0;t<n.length;t++){var i=$.extend(!0,{},n[t]);i.id=_g.uuid(4),i.iKind||(i.iKind=0),i.pageid=e.id,r.push(i)}t.iAnimationlist.reset(r),e.timelines.push(t.iAnimationlist)}})},setPlay:function(e){e.timelines&&e.timelines.length&&_.each(e.timelines,function(e){e.setParams(),e.setPlay()})},play:function(e){e.timelines&&e.timelines.length&&_.each(e.timelines,function(e){e.timeline.play(0,!1)})}}});(function(e){typeof define=="function"&&define.amd?define("coverFlow",["jquery"],e):e(jQuery)})(function(e){if(!e.ui||!e.Widget){e.ui=e.ui||{};var t=0,n=Array.prototype.slice;e.widget=function(t,n,r){var i,s,o,u,a={},f=t.split(".")[0];return t=t.split(".")[1],i=f+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[f]=e[f]||{},s=e[f][t],o=e[f][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n,u.options=e.widget.extend({},u.options),e.each(r,function(t,r){if(!e.isFunction(r)){a[t]=r;return}a[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},i=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;return this._super=e,this._superApply=i,s=r.apply(this,arguments),this._super=t,this._superApply=n,s}}()}),o.prototype=e.widget.extend(u,{widgetEventPrefix:s?u.widgetEventPrefix||t:t},a,{constructor:o,namespace:f,widgetName:t,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){var r=n.call(arguments,1),i=0,s=r.length,o,u;for(;i<s;i++)for(o in r[i])u=r[i][o],r[i].hasOwnProperty(o)&&u!==undefined&&(e.isPlainObject(u)?t[o]=e.isPlainObject(t[o])?e.widget.extend({},t[o],u):e.widget.extend({},u):t[o]=u);return t},e.widget.bridge=function(t,r){var i=r.prototype.widgetFullName||t;e.fn[t]=function(s){var o=typeof s=="string",u=n.call(arguments,1),a=this;return s=!o&&u.length?e.widget.extend.apply(null,[s].concat(u)):s,o?this.each(function(){var n,r=e.data(this,i);if(s==="instance")return a=r,!1;if(!r)return e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+s+"'");if(!e.isFunction(r[s])||s.charAt(0)==="_")return e.error("no such method '"+s+"' for "+t+" widget instance");n=r[s].apply(r,u);if(n!==r&&n!==undefined)return a=n&&n.jquery?a.pushStack(n.get()):n,!1}):this.each(function(){var t=e.data(this,i);t?(t.option(s||{}),t._init&&t._init()):e.data(this,i,new r(s,this))}),a}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(n,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=t++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),n),this.bindings=e(),r!==this&&(e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace)},_destroy:e.noop,widget:function(){return this.element},_on:function(t,n,r){var i,s=this;typeof t!="boolean"&&(r=n,n=t,t=!1),r?(n=i=e(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,i=this.widget()),e.each(r,function(r,o){function u(){if(!t&&(s.options.disabled===!0||e(this).hasClass("ui-state-disabled")))return;return(typeof o=="string"?s[o]:o).apply(s,arguments)}typeof o!="string"&&(u.guid=o.guid=o.guid||u.guid||e.guid++);var a=r.match(/^([\w:-]*)\s*(.*)$/),f=a[1]+s.eventNamespace,l=a[2];l?i.delegate(l,f,u):n.bind(f,u)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,n){t[n]=function(t){return Math.pow(t,e+2)}}),e.each(t,function(t,n){e.easing["easeIn"+t]=n,e.easing["easeOut"+t]=function(e){return 1-n(1-e)},e.easing["easeInOut"+t]=function(e){return e<.5?n(e*2)/2:1-n(e*-2+2)/2}})}()}(function(e,t,n,r){function i(e,t,n,r){var i=this;i.widget=e,i.element=t,i.items=n,i.options=r}function s(e){return parseFloat((.017453*e).toFixed(6))}function o(){e.coverflow.renderer.Classic.apply(this,arguments)}function u(e,t){return typeof e===t}function a(e,t){return!!~(""+e).indexOf(t)}function f(e,t){var n,i;for(n in e)if(i=e[n],!a(i,"-")&&C[i]!==r)return"pfx"===t?i:!0;return!1}function l(t,n,i){var s,o;for(s in t)if(o=n[t[s]],o!==r)return i===!1?t[s]:u(o,"function")?e.proxy(o,i||n):o;return!1}function c(e,t,n){var r=e.charAt(0).toUpperCase()+e.slice(1),i=(e+" "+L.join(r+" ")+r).split(" ");return u(t,"string")||u(t,"undefined")?f(i,t):(i=(e+" "+A.join(r+" ")+r).split(" "),l(i,t,n))}function h(e,t){var n;return function(){var r=this,i=arguments;n&&clearTimeout(n),n=setTimeout(function(){e.apply(r,i),n=null},t)}}e.coverflow={renderer:{},support:{}},i.prototype={cssClass:"classic",itemMargin:0,initialize:function(){var t=this,n=t.options,r={},i=t.items.eq(t.widget.currentIndex);t.itemSize=i.width(),t.outerWidth=t.element.parent().outerWidth(!1),t.itemMargin=-Math.floor(n.overlap/2*i.innerWidth()),t.items.css({marginLeft:t.itemMargin,marginRight:t.itemMargin}),r.width=t.items.width()*t.items.length,e.extend(r,t._getCenterPosition()),t.element.css(r)},_getCenterPosition:function(){var e,t=this,n=t.itemSize,r=t.widget.currentIndex;return e=(t.outerWidth-n)/2,e-=r*t.itemSize/2,e+=parseInt(t.element.css("paddingLeft"),10)||0,e-=r*t.itemMargin*2,e-=t.itemMargin,e=Math.round(e),{left:e}},select:function(){return this._getCenterPosition()},getElementTransitionStyles:function(t){var n=e.coverflow.transition[t.easing]||e.coverflow.transition.easeOutQuint;return e.extend(this._getCenterPosition(),{transition:"left "+t.duration+"ms "+n})},refresh:function(t,n,r){var i=this,s=i.options,o=i.items.length,u=i.itemSize,a=i.itemMargin;this.items.each(function(f){var l=f===r&&0>n-r||f-r>0?"left":"right",c=f===r?1-t:f===n?t:1,h={zIndex:o+("left"===l?r-f:f-r)+10},p=1-c*(1-s.scale),d=[p,c*("right"===l?-0.15:.15),0,p,0,0];h.left=-f*(u/2)+("right"===l?-u/2+u/2*s.overlap:u/2-u/2*s.overlap)*c,e.coverflow.isOldie&&(f===r?(h.left+=a,h.top=0):h.top=Math.ceil(-a/2)),i._transform(this,h,d),e(this).css(h)})},_transform:function(){var t=this;return e.coverflow.support.transform?void t._matrixTransform.apply(t,arguments):void (e.coverflow.isOldie&&t._fallbackTransform.apply(t,arguments))},_matrixTransform:function(e,t,n){t.transform="matrix("+n.join(",")+")"},_fallbackTransform:function(e,t,n){e.filters["DXImageTransform.Microsoft.Matrix"]||(e.style.filter=(e.style.filter?"":" ")+'progid:DXImageTransform.Microsoft.Matrix(sizingMethod="auto expand")');var r=e.filters["DXImageTransform.Microsoft.Matrix"];r.M11=n[0],r.M12=n[2],r.M21=n[1],r.M22=n[3]}},e.extend(e.coverflow.renderer,{Classic:i}),o.prototype={cssClass:"3d",initialize:function(){var t=this,n={};t.itemSize=t.items.eq(t.widget.currentIndex).outerWidth(!0),t.outerWidth=t.element.parent().outerWidth(!1),n.width=t.itemSize*t.items.length,e.extend(n,t._getCenterPosition(),t._getPerspectiveOrigin()),t.element.css(n)},getItemRenderedWidth:function(){var e=this.options;return Math.cos(s(e.angle))*this.itemSize*e.scale},_getPerspectiveOrigin:function(){var e=this,t=e.options;return{perspectiveOrigin:Math.round(e.itemSize/2+e.widget.currentIndex*e.getItemRenderedWidth()*(1-t.overlap))+"px "+t.perspectiveY+"%"}},_getCenterPosition:function(){var e,t=this,n=t.getItemRenderedWidth(),r=t.widget.currentIndex;return e=(t.outerWidth-t.itemSize)/2,e-=r*n,e+=r*n*t.options.overlap,e-=parseInt(t.element.css("paddingLeft"),10)||0,e=Math.round(e),{left:e}},select:function(){return e.extend({},this._getCenterPosition(),this._getPerspectiveOrigin())},getElementTransitionStyles:function(t){var n=this,r=e.coverflow.transition[t.easing]||e.coverflow.transition.easeOutQuint,i={transitionProperty:"left",transitionDuration:t.duration+"ms",transitionTimingFunction:r,transitionDelay:"initial"};return e.extend(i,n._getCenterPosition(),n._getPerspectiveOrigin())},refresh:function(t,n,r){var i=this,o=i.options,u=i.items.length,a=i.itemSize,f=i.getItemRenderedWidth();this.items.each(function(i){var l,c=i===r&&0>n-r||i-r>0?"left":"right",h=i===r?1-t:i===n?t:1,p={zIndex:u+("left"===c?r-i:i-r)+10},d=1-h*(1-o.scale),v="right"===c?o.angle:-o.angle;v=s(h*v),p.left=Math.round(-i*a+h*i*f*(1-o.overlap)+(1-h)*i*f*(1-o.overlap)),l=[(d*Math.cos(v)).toFixed(6),0,Math.sin(-v).toFixed(6),0,0,d,0,0,Math.sin(v).toFixed(6),0,(d*Math.cos(v)).toFixed(6),0,0,0,0,1],p.transform="matrix3d("+l.join(", ")+")",p.transformOrigin="right"===c?"left center":"right center",e(this).css(p)})}},e.extend(e.coverflow.renderer,{ThreeD:o});for(var p=n.createElement("div"),d=p.style,v=0,m=["ms","moz","webkit","o"],g=m.length,y="",b=0,w=e.coverflow.support,E=function(e){return e.charAt(0).toUpperCase()+e.slice(1)};g>b&&!t.requestAnimationFrame;b++)t.requestAnimationFrame=t[m[b]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[m[b]+"CancelAnimationFrame"]||t[m[b]+"CancelRequestAnimationFrame"];if(t.requestAnimationFrame||(t.requestAnimationFrame=function(e){var n=(new Date).getTime(),r=Math.max(0,16-(n-v)),i=t.setTimeout(function(){e(n+r)},r);return v=n+r,i}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(e){clearTimeout(e)}),e.each(m,function(e,t){return"ms"!==t&&(t=E(t)),!w.transform&&t+"Transform"in d&&(w.transform=t+"Transform"),!w.transition&&t+"Transition"in d&&(w.transition=t+"Transition"),w.transform&&w.transition?(y=t,!1):!0}),w.transform&&w.transition||(w.transform="transform"in d?"transform":!1,w.transition="transition"in d?"transition":!1),null==e.support.transform&&(e.support.transform=w.transform),null==e.support.transition&&(e.support.transition=w.transition),null==e.cssProps)throw new Error("Your jQuery version is too old. Please upgrade.");y&&e.each(["transitionProperty","transitionDuration","transitionTimingFunction","transitionDelay","perspectiveOrigin"],function(t,n){null==e.cssProps[n]&&(e.cssProps[n]=y+E(n))}),p=null;var S,x=n.documentElement,T="coverflowjsfeaturedetection",N=n.createElement(T),C=N.style,k="Webkit Moz O ms",L=k.split(" "),A=k.toLowerCase().split(" "),O=function(e,t,r,i){var s,o,u,a,f=n.createElement("div"),l=n.body,c=l||n.createElement("body");if(parseInt(r,10))for(;r--;)u=n.createElement("div"),u.id=i?i[r]:T+(r+1),f.appendChild(u);return s=["&#173;","<style id='s",T,"'>",e,"</style>"].join(""),f.id=T,(l?f:c).innerHTML+=s,c.appendChild(f),l||(c.style.background="",c.style.overflow="hidden",a=x.style.overflow,x.style.overflow="hidden",x.appendChild(c)),o=t(f,e),l?f.parentNode.removeChild(f):(c.parentNode.removeChild(c),x.style.overflow=a),!!o},M={}.hasOwnProperty;S=u(M,"undefined")||u(M.call,"undefined")?function(e,t){return t in e&&u(e.constructor.prototype[t],"undefined")}:function(e,t){return M.call(e,t)},e.coverflow.support.transform3d=function(){var e=!!c("perspective");return e&&"webkitPerspective"in x.style&&O("@media (transform-3d),(-webkit-transform-3d){#coverflowjsfeaturedetection{left:9px;position:absolute;height:3px;}}",function(t){e=9===t.offsetLeft&&3===t.offsetHeight}),e}(),null==e.support.transform3d&&(e.support.transform3d=e.coverflow.support.transform3d);var _={transition:"transitionend",MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",msTransition:"transitionend"},D=navigator.userAgent.toLowerCase(),P=function(){var e=/(msie) ([\w.]+)/.exec(D);return null!==e&&e[1]&&~~e[2]<10}();e.coverflow=e.extend(!0,{},e.coverflow,{isAndroid:/android/.test(D),isOldie:P,transition:{easeInQuad:"cubic-bezier( .55,.085,.68,.53 )",easeInCubic:"cubic-bezier( .550, .055, .675, .190 )",easeInQuart:"cubic-bezier( .895, .03, .685, .22 )",easeInQuint:"cubic-bezier( .755, .05, .855, .06 )",easeInSine:"cubic-bezier( .47, 0, .745, .715 )",easeInExpo:"cubic-bezier( .95, .05, .795, .035 )",easeInCirc:"cubic-bezier( .6, .04, .98, .335 )",easeInBack:"cubic-bezier( .6, -.28, .735, .045 )",easeOutQuad:"cubic-bezier( .25,.46,.45,.94 )",easeOutCubic:"cubic-bezier( .215,.61,.355,1 )",easeOutQuart:"cubic-bezier( .165, .84, .44, 1 )",easeOutQuint:"cubic-bezier( .23, 1, .32, 1 )",easeOutSine:"cubic-bezier( .39, .575, .565, 1 )",easeOutExpo:"cubic-bezier( .19,1,.22,1 )",easeOutCirc:"cubic-bezier( .075, .82, .165, 1 )",easeOutBack:"cubic-bezier( .175, .885, .32, 1.275 )",easeInOutQuad:"cubic-bezier( .455, .03, .515, .955 )",easeInOutCubic:"cubic-bezier( .645, .045, .355, 1 )",easeInOutQuart:"cubic-bezier( .77, 0, .175, 1 )",easeInOutQuint:"cubic-bezier( .86, 0, .07, 1 )",easeInOutSine:"cubic-bezier( .445, .05, .55, .95 )",easeInOutExpo:"cubic-bezier( 1, 0, 0, 1 )",easeInOutCirc:"cubic-bezier( .785, .135, .15, .86 )",easeInOutBack:"cubic-bezier( .68, -.55, .265, 1.55 )"},renderer:{}}),e.widget("ui.coverflow",{options:{items:"> *",active:0,duration:400,easing:"easeOutQuint",angle:45,perspectiveY:45,scale:.7,overlap:.3,trigger:{itemfocus:!1,itemclick:!0,mousewheel:!0}},isTicking:!1,_create:function(){var n,r,i=this,s=this.options,o=e.coverflow.support||{};i.elementOrigStyle=i.element.attr("style"),i.items=i.element.find(s.items).each(function(){var t=e(this);t.data({coverflowOrigElemAttr:{style:t.attr("style"),"class":t.attr("class"),tabIndex:t.attr("tabIndex")}})}).addClass("ui-coverflow-item"),i._setDimensions(),i.support=o,n=o.transform&&!P&&null==t.opera&&o.transform3d?e.coverflow.renderer.ThreeD:e.coverflow.renderer.Classic,r={angle:s.angle,perspectiveY:s.perspectiveY,scale:s.scale,overlap:s.overlap,itemSize:i.itemSize,outerWidth:i.outerWidth},i.renderer=new n(i,i.element,i.items,r),i.element.addClass("ui-coverflow ui-coverflow-"+i.renderer.cssClass+"-render").parent().addClass("ui-coverflow-wrapper ui-clearfix"),s.trigger.itemfocus&&this._bindFocus(),s.trigger.itemclick&&i.element.data("CoverFlowDisableClick",!1)&&i._on(i.items,{click:function(e){i.element.data("CoverFlowDisableClick")||i._select(e)}}),s.trigger.mousewheel&&i._on({mousewheel:i._onMouseWheel,DOMMouseScroll:i._onMouseWheel}),i.useJqueryAnimate=!o.transition||!e.isFunction(t.requestAnimationFrame),i.coverflowrafid=0},_bindFocus:function(){var e=this;e.items.prop("tabIndex",0),e._on(e.items,{focus:e._select})},_init:function(){var e=this,t=e.options;t.duration=~~t.duration,t.duration<1&&(t.duration=1),e.currentIndex=e._isValidIndex(t.active,!0)?t.active:0,e.activeItem=e.items.removeClass("ui-state-active").eq(e.currentIndex).addClass("ui-state-active"),e._setDimensions(),e.renderer.initialize(),e._refresh(1,e._getFrom(),e.currentIndex),e._trigger("beforeselect",null,e._ui()),e._trigger("select",null,e._ui())},_setDimensions:function(){var e=this;e.itemWidth=e.items.width(),e.itemHeight=e.items.height(),e.itemSize=e.items.outerWidth(!0),e.outerWidth=e.element.parent().outerWidth(!1)},_isValidIndex:function(e,t){return t=!!t,e=~~e,(this.currentIndex!==e||t)&&e>-1&&!!this.items.get(e)},_select:function(e){this.select(e.currentTarget)},next:function(){return this.select(this.currentIndex+1)},prev:function(){return this.select(this.currentIndex-1)},_getFrom:function(){var e=this;return Math.abs(e.previous-e.currentIndex)<=1?e.previousIndex:e.currentIndex+(e.previousIndex<e.currentIndex?-1:1)},select:function(n){var r,i=this,s=i.options,o=isNaN(parseInt(n,10))?i.items.index(n):parseInt(n,10);return i._isValidIndex(o)?!1===i._trigger("beforeselect",null,this._ui(i.items.eq(o),o))?!1:(i.isTicking&&(i.useJqueryAnimate?i.element.stop(!0,!1):(i.coverflowrafid&&t.cancelAnimationFrame(i.coverflowrafid),i.element.unbind(_[i.support.transition]))),i.isTicking=!0,i.previousIndex=i.currentIndex,s.active=i.currentIndex=o,r=e.extend({},i.renderer.select(),{coverflow:1}),i.useJqueryAnimate?i._animation(s,r):(s=e.extend({duration:s.duration,easing:s.easing},r),i._transition(s)),!0):!1},_animation:function(t,n){var r=this,i=this._getFrom();e.fx.step.coverflow=function(e){r._refresh(e.now,i,r.currentIndex)},r.element.animate(n,{duration:t.duration,easing:t.easing}).promise().done(function(){r._onAnimationEnd()})},_transition:function(n){var r=this,i=new Date,s=r._getFrom(),o=r.currentIndex,u={},a=function(){var e=((new Date).getTime()-i.getTime())/n.duration;e>1?r.isTicking=!1:r._refresh(e,s,o),r.isTicking&&(r.coverflowrafid=t.requestAnimationFrame(a))};e.isFunction(r.renderer.getElementTransitionStyles)&&(u=e.extend(u,r.renderer.getElementTransitionStyles(n))),r.element.one(_[r.support.transition],function(){r._refresh(1,s,o),r._onAnimationEnd()}).css(u),r.coverflowrafid=t.requestAnimationFrame(a)},_onAnimationEnd:function(){var e=this;e.coverflowrafid&&cancelAnimationFrame(e.coverflowrafid),e.isTicking=!1,e.activeItem=e.items.removeClass("ui-state-active").eq(e.currentIndex).addClass("ui-state-active"),e._trigger("select",null,e._ui())},_refresh:function(e,t,n){this.element.parent().scrollTop(0),this.renderer.refresh(e,t,n)},_ui:function(e,t){return{active:e||this.activeItem,index:null!=t?t:this.currentIndex}},_onMouseWheel:function(e){var t=e.originalEvent;return e.preventDefault(),t.wheelDelta>0||t.detail<0?void this.prev():void this.next()},_destroy:function(){var t=this;t.elementOrigStyle!==r?t.element.attr("style",this.elementOrigStyle):t.element.removeAttr("style"),t.element.removeClass("ui-coverflow ui-helper-clearfix ui-coverflow-"+(t.renderer.cssClass||"classic")+"-render").parent().removeClass("ui-coverflow-wrapper ui-clearfix"),t.items.removeClass("ui-coverflow-item ui-state-active").each(function(){var t=e(this),n=t.data("coverflowOrigElemAttr");e.each(n,function(e,n){n!==r?t.attr(e,n):t.removeAttr(e)}),t.data("coverflowOrigElemAttr",null)}),t._super()}})})(e,this,this.document)});define("interaction_view/mobilemain",["interaction_view/model/main","interaction_view/ui/main","interaction_view/ui/presentation","interaction_view/ui/control","interaction_view/ui/event","interaction_view/ui/environment","interaction_view/ui/mobilemedia","interaction_view/ui/eraser","interaction_view/ui/adapt","interaction_view/ui/analytics","interaction_view/ui/weixin","_g/touchslide2","_g/device","jquery.actual","interaction_view/ui/screenset","interaction_view/ui/touchinit","interaction_view/ui/application","interaction_view/ui/timeline","coverFlow"],function(){var e=require("interaction_view/ui/main");interaction_view.force3D=!1,interaction_view=$.extend({},interaction_view,e),interaction_view.weixin=require("interaction_view/ui/weixin"),interaction_view.control=require("interaction_view/ui/control"),interaction_view.events=require("interaction_view/ui/event"),interaction_view.environment=require("interaction_view/ui/environment"),interaction_view.media=require("interaction_view/ui/mobilemedia"),interaction_view.screenset=require("interaction_view/ui/screenset"),interaction_view.eraser=require("interaction_view/ui/eraser"),interaction_view.adapt=require("interaction_view/ui/adapt"),interaction_view.analytics=require("interaction_view/ui/analytics"),interaction_view.application=require("interaction_view/ui/application");if(_g.device.mobile()||_g.device.tablet())interaction_view.ismobile=!0;interaction_view.touchview=!0,interaction_view.android=_g.device.android(),interaction_view.isWeixin=_g.device.isWeixin(),interaction_view.touchinit=require("interaction_view/ui/touchinit"),workEnd("--------0 mobilemain touchinit.init --------"),interaction_view.touchinit.init()});require(["interaction_view/mobilemain","_g/base"],function(){_g.browserSupport({msie:8,chrome:1,safari:1,mozilla:1})?(interaction_view.init(),$(".return a").live("click",function(){var e=location.search,t={};if(e.indexOf("?")!=-1){var n=e.substr(1);strs=n.split("&");for(var r=0;r<strs.length;r++)t[strs[r].split("=")[0]]=unescape(strs[r].split("=")[1])}return t["from"]=="page"&&$(window.parent.document.getElementById("PreviewWindow")).remove(),!1})):_g.ajax.get({url:"index.json",callback:function(e){console.log(e);if(e.code==200&&e.data){var t=String(e.data.slave_url);t&&t.length?window.location.href=t:window.location.href="/staticfs/admin-epub360/browser-old.html"}else window.location.href="/staticfs/admin-epub360/browser-old.html"}})}),define("diazo/js/app/main/interaction/mobileview",function(){}),define("/Users/blues/projects/epub360/1-src/epub360-built/html/diazo/js/app/main/interaction/mobileview.js",function(){})